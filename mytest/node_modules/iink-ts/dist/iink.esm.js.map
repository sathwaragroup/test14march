{"version":3,"file":"iink.esm.js","sources":["../src/Constants.ts","../src/logger/logger.ts","../src/logger/LoggerManager.ts","../src/utils/DeferredPromise.ts","../src/utils/math.ts","../src/utils/geometry.ts","../src/utils/version.ts","../src/utils/crypto.ts","../src/utils/units.ts","../src/utils/uuid.ts","../src/utils/merge.ts","../src/utils/font.ts","../src/utils/language.ts","../src/utils/quadratics.ts","../src/configuration/GrabberConfiguration.ts","../src/configuration/MenuConfiguration.ts","../src/configuration/recognition/EraserConfiguration.ts","../src/configuration/recognition/DiagramConfiguration.ts","../src/configuration/recognition/ExportConfiguration.ts","../src/configuration/recognition/MarginConfiguration.ts","../src/configuration/recognition/MathConfiguration.ts","../src/configuration/recognition/RawContentConfiguration.ts","../src/configuration/recognition/RecognitionRendererConfiguration.ts","../src/configuration/recognition/TextConfiguration.ts","../src/configuration/recognition/ConvertionConfiguration.ts","../src/configuration/RecognitionConfiguration.ts","../src/configuration/RenderingConfiguration.ts","../src/configuration/ServerConfiguration.ts","../src/configuration/TriggerConfiguration.ts","../src/configuration/UndoRedoConfiguration.ts","../src/configuration/Configuration.ts","../src/configuration/LoggerConfiguration.ts","../src/event/InternalEvent.ts","../src/event/PublicEvent.ts","../src/model/Export.ts","../src/primitive/OIDecorator.ts","../src/grabber/OIPointerEventGrabber.ts","../src/grabber/PointerEventGrabber.ts","../src/primitive/Box.ts","../src/style/Style.ts","../src/style/PenStyle.ts","../src/style/Theme.ts","../node_modules/json-css/lib/jsoncss.min.js","../src/style/StyleHelper.ts","../src/primitive/Symbol.ts","../src/primitive/OIEdge.ts","../src/primitive/OIShape.ts","../src/style/StyleManager.ts","../src/transform/Matrix.ts","../src/primitive/OISymbolBase.ts","../src/primitive/Point.ts","../src/primitive/OIEdgeArc.ts","../src/primitive/OIEdgeLine.ts","../src/primitive/OIEdgePolyLine.ts","../src/primitive/OIShapeEllipse.ts","../src/primitive/OIShapeCircle.ts","../src/primitive/OIShapePolygon.ts","../src/primitive/OIStroke.ts","../src/primitive/OISymbolGroup.ts","../src/primitive/OIText.ts","../src/primitive/OIEraser.ts","../src/primitive/Stroke.ts","../src/recognizer/RecognizerError.ts","../src/recognizer/OIRecognizerMessage.ts","../src/model/Model.ts","../src/model/OIModel.ts","../src/recognizer/OIRecognizer.ts","../src/recognizer/RestRecognizer.ts","../src/recognizer/WSRecognizer.ts","../src/renderer/canvas/CanvasRendererShape.ts","../src/renderer/canvas/CanvasRendererStroke.ts","../src/renderer/canvas/CanvasRendererText.ts","../src/renderer/canvas/CanvasRenderer.ts","../src/renderer/svg/OISVGRendererConst.ts","../src/renderer/svg/SVGBuilder.ts","../src/renderer/svg/OISVGRendererEdgeUtil.ts","../src/renderer/svg/OISVGRendererEraserUtil.ts","../src/renderer/svg/OISVGRendererDecoratorUtil.ts","../src/renderer/svg/OISVGRendererShapeUtil.ts","../src/renderer/svg/OISVGRendererStrokeUtil.ts","../src/renderer/svg/OISVGRendererTextUtil.ts","../src/renderer/svg/OISVGRendererGroupUtil.ts","../src/gesture/Gesture.ts","../src/renderer/svg/OISVGRenderer.ts","../src/renderer/svg/SVGStroker.ts","../src/renderer/svg/WSSVGRenderer.ts","../src/manager/OIConversionManager.ts","../src/manager/OIGestureManager.ts","../src/manager/OIResizeManager.ts","../src/manager/OIRotationManager.ts","../src/manager/OISelectionManager.ts","../src/manager/OISnapManager.ts","../src/manager/OITextManager.ts","../src/manager/OITranslateManager.ts","../src/manager/OIWriteManager.ts","../src/manager/OIEraseManager.ts","../src/manager/OIDebugSVGManager.ts","../src/menu/OIMenu.ts","../src/menu/OIMenuSub.ts","../src/menu/OIMenuAction.ts","../src/menu/OIMenuIntention.ts","../src/menu/OIMenuStyle.ts","../src/menu/OIMenuContext.ts","../src/manager/OIMenuManager.ts","../src/manager/OIMoveManager.ts","../src/history/UndoRedoContext.ts","../src/history/HistoryManager.ts","../src/history/OIHistoryManager.ts","../src/behaviors/OIBehaviors.ts","../src/behaviors/RestBehaviors.ts","../src/behaviors/WSBehaviors.ts","../src/smartguide/SmartGuide.ts","../src/Editor.ts"],"sourcesContent":["/**\n * @group Editor\n * @description List the possibilities of interactions\n */\nexport enum Intention\n{\n  Write = \"write\",\n  Erase = \"erase\",\n  /**\n   * @remarks only usable in the case of offscreen\n   */\n  Select = \"select\",\n  /**\n   * @remarks only usable in the case of offscreen\n   */\n  Move = \"move\"\n}\n\n/**\n * @group Editor\n * @description List all the shapes that can be drawn\n * @remarks only usable in the case of offscreen\n */\nexport enum WriteTool\n{\n  Pencil = \"pencil\",\n  Rectangle = \"rectangle\",\n  Rhombus = \"rhombus\",\n  Circle = \"circle\",\n  Ellipse = \"ellipse\",\n  Triangle = \"triangle\",\n  Parallelogram = \"parallelogram\",\n  Line = \"line\",\n  Arrow = \"arrow\",\n  DoubleArrow = \"double-arrow\",\n}\n\n/**\n * @group Renderer\n * @description List all svg elements roles\n * @remarks only usable in the case of offscreen\n */\nexport enum SvgElementRole\n{\n  Guide = \"guide\",\n  InteractElementsGroup = \"interact-elements-group\",\n  Translate = \"translate\",\n  Resize = \"resize\",\n  Rotate = \"rotate\",\n}\n\n/**\n * @group Renderer\n * @description List all svg elements resize direction\n * @remarks only usable in the case of offscreen\n */\nexport const enum ResizeDirection\n{\n  North = \"n-resize\",\n  East = \"e-resize\",\n  South = \"s-resize\",\n  West = \"w-resize\",\n  NorthEast = \"ne-resize\",\n  NorthWest = \"nw-resize\",\n  SouthEast = \"se-resize\",\n  SouthWest = \"sw-resize\"\n}\n\n/**\n * @group Renderer\n */\nexport const SELECTION_MARGIN = 10 as const\n","/**\n * @group Logger\n */\nexport enum LoggerLevel\n{\n  DEBUG = \"1\",\n  INFO = \"2\",\n  WARN = \"3\",\n  ERROR = \"4\"\n}\n\n/**\n * @group Logger\n */\nexport enum LoggerClass\n{\n  EDITOR = \"EDITOR\",\n  RECOGNIZER = \"RECOGNIZER\",\n  GRABBER = \"GRABBER\",\n  BEHAVIORS = \"BEHAVIORS\",\n  GESTURE = \"GESTURE\",\n  CONFIGURATION = \"CONFIGURATION\",\n  PUBLIC_EVENT = \"PUBLIC_EVENT\",\n  MODEL = \"MODEL\",\n  RENDERER = \"RENDERER\",\n  SMARTGUIDE = \"SMARTGUIDE\",\n  STYLE = \"STYLE\",\n  HISTORY = \"HISTORY\",\n  SYMBOL = \"SYMBOL\",\n  INTERNAL_EVENT = \"INTERNAL_EVENT\",\n  WRITE = \"WRITE\",\n  TRANSFORMER = \"TRANSFORMER\",\n  CONVERTER = \"CONVERTER\",\n  SELECTION = \"SELECTION\",\n  SVGDEBUG = \"SVGDEBUG\",\n  MENU = \"MENU\"\n}\n\n/**\n * @group Logger\n */\nexport class Logger\n{\n  instanceName: LoggerClass\n  level: LoggerLevel\n\n  constructor(instanceName: LoggerClass, level: LoggerLevel)\n  {\n    this.instanceName = instanceName\n    this.level = level\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  debug(functionName: string, ...data: any)\n  {\n    if (LoggerLevel.DEBUG >= this.level) {\n      const dataLog = {\n        from: `${this.instanceName}.${functionName}`,\n        message: data,\n      }\n      console.debug(dataLog)\n    }\n  }\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  info(functionName: string, ...data: any)\n  {\n    if (LoggerLevel.INFO >= this.level) {\n      const dataLog = {\n        from: `${this.instanceName}.${functionName}`,\n        message: data,\n      }\n      console.info(dataLog)\n    }\n  }\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  warn(functionName: string, ...data: any)\n  {\n    if (LoggerLevel.WARN >= this.level) {\n      const dataLog = {\n        from: `${this.instanceName}.${functionName}`,\n        message: data,\n      }\n      console.warn(dataLog)\n    }\n  }\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  error(functionName: string, ...error: any)\n  {\n    const dataLog = {\n      from: `${this.instanceName}.${functionName}`,\n      error,\n    }\n    console.error(dataLog)\n  }\n}\n","import { TLoggerConfiguration } from \"../configuration\"\nimport { Logger, LoggerClass, LoggerLevel } from \"./logger\"\n\n/**\n * @group Logger\n */\nexport class LoggerManager\n{\n  static #loggerMap: Map<LoggerClass, Logger> = new Map()\n\n  static getLogger(name: LoggerClass): Logger\n  {\n    if (!this.#loggerMap.has(name)) {\n      this.#loggerMap.set(name, new Logger(name, LoggerLevel.ERROR))\n    }\n    return this.#loggerMap.get(name) as Logger\n  }\n\n  static setLoggerLevel(config: TLoggerConfiguration)\n  {\n    Object.keys(config).forEach((lc) =>\n    {\n      LoggerManager.getLogger(lc as LoggerClass).level = config[lc as LoggerClass]\n    })\n  }\n}\n","\n/**\n * @group Utils\n */\nexport class DeferredPromise<T> {\n  promise: Promise<T>\n  resolve!: (value: T) => void\n  reject!: (value: Error | string) => void\n\n  isFullFilled: boolean\n  isPending: boolean\n\n\n  constructor()\n  {\n    this.isFullFilled = false\n    this.isPending = true\n\n    this.promise = new Promise((resolve, reject) =>\n    {\n      this.reject = async (v: unknown) =>\n      {\n        this.isFullFilled = true\n        this.isPending = false\n        return reject(v)\n      }\n      this.resolve = async (v: unknown) =>\n      {\n        this.isFullFilled = true\n        this.isPending = false\n        return resolve(v as T)\n      }\n    })\n  }\n}\n","/**\n * @group Utils\n */\nexport function isValidNumber(x: unknown): boolean\n{\n  if (x === undefined || x === null) return false\n  return !isNaN(parseFloat(x.toString())) && isFinite(+x)\n}\n/**\n * @group Utils\n */\nexport function isBetween(val: number, min: number, max: number): boolean\n{\n  return val >= min && val <= max\n}\n\n/**\n * @group Utils\n */\nexport function computeAverage(arr: number[]): number\n{\n  return arr.reduce((p, c) => p + c, 0) / (arr.length || 1)\n}\n","import { TBoundingBox, TPoint, TSegment } from \"../primitive\"\nimport { isBetween } from \"./math\"\n\n/**\n * @group Utils\n */\nexport function computeDistance(p1: TPoint, p2: TPoint): number\n{\n  const distance = Math.hypot(p2.y - p1.y, p2.x - p1.x)\n  return isNaN(distance) ? 0 : distance\n}\n\n/**\n * @group Utils\n */\nexport function computeAngleAxeRadian(begin: TPoint, end: TPoint): number\n{\n  return Math.atan2(end.y - begin.y, end.x - begin.x)\n}\n\n/**\n * @group Utils\n */\nexport function createPointsOnSegment(p1: TPoint, p2: TPoint, spaceBetweenPoint = 1): TPoint[]\n{\n  const points: TPoint[] = []\n  const globalDistance = computeDistance(p1, p2)\n  let spaceWithP1 = spaceBetweenPoint\n  while (spaceWithP1 < globalDistance) {\n    const p = {\n      x: p1.x + (spaceWithP1 * (p2.x - p1.x)) / globalDistance,\n      y: p1.y + (spaceWithP1 * (p2.y - p1.y)) / globalDistance\n    }\n    points.push(p)\n    spaceWithP1 += spaceBetweenPoint\n  }\n  return points\n}\n\n/**\n * @group Utils\n */\nexport function scalaire(v1: TPoint, v2: TPoint): number\n{\n  return v1.x * v2.x + v1.y * v2.y\n}\n\n/**\n * @group Utils\n */\nexport function computeNearestPointOnSegment(p: TPoint, seg: TSegment): TPoint\n{\n  const vectP1P = { x: p.x - seg.p1.x, y: p.y - seg.p1.y }\n  const vectP1P2 = { x: seg.p2.x - seg.p1.x, y: seg.p2.y - seg.p1.y }\n  if (vectP1P2.x === 0 && vectP1P2.y === 0) {\n    return seg.p1\n  }\n  const scalaireP1P_P1P2 = scalaire(vectP1P, vectP1P2)\n  const scalaireP1P2_P1P2 = scalaire(vectP1P2, vectP1P2)\n\n  const t = Math.min(1, Math.max(0, scalaireP1P_P1P2 / scalaireP1P2_P1P2))\n  return { x: seg.p1.x + (vectP1P2.x * t), y: seg.p1.y + (vectP1P2.y * t) }\n}\n\n/**\n * @group Utils\n */\nexport function isPointInsideBox(point: TPoint, box: TBoundingBox): boolean\n{\n  return isBetween(point.x, box.x, box.x + box.width) && isBetween(point.y, box.y, box.y + box.height)\n}\n\n/**\n * @group Utils\n */\nexport function convertRadianToDegree(radian: number): number\n{\n  return +((radian % (2 * Math.PI)) / Math.PI * 180).toFixed(4)\n}\n\n/**\n * @group Utils\n */\nexport function convertDegreeToRadian(degree: number): number\n{\n  return +((degree % 360) / 180 * Math.PI).toFixed(4)\n}\n\n/**\n * @group Utils\n */\nexport function computeRotatedPoint(point: TPoint, center: TPoint, radian: number): TPoint\n{\n  const dx = point.x - center.x\n  const dy = point.y - center.y\n  const cos = Math.cos(radian)\n  const sin = Math.sin(radian)\n  return {\n    x: +(center.x + cos * dx - sin * dy).toFixed(3),\n    y: +(center.y + sin * dx + cos * dy).toFixed(3)\n  }\n}\n\n/**\n * @group Utils\n */\nexport function computePointOnEllipse(center: TPoint, radiusX: number, radiusY: number, phi: number, theta: number): TPoint\n{\n  const cosPhi = Math.cos(phi)\n  const sinPhi = Math.sin(phi)\n\n  const M = Math.abs(radiusX) * Math.cos(theta)\n  const N = Math.abs(radiusY) * Math.sin(theta)\n\n  return {\n    x: +(center.x + cosPhi * M - sinPhi * N).toFixed(3),\n    y: +(center.y + sinPhi * M + cosPhi * N).toFixed(3)\n  }\n}\n\n/**\n * @group Utils\n */\nexport function computeDistanceBetweenPointAndSegment(p: TPoint, seg: TSegment): number\n{\n  return computeDistance(p, computeNearestPointOnSegment(p, seg))\n}\n\n/**\n * @group Utils\n */\nexport function findIntersectionBetween2Segment(seg1: TSegment, seg2: TSegment): TPoint | undefined\n{\n\n  if (seg1.p1.x === seg2.p1.x && seg1.p1.y === seg2.p1.y) return seg1.p1\n  if (seg1.p1.x === seg2.p2.x && seg1.p1.y === seg2.p2.y) return seg1.p1\n\n  if (seg1.p2.x === seg2.p1.x && seg1.p2.y === seg2.p1.y) return seg1.p2\n  if (seg1.p2.x === seg2.p2.x && seg1.p2.y === seg2.p2.y) return seg1.p2\n\n  const S1dx = seg1.p2.x - seg1.p1.x\n  const S1dy = seg1.p2.y - seg1.p1.y\n\n  const S2dx = seg2.p2.x - seg2.p1.x\n  const S2dy = seg2.p2.y - seg2.p1.y\n\n  const S1S2dx = seg1.p1.x - seg2.p1.x\n  const S1S2dy = seg1.p1.y - seg2.p1.y\n\n  const ua_t = S2dx * S1S2dy - S2dy * S1S2dx\n  const ub_t = S1dx * S1S2dy - S1dy * S1S2dx\n  const u_b = S2dy * S1dx - S2dx * S1dy\n\n  if (ua_t === 0 || ub_t === 0 || u_b === 0) return\n\n  const ua = ua_t / u_b\n  const ub = ub_t / u_b\n  if (isBetween(ua, 0, 1) && isBetween(ub, 0, 1)) {\n    return {\n      x: seg1.p1.x + ua * S1dx,\n      y: seg1.p1.y + ua * S1dy\n    }\n  }\n  return\n}\n\n/**\n * @group Utils\n */\nexport function findIntersectBetweenSegmentAndCircle(seg: TSegment, c: TPoint, r: number): TPoint[]\n{\n  const result: TPoint[] = []\n\n  const a = Math.pow(seg.p2.x - seg.p1.x, 2) + Math.pow(seg.p2.y - seg.p1.y, 2)\n  const b = 2 * ((seg.p2.x - seg.p1.x) * (seg.p1.x - c.x) + (seg.p2.y - seg.p1.y) * (seg.p1.y - c.y))\n  const cc = Math.pow(c.x, 2) + Math.pow(c.y, 2) + Math.pow(seg.p1.x, 2) + Math.pow(seg.p1.y, 2) - 2 * (c.x * seg.p1.x + c.y * seg.p1.y) - Math.pow(r, 2)\n  const deter = Math.pow(b, 2) - 4 * a * cc\n\n  if (deter <= 0) return []\n\n  const e = Math.sqrt(deter)\n  const u1 = (-b + e) / (2 * a)\n  const u2 = (-b - e) / (2 * a)\n\n  if ((u1 < 0 || u1 > 1) && (u2 < 0 || u2 > 1)) {\n    return result\n  }\n\n  if (isBetween(u1, 0, 1)) {\n    result.push({\n      x: (seg.p2.x - seg.p1.x) * u1 + seg.p1.x,\n      y: (seg.p2.y - seg.p1.y) * u1 + seg.p1.y\n    })\n  }\n\n  if (isBetween(u2, 0, 1)) {\n    result.push({\n      x: (seg.p2.x - seg.p1.x) * u2 + seg.p1.x,\n      y: (seg.p2.y - seg.p1.y) * u2 + seg.p1.y\n    })\n  }\n\n  return result\n}\n\n/**\n * @group Utils\n */\nexport function computeAngleRadian(p1: TPoint, center: TPoint, p2: TPoint): number\n{\n  const p1c = Math.sqrt(Math.pow(center.x - p1.x, 2) + Math.pow(center.y - p1.y, 2))\n  const p2c = Math.sqrt(Math.pow(center.x - p2.x, 2) + Math.pow(center.y - p2.y, 2))\n  const p1p2 = Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2))\n  return Math.acos((p2c * p2c + p1c * p1c - p1p2 * p1p2) / (2 * p2c * p1c))\n}\n\n/**\n * @group Utils\n */\nexport function getClosestPoints(points1: TPoint[], points2: TPoint[]): { p1: TPoint, p2: TPoint }\n{\n  let p1 = points1[0]\n  let p2 = points2[0]\n  let minDistance = Number.MAX_SAFE_INTEGER\n  points1.forEach(_p1 =>\n  {\n    points2.forEach(_p2 =>\n    {\n      const d = computeDistance(_p1, _p2)\n      if (minDistance > d) {\n        minDistance = d\n        p1 = _p1\n        p2 = _p2\n      }\n    })\n  })\n  return { p1, p2 }\n}\n\n/**\n * @group Utils\n */\nexport function getClosestPoint(points: TPoint[], point: TPoint): { point?: TPoint, index: number }\n{\n  let minDistance = Number.MAX_SAFE_INTEGER\n  let closest: TPoint | undefined\n  let index = -1\n  points.forEach((p, i) =>\n  {\n    const d = computeDistance(p, point)\n    if (minDistance > d) {\n      minDistance = d\n      closest = p\n      index = i\n    }\n  })\n  return {\n    point: closest,\n    index\n  }\n}\n\n/**\n * @group Utils\n */\nexport function isPointInsidePolygon(point: TPoint, points: TPoint[])\n{\n  let inside = false\n  for (let i = 0, j = points.length - 1; i < points.length; j = i++) {\n    const p1 = points[i]\n    const p2 = points[j]\n    const intersect = ((p1.y > point.y) != (p2.y > point.y))\n      && (point.x < (p2.x - p1.x) * (point.y - p1.y) / (p2.y - p1.y) + p1.x)\n    if (intersect) inside = !inside\n  }\n\n  return inside\n}\n","\n/**\n * @group Utils\n */\nexport const isVersionSuperiorOrEqual = (source: string, target: string): boolean =>\n{\n  const sourceParts = source.split(\".\")\n  const targetParts = target.split(\".\")\n\n  for (let i = 0; i < targetParts.length; i++) {\n    const a = Number(targetParts[i])\n    const b = Number(sourceParts[i])\n    if (a > b) return false\n    if (a < b) return true\n  }\n  return true\n}\n","/**\n * @group Utils\n */\nexport async function computeHmac(message: string, applicationKey: string, hmacKey: string): Promise<string>\n{\n  const enc = new TextEncoder()\n  const messageEncoded = enc.encode(message)\n  const keyEncoded = enc.encode(applicationKey + hmacKey)\n\n  const key = await crypto.subtle.importKey(\n    \"raw\",\n    keyEncoded,\n    {\n      name: \"HMAC\",\n      hash: { name: \"SHA-512\" }\n    },\n    false,\n    [\"sign\"]\n  )\n\n  const signature = await crypto.subtle.sign(\n    \"HMAC\",\n    key,\n    messageEncoded\n  )\n\n  const buffer = new Uint8Array(signature)\n  return Array.prototype.map.call(buffer, x => x.toString(16).padStart(2, \"0\")).join(\"\")\n}\n","import { TBoundingBox } from \"../primitive\"\n\n/**\n * @group Utils\n */\nexport function convertMillimeterToPixel(mm: number): number\n{\n  return +(mm * 96 / 25.4).toFixed(3)\n}\n\n/**\n * @group Utils\n */\nexport function convertPixelToMillimeter(px: number): number\n{\n  return +(px / 96 * 25.4).toFixed(3)\n}\n\n/**\n * @group Utils\n */\nexport function convertBoundingBoxMillimeterToPixel(box?: TBoundingBox): TBoundingBox\n{\n  if (!box) {\n    return { height: 0, width: 0, x: 0, y: 0}\n  }\n  return {\n    x: convertMillimeterToPixel(box.x),\n    y: convertMillimeterToPixel(box.y),\n    width: convertMillimeterToPixel(box.width),\n    height: convertMillimeterToPixel(box.height),\n  }\n}\n","\n/**\n * @group Utils\n */\nexport function createUUID(): string\n{\n  let dt = Date.now()\n  const uuid = \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function (c)\n  {\n    const r = (dt + Math.random() * 16) % 16 | 0\n    dt = Math.floor(dt / 16)\n    return (c == \"x\" ? r : (r & 0x3 | 0x8)).toString(16)\n  })\n  return uuid\n}\n","\n/**\n * @group Utils\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const mergeDeep = (target: any, ...sources: any[]): any =>\n{\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const isObject = (item: any) =>\n  {\n    return (item && typeof item === \"object\" && !Array.isArray(item))\n  }\n  if (!sources.length) return target\n  const source = sources.shift()\n\n  if (isObject(target) && isObject(source)) {\n    for (const key in source) {\n      if (isObject(source[key])) {\n        if (!target[key]) {\n          Object.assign(target, { [key]: {} })\n        }\n        mergeDeep(target[key], source[key])\n      }\n      else if (Array.isArray(target[key]) && Array.isArray(source[key])) {\n        target[key].concat(source[key])\n      }\n      else {\n        Object.assign(target, { [key]: source[key] })\n      }\n    }\n  }\n  else if (Array.isArray(target) && Array.isArray(source)) {\n    target = target.concat(source)\n  }\n  else if (source) {\n    target = source\n  }\n\n  return mergeDeep(target, ...sources)\n}\n","import { TConfiguration } from \"../configuration\"\nimport { PartialDeep } from \"./types\"\n\n/**\n * @group Utils\n */\nexport async function getAvailableFontList(configuration: PartialDeep<TConfiguration>): Promise<Array<string>>\n{\n  if (!configuration?.server?.scheme && !configuration?.server?.host) {\n    return Promise.reject(\"Failed to get fonts: configuration.server.scheme & configuration.server.host are required!\")\n  }\n  if (!configuration?.recognition?.lang) {\n    return Promise.reject(\"Failed to get fonts: configuration.recognition.lang is required!\")\n  }\n  const serverConfig = configuration.server\n  const response = await fetch(`${ serverConfig.scheme }://${ serverConfig.host }/api/v4.0/iink/font/google/language/` + configuration.recognition.lang)\n  const { result } = await response.json()\n  return result.sort()\n}\n","import { TConfiguration } from \"../configuration\"\nimport { PartialDeep } from \"./types\"\n\n/**\n * @group Utils\n */\nexport async function getAvailableLanguageList(configuration: PartialDeep<TConfiguration>): Promise<{ result: { [key: string]: string } }>\n{\n  if (configuration?.server?.scheme && configuration?.server?.host) {\n    const serverConfig = configuration.server\n    const response = await fetch(`${ serverConfig.scheme }://${ serverConfig.host }/api/v4.0/iink/availableLanguageList`)\n    return response.json()\n  } else {\n    return Promise.reject(\"Failed to get languages: configuration.server.scheme & configuration.server.host are required!\")\n  }\n}\n","import { TPoint, TPointer } from \"../primitive\"\n\n/**\n * @group Utils\n */\nexport function computeLinksPointers(point: TPointer, angle: number, width: number): TPoint[]\n{\n  const radius = point.p * width\n  return [\n    {\n      x: +(point.x - (Math.sin(angle) * radius)).toFixed(3),\n      y: +(point.y + (Math.cos(angle) * radius)).toFixed(3)\n    },\n    {\n      x: +(point.x + (Math.sin(angle) * radius)).toFixed(3),\n      y: +(point.y - (Math.cos(angle) * radius)).toFixed(3),\n    }\n  ]\n}\n\n/**\n * @group Utils\n */\nexport function computeMiddlePointer(point1: TPointer, point2: TPointer): TPointer\n{\n  return {\n    x: +((point2.x + point1.x) / 2).toFixed(3),\n    y: +((point2.y + point1.y) / 2).toFixed(3),\n    p: +((point2.p + point1.p) / 2).toFixed(3),\n    t: +((point2.t + point1.t) / 2).toFixed(3),\n  }\n}\n","\n/**\n * @group Configuration\n */\nexport type TListenerConfiguration = {\n  capture: boolean\n  passive: boolean\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultListenerConfiguration: TListenerConfiguration = {\n  capture: false,\n  passive: true\n}\n\n\n/**\n * @group Configuration\n */\nexport type TGrabberConfiguration = {\n  listenerOptions: TListenerConfiguration\n  xyFloatPrecision: number\n  timestampFloatPrecision: number\n  delayLongTouch: number\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultGrabberConfiguration: TGrabberConfiguration = {\n  listenerOptions: DefaultListenerConfiguration,\n  xyFloatPrecision: 0,\n  timestampFloatPrecision: 0,\n  delayLongTouch: 500\n}\n","\n/**\n * @group Configuration\n * @remarks only usable in the case of offscreen\n */\nexport type TMenuConfiguration = {\n  enable: boolean,\n  style: {\n    enable: boolean,\n  }\n  intention: {\n    enable: boolean,\n  }\n  action: {\n    enable: boolean,\n  }\n  context: {\n    enable: boolean,\n  }\n}\n\n/**\n * @group Configuration\n * @remarks only usable in the case of offscreen\n */\nexport const DefaultMenuConfiguration: TMenuConfiguration = {\n  enable: true,\n  style: {\n    enable: true\n  },\n  intention: {\n    enable: true\n  },\n  action: {\n    enable: true\n  },\n  context: {\n    enable: true\n  },\n}\n","\n/**\n * @group Configuration\n */\nexport type TEraserConfiguration = {\n  \"erase-precisely\": boolean\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultEraserConfiguration: TEraserConfiguration = {\n  \"erase-precisely\": false\n}\n","\nimport { DefaultEraserConfiguration, TEraserConfiguration } from \"./EraserConfiguration\"\nimport { TTextConfConfiguration } from \"./TextConfiguration\"\n\n/**\n * @group Configuration\n */\nexport type TDiagramConvertConfiguration = {\n  types?: (\"text\" | \"shape\")[]\n  \"match-text-size\"?: boolean\n}\n\n/**\n * @group Configuration\n */\nexport type TDiagramConfiguration = {\n  mimeTypes: (\"application/vnd.myscript.jiix\" | \"application/vnd.openxmlformats-officedocument.presentationml.presentation\" | \"image/svg+xml\")[]\n  \"enable-sub-blocks\"?: boolean\n  text?: TTextConfConfiguration\n  convert?: TDiagramConvertConfiguration\n  \"session-time\"?: number\n  eraser?: TEraserConfiguration\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultDiagramConvertConfiguration: TDiagramConvertConfiguration = {\n  types: [\"text\", \"shape\"],\n  \"match-text-size\": true\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultDiagramConfiguration: TDiagramConfiguration = {\n  convert: DefaultDiagramConvertConfiguration,\n  eraser: DefaultEraserConfiguration,\n  mimeTypes: [\"application/vnd.myscript.jiix\"],\n}\n","\n/**\n * @group Configuration\n */\nexport type TImageViewportConfiguration = {\n  x: number\n  y: number\n  width: number\n  height: number\n}\n\n/**\n * @group Configuration\n */\nexport type TImageConfiguration = {\n  guides: boolean\n  viewport: TImageViewportConfiguration\n}\n\n/**\n * @group Configuration\n */\nexport type TJiixConfiguration = {\n  \"bounding-box\": boolean\n  strokes: boolean\n  ids: boolean\n  \"full-stroke-ids\": boolean\n  text: {\n    chars: boolean\n    words: boolean\n  }\n  style?: boolean\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultJiixConfiguration: TJiixConfiguration = {\n  \"bounding-box\": false,\n  strokes: false,\n  ids: false,\n  \"full-stroke-ids\": false,\n  text: {\n    chars: false,\n    words: true\n  },\n}\n\n/**\n * @group Configuration\n */\nexport type TMathMLFlavor = {\n  name: string\n}\n\n/**\n * @group Configuration\n */\nexport type TMathMLExport = {\n  flavor: TMathMLFlavor\n}\n\n/**\n * @group Configuration\n */\nexport type TExportConfiguration = {\n  \"image-resolution\"?: number\n  image?: TImageConfiguration\n  jiix: TJiixConfiguration\n  mathml?: TMathMLExport\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultExportConfiguration: TExportConfiguration = {\n  \"image-resolution\": 300,\n  jiix: DefaultJiixConfiguration\n}\n","\n/**\n * @group Configuration\n */\nexport type TMarginConfiguration = {\n  bottom: number\n  left: number\n  right: number\n  top: number\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultMarginConfiguration: TMarginConfiguration = {\n  top: 20,\n  left: 10,\n  right: 10,\n  bottom: 10\n}\n","import { DefaultMarginConfiguration, TMarginConfiguration } from \"./MarginConfiguration\"\nimport { DefaultEraserConfiguration, TEraserConfiguration } from \"./EraserConfiguration\"\n\n/**\n * @group Configuration\n */\nexport type TRoundingMode = \"half up\" | \"truncate\"\n\n/**\n * @group Configuration\n */\nexport type TAngleUnit = \"deg\" | \"rad\"\n\n/**\n * @group Configuration\n */\nexport type TSolverOptions = \"algebraic\" | \"numeric\"\n\n/**\n * @group Configuration\n */\nexport type TSolverConfiguration = {\n  enable?: boolean\n  \"fractional-part-digits\"?: number\n  \"decimal-separator\"?: string\n  \"rounding-mode\"?: TRoundingMode\n  \"angle-unit\"?: TAngleUnit\n  options?: TSolverOptions\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultSolverConfiguration: TSolverConfiguration = {\n  enable: true,\n  \"fractional-part-digits\": 3,\n  \"decimal-separator\": \".\",\n  \"rounding-mode\": \"half up\",\n  \"angle-unit\": \"deg\"\n}\n\n/**\n * @group Configuration\n */\nexport type TUndoRedoMode = \"stroke\" | \"session\"\n\n/**\n * @group Configuration\n */\nexport type TMathUndoRedoConfiguration = {\n  mode: TUndoRedoMode\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultMathUndoRedoConfiguration: TMathUndoRedoConfiguration = {\n  mode: \"stroke\"\n}\n\n/**\n * @group Configuration\n */\nexport type TMathConfiguration = {\n  mimeTypes: (\"application/x-latex\" | \"application/mathml+xml\" | \"application/vnd.myscript.jiix\")[]\n  solver?: TSolverConfiguration\n  margin: TMarginConfiguration\n  \"undo-redo\"?: TMathUndoRedoConfiguration\n  customGrammar?: string\n  customGrammarId?: string\n  customGrammarContent?: string\n  eraser?: TEraserConfiguration\n  \"session-time\"?: number\n  \"recognition-timeout\"?: number\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultMathConfiguration: TMathConfiguration = {\n  solver: DefaultSolverConfiguration,\n  margin: DefaultMarginConfiguration,\n  eraser: DefaultEraserConfiguration,\n  \"undo-redo\": DefaultMathUndoRedoConfiguration,\n  mimeTypes: [\"application/vnd.myscript.jiix\"],\n}\n","\nimport { DefaultEraserConfiguration, TEraserConfiguration } from \"./EraserConfiguration\"\nimport { TTextConfConfiguration } from \"./TextConfiguration\"\n\n/**\n * @group Configuration\n */\nexport type TRawContentConfiguration = {\n  text?: TTextConfConfiguration\n  \"session-time\"?: number\n  recognition?: {\n    types: (\"text\" | \"shape\")[]\n  }\n  eraser?: TEraserConfiguration\n  /**\n   * @description allows you to define the detected gestures\n   * @remarks only usable in the case of offscreen\n   */\n  gestures? : (\"underline\" | \"scratch-out\" | \"join\" | \"insert\" | \"strike-through\" | \"surround\")[]\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultRawContentConfiguration: TRawContentConfiguration = {\n  recognition: {\n    types: [\"text\", \"shape\"]\n  },\n  eraser: DefaultEraserConfiguration,\n  /**\n   * @remarks only usable in the case of offscreen\n   */\n  gestures : [\"underline\", \"scratch-out\", \"join\", \"insert\", \"strike-through\", \"surround\"]\n}\n","\n/**\n * @group Configuration\n */\nexport type TRecognitionRendererDebugConfiguration = {\n  \"draw-text-boxes\": boolean\n  \"draw-image-boxes\": boolean\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultDebugConfiguration: TRecognitionRendererDebugConfiguration = {\n  \"draw-text-boxes\": false,\n  \"draw-image-boxes\": false\n}\n\n/**\n * @group Configuration\n */\nexport type TRecognitionRendererConfiguration = {\n  debug: TRecognitionRendererDebugConfiguration\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultRecognitionRendererConfiguration: TRecognitionRendererConfiguration = {\n  debug: DefaultDebugConfiguration\n}\n","import { DefaultMarginConfiguration, TMarginConfiguration } from \"./MarginConfiguration\"\nimport { DefaultEraserConfiguration, TEraserConfiguration } from \"./EraserConfiguration\"\n\n/**\n * @group Configuration\n */\nexport type TTextGuidesConfiguration = {\n  enable: boolean\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultTextGuidesConfiguration: TTextGuidesConfiguration = {\n  enable: true\n}\n\n/**\n * @group Configuration\n */\nexport type TTextConfConfiguration = {\n  customResources?: string[]\n  customLexicon?: string[]\n  addLKText?: boolean\n}\n\n/**\n * @group Configuration\n */\nexport type TTextConfiguration = {\n  text?: boolean\n  mimeTypes: (\"text/plain\" | \"application/vnd.myscript.jiix\")[]\n  margin: TMarginConfiguration\n  guides?: TTextGuidesConfiguration\n  configuration?: TTextConfConfiguration\n  eraser?: TEraserConfiguration\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultTextConfiguration: TTextConfiguration = {\n  guides: DefaultTextGuidesConfiguration,\n  eraser: DefaultEraserConfiguration,\n  margin: DefaultMarginConfiguration,\n  mimeTypes: [\"application/vnd.myscript.jiix\"],\n}\n","\n/**\n * @group Configuration\n */\nexport type TConvertionConfiguration = {\n    force?: {\n        \"on-stylesheet-change\": boolean\n    }\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultConvertionConfiguration: TConvertionConfiguration = {\n    force: {\n        \"on-stylesheet-change\": false\n    }\n}\n","import {\n  TDiagramConfiguration,\n  TExportConfiguration,\n  TMathConfiguration,\n  TRawContentConfiguration,\n  TRecognitionRendererConfiguration,\n  TTextConfiguration,\n  TConvertionConfiguration,\n  DefaultDiagramConfiguration,\n  DefaultExportConfiguration,\n  DefaultRecognitionRendererConfiguration,\n  DefaultRawContentConfiguration,\n  DefaultMathConfiguration,\n  DefaultTextConfiguration,\n  DefaultConvertionConfiguration,\n} from \"./recognition\"\n\n/**\n * @group Configuration\n */\nexport type TRecognitionType = \"TEXT\" | \"MATH\" | \"DIAGRAM\" | \"Raw Content\"\n\n/**\n * @group Configuration\n */\nexport type TConverstionState = \"DIGITAL_EDIT\" | \"HANDWRITING\"\n\n/**\n * @group Configuration\n */\nexport type TRecognitionConfiguration = {\n  type: TRecognitionType\n  alwaysConnected: boolean\n  lang: string\n  math: TMathConfiguration\n  text: TTextConfiguration\n  diagram: TDiagramConfiguration\n  renderer: TRecognitionRendererConfiguration\n  export: TExportConfiguration\n  \"raw-content\": TRawContentConfiguration\n  gesture: {\n    enable: boolean,\n    ignoreGestureStrokes: boolean\n  }\n  convert: TConvertionConfiguration\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultRecognitionConfiguration: TRecognitionConfiguration = {\n  diagram: DefaultDiagramConfiguration,\n  export: DefaultExportConfiguration,\n  math: DefaultMathConfiguration,\n  \"raw-content\": DefaultRawContentConfiguration,\n  renderer: DefaultRecognitionRendererConfiguration,\n  text: DefaultTextConfiguration,\n  type: \"TEXT\",\n  alwaysConnected: true,\n  lang: \"en_US\",\n  gesture: {\n    enable: true,\n    ignoreGestureStrokes: false,\n  },\n  convert: DefaultConvertionConfiguration,\n}\n","\n/**\n * @group Configuration\n */\nexport type TGuidesConfiguration = {\n  enable: boolean,\n  gap: number\n  /**\n   * @remarks only usable in the case of offscreen\n   */\n  type: \"line\" | \"grid\" | \"point\"\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultGuidesConfiguration: TGuidesConfiguration = {\n  enable: true,\n  gap: 50,\n  /**\n   * @remarks only usable in the case of offscreen\n   */\n  type: \"point\"\n}\n\n/**\n * @group Configuration\n */\nexport type TSmartGuidesConfiguration = {\n  enable: boolean\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultSmartGuidesConfiguration: TSmartGuidesConfiguration = {\n  enable: true,\n}\n\n/**\n * @group Configuration\n */\nexport type TRenderingConfiguration = {\n  minHeight: number\n  minWidth: number\n  smartGuide: TSmartGuidesConfiguration\n  guides: TGuidesConfiguration\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultRenderingConfiguration: TRenderingConfiguration = {\n  guides: DefaultGuidesConfiguration,\n  smartGuide: DefaultSmartGuidesConfiguration,\n  minHeight: 100,\n  minWidth: 100,\n}\n","\n/**\n * @group Configuration\n */\nexport type TProtocol = \"WEBSOCKET\" | \"REST\"\n\n/**\n * @group Configuration\n */\nexport type TSchene = \"https\" | \"http\"\n\n/**\n * @group Configuration\n */\nexport type TServerConfiguration = {\n  protocol: TProtocol,\n  scheme: TSchene,\n  host: string\n  applicationKey: string\n  hmacKey: string\n  version: string\n  useWindowLocation?: boolean\n  websocket: {\n    pingEnabled: boolean\n    pingDelay: number\n    maxPingLostCount: number\n    autoReconnect: boolean\n    maxRetryCount: number\n    fileChunkSize: number\n  }\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultServerConfiguration: TServerConfiguration = {\n  protocol: \"WEBSOCKET\",\n  scheme: \"https\",\n  host: \"cloud.myscript.com\",\n  applicationKey: \"\",\n  hmacKey: \"\",\n  version: \"2.3.0\",\n  useWindowLocation: false,\n  websocket: {\n    pingEnabled: true,\n    pingDelay: 15000,\n    maxPingLostCount: 20,\n    autoReconnect: true,\n    maxRetryCount: 2,\n    fileChunkSize: 300000\n  }\n}\n","/**\n * @group Configuration\n * @remarks\n * Configure when the action is triggered.\n *\n * POINTER_UP :   Action is triggered on every PenUP.\n *                This is the recommended mode for CDK V3 WebSocket recognitions.\n *\n * QUIET_PERIOD : Action is triggered after a quiet period in milli-seconds on every pointer up.\n *                The value is set to 1000 for example recognition will be triggered when the user stops writing for 1 seconds.\n *                This is the recommended mode for all REST discoveries.\n *\n * DEMAND :       Action is triggered on external demande\n */\n export type TTriggerConfiguration = {\n  exportContent: \"QUIET_PERIOD\" | \"POINTER_UP\" | \"DEMAND\"\n  exportContentDelay: number\n  resizeTriggerDelay: number\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultTriggerConfiguration: TTriggerConfiguration = {\n  exportContent: \"POINTER_UP\",\n  exportContentDelay: 1000,\n  resizeTriggerDelay: 100\n}\n","\n/**\n * @group Configuration\n */\nexport type TUndoRedoConfiguration = {\n  maxStackSize: number\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultUndoRedoConfiguration: TUndoRedoConfiguration = {\n  maxStackSize: 100\n}\n","\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { PartialDeep, mergeDeep } from \"../utils\"\nimport { DefaultGrabberConfiguration, TGrabberConfiguration } from \"./GrabberConfiguration\"\nimport { DefaultMenuConfiguration, TMenuConfiguration } from \"./MenuConfiguration\"\nimport { DefaultRecognitionConfiguration, TRecognitionConfiguration } from \"./RecognitionConfiguration\"\nimport { DefaultRenderingConfiguration, TRenderingConfiguration } from \"./RenderingConfiguration\"\nimport { DefaultServerConfiguration, TServerConfiguration } from \"./ServerConfiguration\"\nimport { DefaultTriggerConfiguration, TTriggerConfiguration } from \"./TriggerConfiguration\"\nimport { DefaultUndoRedoConfiguration, TUndoRedoConfiguration } from \"./UndoRedoConfiguration\"\n\n/**\n * @group Configuration\n */\nexport type TConfiguration = {\n  offscreen: boolean\n  server: TServerConfiguration\n  recognition: TRecognitionConfiguration\n  grabber: TGrabberConfiguration\n  rendering: TRenderingConfiguration\n  triggers: TTriggerConfiguration\n  \"undo-redo\": TUndoRedoConfiguration,\n  menu: TMenuConfiguration\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultConfiguration: TConfiguration = {\n  offscreen: false,\n  server: DefaultServerConfiguration,\n  recognition: DefaultRecognitionConfiguration,\n  grabber: DefaultGrabberConfiguration,\n  rendering: DefaultRenderingConfiguration,\n  triggers: DefaultTriggerConfiguration,\n  \"undo-redo\": DefaultUndoRedoConfiguration,\n  menu: DefaultMenuConfiguration\n}\n\n/**\n * @group Configuration\n */\nexport class Configuration implements TConfiguration\n{\n  #logger = LoggerManager.getLogger(LoggerClass.CONFIGURATION)\n\n  offscreen: boolean\n  grabber: TGrabberConfiguration\n  recognition: TRecognitionConfiguration\n  rendering: TRenderingConfiguration\n  server: TServerConfiguration\n  triggers: TTriggerConfiguration\n  \"undo-redo\": TUndoRedoConfiguration\n  menu: TMenuConfiguration\n\n  constructor(configuration?: PartialDeep<TConfiguration>)\n  {\n    this.#logger.info(\"constructor\", { configuration })\n    this.offscreen = DefaultConfiguration.offscreen\n    this.grabber = structuredClone(DefaultConfiguration.grabber)\n    this.recognition = structuredClone(DefaultConfiguration.recognition)\n    this.rendering = structuredClone(DefaultConfiguration.rendering)\n    this.server = structuredClone(DefaultConfiguration.server)\n    this[\"undo-redo\"] = structuredClone(DefaultConfiguration[\"undo-redo\"])\n    this.triggers = structuredClone(DefaultConfiguration.triggers)\n    this.menu = structuredClone(DefaultConfiguration.menu)\n\n    this.overrideDefaultConfiguration(configuration)\n  }\n\n  overrideDefaultConfiguration(configuration?: PartialDeep<TConfiguration>): void\n  {\n    this.#logger.info(\"overrideDefaultConfiguration\", { configuration })\n    const defaultConf = structuredClone(DefaultConfiguration) as TConfiguration\n    this.offscreen = Boolean(configuration?.offscreen)\n    this.grabber = mergeDeep({}, defaultConf.grabber, configuration?.grabber)\n    this.recognition = mergeDeep({}, defaultConf.recognition, configuration?.recognition)\n    this.rendering = mergeDeep({}, defaultConf.rendering, configuration?.rendering)\n    this.server = mergeDeep({}, defaultConf.server, configuration?.server)\n    this.triggers = mergeDeep({}, defaultConf.triggers, configuration?.triggers)\n    this[\"undo-redo\"] = mergeDeep({}, defaultConf[\"undo-redo\"], configuration?.[\"undo-redo\"])\n    this.menu = mergeDeep({}, defaultConf.menu, configuration?.menu)\n\n    if (configuration?.recognition?.text?.mimeTypes) {\n      this.recognition.text.mimeTypes = configuration.recognition.text.mimeTypes as (\"text/plain\" | \"application/vnd.myscript.jiix\")[]\n    }\n    if (configuration?.recognition?.math?.mimeTypes) {\n      this.recognition.math.mimeTypes = configuration.recognition.math.mimeTypes as (\"application/vnd.myscript.jiix\" | \"application/x-latex\" | \"application/mathml+xml\")[]\n    }\n    if (configuration?.recognition?.diagram?.mimeTypes) {\n      this.recognition.diagram.mimeTypes = configuration.recognition.diagram.mimeTypes as (\"application/vnd.myscript.jiix\" | \"application/vnd.openxmlformats-officedocument.presentationml.presentation\" | \"image/svg+xml\")[]\n    }\n    if (configuration?.recognition?.diagram?.convert?.types) {\n      this.recognition.diagram.convert!.types = configuration.recognition.diagram.convert.types as (\"text\" | \"shape\")[]\n    }\n    if (configuration?.recognition?.[\"raw-content\"]?.gestures) {\n      this.recognition[\"raw-content\"].gestures = configuration.recognition[\"raw-content\"].gestures as (\"underline\" | \"scratch-out\" | \"join\" | \"insert\" | \"strike-through\" | \"surround\")[]\n    }\n    if (configuration?.recognition?.[\"raw-content\"]?.recognition?.types) {\n      this.recognition[\"raw-content\"].recognition!.types = configuration.recognition[\"raw-content\"].recognition.types as (\"text\" | \"shape\")[]\n    }\n\n    if (this.server?.useWindowLocation) {\n      this.server.scheme = window.location.protocol.indexOf(\"s\") > -1 ? \"https\" : \"http\"\n      this.server.host = window.location.host\n    }\n\n    if (this.offscreen) {\n      this.recognition.type = \"Raw Content\"\n      this.rendering.smartGuide.enable = false\n      this.server.protocol = \"WEBSOCKET\"\n      this.recognition.export.jiix[\"full-stroke-ids\"] = true\n      this.recognition.export.jiix.ids = true\n      this.recognition.export.jiix.text.words = true\n      this.recognition.export.jiix.text.chars = true\n      this.recognition.export.jiix[\"bounding-box\"]= true\n    }\n    else {\n      if (\n        this.server.protocol === \"REST\" &&\n        this.triggers.exportContent === \"POINTER_UP\"\n      ) {\n        this.triggers.exportContent = \"QUIET_PERIOD\"\n        this.triggers.exportContentDelay = Math.max(this.triggers.exportContentDelay, 50)\n      }\n\n      if (\n        this.server.protocol === \"WEBSOCKET\" &&\n        this.recognition.type === \"TEXT\"\n      ) {\n        if (\n          this.rendering.smartGuide.enable &&\n          !this.recognition.text.mimeTypes.includes(\"application/vnd.myscript.jiix\")\n        ) {\n          // mimeType required for smartGuide\n          this.recognition.text.mimeTypes.push(\"application/vnd.myscript.jiix\")\n        }\n      } else {\n        // smartGuide enable only on websocket text\n        this.rendering.smartGuide.enable = false\n      }\n      // raw-content.gestures Unrecognized when not offscreen\n      delete this.recognition[\"raw-content\"].gestures\n      this.menu.style.enable = false\n    }\n    this.#logger.debug(\"overrideDefaultConfiguration\", { configuration: this })\n  }\n}\n","import { LoggerClass, LoggerLevel } from \"../logger\"\n\n/**\n * @group Configuration\n */\nexport type TLoggerConfiguration = {\n  [key in keyof typeof LoggerClass]: LoggerLevel\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultLoggerConfiguration: TLoggerConfiguration = {\n  [LoggerClass.EDITOR]: LoggerLevel.ERROR,\n  [LoggerClass.BEHAVIORS]: LoggerLevel.ERROR,\n  [LoggerClass.RECOGNIZER]: LoggerLevel.ERROR,\n  [LoggerClass.GRABBER]: LoggerLevel.ERROR,\n  [LoggerClass.RENDERER]: LoggerLevel.ERROR,\n  [LoggerClass.CONFIGURATION]: LoggerLevel.ERROR,\n  [LoggerClass.PUBLIC_EVENT]: LoggerLevel.ERROR,\n  [LoggerClass.INTERNAL_EVENT]: LoggerLevel.ERROR,\n  [LoggerClass.MODEL]: LoggerLevel.ERROR,\n  [LoggerClass.SYMBOL]: LoggerLevel.ERROR,\n  [LoggerClass.SMARTGUIDE]: LoggerLevel.ERROR,\n  [LoggerClass.GESTURE]: LoggerLevel.ERROR,\n  [LoggerClass.STYLE]: LoggerLevel.ERROR,\n  [LoggerClass.HISTORY]: LoggerLevel.ERROR,\n  [LoggerClass.TRANSFORMER]: LoggerLevel.ERROR,\n  [LoggerClass.CONVERTER]: LoggerLevel.ERROR,\n  [LoggerClass.WRITE]: LoggerLevel.ERROR,\n  [LoggerClass.SELECTION]: LoggerLevel.ERROR,\n  [LoggerClass.SVGDEBUG]: LoggerLevel.ERROR,\n  [LoggerClass.MENU]: LoggerLevel.ERROR,\n}\n","import { Intention } from \"../Constants\"\nimport { TConverstionState } from \"../configuration\"\nimport { LoggerManager, LoggerClass } from \"../logger\"\nimport { TExport, TJIIXExport } from \"../model\"\nimport { TOISymbol } from \"../primitive\"\nimport { TWSMessageEventSVGPatch } from \"../recognizer\"\nimport { TUndoRedoContext } from \"../history\"\n\n\n/**\n * @group Event\n * @description Lists all internal library events\n * @example\n * You can run code on \"EventType\" raised by using\n * ```ts\n * editor.internalEvents.addEventListener(InternalEventType.SVG_PATCH, (evt) => console.log(evt.detail))\n * ```\n */\nexport enum InternalEventType\n{\n  SVG_PATCH = \"internal_svg_patch\",\n  EXPORTED = \"internal_exported\",\n  CLEAR_MESSAGE = \"internal_clear_message\",\n  ERROR = \"internal_error\",\n  NOTIF = \"internal_notif\",\n  IMPORT_JIIX = \"internal_import_jiix\",\n  CONVERT = \"internal_convert\",\n  CLEAR = \"internal_clear\",\n  CONTEXT_CHANGE = \"internal_context_change\",\n  IDLE = \"internal_idle\",\n  SELECTED = \"internal_selected\",\n  INTENTION = \"internal_intention\",\n}\n\n/**\n * @group Event\n */\nexport class InternalEvent extends EventTarget\n{\n  static #instance: InternalEvent\n  #abortController: AbortController\n  #logger = LoggerManager.getLogger(LoggerClass.INTERNAL_EVENT)\n\n  private constructor()\n  {\n    super()\n    this.#logger.info(\"constructor\")\n    this.#abortController = new AbortController()\n  }\n\n  public static getInstance(): InternalEvent\n  {\n    if (!InternalEvent.#instance) {\n      InternalEvent.#instance = new InternalEvent()\n    }\n\n    return InternalEvent.#instance\n  }\n\n  removeAllListeners(): void\n  {\n    this.#logger.info(\"removeAllListeners\")\n    this.#abortController.abort()\n    this.#abortController = new AbortController()\n  }\n\n  #emit(type: string, data?: unknown): void\n  {\n    this.dispatchEvent(new CustomEvent(type, Object.assign({ bubbles: true, composed: true }, data ? { detail: data } : undefined)))\n  }\n\n  emitSVGPatch(patchChange: TWSMessageEventSVGPatch): void\n  {\n    this.#logger.info(\"emitSVGPatch\", { patchChange })\n    this.#emit(InternalEventType.SVG_PATCH, patchChange)\n  }\n  addSVGPatchListener(callback: (contentChange: TWSMessageEventSVGPatch) => void): void\n  {\n    this.#logger.info(\"addSVGPatchListener\", { callback })\n    this.addEventListener(InternalEventType.SVG_PATCH, (evt: unknown) => callback(((evt as CustomEvent).detail as TWSMessageEventSVGPatch)), { signal: this.#abortController.signal })\n  }\n\n  emitExported(exports: TExport): void\n  {\n    this.#logger.info(\"emitExported\", { exports })\n    this.#emit(InternalEventType.EXPORTED, exports)\n  }\n  addExportedListener(callback: (exports: TExport) => void): void\n  {\n    this.#logger.info(\"addExportedListener\", { callback })\n    this.addEventListener(InternalEventType.EXPORTED, (evt: unknown) => callback(((evt as CustomEvent).detail as TExport)), { signal: this.#abortController.signal })\n  }\n\n  emitClearMessage(): void\n  {\n    this.#logger.info(\"emitClearMessage\")\n    this.#emit(InternalEventType.CLEAR_MESSAGE)\n  }\n  addClearMessageListener(callback: () => void): void\n  {\n    this.#logger.info(\"addClearMessageListener\", { callback })\n    this.addEventListener(InternalEventType.CLEAR_MESSAGE, () => callback(), { signal: this.#abortController.signal })\n  }\n\n  emitError(err: Error): void\n  {\n    this.#logger.info(\"emitError\", { err })\n    this.#emit(InternalEventType.ERROR, err)\n  }\n  addErrorListener(callback: (err: Error) => void): void\n  {\n    this.#logger.info(\"addErrorListener\", { callback })\n    this.addEventListener(InternalEventType.ERROR, (evt: unknown) => callback(((evt as CustomEvent).detail as Error)), { signal: this.#abortController.signal })\n  }\n\n  emitNotif(notif: { message: string, timeout?: number }): void\n  {\n    this.#logger.info(\"emitWNotif\", { notif })\n    this.#emit(InternalEventType.NOTIF, notif)\n  }\n  addNotifListener(callback: (notif: { message: string, timeout?: number }) => void): void\n  {\n    this.#logger.info(\"addNotifListener\", { callback })\n    this.addEventListener(InternalEventType.NOTIF, (evt: unknown) => callback(((evt as CustomEvent).detail as { message: string, timeout?: number })), { signal: this.#abortController.signal })\n  }\n\n  emitImportJIIX(jiix: TJIIXExport): void\n  {\n    this.#logger.info(\"emitImportJIIX\", { jiix })\n    this.#emit(InternalEventType.IMPORT_JIIX, jiix)\n  }\n  addImportJIIXListener(callback: (jiix: TJIIXExport) => void): void\n  {\n    this.#logger.info(\"addImportJIIXListener\", { callback })\n    this.addEventListener(InternalEventType.IMPORT_JIIX, (evt: unknown) => callback(((evt as CustomEvent).detail as TJIIXExport)), { signal: this.#abortController.signal })\n  }\n\n  emitConvert(conversionState: TConverstionState = \"DIGITAL_EDIT\"): void\n  {\n    this.#logger.info(\"emitConvert\", { conversionState })\n    this.#emit(InternalEventType.CONVERT, conversionState)\n  }\n  addConvertListener(callback: (params?: { conversionState?: TConverstionState, mimeTypes?: string[] }) => void): void\n  {\n    this.#logger.info(\"addConvertListener\", { callback })\n    this.addEventListener(InternalEventType.CONVERT, (evt: unknown) => callback(((evt as CustomEvent).detail as { conversionState?: TConverstionState, mimeTypes?: string[] })), { signal: this.#abortController.signal })\n  }\n\n  emitClear(): void\n  {\n    this.#logger.info(\"emitClear\")\n    this.#emit(InternalEventType.CLEAR)\n  }\n  addClearListener(callback: () => void): void\n  {\n    this.#logger.info(\"addClearListener\", { callback })\n    this.addEventListener(InternalEventType.CLEAR, () => callback(), { signal: this.#abortController.signal })\n  }\n\n  emitContextChange(context: TUndoRedoContext): void\n  {\n    this.#logger.info(\"emitContextChange\", { context })\n    this.#emit(InternalEventType.CONTEXT_CHANGE, context)\n  }\n  addContextChangeListener(callback: (context: TUndoRedoContext) => void): void\n  {\n    this.#logger.info(\"addContextChangeListener\", { callback })\n    this.addEventListener(InternalEventType.CONTEXT_CHANGE, (evt: unknown) => callback(((evt as CustomEvent).detail as TUndoRedoContext)), { signal: this.#abortController.signal })\n  }\n\n  emitIdle(idle: boolean): void\n  {\n    this.#logger.info(\"emitIdle\", { idle })\n    this.#emit(InternalEventType.IDLE, idle)\n  }\n  addIdleListener(callback: (idle: boolean) => void): void\n  {\n    this.#logger.info(\"addIdleListener\", { callback })\n    this.addEventListener(InternalEventType.IDLE, (evt: unknown) => callback(((evt as CustomEvent).detail as boolean)), { signal: this.#abortController.signal })\n  }\n\n  emitSelected(symbols: TOISymbol[]): void\n  {\n    this.#emit(InternalEventType.SELECTED, symbols)\n  }\n  addSelectedListener(callback: (symbols: TOISymbol[]) => void): void\n  {\n    this.#logger.info(\"addSelectedListener\", { callback })\n    this.addEventListener(InternalEventType.SELECTED, (evt: unknown) => callback(((evt as CustomEvent).detail as TOISymbol[])), { signal: this.#abortController.signal })\n  }\n\n  emitIntention(intention: Intention): void\n  {\n    this.#emit(InternalEventType.INTENTION, intention)\n  }\n  addIntentionListener(callback: (intention: Intention) => void): void\n  {\n    this.#logger.info(\"addSelectedListener\", { callback })\n    this.addEventListener(InternalEventType.INTENTION, (evt: unknown) => callback(((evt as CustomEvent).detail as Intention)), { signal: this.#abortController.signal })\n  }\n}\n","import { Intention } from \"../Constants\"\nimport { LoggerManager, LoggerClass } from \"../logger\"\nimport { IModel, TExport } from \"../model\"\nimport { TSymbol } from \"../primitive\"\nimport { TUndoRedoContext } from \"../history\"\n\n/**\n * @group Event\n * @description Lists all events that can be listened to on the editor or DOM element\n * @example\n * You can run code on \"EventType\" raised by using\n * ```ts\n * editor.events.addEventListener(EventType.CHANGED, (evt) => console.log(evt.detail))\n * ```\n */\nexport enum EventType {\n  /**\n   * @description event emitted when history has changed i.e. the context of undo-redo\n   */\n  CHANGED = \"changed\",\n  /**\n   * @description event emitted when clearing is complete\n   */\n  CLEARED = \"cleared\",\n  /**\n   * @description event emitted after the conversion is complete\n   */\n  CONVERTED = \"converted\",\n  /**\n   * @description event emitted when the editor encounters an error\n   */\n  ERROR = \"error\",\n  /**\n   * @description event emitted on click on pointer events\n   */\n  POINTEREVENTS = \"pointer_events\",\n  /**\n   * @description event emitted after the end of the export\n   */\n  EXPORTED = \"exported\",\n  /**\n   * @description event emitted after the end of the import\n   */\n  IMPORTED = \"imported\",\n  /**\n   * @description event emitted when the server is idle after a job\n   */\n  IDLE = \"idle\",\n  /**\n   * @description event emitted after full editor initialization\n   */\n  LOADED = \"loaded\",\n  /**\n  * @description event emitted after\n  */\n  SELECTED = \"selected\",\n  /**\n  * @description event emitted after\n  */\n  INTENTION = \"intention\",\n}\n\n/**\n * @group Event\n */\nexport class PublicEvent extends EventTarget\n{\n  static #instance: PublicEvent\n  #element?: HTMLElement\n  #logger = LoggerManager.getLogger(LoggerClass.PUBLIC_EVENT)\n\n  private constructor()\n  {\n    super()\n  }\n\n  public static getInstance(): PublicEvent\n  {\n    if (!PublicEvent.#instance) {\n      PublicEvent.#instance = new PublicEvent()\n    }\n\n    return PublicEvent.#instance\n  }\n\n  setElement(el: HTMLElement)\n  {\n    this.#logger.info(\"setElement\", { el })\n    this.#element = el\n  }\n\n  #emit(type: string, data?: unknown): void\n  {\n    const evt = new CustomEvent(type, Object.assign({ bubbles: true, composed: true }, data ? { detail: data } : undefined))\n    this.dispatchEvent(evt)\n    this.#element?.dispatchEvent(evt)\n  }\n\n  emitLoaded(): void\n  {\n    this.#logger.info(\"emitLoaded\")\n    this.#emit(EventType.LOADED)\n  }\n\n  emitExported(exports: TExport): void\n  {\n    this.#logger.info(\"emitExported\", { exports })\n    this.#emit(EventType.EXPORTED, exports)\n  }\n\n  emitChanged(undoRedoContext: TUndoRedoContext): void\n  {\n    this.#logger.info(\"emitChanged\", { undoRedoContext })\n    this.#emit(EventType.CHANGED, {\n      ...undoRedoContext,\n      canClear: !undoRedoContext.empty\n    })\n  }\n\n  emitIdle(idle: boolean): void\n  {\n    this.#logger.info(\"emitIdle\", { idle })\n    this.#emit(EventType.IDLE, idle)\n  }\n\n  emitCleared(model?: IModel): void\n  {\n    this.#logger.info(\"emitCleared\", { model })\n    this.#emit(EventType.CLEARED, model)\n  }\n\n  emitConverted(exports: TExport): void\n  {\n    this.#logger.info(\"emitConverted\", { exports })\n    this.#emit(EventType.CONVERTED, exports)\n  }\n\n  emitImported(exports: TExport): void\n  {\n    this.#logger.info(\"emitImported\", { exports })\n    this.#emit(EventType.IMPORTED, exports)\n  }\n\n  emitSelected(symbols: TSymbol[]): void\n  {\n    this.#emit(EventType.SELECTED, symbols)\n  }\n\n  emitIntention(intention: Intention): void\n  {\n    this.#emit(EventType.INTENTION, intention)\n  }\n}\n","import { EdgeDecoration, TBoundingBox, TPoint } from \"../primitive\"\n\n/**\n * @group Exports\n * @description List all supported MIME types for export. Please note, the MIME types supported depend on the recognition type configured\n */\nexport enum ExportType\n{\n  JIIX = \"application/vnd.myscript.jiix\",\n  TEXT = \"text/plain\",\n  LATEX = \"application/x-latex\",\n  MATHML = \"application/mathml+xml\",\n  SVG = \"image/svg+xml\",\n  OFFICE_DOCUMENT = \"application/vnd.openxmlformats-officedocument.presentationml.presentation\"\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.preprod.myscript.com/docs/interactive-ink/latest/reference/jiix  Element type}\n */\nexport enum JIIXELementType\n{\n  Text = \"Text\",\n  Node = \"Node\",\n  Edge = \"Edge\",\n  RawContent = \"Raw Content\",\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.preprod.myscript.com/docs/interactive-ink/latest/reference/jiix/#diagram-item-blocks | Element node kind}\n */\nexport enum JIIXNodeKind\n{\n  Circle = \"circle\",\n  Ellipse = \"ellipse\",\n  Rectangle = \"rectangle\",\n  Triangle = \"triangle\",\n  Parallelogram = \"parallelogram\",\n  Polygon = \"polygon\",\n  Rhombus = \"rhombus\",\n}\n\n/**\n * @group Exports\n */\nexport enum JIIXEdgeKind\n{\n  Line = \"line\",\n  PolyEdge = \"polyedge\",\n  Arc = \"arc\",\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.preprod.myscript.com/docs/interactive-ink/latest/reference/jiix/#stroke-item | Stroke item}\n */\nexport type TJIIXStrokeItem = {\n  type: \"stroke\"\n  id: string\n  \"full-id\"?: string\n  timestamp?: string\n  X?: number[]\n  Y?: number[]\n  F?: number[]\n  T?: number[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXBase = {\n  \"bounding-box\"?: TBoundingBox\n  items?: TJIIXStrokeItem[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXElementBase<T = string> = TJIIXBase & {\n  id: string\n  type: T\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.preprod.myscript.com/docs/interactive-ink/latest/reference/jiix/#word-object | Word object}\n */\nexport type TJIIXWord = TJIIXBase & {\n  id?: string\n  label: string\n  candidates?: string[]\n  \"first-char\"?: number\n  \"last-char\"?: number\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.preprod.myscript.com/docs/interactive-ink/latest/reference/jiix/#character-object | Character object}\n */\nexport type TJIIXChar = TJIIXBase & {\n  label: string\n  candidates?: string[]\n  word: number\n  grid: TPoint[]\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.preprod.myscript.com/docs/interactive-ink/latest/reference/jiix/#text-interpretation | Text Element }\n */\nexport type TJIIXTextElement = TJIIXElementBase<JIIXELementType.Text> & {\n  id: string\n  \"bounding-box\"?: TBoundingBox\n  label: string\n  words?: TJIIXWord[]\n  chars?: TJIIXChar[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeElementBase<K = string> = TJIIXElementBase<JIIXELementType.Node> & {\n  id: string\n  kind: K\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeCircle = TJIIXNodeElementBase<JIIXNodeKind.Circle> & {\n  id: string\n  cx: number\n  cy: number\n  r: number\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeEllipse = TJIIXNodeElementBase<JIIXNodeKind.Ellipse> & {\n  id: string\n  cx: number\n  cy: number\n  rx: number\n  ry: number\n  orientation: number\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeRectangle = TJIIXNodeElementBase<JIIXNodeKind.Rectangle> & {\n  id: string\n  height: number\n  width: number\n  x: number\n  y: number\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeTriangle = TJIIXNodeElementBase<JIIXNodeKind.Triangle> & {\n  id: string\n  points: number[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeParrallelogram = TJIIXNodeElementBase<JIIXNodeKind.Parallelogram> & {\n  id: string\n  points: number[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodePolygon = TJIIXNodeElementBase<JIIXNodeKind.Polygon> & {\n  id: string\n  points: number[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeRhombus = TJIIXNodeElementBase<JIIXNodeKind.Rhombus> & {\n  id: string\n  points: number[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeElement =\n  TJIIXNodeCircle |\n  TJIIXNodeEllipse |\n  TJIIXNodeRectangle |\n  TJIIXNodeTriangle |\n  TJIIXNodeParrallelogram |\n  TJIIXNodePolygon |\n  TJIIXNodeRhombus\n\n/**\n * @group Exports\n */\nexport type TJIIXEdgeElementBase<K = string> = TJIIXElementBase<JIIXELementType.Edge> & {\n  kind: K\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.preprod.myscript.com/docs/interactive-ink/latest/reference/jiix/#line-item | Element line}\n */\nexport type TJIIXEdgeLine = TJIIXEdgeElementBase<JIIXEdgeKind.Line> & {\n  x1: number\n  x2: number\n  y1: number\n  y2: number\n  p1Decoration?: EdgeDecoration\n  p2Decoration?: EdgeDecoration\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXEdgePolyEdge = TJIIXEdgeElementBase<JIIXEdgeKind.PolyEdge> & {\n  edges: TJIIXEdgeLine[]\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.preprod.myscript.com/docs/interactive-ink/latest/reference/jiix/#arc-item | Element arc}\n */\nexport type TJIIXEdgeArc = TJIIXEdgeElementBase<JIIXEdgeKind.Arc> & {\n  cx: number,\n  cy: number,\n  rx: number,\n  ry: number,\n  phi: number,\n  startAngle: number,\n  sweepAngle: number\n  startDecoration?: EdgeDecoration\n  endDecoration?: EdgeDecoration\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXEdgeElement =\n  TJIIXEdgeLine |\n  TJIIXEdgePolyEdge |\n  TJIIXEdgeArc\n\n/**\n * @group Exports\n * @remarks {@link https://developer.preprod.myscript.com/docs/interactive-ink/latest/reference/web/jiix | Exports}\n */\nexport type TJIIXElement =\n  TJIIXTextElement |\n  TJIIXNodeElement |\n  TJIIXEdgeElement\n\n/**\n * @group Exports\n */\nexport type TJIIXExport = {\n  type: string\n  id: string\n  \"bounding-box\"?: TBoundingBox\n  version: string\n  elements?: TJIIXElement[]\n  label?: string\n  words?: TJIIXWord[]\n  chars?: TJIIXChar[]\n}\n\n/**\n * @group Exports\n * @remarks\n * List all supported MIME types for export.\n *\n * Attention the MIME types supported depend on the {@link TRecognitionType | type of recognition}\n *\n * {@link https://developer.preprod.myscript.com/docs/interactive-ink/latest/reference/jiix | Documentation}\n */\nexport type TExport = {\n  /** @hidden */\n  [key: string]: unknown\n  /**\n   * @remarks vnd.myscript.jiix is used for text and raw-content exports\n   */\n  \"application/vnd.myscript.jiix\"?: TJIIXExport\n  /**\n   * @remarks text/plain is only use for text export\n   */\n  \"text/plain\"?: string\n  /**\n   * @remarks x-latex is only use for math export\n   * @see {@link https://katex.org/docs/browser.html | katex} to render\n   */\n  \"application/x-latex\"?: string\n  /**\n   * @remarks mathml+xml is only use for math export\n   * @see {@link https://www.w3.org/Math/whatIsMathML.html | Mathematical Markup Language}\n   */\n  \"application/mathml+xml\"?: string\n  /**\n   * @remarks svg+xml is only use for diagram export\n   */\n  \"image/svg+xml\"?: string\n  /**\n   * @remarks vnd.openxmlformats-officedocument.presentationml.presentation is only use for diagram export\n   * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/Blob | Blob}\n   */\n  \"application/vnd.openxmlformats-officedocument.presentationml.presentation\"?: Blob\n}\n","import { createUUID } from \"../utils\"\nimport { TStyle } from \"../style\"\n\n/**\n * @group Primitive\n */\nexport enum DecoratorKind\n{\n  Highlight = \"highlight\",\n  Surround = \"surround\",\n  Underline = \"underline\",\n  Strikethrough = \"strikethrough\",\n}\n\n/**\n * @group Primitive\n */\nexport class OIDecorator\n{\n  id: string\n  kind: DecoratorKind\n  style: TStyle\n\n  constructor(kind: DecoratorKind, style: TStyle)\n  {\n    this.id = `${ kind }-${ createUUID() }`\n    this.style = structuredClone(style)\n    this.kind = kind\n  }\n\n  clone(): OIDecorator\n  {\n    const clone = new OIDecorator(this.kind, structuredClone(this.style))\n    clone.id = this.id\n    return clone\n  }\n\n}\n","import { TGrabberConfiguration } from \"../configuration\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { TPointer } from \"../primitive\"\nimport { IGrabber } from \"./IGrabber\"\n\n/**\n * @group Grabber\n */\nexport class OIPointerEventGrabber implements IGrabber\n{\n  #logger = LoggerManager.getLogger(LoggerClass.GRABBER)\n\n  protected configuration: TGrabberConfiguration\n  protected domElement!: HTMLElement\n  protected activePointerId?: number\n  protected prevent = (e: Event) => e.preventDefault()\n\n  onPointerDown!: (evt: PointerEvent, point: TPointer) => void\n  onPointerMove!: (evt: PointerEvent, point: TPointer) => void\n  onPointerUp!: (evt: PointerEvent, point: TPointer) => void\n  onContextMenu!: (el: HTMLElement, point: TPointer) => void\n\n  constructor(configuration: TGrabberConfiguration)\n  {\n    this.#logger.info(\"constructor\", { configuration })\n    this.configuration = configuration\n  }\n\n  protected roundFloat(oneFloat: number, requestedFloatPrecision: number): number\n  {\n    if (requestedFloatPrecision >= 0) {\n      const floatPrecision: number = Math.pow(10, requestedFloatPrecision)\n      return Math.round(oneFloat / floatPrecision) * floatPrecision\n    }\n    this.#logger.debug(\"roundFloat\", { oneFloat, requestedFloatPrecision })\n    return oneFloat\n  }\n\n  protected extractPoint(event: MouseEvent | TouchEvent): TPointer\n  {\n    let clientX: number, clientY: number\n    if (\"changedTouches\" in event) {\n      ({ clientX, clientY } = event.changedTouches[0])\n    } else {\n      ({ clientX, clientY } = event)\n    }\n    const rect: DOMRect = this.domElement.getBoundingClientRect()\n    const pointer = {\n      x: this.roundFloat(clientX - rect.left - this.domElement.clientLeft + this.domElement.scrollLeft, this.configuration.xyFloatPrecision),\n      y: this.roundFloat(clientY - rect.top - this.domElement.clientTop + this.domElement.scrollTop, this.configuration.xyFloatPrecision),\n      t: this.roundFloat(Date.now(), this.configuration.timestampFloatPrecision),\n      p: (event as PointerEvent).pressure,\n    }\n    this.#logger.debug(\"extractPoint\", { event, pointer })\n    return pointer\n  }\n\n  protected pointerDownHandler = (evt: PointerEvent) =>\n  {\n    this.#logger.info(\"pointerDown\", { evt })\n\n    // exit if not a left click or multi-touch\n    if (evt.button !== 0 || evt.buttons !== 1) {\n      return\n    }\n\n    this.activePointerId = evt.pointerId\n\n    if (this.onPointerDown) {\n      const point = this.extractPoint(evt)\n      this.onPointerDown(evt, point)\n    }\n  }\n\n  protected pointerMoveHandler = (evt: PointerEvent) =>\n  {\n    this.#logger.info(\"pointerMove\", { evt })\n    if (this.activePointerId != undefined && this.activePointerId === evt.pointerId) {\n      if (this.onPointerMove) {\n        const point = this.extractPoint(evt)\n        this.onPointerMove(evt, point)\n      }\n    }\n  }\n\n  protected pointerUpHandler = (evt: PointerEvent) =>\n  {\n    this.#logger.info(\"pointerUp\", { evt })\n    if (this.activePointerId != undefined && this.activePointerId === evt.pointerId) {\n      this.activePointerId = undefined\n      evt.stopPropagation()\n      if (this.onPointerUp) {\n        const point = this.extractPoint(evt)\n        this.onPointerUp(evt, point)\n      }\n    }\n  }\n\n  protected pointerOutHandler = (evt: PointerEvent) =>\n  {\n    if (\n      this.activePointerId != undefined && this.activePointerId === evt.pointerId &&\n      !this.domElement.contains(evt.target as HTMLElement)\n    ) {\n      evt.stopPropagation()\n      this.activePointerId = undefined\n      if (this.onPointerUp) {\n        const point = this.extractPoint(evt)\n        this.onPointerUp(evt, point)\n      }\n    }\n  }\n\n  protected contextMenuHandler = (evt: MouseEvent) =>\n  {\n    const point = this.extractPoint(evt)\n    this.onContextMenu(evt.target as HTMLElement, point)\n  }\n\n  stopPointerEvent(): void\n  {\n    this.activePointerId = undefined\n  }\n\n  attach(domElement: HTMLElement)\n  {\n    this.#logger.info(\"attach\", { domElement })\n    if (this.domElement) {\n      this.detach()\n    }\n    this.domElement = domElement\n    this.domElement.addEventListener(\"pointerdown\", this.pointerDownHandler, this.configuration.listenerOptions)\n    this.domElement.addEventListener(\"pointermove\", this.pointerMoveHandler, this.configuration.listenerOptions)\n    this.domElement.addEventListener(\"pointerup\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.domElement.addEventListener(\"pointerleave\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.domElement.addEventListener(\"pointercancel\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.domElement.addEventListener(\"pointerout\", this.pointerOutHandler, this.configuration.listenerOptions)\n    this.domElement.addEventListener(\"contextmenu\", this.contextMenuHandler)\n  }\n\n  detach()\n  {\n    this.#logger.info(\"detach\")\n    this.domElement?.removeEventListener(\"pointerdown\", this.pointerDownHandler, this.configuration.listenerOptions)\n    this.domElement?.removeEventListener(\"pointermove\", this.pointerMoveHandler, this.configuration.listenerOptions)\n    this.domElement?.removeEventListener(\"pointerup\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.domElement?.removeEventListener(\"pointerleave\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.domElement?.removeEventListener(\"pointercancel\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.domElement?.removeEventListener(\"pointerout\", this.pointerOutHandler, this.configuration.listenerOptions)\n    this.domElement?.removeEventListener(\"contextmenu\", this.contextMenuHandler)\n  }\n}\n","import { TGrabberConfiguration } from \"../configuration\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { TPointer } from \"../primitive\"\nimport { IGrabber } from \"./IGrabber\"\n\n/**\n * @group Grabber\n */\nexport class PointerEventGrabber implements IGrabber\n{\n  protected configuration: TGrabberConfiguration\n\n  protected domElement!: HTMLElement\n\n  protected activePointerId?: number\n\n  protected prevent = (e: Event) => e.preventDefault()\n  #logger = LoggerManager.getLogger(LoggerClass.GRABBER)\n\n  onPointerDown!: (evt: PointerEvent, point: TPointer) => void\n  onPointerMove!: (evt: PointerEvent, point: TPointer) => void\n  onPointerUp!: (evt: PointerEvent, point: TPointer) => void\n\n  constructor(configuration: TGrabberConfiguration)\n  {\n    this.#logger.info(\"constructor\", { configuration })\n    this.configuration = configuration\n  }\n\n  protected roundFloat(oneFloat: number, requestedFloatPrecision: number): number\n  {\n    if (requestedFloatPrecision >= 0) {\n      const floatPrecision: number = Math.pow(10, requestedFloatPrecision)\n      return Math.round(oneFloat / floatPrecision) * floatPrecision\n    }\n    this.#logger.debug(\"roundFloat\", { oneFloat, requestedFloatPrecision })\n    return oneFloat\n  }\n\n  protected extractPoint(event: MouseEvent | TouchEvent): TPointer\n  {\n    let clientX: number, clientY: number\n    if (\"changedTouches\" in event) {\n      ({ clientX, clientY } = event.changedTouches[0])\n    } else {\n      ({ clientX, clientY } = event)\n    }\n    const rect: DOMRect = this.domElement.getBoundingClientRect()\n    const pointer = {\n      x: this.roundFloat(clientX - rect.left - this.domElement.clientLeft + this.domElement.scrollLeft, this.configuration.xyFloatPrecision),\n      y: this.roundFloat(clientY - rect.top - this.domElement.clientTop + this.domElement.scrollTop, this.configuration.xyFloatPrecision),\n      t: this.roundFloat(Date.now(), this.configuration.timestampFloatPrecision),\n      p: (event as PointerEvent).pressure || 1,\n    }\n    this.#logger.debug(\"extractPoint\", { event, pointer })\n    return pointer\n  }\n\n  protected pointerDownHandler = (evt: PointerEvent) =>\n  {\n    this.#logger.info(\"pointerDown\", { evt })\n\n    // exit if not a left click or multi-touch\n    if (evt.button !== 0 || evt.buttons !== 1) {\n      return\n    }\n\n    this.activePointerId = evt.pointerId\n\n    if (this.onPointerDown) {\n      const point = this.extractPoint(evt)\n      this.onPointerDown(evt, point)\n    }\n  }\n\n  protected pointerMoveHandler = (evt: PointerEvent) =>\n  {\n    this.#logger.info(\"pointerMove\", { evt })\n    if (this.activePointerId != undefined && this.activePointerId === evt.pointerId) {\n      if ((evt.target as HTMLElement).classList.contains(\"smartguide\")) {\n        this.pointerUpHandler(evt)\n        return\n      }\n      if (this.onPointerMove) {\n        const point = this.extractPoint(evt)\n        this.onPointerMove(evt, point)\n      }\n    }\n  }\n\n  protected pointerUpHandler = (evt: PointerEvent) =>\n  {\n    this.#logger.info(\"pointerUp\", { evt })\n    if (this.activePointerId != undefined && this.activePointerId === evt.pointerId) {\n      this.activePointerId = undefined\n      evt.stopPropagation()\n      if (this.onPointerUp) {\n        const point = this.extractPoint(evt)\n        this.onPointerUp(evt, point)\n      }\n    }\n  }\n\n  protected pointerOutHandler = (evt: PointerEvent) =>\n  {\n    if (\n      this.activePointerId != undefined && this.activePointerId === evt.pointerId &&\n      !this.domElement.contains(evt.target as HTMLElement)\n    ) {\n      evt.stopPropagation()\n      this.activePointerId = undefined\n      if (this.onPointerUp) {\n        const point = this.extractPoint(evt)\n        this.onPointerUp(evt, point)\n      }\n    }\n  }\n\n  attach(domElement: HTMLElement)\n  {\n    this.#logger.info(\"attach\", { domElement })\n    if (this.domElement) {\n      this.detach()\n    }\n    this.domElement = domElement\n    this.domElement.addEventListener(\"pointerdown\", this.pointerDownHandler, this.configuration.listenerOptions)\n    this.domElement.addEventListener(\"pointermove\", this.pointerMoveHandler, this.configuration.listenerOptions)\n    this.domElement.addEventListener(\"pointerup\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.domElement.addEventListener(\"pointerleave\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.domElement.addEventListener(\"pointercancel\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.domElement.addEventListener(\"pointerout\", this.pointerOutHandler, this.configuration.listenerOptions)\n\n    this.domElement.addEventListener(\"touchmove\", this.prevent)\n\n    // FIXME investigate why this is needed for iOS devices\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\n    document.documentElement.addEventListener(\"pointerdown\", () => { })\n  }\n\n  detach()\n  {\n    this.#logger.info(\"detach\")\n    this.domElement?.removeEventListener(\"pointerdown\", this.pointerDownHandler, this.configuration.listenerOptions)\n    this.domElement?.removeEventListener(\"pointermove\", this.pointerMoveHandler, this.configuration.listenerOptions)\n    this.domElement?.removeEventListener(\"pointerup\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.domElement?.removeEventListener(\"pointerleave\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.domElement?.removeEventListener(\"pointercancel\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.domElement?.removeEventListener(\"pointerout\", this.pointerOutHandler, this.configuration.listenerOptions)\n    this.domElement?.removeEventListener(\"touchmove\", this.prevent)\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\n    document.documentElement.removeEventListener(\"pointerdown\", () => { })\n  }\n}\n","import { isBetween } from \"../utils\"\nimport { TPoint, TSegment } from \"./Point\"\n\n/**\n * @group Primitive\n */\nexport type TBoundingBox = {\n  x: number,\n  y: number,\n  width: number,\n  height: number\n}\n\n/**\n * @group Primitive\n */\nexport type TBox = {\n  x: number\n  y: number\n  width: number\n  height: number\n  xMin: number\n  xMid: number\n  xMax: number\n  yMin: number\n  yMid: number\n  yMax: number\n}\n\n/**\n * @group Primitive\n */\nexport class Box implements TBox\n{\n  x: number\n  y: number\n  width: number\n  height: number\n\n  constructor(boundindBox: TBoundingBox)\n  {\n    if (boundindBox.width < 0) throw new Error(\"width must be positive\")\n    if (boundindBox.height < 0) throw new Error(\"height must be positive\")\n    this.height = boundindBox.height\n    this.width = boundindBox.width\n    this.x = boundindBox.x\n    this.y = boundindBox.y\n  }\n\n  static createFromBoxes(boxes: TBoundingBox[]): Box\n  {\n    if (!boxes?.length) {\n      return new Box({ height: 0, width: 0, x: 0, y: 0 })\n    }\n    const x = Math.min(...boxes.map(b => b.x))\n    const width = Math.max(...boxes.map(b => b.x + b.width)) - x\n    const y = Math.min(...boxes.map(b => b.y))\n    const height = Math.max(...boxes.map(b => b.y + b.height)) - y\n    return new Box({ x, y, width, height })\n  }\n\n  static createFromPoints(points: TPoint[]): Box\n  {\n    if (!points?.length) {\n      return new Box({ height: 0, width: 0, x: 0, y: 0 })\n    }\n    const x = Math.min(...points.map(p => p.x))\n    const width = Math.max(...points.map(p => p.x)) - x\n    const y = Math.min(...points.map(p => p.y))\n    const height = Math.max(...points.map(p => p.y)) - y\n    return new Box({ x, y, width, height })\n  }\n\n  static getCorners(box: TBoundingBox): TPoint[]\n  {\n    return [\n      { x: box.x, y: box.y },\n      { x: box.x + box.width, y: box.y },\n      { x: box.x + box.width, y: box.y + box.height },\n      { x: box.x, y: box.y + box.height }\n    ]\n  }\n\n  static getCenter(box: TBoundingBox): TPoint\n  {\n    return { x: box.x + box.width / 2, y: box.y + box.height / 2 }\n  }\n\n  static getSides(box: TBoundingBox): TSegment[]\n  {\n    const vertices = Box.getCorners(box)\n    return vertices.map((p, i) =>\n    {\n      if (i === 3) {\n        return { p1: vertices[0], p2: p }\n      }\n      else {\n        return { p1: p, p2: vertices[i + 1] }\n      }\n    })\n  }\n\n  static isContained(box: TBoundingBox, wrapper: TBoundingBox): boolean\n  {\n    return isBetween(box.x, wrapper.x, wrapper.x + wrapper.width) &&\n      isBetween(box.x + box.width, wrapper.x, wrapper.x + wrapper.width) &&\n      isBetween(box.y, wrapper.y, wrapper.y + wrapper.height) &&\n      isBetween(box.y + box.height, wrapper.y, wrapper.y + wrapper.height)\n  }\n\n  static containsPoint(box: TBoundingBox, point: TPoint): boolean\n  {\n    return isBetween(point.x, box.x, box.x + box.width) &&\n      isBetween(point.y, box.y, box.y + box.height)\n  }\n\n  static contains(box: TBoundingBox, child: TBoundingBox): boolean\n  {\n    return isBetween(child.x, box.x, box.x + box.width) &&\n      isBetween(child.x + child.width, box.x, box.x + box.width) &&\n      isBetween(child.y, box.y, box.y + box.height) &&\n      isBetween(child.y + child.height, box.y, box.y + box.height)\n  }\n\n  static overlaps(box1: TBoundingBox, box2: TBoundingBox): boolean\n  {\n    if (box1.x > box2.x + box2.width) return false\n    if (box1.x + box1.width < box2.x) return false\n    if (box1.y > box2.y + box2.height) return false\n    if (box1.y + box1.height < box2.y) return false\n\n    return true\n  }\n\n  get xMin(): number\n  {\n    return this.x\n  }\n\n  get xMid(): number\n  {\n    return this.x + this.width / 2\n  }\n\n  get xMax(): number\n  {\n    return this.x + this.width\n  }\n\n  get yMin(): number\n  {\n    return this.y\n  }\n\n  get yMid(): number\n  {\n    return this.y + this.height / 2\n  }\n\n  get yMax(): number\n  {\n    return this.y + this.height\n  }\n\n  get corners(): TPoint[]\n  {\n    return Box.getCorners(this)\n  }\n\n  get center(): TPoint\n  {\n    return Box.getCenter(this)\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return [\n      ...this.corners,\n      this.center\n    ]\n  }\n\n  isContained(wrapper: TBoundingBox): boolean\n  {\n    return Box.isContained(this, wrapper)\n  }\n\n  contains(child: TBoundingBox): boolean\n  {\n    return Box.contains(this, child)\n  }\n\n  containsPoint(point: TPoint): boolean\n  {\n    return Box.containsPoint(this, point)\n  }\n\n  overlaps(boundaries: TBoundingBox): boolean\n  {\n    return Box.overlaps(this, boundaries)\n  }\n}\n","/**\n * @group Style\n * @property {String} color=#000000 Color (supported formats rgb() rgba() hsl() hsla() #rgb #rgba #rrggbb #rrggbbaa)\n * @property {String} width in px\n\n */\nexport type TStyle = {\n  width?: number\n  color?: string\n  opacity?: number\n  fill?: string\n}\n\n/**\n * @group Style\n */\nexport const DefaultStyle: TStyle = {\n  width: 2,\n  color: \"#000000\",\n  opacity: 1,\n  fill: \"transparent\",\n} as const\n","import { TStyle } from \"./Style\"\n\n/**\n * @group Style\n * @property {String} -myscript-pen-width=1 Width of strokes and primitives in mm (no other unit is supported yet)\n * @property {String} -myscript-pen-fill-style=none\n * @property {String} -myscript-pen-fill-color=#FFFFFF00 Color filled inside the area delimited by strokes and primitives\n */\nexport type TPenStyle = TStyle & {\n  \"-myscript-pen-width\"?: number\n  \"-myscript-pen-fill-style\"?: string\n  \"-myscript-pen-fill-color\"?: string\n}\n\n/**\n * @group Style\n */\nexport const DefaultPenStyle: TPenStyle = {\n\n}\n","import { TPenStyle } from \"./PenStyle\"\n\n/**\n * @group Style\n */\nexport type TThemeMath = {\n  \"font-family\": string\n}\n\n/**\n * @group Style\n */\nexport type TThemeMathSolved = {\n  \"font-family\": string\n  color: string\n}\n\n/**\n * @group Style\n */\nexport type TThemeText = {\n  \"font-family\": string,\n  \"font-size\": number\n}\n\n/**\n * @group Style\n */\nexport type TTheme = {\n  ink: TPenStyle\n  \".math\": TThemeMath\n  \".math-solved\": TThemeMathSolved\n  \".text\": TThemeText\n  [key: string]: unknown\n}\n\n/**\n * @group Style\n */\nexport const DefaultTheme: TTheme = {\n  ink: {\n    color: \"#000000\",\n    width: 1,\n    \"-myscript-pen-width\": 1,\n    \"-myscript-pen-fill-style\": \"none\",\n    \"-myscript-pen-fill-color\": \"#FFFFFF00\"\n  },\n  \".math\": {\n    \"font-family\": \"STIXGeneral\"\n  },\n  \".math-solved\": {\n    \"font-family\": \"STIXGeneral\",\n    color: \"#A8A8A8FF\"\n  },\n  \".text\": {\n    \"font-family\": \"MyScriptInter\",\n    \"font-size\": 10\n  }\n}\n","!function(t,e){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=e():\"function\"==typeof define&&define.amd?define([],e):\"object\"==typeof exports?exports.JsonCSS=e():t.JsonCSS=e()}(this,function(){return function(t){function e(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,\"a\",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p=\"\",e(e.s=1)}([function(t,e,n){\"use strict\";function o(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}Object.defineProperty(e,\"__esModule\",{value:!0});var r=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&\"function\"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?\"symbol\":typeof t},i=function t(e){var n=this;o(this,t),this.toJSON=function(t){if(\"string\"!=typeof t)return console.error(\"Need a CSS string but given \",void 0===t?\"undefined\":r(t),t),\"Not a valid CSS..!\";var e={},o=void 0,i=void 0,u=void 0;try{t.split(\"{\").forEach(function(t){if(i=t.trim())if(-1===i.indexOf(\"}\"))e[i]={},o=i;else{i.substring(0,i.indexOf(\"}\")).split(\";\").forEach(function(t){(u=t.split(\":\"))&&2===u.length&&(e[o][u[0].trim().replace(/^\\\"|\\\"$/g,\"\")]=n._trimSemiColon(u[1].trim().replace(/^\\\"|\\\"$/g,\"\")))});try{o=i.split(\"}\")[1].trim(),o&&(e[o]={})}catch(t){}}})}catch(t){return\"Not a valid CSS..!\"}return e},this.toCSS=function(t){if(\"object\"!==(void 0===t?\"undefined\":r(t)))return console.error(\"Need a JSON object but given \",void 0===t?\"undefined\":r(t),t),\"Not a valid JSON..!\";var e=\"\";try{for(var n in t)if(t.hasOwnProperty(n)){e+=n+\" {\\n\";for(var o in t[n])t[n].hasOwnProperty(o)&&(e+=o+\": \"+t[n][o]+\";\\n\");e+=\"}\\n\"}}catch(t){return\"Not a valid JSON..!\"}return e},this._trimSemiColon=function(t){return\";\"===t.slice(-1)?t.slice(0,n.length-1):t}};e.default=i},function(t,e,n){\"use strict\";t.exports=n(0).default}])});","import JsonCSS from \"json-css\"\nimport { TTheme } from \"./Theme\"\nimport { TPenStyle } from \"./PenStyle\"\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst parser: any = new JsonCSS()\n\n/**\n * @group Style\n */\nexport const StyleHelper = {\n  themeToCSS(json: TTheme): string\n  {\n    return parser.toCSS(json) as string\n    // css = css.replace( /[\\r\\n]+/gm, \"\" )\n    // return css\n  },\n  themeToJSON(style: string): TTheme\n  {\n    const theme = parser.toJSON(style) as TTheme\n    theme[\".text\"][\"font-size\"] = Number(theme[\".text\"][\"font-size\"])\n    theme.ink[\"-myscript-pen-width\"] = Number(theme.ink[\"-myscript-pen-width\"])\n    theme.ink.width = Number(theme.ink.width)\n    return theme\n  },\n  penStyleToCSS (penStyle: TPenStyle): string {\n    let css = parser.toCSS({ css: penStyle }) as string\n    css = css.substring(6, css.length - 3)\n    return css\n  },\n  penStyleToJSON (penStyleString: string): TPenStyle {\n    const penStyle = parser.toJSON(`css {${penStyleString}}`).css as TPenStyle\n    if (penStyle.width) {\n      penStyle.width = Number(penStyle.width)\n    } else {\n      delete penStyle.width\n    }\n    if (penStyle[\"-myscript-pen-width\"]) {\n      penStyle[\"-myscript-pen-width\"] = Number(penStyle[\"-myscript-pen-width\"])\n    } else {\n      delete penStyle[\"-myscript-pen-width\"]\n    }\n    return penStyle\n  },\n\n  stringToJSON(style: string): {[key: string]: string}\n  {\n    return parser.toJSON(`css {${style}}`).css\n  },\n  JSONToString(style: {[key: string]: string}): string\n  {\n    return Object.entries(style).map(([k, v]) => `${k}:${v}`).join(\";\")\n  }\n}\n","import { TStyle } from \"../style\"\n\n/**\n * @group Primitive\n */\nexport enum SymbolType\n{\n  Stroke = \"stroke\",\n  Group = \"group\",\n  Shape = \"shape\",\n  Edge = \"edge\",\n  Text = \"text\",\n  Eraser = \"eraser\",\n}\n\n/**\n * @group Primitive\n */\nexport interface TSymbol {\n  id: string\n  creationTime: number\n  modificationDate: number\n  type: string\n  style: TStyle\n}\n","import { SELECTION_MARGIN } from \"../Constants\"\nimport { TStyle } from \"../style\"\nimport { findIntersectionBetween2Segment, PartialDeep } from \"../utils\"\nimport { Box, TBoundingBox } from \"./Box\"\nimport { OISymbolBase } from \"./OISymbolBase\"\nimport { TPoint } from \"./Point\"\nimport { SymbolType } from \"./Symbol\"\n\n/**\n * @group Primitive\n */\nexport enum EdgeKind\n{\n  Line = \"line\",\n  PolyEdge = \"polyedge\",\n  Arc = \"arc\",\n}\n\n/**\n * @group Primitive\n */\nexport enum EdgeDecoration\n{\n  Arrow = \"arrow-head\"\n}\n\n/**\n * @group Primitive\n */\nexport abstract class OIEdgeBase<K = EdgeKind> extends OISymbolBase<SymbolType.Edge>\n{\n  readonly kind: K\n  readonly isClosed = false\n\n  startDecoration?: EdgeDecoration\n  endDecoration?: EdgeDecoration\n\n  constructor(\n    kind: K,\n    startDecoration?: EdgeDecoration,\n    endDecoration?: EdgeDecoration,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(SymbolType.Edge, style)\n    this.kind = kind\n\n    this.startDecoration = startDecoration\n    this.endDecoration = endDecoration\n  }\n\n  abstract get vertices(): TPoint[]\n\n  get bounds(): Box\n  {\n    const bb = Box.createFromPoints(this.vertices)\n    bb.x -= SELECTION_MARGIN / 2\n    bb.y -= SELECTION_MARGIN / 2\n    bb.height += SELECTION_MARGIN\n    bb.width += SELECTION_MARGIN\n    if (this.startDecoration || this.endDecoration) {\n      bb.x -= ((this.style.width || 1) * 2.5)\n      bb.y -= ((this.style.width || 1) * 2.5)\n      bb.height += ((this.style.width || 1) * 5)\n      bb.width += ((this.style.width || 1) * 5)\n    }\n    return bb\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return this.vertices\n  }\n\n  overlaps(box: TBoundingBox): boolean\n  {\n    return this.bounds.isContained(box) ||\n      this.edges.some(e1 => Box.getSides(box).some(e2 => !!findIntersectionBetween2Segment(e1, e2)))\n  }\n\n  abstract clone(): OIEdgeBase\n}\n","import { TStyle } from \"../style\"\nimport { findIntersectionBetween2Segment, PartialDeep } from \"../utils\"\nimport { Box, TBoundingBox } from \"./Box\"\nimport { OISymbolBase } from \"./OISymbolBase\"\nimport { TPoint } from \"./Point\"\nimport { SymbolType } from \"./Symbol\"\n\n/**\n * @group Primitive\n */\nexport enum ShapeKind\n{\n  Circle = \"circle\",\n  Ellipse = \"ellipse\",\n  Polygon = \"polygon\",\n  Table = \"table\"\n}\n\n/**\n * @group Primitive\n */\nexport abstract class OIShapeBase<K = ShapeKind> extends OISymbolBase<SymbolType.Shape>\n{\n  readonly kind: K\n  readonly isClosed = true\n\n  constructor(kind: K, style?: PartialDeep<TStyle>)\n  {\n    super(SymbolType.Shape, style)\n    this.kind = kind\n  }\n\n  get bounds(): Box\n  {\n    return Box.createFromPoints(this.vertices)\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return this.bounds.snapPoints\n  }\n\n  overlaps(box: TBoundingBox): boolean\n  {\n    return this.bounds.isContained(box) ||\n      this.edges.some(e1 => Box.getSides(box).some(e2 => !!findIntersectionBetween2Segment(e1, e2)))\n  }\n}\n","import { LoggerClass, LoggerManager } from \"../logger\"\nimport { PartialDeep, mergeDeep } from \"../utils\"\nimport { DefaultPenStyle, TPenStyle } from \"./PenStyle\"\nimport { DefaultTheme, TTheme } from \"./Theme\"\n\n/**\n * @group Style\n */\nexport class StyleManager\n{\n  #penStyle!: TPenStyle\n  #theme!: TTheme\n  #penStyleClasses!: string\n  #currentPenStyle!: TPenStyle\n  #logger =  LoggerManager.getLogger(LoggerClass.STYLE)\n\n  constructor(penStyle?: PartialDeep<TPenStyle>, theme?: PartialDeep<TTheme>)\n  {\n    this.#logger.info(\"constructor\", { penStyle, theme })\n    this.setTheme(theme)\n    this.setPenStyleClasses()\n    this.setPenStyle(penStyle)\n  }\n\n  get currentPenStyle(): TPenStyle\n  {\n    return this.#currentPenStyle || this.#penStyle\n  }\n\n  get penStyle(): TPenStyle\n  {\n    return this.#penStyle\n  }\n  setPenStyle(style?: PartialDeep<TPenStyle>)\n  {\n    this.#logger.info(\"setPenStyle\", { style })\n    this.#penStyle = mergeDeep(structuredClone(DefaultPenStyle), style || {}) as TPenStyle\n    this.#currentPenStyle = style || (this.theme[`.${ this.#penStyleClasses }`]) as TPenStyle\n    this.#logger.debug(\"setPenStyle\", this.#currentPenStyle)\n  }\n\n  get theme(): TTheme\n  {\n    return this.#theme\n  }\n  setTheme(theme?: PartialDeep<TTheme>)\n  {\n    this.#logger.info(\"setTheme\", { theme })\n    this.#theme = mergeDeep(structuredClone(DefaultTheme), theme || {}) as TTheme\n    this.#logger.debug(\"setTheme\", this.#theme)\n  }\n\n  get penStyleClasses(): string\n  {\n    return this.#penStyleClasses\n  }\n  setPenStyleClasses(penStyleClass = \"\")\n  {\n    this.#logger.info(\"setPenStyleClasses\", { penStyleClass })\n    this.#penStyleClasses = penStyleClass\n    this.#currentPenStyle = (this.theme[`.${ this.#penStyleClasses }`]) as TPenStyle\n    this.#logger.debug(\"setPenStyleClasses\", this.#currentPenStyle)\n  }\n\n}\n","import { TPoint } from \"../primitive\"\n\n/**\n * @group Transform\n * @remarks Represents a 2D affine transform, defined as a 3x3 matrix with an implicit third raw of <code>[ 0 0 1 ]</code>\n */\nexport type TMatrixTransform = {\n  /**\n   * @remarks scaling x\n   */\n  xx: number,\n  /**\n   * @remarks shearing x\n   */\n  yx: number,\n  /**\n   * @remarks translation x\n   */\n  tx: number,\n  /**\n   * @remarks shearing y\n   */\n  xy: number,\n  /**\n   * @remarks scaling y\n   */\n  yy: number,\n  /**\n   * @remarks translation y\n   */\n  ty: number,\n}\n\n/**\n * @group Transform\n * @remarks Represents a 2D affine transform, defined as a 3x3 matrix with an implicit third raw of <code>[ 0 0 1 ]</code>\n */\nexport class MatrixTransform implements TMatrixTransform\n{\n  xx: number\n  yx: number\n  xy: number\n  yy: number\n  tx: number\n  ty: number\n\n  constructor(xx: number, yx: number, xy: number, yy: number, tx: number, ty: number)\n  {\n    this.xx = xx\n    this.yx = yx\n    this.xy = xy\n    this.yy = yy\n    this.tx = tx\n    this.ty = ty\n  }\n\n  static identity(): MatrixTransform\n  {\n    return new MatrixTransform(1, 0, 0, 1, 0, 0)\n  }\n\n  static applyToPoint(mat: TMatrixTransform, point: TPoint): TPoint\n  {\n    return {\n      x: mat.xx * point.x + mat.xy * point.y + mat.tx,\n      y: mat.yx * point.x + mat.yy * point.y + mat.ty,\n    }\n  }\n\n  static rotation(mat: TMatrixTransform): number\n  {\n    let rotation\n\n    if (mat.xx !== 0 || mat.xy !== 0) {\n      const hypotAc = Math.hypot(mat.xx, mat.xy)\n      rotation = Math.acos(mat.xx / hypotAc) * (mat.xy > 0 ? -1 : 1)\n    } else if (mat.yx !== 0 || mat.yy !== 0) {\n      const hypotBd = Math.hypot(mat.yx, mat.yy)\n      rotation = Math.PI / 2 + Math.acos(mat.yx / hypotBd) * (mat.yy > 0 ? -1 : 1)\n    } else {\n      rotation = 0\n    }\n\n    return rotation\n  }\n\n  static toCssString(matrix: TMatrixTransform): string\n  {\n    return `matrix(${ matrix.xx }, ${ matrix.yx }, ${ matrix.xy }, ${ matrix.yy }, ${ matrix.tx }, ${ matrix.ty })`\n  }\n\n\tinvert() {\n\t\tconst { xx, yx, xy, yy, tx, ty } = this\n\t\tconst denom = xx * yy - yx * xy\n\t\tthis.xx = yy / denom\n\t\tthis.yx = yx / -denom\n\t\tthis.xy = xy / -denom\n\t\tthis.yy = xx / denom\n\t\tthis.tx = (yy * tx - xy * ty) / -denom\n\t\tthis.ty = (yx * tx - xx * ty) / denom\n\t\treturn this\n\t}\n\n  multiply(m: TMatrixTransform): MatrixTransform\n  {\n    const { xx, yx, xy, yy, tx, ty } = this\n    this.xx = xx * m.xx + xy * m.yx\n    this.yx = yx * m.xx + yy * m.yx\n    this.xy = xx * m.xy + xy * m.yy\n    this.yy = yx * m.xy + yy * m.yy\n    this.tx = xx * m.tx + xy * m.ty + tx\n    this.ty = yx * m.tx + yy * m.ty + ty\n    return this\n  }\n\n  translate(tx: number, ty: number): MatrixTransform\n  {\n    return this.multiply({ xx: 1, yx: 0, xy: 0, yy: 1, tx, ty })\n  }\n\n  rotate(radian: number, center?: TPoint): MatrixTransform\n  {\n    if (center) {\n      this.translate(center.x, center.y)\n    }\n    const cosAngle = Math.round(Math.cos(radian) * 1000) / 1000\n    const sinAngle = Math.round(Math.sin(radian) * 1000) / 1000\n    this.multiply({\n      xx: cosAngle,\n      yx: sinAngle,\n      xy: -sinAngle,\n      yy: cosAngle,\n      tx: 0,\n      ty: 0\n    })\n    if (center) {\n      this.translate(-center.x, -center.y)\n    }\n    return this\n  }\n\n  scale(x: number, y: number, center?: TPoint): MatrixTransform\n  {\n    if (center) {\n      this.translate(center.x, center.y)\n    }\n    this.multiply({\n      xx: x,\n      yx: 0,\n      xy: 0,\n      yy: y,\n      tx: 0,\n      ty: 0\n    })\n    if (center) {\n      this.translate(-center.x, -center.y)\n    }\n    return this\n  }\n\n  applyToPoint(point: TPoint): TPoint\n  {\n    return MatrixTransform.applyToPoint(this, point)\n  }\n\n  clone(): MatrixTransform\n  {\n    return new MatrixTransform(this.xx, this.yx, this.xy, this.yy, this.tx, this.ty)\n  }\n\n  toCssString(): string\n  {\n    return MatrixTransform.toCssString(this)\n  }\n\n}\n","import { PartialDeep, createUUID, findIntersectionBetween2Segment } from \"../utils\"\nimport { TBoundingBox } from \"./Box\"\nimport { TPoint, TSegment } from \"./Point\"\nimport { SymbolType, TSymbol } from \"./Symbol\"\nimport { DefaultStyle, TStyle } from \"../style\"\nimport { MatrixTransform } from \"../transform\"\n\n/**\n * @group Primitive\n */\nexport abstract class OISymbolBase<T extends string = SymbolType> implements TSymbol\n{\n  readonly type: T\n  abstract readonly isClosed: boolean\n  style: TStyle\n\n  id: string\n  creationTime: number\n  modificationDate: number\n  selected: boolean\n  deleting: boolean\n  transform: MatrixTransform\n\n  constructor(type: T, style?: PartialDeep<TStyle>)\n  {\n    this.type = type\n    this.id = `${ this.type }-${ createUUID() }`\n\n    this.creationTime = Date.now()\n    this.modificationDate = this.creationTime\n    this.selected = false\n    this.deleting = false\n\n    this.transform = MatrixTransform.identity()\n\n    this.style = Object.assign({}, DefaultStyle, style)\n    this.style.opacity = +this.style.opacity!\n    this.style.width = +this.style.width!\n  }\n\n  abstract get vertices(): TPoint[]\n\n  abstract get snapPoints(): TPoint[]\n\n  get edges(): TSegment[]\n  {\n    if (this.isClosed) {\n      return this.vertices.map((p, i) =>\n        {\n          if (i === this.vertices.length - 1) {\n            return { p1: p, p2: this.vertices[0] }\n          }\n          else {\n            return { p1: p, p2: this.vertices[i + 1] }\n          }\n        })\n    }\n    else {\n      return this.vertices.slice(0, -1).map((p, i) =>\n      {\n        return { p1: p, p2: this.vertices[i + 1] }\n      })\n    }\n  }\n\n  abstract overlaps(box: TBoundingBox): boolean\n\n  abstract clone(): OISymbolBase\n\n  abstract toJSON(): PartialDeep<OISymbolBase>\n\n  isIntersected(seg: TSegment): boolean\n  {\n    return this.edges.some(edge =>\n    {\n      return findIntersectionBetween2Segment(edge, seg)\n    })\n  }\n}\n","import { PartialDeep, isValidNumber } from \"../utils\"\n\n/**\n * @group Primitive\n */\nexport type TPoint = {\n  x: number\n  y: number\n}\n\n/**\n * @group Primitive\n */\nexport type TPointer = TPoint & {\n  t: number\n  p: number\n}\n\n/**\n * @group Primitive\n */\nexport type TSegment = {\n  p1: TPoint\n  p2: TPoint\n}\n\n/**\n * @group Primitive\n */\nexport function isValidPoint(p?: PartialDeep<TPoint>): boolean\n{\n  if (!p) return false\n  if (!isValidNumber(p.x)) return false\n  if (!isValidNumber(p.y)) return false\n  return true\n}\n","import { SELECTION_MARGIN } from \"../Constants\"\nimport { TStyle } from \"../style\"\nimport { PartialDeep, computePointOnEllipse, isValidNumber } from \"../utils\"\nimport { EdgeDecoration, EdgeKind, OIEdgeBase } from \"./OIEdge\"\nimport { TPoint, isValidPoint } from \"./Point\"\n\n/**\n * @group Primitive\n */\nexport class OIEdgeArc extends OIEdgeBase<EdgeKind.Arc>\n{\n  center: TPoint\n  startAngle: number\n  sweepAngle: number\n  radiusX: number\n  radiusY: number\n  phi: number\n  protected _vertices: Map<string, TPoint[]>\n\n  constructor(\n    center: TPoint,\n    startAngle: number,\n    sweepAngle: number,\n    radiusX: number,\n    radiusY: number,\n    phi: number,\n    startDecoration?: EdgeDecoration,\n    endDecoration?: EdgeDecoration,\n    style?: PartialDeep<TStyle>,\n  )\n  {\n    super(EdgeKind.Arc, startDecoration, endDecoration, style)\n    this.center = center\n    this.startAngle = startAngle\n    this.sweepAngle = sweepAngle\n    this.radiusX = radiusX\n    this.radiusY = radiusY\n    this.phi = phi\n    this._vertices = new Map<string, TPoint[]>()\n    this._vertices.set(this.verticesId, this.computedVertices())\n  }\n\n  protected get verticesId(): string\n  {\n    return `${ this.center.x }-${ this.center.y }-${ this.startAngle }-${ this.sweepAngle }-${ this.radiusX }-${ this.radiusY }-${ this.phi }`\n  }\n\n  protected computedVertices(): TPoint[]\n  {\n    const length = Math.abs(this.sweepAngle) * Math.sqrt((Math.pow(this.radiusX, 2) + Math.pow(this.radiusY, 2)) / 2)\n    const nbVertices = Math.max(8, Math.round(length / SELECTION_MARGIN))\n    const angleStep = this.sweepAngle / nbVertices\n    const v: TPoint[] = []\n    const endAngle = this.startAngle + this.sweepAngle\n    if (this.sweepAngle > 0) {\n      for (let angle = this.startAngle; angle < endAngle; angle += angleStep) {\n        v.push(computePointOnEllipse(this.center, this.radiusX, this.radiusY, this.phi, angle))\n      }\n    } else {\n      for (let angle = this.startAngle; angle > endAngle; angle += angleStep) {\n        v.push(computePointOnEllipse(this.center, this.radiusX, this.radiusY, this.phi, angle))\n      }\n    }\n    v.push(computePointOnEllipse(this.center, this.radiusX, this.radiusY, this.phi, endAngle))\n    return v\n  }\n\n  get vertices(): TPoint[]\n  {\n    if (!this._vertices.has(this.verticesId)) {\n      this._vertices.set(this.verticesId, this.computedVertices())\n    }\n    return this._vertices.get(this.verticesId)!\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return [\n      this.vertices[0],\n      this.vertices.at(-1)!\n    ]\n  }\n\n  clone(): OIEdgeArc\n  {\n    const clone = new OIEdgeArc(\n      structuredClone(this.center),\n      this.startAngle,\n      this.sweepAngle,\n      this.radiusX,\n      this.radiusY,\n      this.phi,\n      this.startDecoration,\n      this.endDecoration,\n      structuredClone(this.style)\n    )\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<OIEdgeArc>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      center: this.center,\n      startAngle: this.startAngle,\n      sweepAngle: this.sweepAngle,\n      radiusX: this.radiusX,\n      radiusY: this.radiusY,\n      phi: this.phi,\n      startDecoration: this.startDecoration,\n      style: this.style,\n      endDecoration: this.endDecoration,\n    }\n  }\n\n  static create(partial: PartialDeep<OIEdgeArc>): OIEdgeArc\n  {\n    if (!isValidPoint(partial?.center)) throw new Error(`Unable to create a arc, center point is invalid`)\n    if (!isValidNumber(partial?.startAngle)) throw new Error(`Unable to create a arc, startAngle is invalid`)\n    if (!isValidNumber(partial?.sweepAngle)) throw new Error(`Unable to create a arc, sweepAngle is invalid`)\n    if (!isValidNumber(partial?.radiusX)) throw new Error(`Unable to create a arc, radiusX is invalid`)\n    if (!isValidNumber(partial?.radiusY)) throw new Error(`Unable to create a arc, radiusY is invalid`)\n    const arc = new OIEdgeArc(\n      partial?.center as TPoint,\n      partial.startAngle!,\n      partial.sweepAngle!,\n      partial.radiusX!,\n      partial.radiusY!,\n      partial.phi || 0,\n      partial.startDecoration,\n      partial.endDecoration,\n      partial.style\n    )\n    if (partial.id) {\n      arc.id = partial.id\n    }\n    return arc\n  }\n}\n","import { TStyle } from \"../style\"\nimport { PartialDeep } from \"../utils\"\nimport { EdgeDecoration, EdgeKind, OIEdgeBase } from \"./OIEdge\"\nimport { TPoint, isValidPoint } from \"./Point\"\n\n/**\n * @group Primitive\n */\nexport class OIEdgeLine extends OIEdgeBase<EdgeKind.Line>\n{\n  start: TPoint\n  end: TPoint\n\n  constructor(\n    start: TPoint,\n    end: TPoint,\n    startDecoration?: EdgeDecoration,\n    endDecoration?: EdgeDecoration,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(EdgeKind.Line, startDecoration, endDecoration, style)\n    this.start = start\n    this.end = end\n  }\n\n  get vertices(): TPoint[]\n  {\n    return [\n      this.start,\n      this.end\n    ]\n  }\n\n  clone(): OIEdgeLine\n  {\n    const clone = new OIEdgeLine(structuredClone(this.start), structuredClone(this.end), this.startDecoration, this.endDecoration, structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<OIEdgeLine>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      start: this.start,\n      end: this.end,\n      style: this.style,\n      startDecoration: this.startDecoration,\n      endDecoration: this.endDecoration,\n    }\n  }\n\n  static create(partial: PartialDeep<OIEdgeLine>): OIEdgeLine\n  {\n    if (!isValidPoint(partial?.start)) throw new Error(`Unable to create a arc, start point is invalid`)\n    if (!isValidPoint(partial?.end)) throw new Error(`Unable to create a arc, end point is invalid`)\n    const line = new OIEdgeLine(partial?.start as TPoint, partial?.end as TPoint, partial.startDecoration, partial.endDecoration, partial.style)\n    if (partial.id) {\n      line.id = partial.id\n    }\n    return line\n  }\n}\n","import { TStyle } from \"../style\"\nimport { PartialDeep } from \"../utils\"\nimport { EdgeDecoration, EdgeKind, OIEdgeBase } from \"./OIEdge\"\nimport { TPoint, isValidPoint } from \"./Point\"\n\n/**\n * @group Primitive\n */\nexport class OIEdgePolyLine extends OIEdgeBase<EdgeKind.PolyEdge>\n{\n  points: TPoint[]\n\n  constructor(\n    points: TPoint[],\n    startDecoration?: EdgeDecoration,\n    endDecoration?: EdgeDecoration,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(EdgeKind.PolyEdge, startDecoration, endDecoration, style)\n    this.points = points\n  }\n\n  get vertices(): TPoint[]\n  {\n    return this.points\n  }\n\n  clone(): OIEdgePolyLine\n  {\n    const clone = new OIEdgePolyLine(structuredClone(this.points),this.startDecoration, this.endDecoration, structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<OIEdgePolyLine>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      points: this.points,\n      style: this.style,\n      startDecoration: this.startDecoration,\n      endDecoration: this.endDecoration,\n    }\n  }\n\n  static create(partial: PartialDeep<OIEdgePolyLine>): OIEdgePolyLine\n  {\n    if (!partial?.points?.map(p => isValidPoint(p))) throw new Error(`Unable to create a PolyLine, points are invalid`)\n    const polyline = new OIEdgePolyLine(partial?.points as TPoint[], partial.startDecoration, partial.endDecoration, partial.style)\n    if (partial.id) {\n      polyline.id = partial.id\n    }\n    return polyline\n  }\n}\n","import { SELECTION_MARGIN } from \"../Constants\"\nimport { TStyle } from \"../style\"\nimport { PartialDeep, computePointOnEllipse, findIntersectionBetween2Segment, isValidNumber, } from \"../utils\"\nimport { TPoint, isValidPoint } from \"./Point\"\nimport { OIShapeBase, ShapeKind } from \"./OIShape\"\nimport { Box, TBoundingBox } from \"./Box\"\n\n/**\n * @group Primitive\n */\nexport class OIShapeEllipse extends OIShapeBase<ShapeKind.Ellipse>\n{\n  center: TPoint\n  radiusX: number\n  radiusY: number\n  orientation: number\n  protected _vertices: Map<string, TPoint[]>\n\n  constructor(\n    center: TPoint,\n    radiusX: number,\n    radiusY: number,\n    orientation: number,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(ShapeKind.Ellipse, style)\n    this.center = center\n    this.radiusX = radiusX\n    this.radiusY = radiusY\n    this.orientation = orientation\n    this._vertices = new Map<string, TPoint[]>()\n  }\n\n  protected get verticesId(): string\n  {\n    return `${ this.center.x }-${ this.center.y }-${ this.radiusX }-${ this.radiusY }-${ this.orientation }`\n  }\n\n  protected computedVertices(): TPoint[]\n  {\n    const points: TPoint[] = []\n    const perimeter = 2 * Math.PI * Math.sqrt((Math.pow(this.radiusX, 2) + Math.pow(this.radiusY, 2)) / 2)\n    const nbPoint = Math.max(8, Math.round(perimeter / SELECTION_MARGIN))\n    for (let i = 0; i < nbPoint; i++) {\n      const theta = 2 * Math.PI * (i / nbPoint)\n      points.push(computePointOnEllipse(this.center, this.radiusX, this.radiusY, this.orientation, theta))\n    }\n\n    return points\n  }\n\n  get vertices(): TPoint[]\n  {\n    if (!this._vertices.has(this.verticesId)) {\n      this._vertices.set(this.verticesId, this.computedVertices())\n    }\n    return this._vertices.get(this.verticesId)!\n  }\n\n  overlaps(box: TBoundingBox): boolean\n  {\n\n    return this.bounds.isContained(box) ||\n      this.edges.some(e1 => Box.getSides(box).some(e2 => !!findIntersectionBetween2Segment(e1, e2)))\n  }\n\n  clone(): OIShapeEllipse\n  {\n    const clone = new OIShapeEllipse(structuredClone(this.center), this.radiusX, this.radiusY, this.orientation, structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<OIShapeEllipse>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      center: this.center,\n      orientation: this.orientation,\n      radiusX: this.radiusX,\n      radiusY: this.radiusY,\n      style: this.style,\n    }\n  }\n\n  static createBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): OIShapeEllipse\n  {\n    const center = {\n      x: (origin.x + target.x) / 2,\n      y: (origin.y + target.y) / 2\n    }\n    const radiusX = Math.abs(origin.x - target.x) / 2\n    const radiusY = Math.abs(origin.y - target.y) / 2\n    return new OIShapeEllipse(center, radiusX, radiusY, 0, style)\n  }\n\n  static updateBetweenPoints(ellipse: OIShapeEllipse, origin: TPoint, target: TPoint): OIShapeEllipse\n  {\n    ellipse.center = {\n      x: (origin.x + target.x) / 2,\n      y: (origin.y + target.y) / 2\n    }\n    ellipse.radiusX = Math.abs(origin.x - target.x) / 2\n    ellipse.radiusY = Math.abs(origin.y - target.y) / 2\n    return ellipse\n  }\n\n  static create(partial: PartialDeep<OIShapeEllipse>): OIShapeEllipse\n  {\n    if (!isValidPoint(partial.center)) throw new Error(`Unable to create ellipse, center is undefined`)\n    if (!isValidNumber(partial.radiusX)) throw new Error(`Unable to create ellipse, radiusX is undefined`)\n    if (!isValidNumber(partial.radiusY)) throw new Error(`Unable to create ellipse, radiusY is undefined`)\n    const ellipse = new OIShapeEllipse(partial.center as TPoint, partial.radiusX!, partial.radiusY!, partial.orientation || 0, partial.style)\n    if (partial.id) {\n      ellipse.id = partial.id\n    }\n    return ellipse\n  }\n}\n","import { SELECTION_MARGIN } from \"../Constants\"\nimport { TStyle } from \"../style\"\nimport { PartialDeep, findIntersectBetweenSegmentAndCircle, isValidNumber, computeRotatedPoint } from \"../utils\"\nimport { TPoint, isValidPoint } from \"./Point\"\nimport { OIShapeBase, ShapeKind } from \"./OIShape\"\nimport { Box, TBoundingBox } from \"./Box\"\n\n/**\n * @group Primitive\n */\nexport class OIShapeCircle extends OIShapeBase<ShapeKind.Circle>\n{\n  center: TPoint\n  radius: number\n  protected _vertices: Map<string, TPoint[]>\n  protected _bounds: Map<string, Box>\n\n  constructor(\n    center: TPoint,\n    radius: number,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(ShapeKind.Circle, style)\n    this.center = center\n    this.radius = radius\n    this._vertices = new Map<string, TPoint[]>()\n    this._vertices.set(this.verticesId, this.computedVertices())\n    this._bounds = new Map<string, Box>()\n    this._bounds.set(this.verticesId, this.computedBondingBox())\n  }\n\n  protected get verticesId(): string\n  {\n    return `${ this.center.x }-${ this.center.y }-${ this.radius }`\n  }\n\n  protected computedVertices(): TPoint[]\n  {\n    const firstPoint: TPoint = {\n      x: this.center.x,\n      y: this.radius + this.center.y\n    }\n    const perimeter = 2 * Math.PI * this.radius\n    const nbPoint = Math.max(8, Math.round(perimeter / SELECTION_MARGIN))\n    const points: TPoint[] = []\n    for (let i = 0; i < nbPoint; i++) {\n      const rad = 2 * Math.PI * (i / nbPoint)\n      points.push(computeRotatedPoint(firstPoint, this.center, rad))\n    }\n    return points\n  }\n\n  protected computedBondingBox(): Box\n  {\n    const boundingBox: TBoundingBox = {\n      x: this.center.x - this.radius,\n      y: this.center.y - this.radius,\n      height: this.radius * 2,\n      width: this.radius * 2\n    }\n    this._bounds\n    return new Box(boundingBox)\n  }\n\n  get bounds(): Box\n  {\n    if (!this._bounds.has(this.verticesId)) {\n      this._bounds.set(this.verticesId, this.computedBondingBox())\n    }\n    return this._bounds.get(this.verticesId)!\n  }\n\n  get vertices(): TPoint[]\n  {\n    if (!this._vertices.has(this.verticesId)) {\n      this._vertices.set(this.verticesId, this.computedVertices())\n    }\n    return this._vertices.get(this.verticesId)!\n  }\n\n\n  overlaps(box: TBoundingBox): boolean\n  {\n    return this.bounds.isContained(box) ||\n      Box.getSides(box).some(seg => findIntersectBetweenSegmentAndCircle(seg, this.center, this.radius).length)\n  }\n\n  clone(): OIShapeCircle\n  {\n    const clone = new OIShapeCircle(structuredClone(this.center), this.radius, structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<OIShapeCircle>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      center: this.center,\n      radius: this.radius,\n      style: this.style,\n    }\n  }\n\n  static createBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): OIShapeCircle\n  {\n    const center = {\n      x: (origin.x + target.x) / 2,\n      y: (origin.y + target.y) / 2\n    }\n\n    const width = Math.abs(origin.x - target.x)\n    const height = Math.abs(origin.y - target.y)\n    const radius = Math.min(width, height) / 2\n    return new OIShapeCircle(center, radius, style)\n  }\n  static updateBetweenPoints(circle: OIShapeCircle, origin: TPoint, target: TPoint): OIShapeCircle\n  {\n    circle.center = {\n      x: (origin.x + target.x) / 2,\n      y: (origin.y + target.y) / 2\n    }\n    const width = Math.abs(origin.x - target.x)\n    const height = Math.abs(origin.y - target.y)\n    circle.radius = Math.min(width, height) / 2\n    return circle\n  }\n\n  static create(partial: PartialDeep<OIShapeCircle>): OIShapeCircle\n  {\n    if (!isValidPoint(partial.center)) throw new Error(`Unable to create circle, center is invalid`)\n    if (!isValidNumber(partial.radius)) throw new Error(`Unable to create circle, radius is undefined`)\n    const circle = new OIShapeCircle(partial.center as TPoint, partial.radius!, partial.style)\n    if (partial.id) {\n      circle.id = partial.id\n    }\n    return circle\n  }\n}\n","import { TStyle } from \"../style\"\nimport { TPoint, isValidPoint } from \"./Point\"\nimport { OIShapeBase, ShapeKind } from \"./OIShape\"\nimport { Box } from \"./Box\"\nimport { PartialDeep } from \"../utils\"\n\n/**\n * @group Primitive\n */\nexport class OIShapePolygon extends OIShapeBase<ShapeKind.Polygon>\n{\n  points: TPoint[]\n\n  constructor(points: TPoint[], style?: PartialDeep<TStyle>)\n  {\n    super(ShapeKind.Polygon, style)\n    this.points = points\n  }\n\n  get vertices(): TPoint[]\n  {\n    return this.points\n  }\n\n  get bounds(): Box\n  {\n    return Box.createFromPoints(this.vertices)\n  }\n\n  clone(): OIShapePolygon\n  {\n    const clone = new OIShapePolygon(structuredClone(this.points), structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<OIShapePolygon>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      points: this.points,\n      style: this.style,\n    }\n  }\n\n  static create(partial: PartialDeep<OIShapePolygon>): OIShapePolygon\n  {\n    if (!partial?.points || partial?.points?.length < 3) throw new Error(`Unable to create polygon at least 3 points required`)\n    if (partial?.points?.some(p => !isValidPoint(p))) throw new Error(`Unable to create a polygon, one or more points are invalid`)\n    const polygon = new OIShapePolygon(partial.points as TPoint[], partial.style)\n    if (partial.id) {\n      polygon.id = partial.id\n    }\n    return polygon\n  }\n\n  static createTriangleBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): OIShapePolygon\n  {\n    const points: TPoint[] = [\n      { x: origin.x, y: origin.y },\n      { x: target.x, y: origin.y },\n      { x: (origin.x + target.x) / 2, y: target.y }\n    ]\n    return new OIShapePolygon(points, style)\n  }\n  static updateTriangleBetweenPoints(poly: OIShapePolygon, origin: TPoint, target: TPoint): OIShapePolygon\n  {\n    poly.points = [\n      { x: origin.x, y: origin.y },\n      { x: target.x, y: origin.y },\n      { x: (origin.x + target.x) / 2, y: target.y }\n    ]\n    poly.modificationDate = Date.now()\n    return poly\n  }\n\n  static createParallelogramBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): OIShapePolygon\n  {\n    const points: TPoint[] = [\n      { x: origin.x, y: origin.y },\n      { x: origin.x + (target.x - origin.x) * 0.75, y: origin.y },\n      { x: target.x, y: target.y },\n      { x: origin.x + (target.x - origin.x) * 0.25, y: target.y },\n    ]\n    return new OIShapePolygon(points, style)\n  }\n  static updateParallelogramBetweenPoints(poly: OIShapePolygon, origin: TPoint, target: TPoint): OIShapePolygon\n  {\n    const points: TPoint[] = [\n      { x: origin.x, y: origin.y },\n      { x: origin.x + (target.x - origin.x) * 0.75, y: origin.y },\n      { x: target.x, y: target.y },\n      { x: origin.x + (target.x - origin.x) * 0.25, y: target.y },\n    ]\n    poly.points = points\n    poly.modificationDate = Date.now()\n    return poly\n  }\n\n  static createRectangleBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): OIShapePolygon\n  {\n    const box = Box.createFromPoints([origin, target])\n    const points: TPoint[] = [\n      { x: box.xMin, y: box.yMin },\n      { x: box.xMax, y: box.yMin },\n      { x: box.xMax, y: box.yMax },\n      { x: box.xMin, y: box.yMax },\n    ]\n    return new OIShapePolygon(points, style)\n  }\n  static updateRectangleBetweenPoints(poly: OIShapePolygon, origin: TPoint, target: TPoint): OIShapePolygon\n  {\n    const box = Box.createFromPoints([origin, target])\n    const points: TPoint[] = [\n      { x: box.xMin, y: box.yMin },\n      { x: box.xMax, y: box.yMin },\n      { x: box.xMax, y: box.yMax },\n      { x: box.xMin, y: box.yMax },\n    ]\n    poly.points = points\n    poly.modificationDate = Date.now()\n    return poly\n  }\n\n  static createRhombusBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): OIShapePolygon\n  {\n    const box = Box.createFromPoints([origin, target])\n    const points: TPoint[] = [\n      { x: box.xMid, y: box.yMin },\n      { x: box.xMax, y: box.yMid },\n      { x: box.xMid, y: box.yMax },\n      { x: box.xMin, y: box.yMid },\n    ]\n    return new OIShapePolygon(points, style)\n  }\n\n  static updateRhombusBetweenPoints(poly: OIShapePolygon, origin: TPoint, target: TPoint): OIShapePolygon\n  {\n    const box = Box.createFromPoints([origin, target])\n    const points: TPoint[] = [\n      { x: box.xMid, y: box.yMin },\n      { x: box.xMax, y: box.yMid },\n      { x: box.xMid, y: box.yMax },\n      { x: box.xMin, y: box.yMid },\n    ]\n    poly.points = points\n    poly.modificationDate = Date.now()\n    return poly\n  }\n}\n","import { TStyle } from \"../style\"\nimport { PartialDeep, computeDistance, getClosestPoint } from \"../utils\"\nimport { TStroke, TStrokeToSend } from \"./Stroke\"\nimport { TPoint, TPointer } from \"./Point\"\nimport { Box, TBoundingBox } from \"./Box\"\nimport { SymbolType } from \"./Symbol\"\nimport { OIDecorator } from \"./OIDecorator\"\nimport { OISymbolBase } from \"./OISymbolBase\"\n\n/**\n * @group Primitive\n */\nexport class OIStroke extends OISymbolBase<SymbolType.Stroke>\n{\n  readonly isClosed = false\n\n  pointerType: string\n  length: number\n  decorators: OIDecorator[]\n  pointers: Array<TPointer>\n\n  constructor(style?: PartialDeep<TStyle>, pointerType = \"pen\")\n  {\n    super(SymbolType.Stroke, style)\n\n    this.pointerType = pointerType\n    this.pointers = []\n    this.decorators = []\n    this.length = 0\n  }\n\n  get bounds(): Box\n  {\n    return Box.createFromPoints(this.vertices)\n  }\n\n  static split(strokeToSplit: OIStroke, i: number): { before: OIStroke, after: OIStroke }\n  {\n    const before = new OIStroke(strokeToSplit.style, strokeToSplit.pointerType)\n    before.pointers = strokeToSplit.pointers.slice(0, i)\n\n    const after = new OIStroke(strokeToSplit.style, strokeToSplit.pointerType)\n    after.pointers = strokeToSplit.pointers.slice(i)\n\n    return { before, after }\n  }\n\n  static substract(stroke: OIStroke, partStroke: OIStroke): { before?: OIStroke, after?: OIStroke }\n  {\n    if (!partStroke.length) return { before: stroke }\n    const result: { before?: OIStroke, after?: OIStroke } = {}\n    const lastPointBeforeStroke = {\n      x: partStroke.pointers[0].x as number,\n      y: partStroke.pointers[0].y as number\n    }\n    const closestLastPointBeforeStroke = getClosestPoint(stroke.pointers, lastPointBeforeStroke)\n    if (closestLastPointBeforeStroke.index > -1) {\n      const newStrokes = OIStroke.split(stroke, closestLastPointBeforeStroke.index)\n      result.before = newStrokes.before\n      result.after = newStrokes.after\n    }\n    const strokeAfter = result.after || stroke\n    const firstPointAfterStroke = {\n      x: partStroke.pointers.at(-1)!.x as number,\n      y: partStroke.pointers.at(-1)!.y as number\n    }\n    const closestFirstPointStrokeAfter = getClosestPoint(strokeAfter.pointers, firstPointAfterStroke)\n    if (closestFirstPointStrokeAfter.index > -1) {\n      const newStrokes = OIStroke.split(strokeAfter, closestFirstPointStrokeAfter.index)\n      result.after = newStrokes.after\n    }\n    if (!result.before?.pointers.length) result.before = undefined\n    if (!result.after?.pointers.length) result.after = undefined\n    return result\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return this.bounds.snapPoints\n  }\n\n  get vertices(): TPoint[]\n  {\n    return this.pointers\n  }\n\n  protected computePressure(distance: number): number\n  {\n    let ratio = 1.0\n    if (distance === this.length) {\n      ratio = 1.0\n    } else if (distance < 10) {\n      ratio = 0.2 + Math.pow(0.1 * distance, 0.4)\n    } else if (distance > this.length - 10) {\n      ratio = 0.2 + Math.pow(0.1 * (this.length - distance), 0.4)\n    }\n    const pressure = ratio * Math.max(0.1, 1.0 - (0.1 * Math.sqrt(distance)))\n    return isNaN(pressure) ? 0.5 : Math.round(pressure * 100) / 100\n  }\n\n  protected filterPointByAcquisitionDelta(point: TPointer): boolean\n  {\n    const lastPointer = this.pointers.at(-1)\n    const delta: number = (2 + ((this.style.width || 1) / 4))\n    return !lastPointer ||\n      Math.abs(lastPointer.x - point.x) >= delta ||\n      Math.abs(lastPointer.y - point.y) >= delta\n  }\n\n  addPointer(pointer: TPointer): void\n  {\n    if (this.filterPointByAcquisitionDelta(pointer)) {\n      const lastPointer = this.pointers.at(-1)\n      const distance = lastPointer ? computeDistance(pointer, lastPointer) : 0\n      this.length += distance\n      pointer.p = this.computePressure(distance)\n      this.pointers.push(pointer)\n      this.modificationDate = Date.now()\n    }\n  }\n\n  overlaps(box: TBoundingBox): boolean\n  {\n    return this.pointers.some(p =>\n    {\n      return p.x >= box.x && p.x <= box.x + box.width\n        && p.y >= box.y && p.y <= box.y + box.height\n    })\n  }\n\n  clone(): OIStroke\n  {\n    const clone = new OIStroke(this.style, this.pointerType)\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    clone.pointers = structuredClone(this.pointers)\n    clone.decorators = this.decorators.map(d => d.clone())\n    clone.length = this.length\n    return clone\n  }\n\n  formatToSend(): TStrokeToSend\n  {\n    const json: TStrokeToSend = {\n      id: this.id,\n      pointerType: this.pointerType,\n      p: [],\n      t: [],\n      x: [],\n      y: []\n    }\n    this.pointers.forEach(p =>\n    {\n      json.p.push(p.p)\n      json.t.push(p.t)\n      json.x.push(p.x)\n      json.y.push(p.y)\n    })\n    return json\n  }\n\n  toJSON(): PartialDeep<OIStroke>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      pointers: this.pointers,\n      style: this.style,\n      decorators: this.decorators.length ? this.decorators : undefined\n    }\n  }\n\n  static create(partial: PartialDeep<OIStroke>): OIStroke\n  {\n    if (!partial.pointers?.length) {\n      throw new Error(`not pointers`)\n    }\n    const stroke = new OIStroke(partial.style, partial.pointerType)\n    if (partial.id) {\n      stroke.id = partial.id\n    }\n    const errors: string[] = []\n    let flag = true\n    partial.pointers?.forEach((pp, pIndex) =>\n    {\n      if (!pp) {\n        errors.push(`no pointer at ${ pIndex }`)\n        flag = false\n        return\n      }\n      const pointer: TPointer = {\n        p: pp.p || 1,\n        t: pp.t || pIndex,\n        x: 0,\n        y: 0\n      }\n      if (pp?.x == undefined || pp?.x == null) {\n        errors.push(`no x at pointer at ${ pIndex }`)\n        flag = false\n        return\n      }\n      else {\n        pointer.x = pp.x\n      }\n      if (pp?.y == undefined || pp?.y == null) {\n        errors.push(`no y at pointer at ${ pIndex }`)\n        flag = false\n        return\n      }\n      else {\n        pointer.y = pp.y\n      }\n      if (flag) {\n        stroke.addPointer(pointer)\n      }\n    })\n\n    if (errors.length) {\n      throw new Error(errors.join(\" and \"))\n    }\n    if (partial.decorators?.length) {\n      partial.decorators.forEach(d => {\n        if(d?.kind) {\n          stroke.decorators.push(new OIDecorator(d.kind, Object.assign({}, stroke.style, d.style)))\n        }\n      })\n    }\n    return stroke\n  }\n}\n\n/**\n * @group Primitive\n * @group Utils\n */\nexport function convertPartialStrokesToOIStrokes(json: PartialDeep<TStroke>[]): OIStroke[]\n{\n  const errors: string[] = []\n  const strokes: OIStroke[] = []\n  json.forEach((j, i) =>\n  {\n    try {\n      strokes.push(OIStroke.create(j as PartialDeep<OIStroke>))\n    } catch (e) {\n      errors.push(`stroke ${ i + 1 } has ${ (e as Error).message }`)\n    }\n  })\n\n  if (errors.length) {\n    throw new Error(errors.join(\"\\n\"))\n  }\n\n  return strokes\n}\n","import { TStyle } from \"../style\"\nimport { PartialDeep } from \"../utils\"\nimport { TPoint } from \"./Point\"\nimport { Box, TBoundingBox } from \"./Box\"\nimport { SymbolType } from \"./Symbol\"\nimport { OIDecorator } from \"./OIDecorator\"\nimport { OISymbolBase } from \"./OISymbolBase\"\nimport { OIStroke } from \"./OIStroke\"\nimport { TOISymbol } from \".\"\n\n/**\n * @group Primitive\n */\nexport class OISymbolGroup extends OISymbolBase<SymbolType.Group>\n{\n  readonly isClosed = false\n\n  children: TOISymbol[]\n  decorators: OIDecorator[]\n\n  constructor(\n    children: TOISymbol[],\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(SymbolType.Group, style)\n    this.children = children\n    this.decorators = []\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return this.bounds.snapPoints\n  }\n\n  get vertices(): TPoint[]\n  {\n    return this.children.flatMap(s => s.vertices)\n  }\n\n  get bounds(): Box\n  {\n    return Box.createFromBoxes(this.children.map(c => c.bounds))\n  }\n\n  updateChildrenStyle(): void\n  {\n    this.children.forEach(child => {\n      child.style = Object.assign({}, child.style, this.style)\n      if (child.type === SymbolType.Text) {\n        child.chars.forEach(c =>\n        {\n          if (child.style.color) {\n            c.color = child.style.color\n          }\n        })\n      }\n      else if (child.type === SymbolType.Group) {\n        child.updateChildrenStyle()\n      }\n    })\n  }\n\n  overlaps(box: TBoundingBox): boolean\n  {\n    return this.children.some(s => s.overlaps(box))\n  }\n\n  containsSymbol(strokeId: string): boolean\n  {\n    return OISymbolGroup.containsSymbol(this, strokeId)\n  }\n\n  containsOnlyStroke(): boolean\n  {\n    return OISymbolGroup.containsOnlyStroke(this)\n  }\n\n  extractSymbols(): TOISymbol[]\n  {\n    return OISymbolGroup.extractSymbols(this)\n  }\n\n  extractStrokes(): OIStroke[]\n  {\n    return OISymbolGroup.extractStrokes(this)\n  }\n\n  removeChilds(symbolIds: string[]): OISymbolGroup\n  {\n    return OISymbolGroup.removeChilds(this, symbolIds)\n  }\n\n  static containsOnlyStroke(group: OISymbolGroup): boolean\n  {\n    return group.children.every(s =>\n    {\n      if (s.type === SymbolType.Group) {\n        return OISymbolGroup.containsOnlyStroke(s as OISymbolGroup)\n      }\n      if (s.type === SymbolType.Stroke) {\n        return true\n      }\n      return false\n    })\n  }\n\n  static extractSymbols(group: OISymbolGroup): TOISymbol[]\n  {\n    return group.children.flatMap(s =>\n    {\n      if (s.type === SymbolType.Group) {\n        return OISymbolGroup.extractSymbols(s as OISymbolGroup).concat(s)\n      }\n      return s\n    })\n  }\n\n  static extractStrokes(group: OISymbolGroup): OIStroke[]\n  {\n    return group.children.flatMap(s =>\n    {\n      if (s.type === SymbolType.Stroke) {\n        return s as OIStroke\n      }\n      if (s.type === SymbolType.Group) {\n        return OISymbolGroup.extractStrokes(s as OISymbolGroup)\n      }\n      return\n    }).filter(s => !!s) as OIStroke[]\n  }\n\n  static containsSymbol(group: OISymbolGroup, symbolId: string): boolean\n  {\n    return group.children.some(symbol =>\n    {\n      if (symbol.type === SymbolType.Group) {\n        return OISymbolGroup.containsSymbol(symbol as OISymbolGroup, symbolId)\n      }\n      return symbol.id === symbolId\n    })\n  }\n\n  static removeChilds(group: OISymbolGroup, symbolIds: string[]): OISymbolGroup\n  {\n    group.children = group.children.filter(s => !symbolIds.includes(s.id))\n    const symbolsToRemove = group.children.slice()\n    symbolsToRemove.forEach(s =>\n    {\n      if (s.type === SymbolType.Group) {\n        if (!s.removeChilds(symbolIds).children.length) {\n          group.children = group.children.filter(s1 => s1.id !== s.id)\n        }\n      }\n    })\n    return group\n  }\n\n  clone(): OISymbolGroup\n  {\n    const clone = new OISymbolGroup(this.children.map(s => s.clone()), structuredClone({ ...this.style }))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    clone.decorators = this.decorators.map(d => d.clone())\n    return clone\n  }\n\n  toJSON(): PartialDeep<OISymbolGroup>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      children: JSON.parse(JSON.stringify(this.children)),\n      decorators: this.decorators.length ? JSON.parse(JSON.stringify(this.decorators)) : undefined\n    }\n  }\n}\n","import { TStyle } from \"../style\"\nimport { PartialDeep, convertDegreeToRadian, findIntersectionBetween2Segment, isPointInsidePolygon, computeRotatedPoint } from \"../utils\"\nimport { TPoint, isValidPoint } from \"./Point\"\nimport { SymbolType } from \"./Symbol\"\nimport { Box, TBoundingBox } from \"./Box\"\nimport { OIDecorator } from \"./OIDecorator\"\nimport { OISymbolBase } from \"./OISymbolBase\"\n\n/**\n * @group Primitive\n */\nexport type TOISymbolChar = {\n  id: string\n  label: string\n  fontSize: number\n  fontWeight: \"normal\" | \"bold\"\n  color: string\n  bounds: TBoundingBox\n}\n\n/**\n * @group Primitive\n */\nexport class OIText extends OISymbolBase<SymbolType.Text>\n{\n  readonly isClosed = true\n\n  point: TPoint\n  chars: TOISymbolChar[]\n  decorators: OIDecorator[]\n  bounds: Box\n  rotation?: {\n    degree: number,\n    center: TPoint\n  }\n\n  constructor(\n    chars: TOISymbolChar[],\n    point: TPoint,\n    bounds: TBoundingBox,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(SymbolType.Text, style)\n    this.point = point\n    this.bounds = new Box(bounds)\n    this.chars = chars\n    this.decorators = []\n  }\n\n  get label(): string\n  {\n    return this.chars.map(c => c.label).join(\"\")\n  }\n\n  get vertices(): TPoint[]\n  {\n    if (this.rotation) {\n      const center = this.rotation.center\n      const rad = convertDegreeToRadian(-this.rotation.degree)\n      return this.bounds.corners\n        .map(p =>\n        {\n          return computeRotatedPoint(p, center, rad)\n        })\n    }\n    else {\n      return this.bounds.corners\n    }\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    const offsetY = this.bounds.yMax - this.point.y\n    const points = [\n      { x: this.bounds.x, y: this.bounds.yMin + offsetY },\n      { x: this.bounds.xMax, y: this.bounds.yMin + offsetY },\n      { x: this.bounds.xMax, y: this.bounds.yMax - offsetY },\n      { x: this.bounds.x, y: this.bounds.yMax - offsetY },\n      this.bounds.center\n    ]\n    if (this.rotation) {\n      const center = this.rotation.center\n      const rad = convertDegreeToRadian(-this.rotation.degree)\n      return points\n        .map(p =>\n        {\n          return computeRotatedPoint(p, center, rad)\n        })\n    }\n    return points\n  }\n\n  protected getCharCorners(char: TOISymbolChar): TPoint[]\n  {\n    const boxBox = new Box(char.bounds)\n    if (this.rotation) {\n      const center = this.rotation.center\n      const rad = convertDegreeToRadian(-this.rotation.degree)\n      return boxBox.corners\n        .map(p =>\n        {\n          return computeRotatedPoint(p, center, rad)\n        })\n    }\n    return boxBox.corners\n  }\n\n  getCharsOverlaps(points: TPoint[]): TOISymbolChar[]\n  {\n    return this.chars.filter(c =>\n    {\n      const charCorners = this.getCharCorners(c)\n      return points.some(p => isPointInsidePolygon(p, charCorners))\n    })\n  }\n\n  overlaps(box: TBoundingBox): boolean\n  {\n    return this.vertices.some(p => Box.containsPoint(box, p)) ||\n      this.edges.some(e1 => Box.getSides(box).some(e2 => !!findIntersectionBetween2Segment(e1, e2)))\n  }\n\n  clone(): OIText\n  {\n    const clone = new OIText(structuredClone(this.chars), structuredClone(this.point), this.bounds, structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    clone.decorators = this.decorators.map(d => d.clone())\n    clone.rotation = this.rotation ? structuredClone(this.rotation) : undefined\n    return clone\n  }\n\n  toJSON(): PartialDeep<OIText>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      point: this.point,\n      chars: this.chars,\n      style: this.style,\n      rotation: this.rotation,\n      bounds: this.bounds,\n      decorators: this.decorators.length ? this.decorators : undefined\n    }\n  }\n\n  static create(partial: PartialDeep<OIText>): OIText\n  {\n    if (!isValidPoint(partial?.point)) throw new Error(`Unable to create a OIText, point are invalid`)\n    if (!partial.chars?.length) throw new Error(`Unable to create a OIText, no chars`)\n    if (!partial.bounds) throw new Error(`Unable to create a OIText, no boundingBox`)\n    const text = new OIText(partial.chars as TOISymbolChar[], partial.point as TPoint, partial.bounds as TBoundingBox, partial.style)\n    if (partial.id) text.id = partial.id\n    if (partial.decorators?.length) {\n      partial.decorators.forEach(d => {\n        if(d?.kind) {\n          text.decorators.push(new OIDecorator(d.kind, Object.assign({}, text.style, d.style)))\n        }\n      })\n    }\n    return text\n  }\n}\n","import { createUUID, PartialDeep } from \"../utils\"\nimport { TPoint, TPointer } from \"./Point\"\nimport { Box, TBoundingBox } from \"./Box\"\nimport { SymbolType } from \"./Symbol\"\nimport { OISymbolBase } from \"./OISymbolBase\"\nimport { TStyle } from \"../style\"\n\nconst style: TStyle = {\n  color: \"grey\",\n  fill: \"none\",\n  width: 12,\n  opacity: 0.2\n}\n\n/**\n * @group Primitive\n */\nexport class OIEraser extends OISymbolBase<SymbolType.Eraser>\n{\n  readonly isClosed = false\n  pointers: TPointer[]\n\n  constructor()\n  {\n    super(SymbolType.Eraser, style)\n    this.id = `${ this.type }-${ createUUID() }`\n    this.creationTime = Date.now()\n    this.modificationDate = this.creationTime\n    this.pointers = []\n  }\n\n  get bounds(): Box\n  {\n    return Box.createFromPoints(this.vertices)\n  }\n\n  get vertices(): TPoint[]\n  {\n    return this.pointers\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return []\n  }\n\n  clone(): OISymbolBase\n  {\n    const clone = new OIEraser()\n    clone.id = this.id\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    clone.pointers = structuredClone(this.pointers)\n    return clone\n  }\n\n  overlaps(box: TBoundingBox): boolean\n  {\n    return this.pointers.some(p =>\n    {\n      return p.x >= box.x && p.x <= box.x + box.width\n        && p.y >= box.y && p.y <= box.y + box.height\n    })\n  }\n\n  toJSON(): PartialDeep<OIEraser>\n  {\n    return {\n      id: this.id,\n      pointers: this.pointers,\n      style: this.style\n    }\n  }\n}\n","import { DefaultPenStyle, TPenStyle } from \"../style\"\nimport { PartialDeep, createUUID } from \"../utils\"\nimport { TPointer } from \"./Point\"\nimport { SymbolType, TSymbol } from \"./Symbol\"\n\n/**\n * @group Primitive\n */\nexport type TStrokeToSend = {\n  id: string\n  pointerType: string\n  x: number[]\n  y: number[]\n  t: number[]\n  p: number[]\n}\n\n/**\n * @group Primitive\n */\nexport type TStrokeGroupToSend = {\n  penStyle?: string\n  strokes: TStrokeToSend[]\n}\n\n/**\n * @group Primitive\n */\nexport type TStroke = TSymbol & {\n  pointerType: string\n  pointers: TPointer[]\n  length: number\n}\n\n/**\n * @group Primitive\n */\nexport type TStrokeGroup = {\n  penStyle: TPenStyle\n  strokes: Stroke[]\n}\n\n/**\n * @group Primitive\n */\nexport class Stroke implements TStroke\n{\n  type = SymbolType.Stroke\n  id: string\n  creationTime: number\n  modificationDate: number\n  style: TPenStyle\n  pointerType: string\n  pointers: TPointer[]\n  length: number\n\n  constructor(style: TPenStyle, pointerType = \"pen\")\n  {\n    this.id = `${this.type}-${createUUID()}`\n    this.creationTime = Date.now()\n    this.modificationDate = this.creationTime\n    this.style = style\n    this.pointerType = pointerType\n    this.pointers = []\n    this.length = 0\n  }\n\n  clone(): Stroke\n  {\n    const clone = new Stroke(this.style, this.pointerType)\n    clone.id = this.id\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    clone.pointers = structuredClone(this.pointers)\n    clone.length = this.length\n    return clone\n  }\n\n  formatToSend(): TStrokeToSend\n  {\n    const json: TStrokeToSend = {\n      id: this.id,\n      pointerType: this.pointerType,\n      p: [],\n      t: [],\n      x: [],\n      y: []\n    }\n    this.pointers.forEach(p => {\n      json.p.push(p.p)\n      json.t.push(p.t)\n      json.x.push(p.x)\n      json.y.push(p.y)\n    })\n    return json\n  }\n}\n\n/**\n * @group Primitive\n * @group Utils\n */\nexport function convertPartialStrokesToStrokes(json: PartialDeep<TStroke>[]): Stroke[]\n{\n  const errors: string[] = []\n  const strokes: Stroke[] = []\n  json.forEach((j, ji) => {\n    let flag = true\n    const stroke = new Stroke(j.style || DefaultPenStyle, j.pointerType)\n    if (j.id) stroke.id = j.id\n    if (!j.pointers?.length) {\n      errors.push(`stroke ${ji + 1} has not pointers`)\n      flag = false\n      return\n    }\n    j.pointers?.forEach((pp, pIndex) => {\n      if (!pp) {\n        errors.push(`stroke ${ji + 1} has no pointer at ${pIndex}`)\n        flag = false\n        return\n      }\n      const pointer: TPointer = {\n        p: pp.p || 1,\n        t: pp.t || pIndex,\n        x: 0,\n        y: 0\n      }\n      if (pp?.x == undefined || pp?.x == null) {\n        errors.push(`stroke ${ji + 1} has no x at pointer at ${pIndex}`)\n        flag = false\n        return\n      }\n      else {\n        pointer.x = pp.x\n      }\n      if (pp?.y == undefined || pp?.y == null) {\n        errors.push(`stroke ${ji + 1} has no y at pointer at ${pIndex}`)\n        flag = false\n        return\n      }\n      else {\n        pointer.y = pp.y\n      }\n      if (flag) {\n        stroke.pointers.push(pointer)\n      }\n    })\n    if (flag) {\n      strokes.push(stroke)\n    }\n  })\n\n  if (errors.length) {\n    throw new Error(errors.join(\"\\n\"))\n  }\n\n  return strokes\n}\n","/**\n * @group Recognizer\n * @remarks List all errors generated by the backend with their descriptions\n */\nexport enum RecognizerError {\n  NO_ACTIVITY = \"Session closed due to no activity. Without a connection on your part, it will be permanently lost after an hour.\",\n  WRONG_CREDENTIALS = \"Application credentials are invalid. Please check or regenerate your application key and hmackey.\",\n  TOO_OLD = \"Session is too old. Max Session Duration Reached.\",\n  NO_SESSION_FOUND = \"No sessions found. Without activation for 1 hour, sessions are deleted from the server. To avoid losing your work, use the json export, then import it this will create a new session.\",\n  UNKNOW = \"An unknown error has occurred.\",\n  ABNORMAL_CLOSURE = \"MyScript recognition server is not reachable.\",\n  CANT_ESTABLISH = \"Unable to establish a connection to MyScript recognition server. Check the host and your connectivity.\",\n  GOING_AWAY = \"MyScript recognition server is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection.\",\n  PROTOCOL_ERROR = \"MyScript recognition server terminated the connection due to a protocol error.\",\n  UNSUPPORTED_DATA = \"MyScript recognition server terminated the connection because the endpoint received data of a type it cannot accept. (For example, a text-only endpoint received binary data.)\",\n  INVALID_FRAME_PAYLOAD = \"MyScript recognition server terminated the connection because a message was received that contained inconsistent data (e.g., non-UTF-8 data within a text message).\",\n  POLICY_VIOLATION = \"MyScript recognition server terminated the connection because it received a message that violates its policy.\",\n  MESSAGE_TOO_BIG = \"MyScript recognition server terminated the connection because a data frame was received that is too large.\",\n  INTERNAL_ERROR = \"MyScript recognition server terminated the connection because it encountered an unexpected condition that prevented it from fulfilling the request.\",\n  SERVICE_RESTART = \"MyScript recognition server terminated the connection because it is restarting.\",\n  TRY_AGAIN = \"MyScript recognition server terminated the connection due to a temporary condition, e.g. it is overloaded and is casting off some of its clients.\",\n  BAD_GATEWAY = \"MyScript recognition server was acting as a gateway or proxy and received an invalid response from the upstream server.\",\n  TLS_HANDSHAKE = \"MyScript recognition server connection was closed due to a failure to perform a TLS handshake\",\n}\n","import { TGesture } from \"../gesture\"\nimport { TExport } from \"../model\"\n\n/**\n * @group Recognizer\n */\nexport enum TOIMessageType\n{\n  HMAC_Challenge = \"hmacChallenge\",\n  Authenticated = \"authenticated\",\n  SessionDescription = \"sessionDescription\",\n  NewPart = \"newPart\",\n  PartChanged = \"partChanged\",\n  ContentChanged = \"contentChanged\",\n  Idle = \"idle\",\n  Pong = \"pong\",\n  Exported = \"exported\",\n  GestureDetected = \"gestureDetected\",\n  ContextlessGesture = \"contextlessGesture\",\n  Error = \"error\",\n}\n\n/**\n * @group Recognizer\n * @description use to type message to send to backend\n */\nexport type TOIMessageEvent = {\n  type: string\n  [key: string]: unknown\n}\n\n/**\n * @group Recognizer\n */\nexport type TOIMessage<T = string> = {\n  type: T\n}\n\n/**\n * @group Recognizer\n */\nexport type TOIMessageEventAuthenticated = TOIMessage<TOIMessageType.Authenticated>\n\n/**\n * @group Recognizer\n */\nexport type TOIMessageEventHMACChallenge = TOIMessage<TOIMessageType.HMAC_Challenge> & {\n  hmacChallenge: string\n  iinkSessionId: string\n}\n\n/**\n * @group Recognizer\n */\nexport type TOISessionDescriptionMessage = TOIMessage<TOIMessageType.SessionDescription> & {\n  contentPartCount: number\n  iinkSessionId: string\n}\n\n/**\n * @group Recognizer\n */\nexport type TOIMessageEventNewPart = TOIMessage<TOIMessageType.NewPart> & {\n  id: string\n  idx: null\n}\n\n/**\n * @group Recognizer\n */\nexport type TOIMessageEventPartChange = TOIMessage<TOIMessageType.PartChanged> & {\n  partIdx: number\n  partId: string\n  partCount: number\n}\n\n/**\n * @group Recognizer\n */\nexport type TOIMessageEventContentChange = TOIMessage<TOIMessageType.ContentChanged> & {\n  partId: string\n  canUndo: boolean\n  canRedo: boolean\n  empty: boolean\n  undoStackIndex: number\n  possibleUndoCount: number\n}\n\n/**\n * @group Recognizer\n */\nexport type TOIMessageEventExport = TOIMessage<TOIMessageType.Exported> & {\n  partId: string\n  exports: TExport\n}\n\n/**\n * @group Recognizer\n */\nexport type TOIMessageEventGesture = TOIMessage<TOIMessageType.GestureDetected> & TGesture\n\n/**\n * @group Recognizer\n */\nexport type TOIMessageEventContextlessGesture = TOIMessage<TOIMessageType.ContextlessGesture> & {\n  gestureType: \"none\" | \"scratch\" | \"left-right\" | \"right-left\" | \"bottom-top\" | \"top-bottom\" | \"surround\",\n  strokeId: string\n}\n\n/**\n * @group Recognizer\n */\nexport type TOIMessageEventPong = TOIMessage<TOIMessageType.Pong>\n\n/**\n * @group Recognizer\n */\nexport type TOIMessageEventIdle = TOIMessage<TOIMessageType.Idle>\n\n/**\n * @group Recognizer\n */\nexport type TOIMessageEventError = TOIMessage<TOIMessageType.Error> & {\n  code?: number | string\n  message?: string\n  data?: {\n    code: number | string\n    message: string\n  }\n}\n\n/**\n * @group Recognizer\n */\nexport type TOIMessageReceived =\n  TOIMessageEventAuthenticated |\n  TOIMessageEventHMACChallenge |\n  TOISessionDescriptionMessage |\n  TOIMessageEventNewPart |\n  TOIMessageEventPartChange |\n  TOIMessageEventContentChange |\n  TOIMessageEventExport |\n  TOIMessageEventGesture |\n  TOIMessageEventContextlessGesture |\n  TOIMessageEventPong |\n  TOIMessageEventIdle |\n  TOIMessageEventError\n","import { LoggerClass, LoggerManager } from \"../logger\"\nimport { TPenStyle } from \"../style\"\nimport { computeDistance } from \"../utils\"\nimport { TExport } from \"./Export\"\nimport { IModel } from \"./IModel\"\nimport { Stroke, TPoint, TPointer } from \"../primitive\"\n\n/**\n * @group Model\n */\nexport type TRecognitionPositions = {\n  lastSentPosition: number\n  lastReceivedPosition: number\n}\n\n/**\n * @group Model\n */\nexport class Model implements IModel\n{\n  readonly creationTime: number\n  modificationDate: number\n  positions: TRecognitionPositions\n  currentSymbol?: Stroke\n  symbols: Stroke[]\n  exports?: TExport\n  converts?: TExport\n  width: number\n  height: number\n  rowHeight: number\n  idle: boolean\n  #logger = LoggerManager.getLogger(LoggerClass.MODEL)\n\n  constructor(width = 100, height = 100, rowHeight = 0, creationDate = Date.now())\n  {\n    this.#logger.info(\"constructor\", { width, height, creationDate })\n    this.creationTime = creationDate\n    this.modificationDate = creationDate\n    this.width = width\n    this.height = height\n    this.rowHeight = rowHeight\n    this.symbols = []\n    this.positions = {\n      lastSentPosition: 0,\n      lastReceivedPosition: 0\n    }\n    this.idle = true\n  }\n\n  protected computePressure(distance: number, globalDistance: number): number\n  {\n    let ratio = 1.0\n    if (distance === globalDistance) {\n      ratio = 1.0\n    } else if (distance < 10) {\n      ratio = 0.2 + Math.pow(0.1 * distance, 0.4)\n    } else if (distance > globalDistance - 10) {\n      ratio = 0.2 + Math.pow(0.1 * (globalDistance - distance), 0.4)\n    }\n    const pressure = ratio * Math.max(0.1, 1.0 - (0.1 * Math.sqrt(distance)))\n    return isNaN(pressure) ? 0.5 : Math.round(pressure * 100) / 100\n  }\n\n  protected filterPointByAcquisitionDelta(stroke: Stroke, point: TPointer, lastPointer?: TPointer): boolean\n  {\n    const delta: number = (2 + ((stroke.style[\"-myscript-pen-width\"] || 0) / 4))\n    return !lastPointer ||\n      stroke.pointers.length === 0 ||\n      Math.abs(lastPointer.x - point.x) >= delta ||\n      Math.abs(lastPointer.y - point.y) >= delta\n  }\n\n  getStrokeFromPoint(point: TPoint): Stroke[]\n  {\n    this.#logger.info(\"getStrokeFromPoint\", { point })\n    const isBetween = (val: number, min: number, max: number): boolean => (val >= min && val <= max)\n\n    const _strokeList: Stroke[] = []\n    this.symbols.forEach((stroke) =>\n    {\n      for (let i = 0; i < stroke.pointers.length; i++) {\n        const strokePointer = stroke.pointers[i]\n        if (\n          isBetween(strokePointer.x, point.x - 5, point.x + 5) &&\n          isBetween(strokePointer.y, point.y - 5, point.y + 5)\n        ) {\n          _strokeList.push(stroke)\n          break\n        }\n        else {\n          if (computeDistance(point, strokePointer) < 10) {\n            _strokeList.push(stroke)\n            break\n          }\n        }\n      }\n    })\n    this.#logger.debug(\"getStrokeFromPoint\", { strokes: _strokeList })\n    return _strokeList\n  }\n\n  addPoint(stroke: Stroke, pointer: TPointer): void\n  {\n    this.#logger.debug(\"addPoint\", { stroke, pointer })\n    const lastPointer = stroke.pointers.at(-1)\n    if (this.filterPointByAcquisitionDelta(stroke, pointer, lastPointer)) {\n      const distance = lastPointer ? computeDistance(pointer, lastPointer) : 0\n      stroke.length += distance\n      pointer.p = this.computePressure(distance, stroke.length)\n      stroke.pointers.push(pointer)\n      stroke.modificationDate = Date.now()\n    }\n  }\n\n  addStroke(stroke: Stroke): void\n  {\n    this.#logger.info(\"addStroke\", { stroke })\n    this.symbols.push(stroke)\n    this.modificationDate = Date.now()\n    this.converts = undefined\n    this.exports = undefined\n  }\n\n  updateStroke(updatedStroke: Stroke): void\n  {\n    this.#logger.info(\"updateStroke\", { updatedStroke })\n    const strokeIndex = this.symbols.findIndex((s: Stroke): boolean => s.id === updatedStroke.id)\n    if (strokeIndex !== -1) {\n      updatedStroke.modificationDate = Date.now()\n      this.symbols.splice(strokeIndex, 1, updatedStroke)\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n    this.#logger.debug(\"updateStroke\", this.symbols)\n  }\n\n  removeStroke(id: string): void\n  {\n    this.#logger.info(\"removeStroke\", { id })\n    const strokeIndex = this.symbols.findIndex(s => s.id === id)\n    if (strokeIndex !== -1) {\n      this.positions.lastSentPosition--\n      this.positions.lastReceivedPosition--\n      this.symbols.splice(strokeIndex, 1)\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n    this.#logger.debug(\"removeStroke\", this.symbols)\n  }\n\n  removeStrokesFromPoint(point: TPoint): string[]\n  {\n    this.#logger.info(\"removeStrokesFromPoint\", { point })\n    const strokes = this.getStrokeFromPoint(point)\n    strokes.forEach(strokeToRemove =>\n    {\n      this.removeStroke(strokeToRemove.id)\n    })\n    this.#logger.debug(\"removeStrokesFromPoint\", strokes.map(s => s.id))\n    return strokes.map(s => s.id)\n  }\n\n  extractUnsentStrokes(): Stroke[]\n  {\n    return this.symbols.slice(this.positions.lastSentPosition)\n  }\n\n  initCurrentStroke(point: TPointer, pointerType: string, style: TPenStyle, dpi = 96): void\n  {\n    this.#logger.info(\"initCurrentStroke\", { point, pointerType, style, dpi })\n    if (style[\"-myscript-pen-width\"]) {\n      const pxWidth = (style[\"-myscript-pen-width\"] * dpi) / 25.4\n      style.width = pxWidth / 2\n    }\n    this.modificationDate = Date.now()\n    this.exports = undefined\n    this.currentSymbol = new Stroke(style, pointerType)\n    this.#logger.debug(\"initCurrentStroke\", this.currentSymbol)\n    this.addPoint(this.currentSymbol, point)\n  }\n\n  appendToCurrentStroke(point: TPointer): void\n  {\n    this.#logger.info(\"appendToCurrentStroke\", { point })\n    if (this.currentSymbol) {\n      this.addPoint(this.currentSymbol, point)\n    }\n    this.#logger.debug(\"appendToCurrentStroke\", this.currentSymbol)\n  }\n\n  endCurrentStroke(point: TPointer): void\n  {\n    this.#logger.info(\"endCurrentStroke\", { point })\n    if (this.currentSymbol) {\n      this.addPoint(this.currentSymbol, point)\n      this.addStroke(this.currentSymbol)\n      this.currentSymbol = undefined\n    }\n    this.#logger.debug(\"endCurrentStroke\", this.currentSymbol)\n  }\n\n  updatePositionSent(position: number = this.symbols.length): void\n  {\n    this.#logger.info(\"updatePositionSent\", { position })\n    this.positions.lastSentPosition = position\n    this.#logger.debug(\"updatePositionSent\", this.positions.lastSentPosition)\n  }\n\n  updatePositionReceived(): void\n  {\n    this.#logger.info(\"updatePositionReceived\")\n    this.positions.lastReceivedPosition = this.positions.lastSentPosition\n    this.#logger.debug(\"updatePositionReceived\", this.positions.lastReceivedPosition)\n  }\n\n  mergeExport(exports: TExport)\n  {\n    this.#logger.info(\"mergeExport\", { exports })\n    if (this.exports) {\n      Object.assign(this.exports, exports)\n    } else {\n      this.exports = exports\n    }\n    this.#logger.debug(\"mergeExport\", this.exports)\n  }\n\n  mergeConvert(converts: TExport)\n  {\n    this.#logger.info(\"mergeConvert\", { converts })\n    if (this.converts) {\n      Object.assign(this.converts, converts)\n    } else {\n      this.converts = converts\n    }\n    this.#logger.debug(\"mergeConvert\", this.converts)\n  }\n\n  clone(): Model\n  {\n    this.#logger.info(\"clone\")\n    const clonedModel = new Model(this.width, this.height, this.rowHeight, this.creationTime)\n    clonedModel.modificationDate = JSON.parse(JSON.stringify(this.modificationDate))\n    clonedModel.currentSymbol = this.currentSymbol ? this.currentSymbol.clone() : undefined\n    clonedModel.symbols = this.symbols.map(s => s.clone())\n    clonedModel.positions = JSON.parse(JSON.stringify(this.positions))\n    clonedModel.exports = this.exports ? JSON.parse(JSON.stringify(this.exports)) : undefined\n    clonedModel.converts = this.converts ? JSON.parse(JSON.stringify(this.converts)) : undefined\n    clonedModel.idle = this.idle\n    this.#logger.debug(\"clone\", { clonedModel })\n    return clonedModel\n  }\n\n  clear(): void\n  {\n    this.#logger.info(\"clear\")\n    this.modificationDate = Date.now()\n    this.currentSymbol = undefined\n    this.symbols = []\n    this.positions.lastSentPosition = 0\n    this.positions.lastReceivedPosition = 0\n    this.exports = undefined\n    this.converts = undefined\n    this.idle = true\n  }\n}\n","import { LoggerClass, LoggerManager } from \"../logger\"\nimport\n{\n  SymbolType,\n  TOISymbol,\n} from \"../primitive\"\nimport { TExport } from \"./Export\"\nimport { IModel } from \"./IModel\"\n\n/**\n * @group Model\n */\nexport class OIModel implements IModel\n{\n  #logger = LoggerManager.getLogger(LoggerClass.MODEL)\n  readonly creationTime: number\n  modificationDate: number\n  currentSymbol?: TOISymbol\n  symbols: TOISymbol[]\n  exports?: TExport\n  converts?: TExport\n  width: number\n  height: number\n  rowHeight: number\n  idle: boolean\n\n  constructor(width = 100, height = 100, rowHeight = 0, creationDate = Date.now())\n  {\n    this.creationTime = creationDate\n    this.modificationDate = creationDate\n    this.width = width\n    this.height = height\n    this.rowHeight = rowHeight\n    this.symbols = []\n    this.exports = undefined\n    this.converts = undefined\n    this.idle = true\n  }\n\n  get symbolsSelected(): TOISymbol[]\n  {\n    return this.symbols.filter(s => s.selected)\n  }\n\n  get symbolsToDelete(): TOISymbol[]\n  {\n    return this.symbols.filter(s => s.deleting)\n  }\n\n  selectSymbol(id: string): void\n  {\n    const symbol = this.symbols.find(s => s.id === id || (s.type === SymbolType.Group && s.containsSymbol(id)))\n    if (symbol) {\n      symbol.selected = true\n    }\n  }\n\n  unselectSymbol(id: string): void\n  {\n    const symbol = this.symbols.find(s => s.id === id)\n    if (symbol) {\n      symbol.selected = false\n    }\n  }\n\n  resetSelection(): void\n  {\n    this.symbols.forEach(s => s.selected = false)\n  }\n\n  getRootSymbol(id: string): TOISymbol | undefined\n  {\n    return this.symbols.find(s =>\n    {\n      if (s.id === id) return s\n      if (s.type === SymbolType.Group && s.containsSymbol(id)) {\n        return s\n      }\n      return\n    })\n  }\n\n  getSymbolRowIndex(symbol: TOISymbol): number\n  {\n    return Math.round(symbol.bounds.yMid / this.rowHeight)\n  }\n\n  getSymbolsByRowOrdered(): { rowIndex: number, symbols: TOISymbol[] }[]\n  {\n    const rows: { rowIndex: number, symbols: TOISymbol[] }[] = []\n    this.symbols.forEach(s =>\n    {\n      const rowIndex = this.getSymbolRowIndex(s)\n      const row = rows.find(r => r.rowIndex === rowIndex)\n      if (row) {\n        row.symbols.push(s)\n      }\n      else {\n        rows.push({ rowIndex, symbols: [s] })\n      }\n    })\n    rows.forEach(r =>\n    {\n      r.symbols.sort((s1, s2) => s1.bounds.xMid - s2.bounds.xMid)\n    })\n    return rows.sort((r1, r2) => r1.rowIndex - r2.rowIndex)\n  }\n\n  roundToLineGuide(y: number): number\n  {\n    return Math.round(y / this.rowHeight) * this.rowHeight\n  }\n\n  isSymbolAbove(source: TOISymbol, target: TOISymbol): boolean\n  {\n    return source.bounds.yMid - this.rowHeight / 2 > target.bounds.yMid\n  }\n\n  isSymbolInRow(source: TOISymbol, target: TOISymbol): boolean\n  {\n    return Math.abs(source.bounds.yMid - target.bounds.yMid) <= this.rowHeight / 2\n  }\n\n  isSymbolBelow(source: TOISymbol, target: TOISymbol): boolean\n  {\n    return source.bounds.yMid + this.rowHeight / 2 < target.bounds.yMid\n  }\n\n  getFirstSymbol(symbols: TOISymbol[]): TOISymbol | undefined\n  {\n    if (!symbols.length) return\n    return symbols.reduce((previous, current) =>\n    {\n      if (previous) {\n        if (Math.round(previous.bounds.yMid / this.rowHeight) < Math.round(current.bounds.yMid / this.rowHeight)) {\n          return previous\n        }\n        else if (Math.round(previous.bounds.yMid / this.rowHeight) == Math.round(current.bounds.yMid / this.rowHeight) && previous.bounds.xMid < current.bounds.xMid) {\n          return previous\n        }\n      }\n      return current\n    })\n  }\n\n  getLastSymbol(symbols: TOISymbol[]): TOISymbol | undefined\n  {\n    if (!symbols.length) return\n    return symbols.reduce((previous, current) =>\n    {\n      if (previous) {\n        if (previous.bounds.yMid - current.bounds.yMid > this.rowHeight / 2) {\n          return previous\n        }\n        if (previous.bounds.yMid - current.bounds.yMid < this.rowHeight / 2) {\n          return current\n        }\n        else if (previous.bounds.xMid > current.bounds.xMid) {\n          return previous\n        }\n      }\n      return current\n    })\n  }\n\n  addSymbol(symbol: TOISymbol): void\n  {\n    this.#logger.info(\"addSymbol\", { symbol })\n    const sIndex = this.symbols.findIndex(s => s.id === symbol.id)\n    if (sIndex > -1) {\n      throw new Error(`Symbol id already exist: ${ symbol.id }`)\n    }\n    this.symbols.push(symbol)\n    this.modificationDate = Date.now()\n    this.converts = undefined\n    this.exports = undefined\n    this.#logger.debug(\"addSymbol\", this.symbols)\n  }\n\n  updateSymbol(updatedSymbol: TOISymbol): void\n  {\n    this.#logger.info(\"updateSymbol\", { updatedSymbol })\n    const sIndex = this.symbols.findIndex(s => s.id === updatedSymbol.id)\n    if (sIndex !== -1) {\n      updatedSymbol.modificationDate = Date.now()\n      this.symbols.splice(sIndex, 1, updatedSymbol)\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n    this.#logger.debug(\"updateSymbol\", this.symbols)\n  }\n\n  replaceSymbol(id: string, symbols: TOISymbol[]): void\n  {\n    const sIndex = this.symbols.findIndex(s => s.id === id)\n    if (sIndex !== -1) {\n      this.symbols.splice(sIndex, 1, ...symbols)\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n  }\n\n  changeOrderSymbol(id: string, position: \"first\" | \"last\" | \"forward\" | \"backward\")\n  {\n    const fromIndex = this.symbols.findIndex(s => s.id === id)\n    if (fromIndex > -1) {\n      let toIndex = fromIndex\n      switch (position) {\n        case \"first\":\n          toIndex = 0\n          break\n        case \"last\":\n          toIndex = this.symbols.length - 1\n          break\n        case \"forward\":\n          toIndex = Math.min(toIndex + 1, this.symbols.length - 1)\n          break\n        case \"backward\":\n          toIndex = Math.max(toIndex - 1, 0)\n          break\n      }\n      const sym = this.symbols.splice(fromIndex, 1)[0]\n      this.symbols.splice(toIndex, 0, sym)\n    }\n  }\n\n  removeSymbol(id: string): void\n  {\n    this.#logger.info(\"removeSymbol\", { id })\n    const symbolIndex = this.symbols.findIndex(s => s.id === id)\n    if (symbolIndex !== -1) {\n      this.symbols.splice(symbolIndex, 1)\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n    this.#logger.debug(\"removeSymbol\", this.symbols)\n  }\n\n  extractDifferenceSymbols(model: OIModel): { added: TOISymbol[], removed: TOISymbol[] }\n  {\n    return {\n      added: this.symbols.filter(s1 => model.symbols.findIndex(s2 => s1.id === s2.id && s1.modificationDate === s2.modificationDate) === -1),\n      removed: model.symbols.filter(s1 => this.symbols.findIndex(s2 => s1.id === s2.id && s1.modificationDate === s2.modificationDate) === -1)\n    }\n  }\n\n  mergeExport(exports: TExport)\n  {\n    this.#logger.info(\"mergeExport\", { exports })\n    if (this.exports) {\n      Object.assign(this.exports, exports)\n    } else {\n      this.exports = exports\n    }\n    this.#logger.debug(\"mergeExport\", this.exports)\n  }\n\n  clone(): OIModel\n  {\n    this.#logger.info(\"clone\")\n    const clonedModel = new OIModel(this.width, this.height, this.rowHeight, this.creationTime)\n    clonedModel.modificationDate = this.modificationDate\n    clonedModel.symbols = this.symbols.map(s =>\n    {\n      const c = s.clone()\n      c.selected = false\n      return c\n    })\n    clonedModel.exports = structuredClone(this.exports)\n    clonedModel.idle = this.idle\n    this.#logger.debug(\"clone\", { clonedModel })\n    return clonedModel\n  }\n\n  clear(): void\n  {\n    this.#logger.info(\"clear\")\n    this.modificationDate = Date.now()\n    this.symbols = []\n    this.currentSymbol = undefined\n    this.exports = undefined\n    this.converts = undefined\n    this.idle = true\n\n  }\n}\n","import { TRecognitionConfiguration, TServerConfiguration } from \"../configuration\"\nimport { InternalEvent } from \"../event\"\nimport { TOIHistoryBackendChanges, TUndoRedoContext } from \"../history\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { TExport, TJIIXExport } from \"../model\"\nimport { OIStroke } from \"../primitive\"\nimport { TMatrixTransform } from \"../transform\"\nimport { computeHmac, DeferredPromise } from \"../utils\"\nimport\n{\n  TOIMessageEvent,\n  TOIMessageEventContentChange,\n  TOIMessageEventContextlessGesture,\n  TOIMessageEventError,\n  TOIMessageEventExport,\n  TOIMessageEventGesture,\n  TOIMessageEventHMACChallenge,\n  TOIMessageEventNewPart,\n  TOIMessageEventPartChange,\n  TOIMessageReceived,\n  TOIMessageType,\n  TOISessionDescriptionMessage\n} from \"./OIRecognizerMessage\"\nimport { RecognizerError } from \"./RecognizerError\"\nimport PingWorker from \"web-worker:../worker/ping.worker.ts\"\n\n/**\n * A websocket dialog have this sequence :\n * --------------- Client --------------------------------------------------------------- Server ---------------\n * { type: \"authenticate\" }                           ==================>\n *                                                    <==================       { type: \"hmacChallenge\" }\n * { type: \"hmac\" }                                   ==================>\n *                                                    <==================       { type: \"authenticated\" }\n * { type: \"initSession\" | \"restoreSession\" }         ==================>\n *                                                    <==================       { type: \"sessionDescription\" }\n * { type: \"newContentPart\" | \"openContentPart\" }     ==================>\n *                                                    <==================       { type: \"partChanged\" }\n * { type: \"addStrokes\" }                             ==================>\n *                                                    <==================       { type: \"contentChanged\" }\n * { type: \"transform\" }                              ==================>\n *                                                    <==================       { type: \"contentChanged\" }\n * { type: \"eraseStrokes\" }                           ==================>\n *                                                    <==================       { type: \"contentChanged\" }\n */\n\n/**\n * @group Recognizer\n */\nexport class OIRecognizer\n{\n  #logger = LoggerManager.getLogger(LoggerClass.RECOGNIZER)\n  protected serverConfiguration: TServerConfiguration\n  protected recognitionConfiguration: TRecognitionConfiguration\n\n  protected socket!: WebSocket\n  protected pingWorker?: Worker\n  protected pingCount = 0\n  protected reconnectionCount = 0\n  protected sessionId?: string\n  protected currentPartId?: string\n  protected currentErrorCode?: string | number\n\n  protected connected: DeferredPromise<void>\n  protected initialized: DeferredPromise<void>\n\n  protected addStrokeDeferred?: DeferredPromise<TOIMessageEventGesture | undefined>\n  protected contextlessGestureDeferred: Map<string, DeferredPromise<TOIMessageEventContextlessGesture>>\n  protected transformStrokeDeferred?: DeferredPromise<void>\n  protected eraseStrokeDeferred?: DeferredPromise<void>\n  protected replaceStrokeDeferred?: DeferredPromise<void>\n  protected exportDeferredMap: Map<string, DeferredPromise<TExport>>\n  protected closeDeferred?: DeferredPromise<void>\n  protected waitForIdleDeferred?: DeferredPromise<void>\n  protected undoDeferred?: DeferredPromise<void>\n  protected redoDeferred?: DeferredPromise<void>\n  protected clearDeferred?: DeferredPromise<void>\n\n  url: string\n\n  constructor(serverConfig: TServerConfiguration, recognitionConfig: TRecognitionConfiguration)\n  {\n    this.#logger.info(\"constructor\", { serverConfig, recognitionConfig })\n    this.serverConfiguration = serverConfig\n    this.recognitionConfiguration = recognitionConfig\n    const scheme = (this.serverConfiguration.scheme === \"https\") ? \"wss\" : \"ws\"\n    this.url = `${ scheme }://${ this.serverConfiguration.host }/api/v4.0/iink/offscreen?applicationKey=${ this.serverConfiguration.applicationKey }`\n\n    this.exportDeferredMap = new Map()\n    this.contextlessGestureDeferred = new Map()\n\n    this.connected = new DeferredPromise<void>()\n    this.initialized = new DeferredPromise<void>()\n  }\n\n  get mimeTypes(): string[]\n  {\n    return [\"application/vnd.myscript.jiix\"]\n  }\n\n  get event(): InternalEvent\n  {\n    return InternalEvent.getInstance()\n  }\n\n  #send(message: TOIMessageEvent): void\n  {\n    if (!this.socket) {\n      throw new Error(\"Recognizer must be initilized\")\n    }\n    if (this.socket.readyState === this.socket.OPEN) {\n      this.socket.send(JSON.stringify(message))\n    }\n    else {\n      throw new Error(`Connection not ready, state: ${ this.socket.readyState }}`)\n    }\n  }\n\n  protected rejectDeferredPending(error: Error | string): void\n  {\n    this.initialized.reject(error)\n    this.addStrokeDeferred?.reject(error)\n    this.transformStrokeDeferred?.reject(error)\n    this.eraseStrokeDeferred?.reject(error)\n    this.replaceStrokeDeferred?.reject(error)\n    this.undoDeferred?.reject(error)\n    this.redoDeferred?.reject(error)\n    this.clearDeferred?.reject(error)\n    Array.from(this.contextlessGestureDeferred.values())\n      .forEach(v =>\n      {\n        v.reject(error)\n      })\n    Array.from(this.exportDeferredMap.values())\n      .forEach(v =>\n      {\n        v.reject(error)\n      })\n    this.waitForIdleDeferred?.reject(error)\n  }\n\n  protected resetAllDeferred(): void\n  {\n    this.connected = new DeferredPromise<void>()\n    this.initialized = new DeferredPromise<void>()\n    this.addStrokeDeferred = undefined\n    this.contextlessGestureDeferred.clear()\n    this.transformStrokeDeferred = undefined\n    this.eraseStrokeDeferred = undefined\n    this.replaceStrokeDeferred = undefined\n    this.exportDeferredMap.clear()\n    this.waitForIdleDeferred = undefined\n    this.closeDeferred = undefined\n  }\n\n  protected clearSocketListener(): void\n  {\n    this.socket.removeEventListener(\"open\", this.openCallback.bind(this))\n    this.socket.removeEventListener(\"close\", this.closeCallback.bind(this))\n    this.socket.removeEventListener(\"message\", this.messageCallback.bind(this))\n  }\n\n  protected closeCallback(evt: CloseEvent): void\n  {\n    this.#logger.info(\"closeCallback\", { evt })\n    let message = evt.reason\n    if (!this.currentErrorCode) {\n      switch (evt.code) {\n        case 1000:\n          // Normal Closure\n          break\n        case 1001:\n          message = RecognizerError.GOING_AWAY\n          break\n        case 1002:\n          message = RecognizerError.PROTOCOL_ERROR\n          break\n        case 1003:\n          message = RecognizerError.UNSUPPORTED_DATA\n          break\n        case 1006:\n          message = RecognizerError.ABNORMAL_CLOSURE\n          break\n        case 1007:\n          message = RecognizerError.INVALID_FRAME_PAYLOAD\n          break\n        case 1008:\n          message = RecognizerError.POLICY_VIOLATION\n          break\n        case 1009:\n          message = RecognizerError.MESSAGE_TOO_BIG\n          break\n        case 1011:\n          message = RecognizerError.INTERNAL_ERROR\n          break\n        case 1012:\n          message = RecognizerError.SERVICE_RESTART\n          break\n        case 1013:\n          message = RecognizerError.TRY_AGAIN\n          break\n        case 1014:\n          message = RecognizerError.BAD_GATEWAY\n          break\n        case 1015:\n          message = RecognizerError.TLS_HANDSHAKE\n          break\n        default:\n          message = RecognizerError.CANT_ESTABLISH\n          break\n      }\n    }\n\n    this.clearSocketListener()\n    this.closeDeferred?.resolve()\n    if (!this.currentErrorCode && evt.code !== 1000) {\n      const error = new Error(message)\n      this.event.emitError(error)\n      this.rejectDeferredPending(message)\n    }\n    this.pingWorker?.terminate()\n    this.resetAllDeferred()\n  }\n\n  protected openCallback(): void\n  {\n    this.connected.resolve()\n    this.reconnectionCount = 0\n    this.#send({\n      type: \"authenticate\",\n      \"myscript-client-name\": \"iink-ts\",\n      \"myscript-client-version\": \"2.0.1\",\n    })\n  }\n\n  protected async manageHMACChallenge(hmacChallengeMessage: TOIMessageEventHMACChallenge): Promise<void>\n  {\n    this.#send({\n      type: \"hmac\",\n      hmac: await computeHmac(hmacChallengeMessage.hmacChallenge, this.serverConfiguration.applicationKey, this.serverConfiguration.hmacKey)\n    })\n  }\n\n  protected initPing(): void\n  {\n    this.pingWorker = new PingWorker()\n    this.pingWorker.postMessage({\n      pingDelay: this.serverConfiguration.websocket.pingDelay,\n    })\n    this.pingWorker.onmessage = () =>\n    {\n      if (this.pingCount < this.serverConfiguration.websocket.maxPingLostCount) {\n        this.#send({ type: \"ping\" })\n      }\n      else {\n        this.close(1000, \"MAXIMUM_PING_REACHED\")\n        this.pingWorker?.terminate()\n      }\n      this.pingCount++\n    }\n  }\n\n  protected manageAuthenticated(): void\n  {\n    const pixelTomm = 25.4 / 96\n    this.#send({\n      type: this.sessionId ? \"restoreSession\" : \"initSession\",\n      iinkSessionId: this.sessionId,\n      scaleX: pixelTomm,\n      scaleY: pixelTomm,\n      configuration: this.recognitionConfiguration\n    })\n  }\n\n  protected manageSessionDescriptionMessage(sessionDescriptionMessage: TOISessionDescriptionMessage): void\n  {\n    if (sessionDescriptionMessage.iinkSessionId) {\n      this.sessionId = sessionDescriptionMessage.iinkSessionId\n    }\n    if (this.currentPartId) {\n      this.#send({ type: \"openContentPart\", id: this.currentPartId })\n    }\n    else {\n      this.#send({ type: \"newContentPart\", contentType: this.recognitionConfiguration.type, mimeTypes: this.mimeTypes })\n    }\n  }\n\n  protected manageNewPartMessage(newPartMessage: TOIMessageEventNewPart): void\n  {\n    this.initialized.resolve()\n    this.currentPartId = newPartMessage.id\n  }\n\n  protected managePartChangeMessage(partChangeMessage: TOIMessageEventPartChange): void\n  {\n    this.initialized?.resolve()\n    this.currentPartId = partChangeMessage.partId\n  }\n\n  protected manageContentChangedMessage(contentChangeMessage: TOIMessageEventContentChange): void\n  {\n    this.initialized?.resolve()\n    this.replaceStrokeDeferred?.resolve()\n    this.transformStrokeDeferred?.resolve()\n    this.eraseStrokeDeferred?.resolve()\n    this.undoDeferred?.resolve()\n    this.redoDeferred?.resolve()\n    this.clearDeferred?.resolve()\n    this.event.emitContextChange({\n      canRedo: contentChangeMessage.canRedo,\n      canUndo: contentChangeMessage.canRedo,\n    } as TUndoRedoContext)\n  }\n\n  protected manageExportMessage(exportMessage: TOIMessageEventExport): void\n  {\n    if (exportMessage.exports[\"application/vnd.myscript.jiix\"]) {\n      exportMessage.exports[\"application/vnd.myscript.jiix\"] = JSON.parse(exportMessage.exports[\"application/vnd.myscript.jiix\"].toString()) as TJIIXExport\n    }\n\n    Object.keys(exportMessage.exports)\n      .forEach(key =>\n      {\n        if (this.exportDeferredMap.has(key)) {\n          this.exportDeferredMap.get(key)!.resolve(exportMessage.exports)\n        }\n      })\n    this.event.emitExported(exportMessage.exports)\n  }\n\n  protected manageWaitForIdle(): void\n  {\n    this.waitForIdleDeferred?.resolve()\n    this.event.emitIdle(true)\n  }\n\n  protected manageErrorMessage(errorMessage: TOIMessageEventError): void\n  {\n    this.currentErrorCode = errorMessage.data?.code || errorMessage.code\n    let message = errorMessage.data?.message || errorMessage.message || RecognizerError.UNKNOW\n\n    if (this.currentErrorCode === \"no.activity\") {\n      this.rejectDeferredPending(message)\n      this.event.emitNotif({ message: RecognizerError.NO_ACTIVITY, timeout: Infinity })\n    }\n    else {\n      switch (this.currentErrorCode) {\n        case \"access.not.granted\":\n          message = RecognizerError.WRONG_CREDENTIALS\n          break\n        case \"session.too.old\":\n          message = RecognizerError.TOO_OLD\n          break\n        case \"restore.session.not.found\":\n          message = RecognizerError.NO_SESSION_FOUND\n          break\n      }\n      this.rejectDeferredPending(message)\n      this.event.emitError(new Error(message))\n    }\n  }\n\n  protected manageGestureDetected(gestureMessage: TOIMessageEventGesture): void\n  {\n    this.addStrokeDeferred?.resolve(gestureMessage)\n  }\n\n  protected manageContextlessGesture(gestureMessage: TOIMessageEventContextlessGesture): void\n  {\n    this.contextlessGestureDeferred.get(gestureMessage.strokeId)?.resolve(gestureMessage)\n  }\n\n  protected messageCallback(message: MessageEvent<string>): void\n  {\n    this.currentErrorCode = undefined\n    try {\n      const websocketMessage: TOIMessageReceived = JSON.parse(message.data)\n      if (websocketMessage.type === TOIMessageType.Pong) {\n        return\n      }\n      this.pingCount = 0\n      switch (websocketMessage.type) {\n        case TOIMessageType.HMAC_Challenge:\n          this.manageHMACChallenge(websocketMessage)\n          break\n        case TOIMessageType.Authenticated:\n          this.manageAuthenticated()\n          break\n        case TOIMessageType.SessionDescription:\n          this.manageSessionDescriptionMessage(websocketMessage)\n          break\n        case TOIMessageType.NewPart:\n          this.manageNewPartMessage(websocketMessage)\n          break\n        case TOIMessageType.PartChanged:\n          this.managePartChangeMessage(websocketMessage)\n          break\n        case TOIMessageType.ContentChanged:\n          this.manageContentChangedMessage(websocketMessage)\n          break\n        case TOIMessageType.Exported:\n          this.manageExportMessage(websocketMessage)\n          break\n        case TOIMessageType.GestureDetected:\n          this.manageGestureDetected(websocketMessage)\n          break\n        case TOIMessageType.ContextlessGesture:\n          this.manageContextlessGesture(websocketMessage)\n          break\n        case TOIMessageType.Error:\n          this.manageErrorMessage(websocketMessage)\n          break\n        case TOIMessageType.Idle:\n          this.manageWaitForIdle()\n          break\n        default:\n          this.#logger.warn(\"messageCallback\", `Message type unknow: \"${ websocketMessage }\".`)\n          break\n      }\n    }\n    catch (error) {\n      this.event.emitError(new Error(message.data))\n    }\n  }\n\n  async init(): Promise<void>\n  {\n    if (this.currentErrorCode === \"restore.session.not.found\") {\n      this.currentErrorCode === undefined\n      this.sessionId = undefined\n      this.currentPartId = undefined\n    }\n    this.socket = new WebSocket(this.url)\n    this.clearSocketListener()\n    this.socket.addEventListener(\"open\", this.openCallback.bind(this))\n    this.socket.addEventListener(\"close\", this.closeCallback.bind(this))\n    this.socket.addEventListener(\"message\", this.messageCallback.bind(this))\n    await this.initialized.promise\n    if (this.serverConfiguration.websocket.pingEnabled) {\n      this.pingCount = 0\n      this.initPing()\n    }\n  }\n\n  async send(message: TOIMessageEvent): Promise<void>\n  {\n    if (!this.socket) {\n      return Promise.reject(new Error(\"Recognizer must be initilized\"))\n    }\n\n    switch (this.socket.readyState) {\n      case this.socket.CONNECTING:\n      case this.socket.OPEN:\n        await this.initialized.promise\n        this.#send(message)\n        return Promise.resolve()\n      case this.socket.CLOSING:\n      case this.socket.CLOSED:\n        if (this.serverConfiguration.websocket.autoReconnect) {\n          this.reconnectionCount++\n          if (this.serverConfiguration.websocket.maxRetryCount > this.reconnectionCount) {\n            this.event.emitClearMessage()\n            await this.init()\n            await this.waitForIdle()\n            return this.send(message)\n          }\n          else {\n            return Promise.reject(new Error(\"Unable to send message. The maximum number of connection attempts has been reached.\"))\n          }\n        }\n        else {\n          return Promise.reject(new Error(\"Unable to send message. Connection closed and automatic reconnection disabled\"))\n        }\n        break\n    }\n  }\n\n  protected buildAddStrokesMessage(strokes: OIStroke[], processGestures = true): TOIMessageEvent\n  {\n    return {\n      type: \"addStrokes\",\n      processGestures,\n      strokes: strokes.map(s => s.formatToSend())\n    }\n  }\n  async addStrokes(strokes: OIStroke[], processGestures = true): Promise<TOIMessageEventGesture | undefined>\n  {\n    this.addStrokeDeferred = new DeferredPromise<TOIMessageEventGesture | undefined>()\n    if (strokes.length === 0) {\n      this.addStrokeDeferred.resolve(undefined)\n      return this.addStrokeDeferred?.promise\n    }\n    await this.send(this.buildAddStrokesMessage(strokes, processGestures))\n    return this.addStrokeDeferred?.promise\n  }\n\n  protected buildReplaceStrokesMessage(oldStrokeIds: string[], newStrokes: OIStroke[]): TOIMessageEvent\n  {\n    return {\n      type: \"replaceStrokes\",\n      oldStrokeIds,\n      newStrokes: newStrokes.map(s => s.formatToSend())\n    }\n  }\n  async replaceStrokes(oldStrokeIds: string[], newStrokes: OIStroke[]): Promise<void>\n  {\n    this.replaceStrokeDeferred = new DeferredPromise<void>()\n    if (oldStrokeIds.length === 0) {\n      this.replaceStrokeDeferred.resolve()\n      return this.replaceStrokeDeferred?.promise\n    }\n    await this.send(this.buildReplaceStrokesMessage(oldStrokeIds, newStrokes))\n    return this.replaceStrokeDeferred?.promise\n  }\n\n  protected buildTransformTranslateMessage(strokeIds: string[], tx: number, ty: number): TOIMessageEvent\n  {\n    return {\n      type: \"transform\",\n      transformationType: \"TRANSLATE\",\n      strokeIds,\n      tx,\n      ty\n    }\n  }\n  async transformTranslate(strokeIds: string[], tx: number, ty: number): Promise<void>\n  {\n    this.transformStrokeDeferred = new DeferredPromise<void>()\n    if (strokeIds.length === 0) {\n      this.transformStrokeDeferred.resolve()\n      return this.transformStrokeDeferred?.promise\n    }\n    await this.send(this.buildTransformTranslateMessage(strokeIds, tx, ty))\n    return this.transformStrokeDeferred?.promise\n  }\n\n  protected buildTransformRotateMessage(strokeIds: string[], angle: number, x0: number = 0, y0: number = 0): TOIMessageEvent\n  {\n    return {\n      type: \"transform\",\n      transformationType: \"ROTATE\",\n      strokeIds,\n      angle,\n      x0,\n      y0\n    }\n  }\n  async transformRotate(strokeIds: string[], angle: number, x0: number = 0, y0: number = 0): Promise<void>\n  {\n    this.transformStrokeDeferred = new DeferredPromise<void>()\n    if (strokeIds.length === 0) {\n      this.transformStrokeDeferred.resolve()\n      return this.transformStrokeDeferred?.promise\n    }\n    await this.send(this.buildTransformRotateMessage(strokeIds, angle, x0, y0))\n    return this.transformStrokeDeferred?.promise\n  }\n\n  protected buildTransformScaleMessage(strokeIds: string[], scaleX: number, scaleY: number, x0: number = 0, y0: number = 0): TOIMessageEvent\n  {\n    return {\n      type: \"transform\",\n      transformationType: \"SCALE\",\n      strokeIds,\n      scaleX,\n      scaleY,\n      x0,\n      y0\n    }\n  }\n  async transformScale(strokeIds: string[], scaleX: number, scaleY: number, x0: number = 0, y0: number = 0): Promise<void>\n  {\n    this.transformStrokeDeferred = new DeferredPromise<void>()\n    if (strokeIds.length === 0) {\n      this.transformStrokeDeferred.resolve()\n      return this.transformStrokeDeferred?.promise\n    }\n    await this.send(this.buildTransformScaleMessage(strokeIds, scaleX, scaleY, x0, y0))\n    return this.transformStrokeDeferred?.promise\n  }\n\n  protected buildTransformMatrixMessage(strokeIds: string[], matrix: TMatrixTransform): TOIMessageEvent\n  {\n    return {\n      type: \"transform\",\n      transformationType: \"MATRIX\",\n      strokeIds,\n      ...matrix\n    }\n  }\n  async transformMatrix(strokeIds: string[], matrix: TMatrixTransform): Promise<void>\n  {\n    this.transformStrokeDeferred = new DeferredPromise<void>()\n    if (strokeIds.length === 0) {\n      this.transformStrokeDeferred.resolve()\n      return this.transformStrokeDeferred?.promise\n    }\n    await this.send(this.buildTransformMatrixMessage(strokeIds, matrix))\n    return this.transformStrokeDeferred?.promise\n  }\n\n  protected buildEraseStrokesMessage(strokeIds: string[]): TOIMessageEvent\n  {\n    return {\n      type: \"eraseStrokes\",\n      strokeIds\n    }\n  }\n  async eraseStrokes(strokeIds: string[]): Promise<void>\n  {\n    this.eraseStrokeDeferred = new DeferredPromise<void>()\n    if (strokeIds.length === 0) {\n      this.eraseStrokeDeferred.resolve()\n      return this.eraseStrokeDeferred?.promise\n    }\n    await this.send(this.buildEraseStrokesMessage(strokeIds))\n    return this.eraseStrokeDeferred?.promise\n  }\n\n  async recognizeGesture(stroke: OIStroke): Promise<TOIMessageEventContextlessGesture | undefined>\n  {\n    if (!stroke) {\n      return\n    }\n    this.contextlessGestureDeferred.set(stroke.id, new DeferredPromise<TOIMessageEventContextlessGesture>())\n    const pixelTomm = 25.4 / 96\n    await this.send({\n      type: \"contextlessGesture\",\n      scaleX: pixelTomm,\n      scaleY: pixelTomm,\n      stroke: stroke.formatToSend()\n    })\n    return this.contextlessGestureDeferred.get(stroke.id)!.promise\n  }\n\n  async waitForIdle(): Promise<void>\n  {\n    if (!this.waitForIdleDeferred || this.waitForIdleDeferred.isFullFilled) {\n      this.waitForIdleDeferred = new DeferredPromise<void>()\n    }\n    const message: TOIMessageEvent = {\n      type: \"waitForIdle\",\n    }\n    await this.send(message)\n    return this.waitForIdleDeferred?.promise\n  }\n\n  protected buildUndoRedoChanges(changes: TOIHistoryBackendChanges): TOIMessageEvent[]\n  {\n    const changesMessages: TOIMessageEvent[] = []\n    if (changes.added?.length) {\n      changesMessages.push(this.buildAddStrokesMessage(changes.added, false))\n    }\n    if (changes.erased?.length) {\n      changesMessages.push(this.buildEraseStrokesMessage(changes.erased.map(s => s.id)))\n    }\n    if (changes.replaced?.newStrokes.length) {\n      changesMessages.push(this.buildReplaceStrokesMessage(changes.replaced.oldStrokes.map(s => s.id), changes.replaced.newStrokes))\n    }\n    if (changes.matrix?.strokes.length) {\n      changesMessages.push(this.buildTransformMatrixMessage(changes.matrix.strokes.map(s => s.id), changes.matrix.matrix))\n    }\n    if (changes.translate?.length) {\n      changes.translate.forEach(tr =>\n      {\n        changesMessages.push(this.buildTransformTranslateMessage(tr.strokes.map(s => s.id), tr.tx, tr.ty))\n      })\n    }\n    if (changes.rotate?.length) {\n      changes.rotate.forEach(tr =>\n      {\n        changesMessages.push(this.buildTransformRotateMessage(tr.strokes.map(s => s.id), tr.angle, tr.center.x, tr.center.y))\n      })\n    }\n    if (changes.scale?.length) {\n      changes.scale.forEach(tr =>\n      {\n        changesMessages.push(this.buildTransformScaleMessage(tr.strokes.map(s => s.id), tr.scaleX, tr.scaleY, tr.origin.x, tr.origin.y))\n      })\n    }\n    return changesMessages\n  }\n\n  async undo(actions: TOIHistoryBackendChanges): Promise<void>\n  {\n    const changes = this.buildUndoRedoChanges(actions)\n    if (changes.length === 0) {\n      return\n    }\n    this.undoDeferred = new DeferredPromise<void>()\n    const message: TOIMessageEvent = {\n      type: \"undo\",\n      changes\n    }\n    await this.send(message)\n    return this.undoDeferred?.promise\n  }\n\n  async redo(actions: TOIHistoryBackendChanges): Promise<void>\n  {\n    const changes = this.buildUndoRedoChanges(actions)\n    if (changes.length === 0) {\n      return\n    }\n    this.redoDeferred = new DeferredPromise<void>()\n\n    const message: TOIMessageEvent = {\n      type: \"redo\",\n      changes\n    }\n    await this.send(message)\n    return this.redoDeferred?.promise\n  }\n\n  async export(requestedMimeTypes?: string[]): Promise<TExport>\n  {\n    const mimeTypes: string[] = requestedMimeTypes || this.mimeTypes.slice()\n    await Promise.all(mimeTypes.map(mt => this.exportDeferredMap.get(mt)?.promise))\n    mimeTypes.forEach(mt =>\n    {\n      this.exportDeferredMap.set(mt, new DeferredPromise<TExport>())\n    })\n\n    const message: TOIMessageEvent = {\n      type: \"export\",\n      partId: this.currentPartId,\n      mimeTypes\n    }\n    await this.send(message)\n    const exports = await Promise.all(mimeTypes.map(mt => this.exportDeferredMap.get(mt)!.promise))\n    return Object.assign({}, ...exports)\n  }\n\n  async clear(): Promise<void>\n  {\n    this.clearDeferred = new DeferredPromise<void>()\n    await this.send({\n      type: \"clear\"\n    })\n    return this.clearDeferred?.promise\n  }\n\n  async close(code: number, reason: string): Promise<void>\n  {\n    this.closeDeferred = new DeferredPromise<void>()\n    if (this.socket.readyState === this.socket.OPEN || this.socket.readyState === this.socket.CONNECTING) {\n      this.socket.close(code, reason)\n    }\n    else {\n      this.closeDeferred.resolve()\n    }\n    return this.closeDeferred.promise\n  }\n\n  async destroy(): Promise<void>\n  {\n    this.resetAllDeferred()\n    if (this.socket) {\n      await this.close(1000, \"Recognizer destroyed\")\n    }\n  }\n}\n","import { TConverstionState, TDiagramConfiguration, TExportConfiguration, TMathConfiguration, TRawContentConfiguration, TRecognitionConfiguration, TServerConfiguration, TTextConfiguration } from \"../configuration\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { Model, TExport, TJIIXExport } from \"../model\"\nimport { TStrokeGroup, TStrokeGroupToSend } from \"../primitive\"\nimport { StyleHelper, TPenStyle } from \"../style\"\nimport { computeHmac, isVersionSuperiorOrEqual } from \"../utils\"\nimport { RecognizerError } from \"./RecognizerError\"\n\ntype ApiError = {\n  code?: string\n  message: string\n}\n\n/**\n * @group Recognizer\n */\nexport type TRestPostConfiguration = {\n  lang: string,\n  diagram?: TDiagramConfiguration,\n  math?: TMathConfiguration,\n  \"raw-content\"?: TRawContentConfiguration,\n  text?: TTextConfiguration,\n  export: TExportConfiguration\n}\n\n/**\n * @group Recognizer\n */\nexport type TRestPostData = {\n  configuration: TRestPostConfiguration,\n  xDPI: number,\n  yDPI: number,\n  contentType: string,\n  conversionState?: TConverstionState\n  height: number,\n  width: number,\n  strokeGroups: TStrokeGroupToSend[]\n}\n\n/**\n * @group Recognizer\n */\nexport class RestRecognizer\n{\n  #logger = LoggerManager.getLogger(LoggerClass.RECOGNIZER)\n\n  protected serverConfiguration: TServerConfiguration\n  protected recognitionConfiguration: TRecognitionConfiguration\n\n  constructor(serverConfig: TServerConfiguration, recognitionConfig: TRecognitionConfiguration)\n  {\n    this.#logger.info(\"constructor\", { serverConfig, recognitionConfig })\n    this.serverConfiguration = serverConfig\n    this.recognitionConfiguration = recognitionConfig\n  }\n\n  get url()\n  {\n    return `${ this.serverConfiguration.scheme }://${ this.serverConfiguration.host }/api/v4.0/iink/batch`\n  }\n\n  get postConfig(): TRestPostConfiguration\n  {\n    switch (this.recognitionConfiguration.type) {\n      case \"DIAGRAM\":\n        return {\n          lang: this.recognitionConfiguration.lang,\n          diagram: this.recognitionConfiguration.diagram,\n          export: this.recognitionConfiguration.export\n        }\n      case \"MATH\":\n        return {\n          lang: this.recognitionConfiguration.lang,\n          math: this.recognitionConfiguration.math,\n          export: this.recognitionConfiguration.export\n        }\n      case \"Raw Content\":\n        return {\n          lang: this.recognitionConfiguration.lang,\n          \"raw-content\": this.recognitionConfiguration[\"raw-content\"],\n          export: this.recognitionConfiguration.export\n        }\n      case \"TEXT\":\n        return {\n          lang: this.recognitionConfiguration.lang,\n          text: this.recognitionConfiguration.text,\n          export: this.recognitionConfiguration.export\n        }\n      default:\n        throw new Error(`get postConfig error Recognition type unkow \"${ this.recognitionConfiguration.type }\"`)\n        break\n    }\n  }\n\n  protected buildData(model: Model): TRestPostData\n  {\n    this.#logger.info(\"buildData\", { model })\n    const isPenStyleEqual = (ps1: TPenStyle, ps2: TPenStyle) =>\n    {\n      return ps1 && ps2 && ps1[\"-myscript-pen-fill-color\"] === ps2[\"-myscript-pen-fill-color\"] &&\n        ps1[\"-myscript-pen-fill-style\"] === ps2[\"-myscript-pen-fill-style\"] &&\n        ps1[\"-myscript-pen-width\"] === ps2[\"-myscript-pen-width\"] &&\n        ps1.color === ps2.color &&\n        ps1.width === ps2.width\n    }\n\n    const strokeGroupByPenStyle: TStrokeGroup[] = []\n    model.symbols.forEach((s) =>\n    {\n      const groupIndex = strokeGroupByPenStyle.findIndex(sg => isPenStyleEqual(sg.penStyle, s.style))\n      if (groupIndex > -1) {\n        strokeGroupByPenStyle[groupIndex].strokes.push(s)\n      } else {\n        strokeGroupByPenStyle.push({\n          penStyle: s.style,\n          strokes: [s]\n        })\n      }\n    })\n\n    const strokeGroupsToSend: TStrokeGroupToSend[] = []\n    strokeGroupByPenStyle.forEach((group: TStrokeGroup) =>\n    {\n      const newPenStyle = JSON.stringify(group.penStyle) === \"{}\" ? undefined : StyleHelper.penStyleToCSS(group.penStyle as TPenStyle)\n      const newGroup = {\n        penStyle: newPenStyle,\n        strokes: group.strokes.map(s => s.formatToSend())\n      }\n      strokeGroupsToSend.push(newGroup)\n    })\n\n    const contentType: string = this.recognitionConfiguration.type === \"Raw Content\" ?\n      \"Raw Content\" :\n      this.recognitionConfiguration.type.charAt(0).toUpperCase() + this.recognitionConfiguration.type.slice(1).toLowerCase()\n\n    const data = {\n      configuration: this.postConfig,\n      xDPI: 96,\n      yDPI: 96,\n      contentType,\n      height: model.height,\n      width: model.width,\n      strokeGroups: strokeGroupsToSend\n    }\n    this.#logger.debug(\"buildData\", { data })\n    return data\n  }\n\n  protected async post(data: unknown, mimeType: string): Promise<unknown>\n  {\n    this.#logger.info(\"post\", { data, mimeType })\n    const headers = new Headers()\n    headers.append(\"Accept\", \"application/json,\" + mimeType)\n    headers.append(\"applicationKey\", this.serverConfiguration.applicationKey)\n    try {\n      const hmac = await computeHmac(JSON.stringify(data), this.serverConfiguration.applicationKey, this.serverConfiguration.hmacKey)\n      headers.append(\"hmac\", hmac)\n    } catch (error) {\n      this.#logger.error(\"post.computeHmac\", error)\n    }\n    headers.append(\"Content-Type\", \"application/json\")\n\n    if (isVersionSuperiorOrEqual(this.serverConfiguration.version, \"2.0.4\")) {\n      headers.append(\"myscript-client-name\", \"iink-ts\")\n      headers.append(\"myscript-client-version\", \"2.0.1\")\n    }\n\n    const reqInit: RequestInit = {\n      method: \"POST\",\n      headers,\n      body: JSON.stringify(data)\n    }\n    const request = new Request(this.url, reqInit)\n    const response: Response = await fetch(request)\n    if (response.ok) {\n      const contentType = response.headers.get(\"content-type\")\n      let result: unknown\n      switch (contentType) {\n        case \"application/vnd.openxmlformats-officedocument.presentationml.presentation\":\n        case \"image/png\":\n        case \"image/jpeg\":\n          result = await response.blob()\n          break\n        case \"application/json\":\n          result = await response.json()\n          break\n        case \"application/vnd.myscript.jiix\":\n          result = await response.clone().json().catch(async () => await response.text())\n          break\n        default:\n          result = await response.text()\n          break\n      }\n      this.#logger.debug(\"post\", { result })\n      return result\n    } else {\n      const err = await response.json() as ApiError\n      this.#logger.error(\"post\", { err })\n      throw err\n    }\n  }\n\n  protected async tryFetch(data: TRestPostData, mimeType: string): Promise<TExport | never>\n  {\n    this.#logger.debug(\"tryFetch\", { data, mimeType })\n    return this.post(data, mimeType)\n      .then((res) =>\n      {\n        const exports: TExport = {}\n        exports[mimeType] = res as TJIIXExport | string | Blob\n        this.#logger.debug(\"tryFetch\", { exports })\n        return exports\n      })\n      .catch((err) =>\n      {\n        this.#logger.error(\"tryFetch\", { data, mimeType, err })\n        let message = err.message || RecognizerError.UNKNOW\n        if (!err.code) {\n          message = RecognizerError.CANT_ESTABLISH\n        } else if (err.code === \"access.not.granted\") {\n          message = RecognizerError.WRONG_CREDENTIALS\n        }\n        const error = new Error(message)\n        throw error\n      })\n  }\n\n  protected getMimeTypes(requestedMimeTypes?: string[]): string[]\n  {\n    this.#logger.info(\"getMimeTypes\", { requestedMimeTypes })\n    let mimeTypes: string[] = requestedMimeTypes || []\n    if (!mimeTypes.length) {\n      switch (this.recognitionConfiguration.type) {\n        case \"DIAGRAM\":\n          mimeTypes = this.recognitionConfiguration.diagram.mimeTypes\n          break\n        case \"MATH\":\n          mimeTypes = this.recognitionConfiguration.math.mimeTypes\n          break\n        case \"Raw Content\":\n          mimeTypes = [\"application/vnd.myscript.jiix\"]\n          break\n        case \"TEXT\":\n          mimeTypes = this.recognitionConfiguration.text.mimeTypes\n          break\n        default:\n          throw new Error(`Recognition type \"${ this.recognitionConfiguration.type }\" is unknown.\\n Possible types are:\\n -DIAGRAM\\n -MATH\\n -Raw Content\\n -TEXT`)\n          break\n      }\n    }\n    return mimeTypes\n  }\n\n  async convert(model: Model, conversionState?: TConverstionState, requestedMimeTypes?: string[]): Promise<Model>\n  {\n    this.#logger.info(\"convert\", { model, conversionState, requestedMimeTypes })\n    const myModel = model.clone()\n    const mimeTypes = this.getMimeTypes(requestedMimeTypes)\n    const dataToConcert = this.buildData(myModel)\n    dataToConcert.conversionState = conversionState\n    const promises = mimeTypes.map(mt => this.tryFetch(dataToConcert, mt))\n    const exports: TExport[] = await Promise.all(promises)\n    exports.forEach(e =>\n    {\n      myModel.mergeConvert(e)\n    })\n    this.#logger.debug(\"convert\", { model: myModel })\n    return myModel\n  }\n\n  async export(model: Model, requestedMimeTypes?: string[]): Promise<Model>\n  {\n    this.#logger.info(\"export\", { model, requestedMimeTypes })\n    const myModel = model.clone()\n    if (myModel.symbols.length === 0) {\n      return Promise.resolve(myModel)\n    }\n    const mimeTypes = this.getMimeTypes(requestedMimeTypes)\n    if (!mimeTypes.length) {\n      this.#logger.error(\"export\", { model, requestedMimeTypes, \"Export failed, no mimeTypes define in recognition configuration\": String })\n      return Promise.reject(new Error(\"Export failed, no mimeTypes define in recognition configuration\"))\n    }\n    const mimeTypesRequiringExport: string[] = mimeTypes.filter(m => !myModel.exports || !myModel.exports[m])\n    const data = this.buildData(model)\n    const exports: TExport[] = await Promise.all(mimeTypesRequiringExport.map(mimeType => this.tryFetch(data, mimeType)))\n    exports.forEach(e =>\n    {\n      myModel.mergeExport(e)\n    })\n    this.#logger.debug(\"export\", { model: myModel })\n    return myModel\n  }\n\n  async resize(model: Model): Promise<Model>\n  {\n    this.#logger.info(\"resize\", { model })\n    return this.export(model)\n  }\n\n}\n","import { TConverstionState, TRecognitionConfiguration, TServerConfiguration } from \"../configuration\"\nimport { InternalEvent } from \"../event\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { Model, TExport, TJIIXExport } from \"../model\"\nimport { Stroke } from \"../primitive\"\nimport { StyleHelper, TPenStyle, TTheme } from \"../style\"\nimport { TUndoRedoContext } from \"../history\"\nimport { DeferredPromise, PartialDeep, computeHmac, isVersionSuperiorOrEqual } from \"../utils\"\nimport\n{\n  TWSMessageEvent,\n  TWSMessageEventContentChange,\n  TWSMessageEventError,\n  TWSMessageEventExport,\n  TWSMessageEventHMACChallenge,\n  TWSMessageEventPartChange,\n  TWSMessageEventSVGPatch\n} from \"./WSRecognizerMessage\"\nimport { RecognizerError } from \"./RecognizerError\"\n\n/**\n * A websocket dialog have this sequence :\n * --------------------------- Client --------------------------------------------------- Server ----------------------------------\n * init: send newContentPackage or restoreIInkSession           ==================>\n *                                                              <==================       ack\n * answer ack:\n *  send the hmac (if enable)                                   ==================>\n *  send the configuration                                      ==================>\n *                                                              <==================       contentPackageDescription\n * answer contentPackageDescription:\n *  send newContentPart or openContentPart                      ==================>\n *                                                              <==================        partChanged\n *                                                              <==================        contentChanged\n *                                                              <==================        newPart\n *                                                              <==================        svgPatch\n *\n * setPenStyle (send the parameters)                            ==================>\n * setTheme (send the parameters)                               ==================>\n * setPenStyleClasses (send the parameters)                     ==================>\n *                                                              <==================        svgPatch\n * addStrokes (send the strokes ) ============>\n *                                                              <==================        update\n */\n\n/**\n * @group Recognizer\n */\nexport class WSRecognizer\n{\n  #logger = LoggerManager.getLogger(LoggerClass.RECOGNIZER)\n  protected serverConfiguration: TServerConfiguration\n  protected recognitionConfiguration: TRecognitionConfiguration\n\n  protected socket!: WebSocket\n  protected pingCount = 0\n  protected reconnectionCount = 0\n  protected viewSizeHeight!: number\n  protected viewSizeWidth!: number\n  protected sessionId?: string\n  // contentPartCount = 0\n  currentPartId?: string\n  protected currentErrorCode?: string | number\n\n  protected penStyle?: TPenStyle\n  protected penStyleClasses?: string\n  protected theme?: TTheme\n\n  protected connected?: DeferredPromise<void>\n  protected initialized?: DeferredPromise<void>\n  protected ackDeferred?: DeferredPromise<void>\n  protected addStrokeDeferred?: DeferredPromise<TExport>\n  protected exportDeferred?: DeferredPromise<TExport>\n  protected convertDeferred?: DeferredPromise<TExport>\n  protected importDeferred?: DeferredPromise<TExport>\n  protected resizeDeferred?: DeferredPromise<void>\n  protected undoDeferred?: DeferredPromise<TExport>\n  protected redoDeferred?: DeferredPromise<TExport>\n  protected clearDeferred?: DeferredPromise<TExport>\n  protected importPointEventsDeferred?: DeferredPromise<TExport>\n  protected waitForIdleDeferred?: DeferredPromise<void>\n\n  url: string\n\n  constructor(serverConfig: TServerConfiguration, recognitionConfig: TRecognitionConfiguration)\n  {\n    this.serverConfiguration = serverConfig\n    this.recognitionConfiguration = recognitionConfig\n    const scheme = (this.serverConfiguration.scheme === \"https\") ? \"wss\" : \"ws\"\n    this.url = `${ scheme }://${ this.serverConfiguration.host }/api/v4.0/iink/document?applicationKey=${ this.serverConfiguration.applicationKey }`\n    this.#logger.info(\"constructor\", { serverConfig, recognitionConfig, url: this.url })\n  }\n\n  get mimeTypes(): string[]\n  {\n    switch (this.recognitionConfiguration.type.toLocaleLowerCase()) {\n      case \"text\":\n        return this.recognitionConfiguration.text.mimeTypes\n      case \"math\":\n        return this.recognitionConfiguration.math.mimeTypes\n      default:\n        throw new Error(`Unauthorized recognition type: \"${ this.recognitionConfiguration.type }\"`)\n    }\n  }\n\n  get internalEvent(): InternalEvent\n  {\n    return InternalEvent.getInstance()\n  }\n\n  protected infinitePing(): void\n  {\n    this.pingCount++\n    if (this.serverConfiguration.websocket.maxPingLostCount < this.pingCount) {\n      this.socket.close(1000, \"MAXIMUM_PING_REACHED\")\n    } else if (this.socket.readyState <= 1) {\n      setTimeout(() =>\n      {\n        if (this.socket.readyState <= 1) {\n          this.socket.send(JSON.stringify({ type: \"ping\" }))\n          this.infinitePing()\n        }\n      }, this.serverConfiguration.websocket.pingDelay)\n    }\n  }\n\n  protected openCallback(): void\n  {\n    this.connected?.resolve()\n    const params: TWSMessageEvent = {\n      type: this.sessionId ? \"restoreIInkSession\" : \"newContentPackage\",\n      iinkSessionId: this.sessionId,\n      applicationKey: this.serverConfiguration.applicationKey,\n      xDpi: 96,\n      yDpi: 96,\n      viewSizeHeight: this.viewSizeHeight,\n      viewSizeWidth: this.viewSizeWidth\n    }\n    if (isVersionSuperiorOrEqual(this.serverConfiguration.version, \"2.0.4\")) {\n      params[\"myscript-client-name\"] = \"iink-ts\"\n      params[\"myscript-client-version\"] = \"2.0.1\"\n    }\n    this.send(params)\n  }\n\n  protected rejectDeferredPending(error: Error): void\n  {\n    if (this.connected?.isPending) {\n      this.connected?.reject(error)\n    }\n    if (this.initialized?.isPending) {\n      this.initialized?.reject(error)\n    }\n    if (this.addStrokeDeferred?.isPending) {\n      this.addStrokeDeferred?.reject(error)\n    }\n    if (this.exportDeferred?.isPending) {\n      this.exportDeferred?.reject(error)\n    }\n    if (this.convertDeferred?.isPending) {\n      this.convertDeferred?.reject(error)\n    }\n    if (this.importDeferred?.isPending) {\n      this.importDeferred?.reject(error)\n    }\n    if (this.resizeDeferred?.isPending) {\n      this.resizeDeferred?.reject(error)\n    }\n    if (this.undoDeferred?.isPending) {\n      this.undoDeferred?.reject(error)\n    }\n    if (this.redoDeferred?.isPending) {\n      this.redoDeferred?.reject(error)\n    }\n    if (this.clearDeferred?.isPending) {\n      this.clearDeferred.reject(error)\n    }\n    if (this.waitForIdleDeferred?.isPending) {\n      this.waitForIdleDeferred.reject(error)\n    }\n  }\n\n  protected closeCallback(evt: CloseEvent): void\n  {\n    let message = \"\"\n    if (!this.currentErrorCode) {\n      switch (evt.code) {\n        case 1000:\n          // Normal Closure\n          break\n        case 1001:\n          message = RecognizerError.GOING_AWAY\n          break\n        case 1002:\n          message = RecognizerError.PROTOCOL_ERROR\n          break\n        case 1003:\n          message = RecognizerError.UNSUPPORTED_DATA\n          break\n        case 1006:\n          message = RecognizerError.ABNORMAL_CLOSURE\n          break\n        case 1007:\n          message = RecognizerError.INVALID_FRAME_PAYLOAD\n          break\n        case 1008:\n          message = RecognizerError.POLICY_VIOLATION\n          break\n        case 1009:\n          message = RecognizerError.MESSAGE_TOO_BIG\n          break\n        case 1011:\n          message = RecognizerError.INTERNAL_ERROR\n          break\n        case 1012:\n          message = RecognizerError.SERVICE_RESTART\n          break\n        case 1013:\n          message = RecognizerError.TRY_AGAIN\n          break\n        case 1014:\n          message = RecognizerError.BAD_GATEWAY\n          break\n        case 1015:\n          message = RecognizerError.TLS_HANDSHAKE\n          break\n        default:\n          this.#logger.warn(\"closeCallback\", \"unknow CloseEvent.code\", { evt })\n          message = RecognizerError.CANT_ESTABLISH\n          break\n      }\n    }\n    const error = new Error(message || evt.reason)\n\n    this.rejectDeferredPending(error)\n\n    if (!this.currentErrorCode && evt.code !== 1000) {\n      this.internalEvent.emitError(error)\n    }\n  }\n\n  protected async manageAckMessage(websocketMessage: TWSMessageEvent): Promise<void>\n  {\n    this.#logger.info(\"manageAckMessage\", { websocketMessage })\n    const hmacChallengeMessage = websocketMessage as TWSMessageEventHMACChallenge\n    if (hmacChallengeMessage.hmacChallenge) {\n      this.send({\n        type: \"hmac\",\n        hmac: await computeHmac(hmacChallengeMessage.hmacChallenge, this.serverConfiguration.applicationKey, this.serverConfiguration.hmacKey)\n      })\n    }\n    if (hmacChallengeMessage.iinkSessionId) {\n      this.sessionId = hmacChallengeMessage.iinkSessionId\n    }\n\n    const recognitionConfig = structuredClone(this.recognitionConfiguration) as PartialDeep<TRecognitionConfiguration>\n    if (!isVersionSuperiorOrEqual(this.serverConfiguration.version, \"2.3.0\")) {\n      delete recognitionConfig.convert\n    }\n    this.send({ ...recognitionConfig, type: \"configuration\" })\n    this.ackDeferred?.resolve()\n  }\n\n  protected async manageContentPackageDescriptionMessage(): Promise<void>\n  {\n    this.reconnectionCount = 0\n    await this.ackDeferred?.promise\n    this.#logger.info(\"manageContentPackageDescriptionMessage\")\n    if (this.currentPartId) {\n      this.send({ type: \"openContentPart\", id: this.currentPartId, mimeTypes: this.mimeTypes })\n    }\n    else {\n      this.send({ type: \"newContentPart\", contentType: this.recognitionConfiguration.type, mimeTypes: this.mimeTypes })\n    }\n  }\n\n  protected managePartChangeMessage(websocketMessage: TWSMessageEvent): void\n  {\n    this.#logger.info(\"managePartChangeMessage\", { websocketMessage })\n    const partChangeMessage = websocketMessage as TWSMessageEventPartChange\n    this.currentPartId = partChangeMessage.partId\n    this.initialized?.resolve()\n  }\n\n  protected manageExportMessage(websocketMessage: TWSMessageEvent): void\n  {\n    this.#logger.info(\"manageExportMessage\", { websocketMessage })\n    const exportMessage = websocketMessage as TWSMessageEventExport\n    if (exportMessage.exports[\"application/vnd.myscript.jiix\"]) {\n      exportMessage.exports[\"application/vnd.myscript.jiix\"] = JSON.parse(exportMessage.exports[\"application/vnd.myscript.jiix\"].toString()) as TJIIXExport\n    }\n    this.initialized?.resolve()\n    this.addStrokeDeferred?.resolve(exportMessage.exports)\n    this.exportDeferred?.resolve(exportMessage.exports)\n    this.convertDeferred?.resolve(exportMessage.exports)\n    this.importDeferred?.resolve(exportMessage.exports)\n    this.undoDeferred?.resolve(exportMessage.exports)\n    this.redoDeferred?.resolve(exportMessage.exports)\n    this.clearDeferred?.resolve(exportMessage.exports)\n    this.importPointEventsDeferred?.resolve(exportMessage.exports)\n    this.internalEvent.emitExported(exportMessage.exports)\n  }\n\n  protected async manageWaitForIdle(): Promise<void>\n  {\n    this.internalEvent.emitIdle(true)\n    this.waitForIdleDeferred?.resolve()\n  }\n\n  protected manageErrorMessage(websocketMessage: TWSMessageEvent): void\n  {\n    const err = websocketMessage as TWSMessageEventError\n    this.currentErrorCode = err.data?.code || err.code\n    let message = err.data?.message || err.message || RecognizerError.UNKNOW\n\n    switch (this.currentErrorCode) {\n      case \"no.activity\":\n        message = RecognizerError.NO_ACTIVITY\n        break\n      case \"access.not.granted\":\n        message = RecognizerError.WRONG_CREDENTIALS\n        break\n      case \"session.too.old\":\n        message = RecognizerError.TOO_OLD\n        break\n    }\n    const error = new Error(message)\n    this.rejectDeferredPending(error)\n    this.internalEvent.emitError(error)\n  }\n\n  protected manageContentChangeMessage(websocketMessage: TWSMessageEvent): void\n  {\n    this.#logger.info(\"manageContentChangeMessage\", { websocketMessage })\n    const contentChangeMessage = websocketMessage as TWSMessageEventContentChange\n    const context: TUndoRedoContext = {\n      canRedo: contentChangeMessage.canRedo,\n      canUndo: contentChangeMessage.canUndo,\n      empty: contentChangeMessage.empty,\n      stackIndex: contentChangeMessage.undoStackIndex,\n      possibleUndoCount: contentChangeMessage.possibleUndoCount,\n    }\n    this.internalEvent.emitContextChange(context)\n  }\n\n  protected manageSVGPatchMessage(websocketMessage: TWSMessageEvent): void\n  {\n    this.#logger.info(\"manageSVGPatchMessage\", { websocketMessage })\n    this.resizeDeferred?.resolve()\n    const svgPatchMessage = websocketMessage as TWSMessageEventSVGPatch\n    this.internalEvent.emitSVGPatch(svgPatchMessage)\n  }\n\n  protected messageCallback(message: MessageEvent<string>): void\n  {\n    this.#logger.debug(\"messageCallback\", { message })\n    this.currentErrorCode = undefined\n    const websocketMessage: TWSMessageEvent = JSON.parse(message.data)\n    if (websocketMessage.type !== \"pong\") {\n      this.pingCount = 0\n      switch (websocketMessage.type) {\n        case \"ack\":\n          this.manageAckMessage(websocketMessage)\n          break\n        case \"contentPackageDescription\":\n          this.manageContentPackageDescriptionMessage()\n          break\n        case \"partChanged\":\n          this.managePartChangeMessage(websocketMessage)\n          break\n        case \"newPart\":\n          this.initialized?.resolve()\n          break\n        case \"contentChanged\":\n          this.manageContentChangeMessage(websocketMessage)\n          break\n        case \"exported\":\n          this.manageExportMessage(websocketMessage)\n          break\n        case \"svgPatch\":\n          this.manageSVGPatchMessage(websocketMessage)\n          break\n        case \"error\":\n          this.manageErrorMessage(websocketMessage)\n          break\n        case \"idle\":\n          this.manageWaitForIdle()\n          break\n        default:\n          this.#logger.warn(\"messageCallback\", `Message type unknow: \"${ websocketMessage.type }\".`)\n      }\n    }\n  }\n\n  async init(height: number, width: number): Promise<void>\n  {\n    try {\n      this.#logger.info(\"init\", { height, width })\n      this.destroy()\n      this.connected = new DeferredPromise<void>()\n      this.initialized = new DeferredPromise<void>()\n      this.ackDeferred = new DeferredPromise<void>()\n      this.viewSizeHeight = height\n      this.viewSizeWidth = width\n      this.pingCount = 0\n      this.socket = new WebSocket(this.url)\n\n      if (this.serverConfiguration.websocket.pingEnabled) {\n        this.infinitePing()\n      }\n\n      this.socket.addEventListener(\"open\", this.openCallback.bind(this))\n      this.socket.addEventListener(\"close\", this.closeCallback.bind(this))\n      this.socket.addEventListener(\"message\", this.messageCallback.bind(this))\n\n      return this.initialized.promise\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    } catch (err: any) {\n      const error = new Error(RecognizerError.CANT_ESTABLISH)\n      this.internalEvent.emitError(error)\n      this.initialized?.reject(error)\n      return this.initialized?.promise\n    }\n  }\n\n  async send(message: TWSMessageEvent): Promise<void>\n  {\n    if (!this.connected) {\n      return Promise.reject(new Error(\"Recognizer must be initilized\"))\n    }\n    await this.connected.promise\n    if (this.socket.readyState === this.socket.OPEN) {\n      this.#logger.debug(\"send\", { message })\n      this.socket.send(JSON.stringify(message))\n      return Promise.resolve()\n    } else {\n      if (this.socket.readyState != this.socket.CONNECTING && this.serverConfiguration.websocket.autoReconnect) {\n        this.reconnectionCount++\n        if (this.serverConfiguration.websocket.maxRetryCount >= this.reconnectionCount) {\n          this.#logger.debug(\"send\", `try to reconnect number: ${ this.reconnectionCount }.`)\n          this.internalEvent.emitClearMessage()\n          await this.init(this.viewSizeHeight, this.viewSizeWidth)\n          await this.setPenStyle(this.penStyle as TPenStyle)\n          await this.setPenStyleClasses(this.penStyleClasses as string)\n          await this.setTheme(this.theme as TTheme)\n          return this.send(message)\n        }\n        else {\n          return Promise.reject(new Error(\"Unable to send message. The maximum number of connection attempts has been reached.\"))\n        }\n      }\n    }\n  }\n\n  async addStrokes(strokes: Stroke[]): Promise<TExport>\n  {\n    this.#logger.info(\"addStrokes\", { strokes })\n    await this.initialized?.promise\n    this.addStrokeDeferred = new DeferredPromise<TExport>()\n    if (strokes.length === 0) {\n      this.addStrokeDeferred.resolve({} as TExport)\n    }\n    else {\n      await this.send({\n        type: \"addStrokes\",\n        strokes: strokes.map(s => s.formatToSend())\n      })\n    }\n    return this.addStrokeDeferred?.promise\n  }\n\n  async setPenStyle(penStyle: TPenStyle): Promise<void>\n  {\n    this.#logger.info(\"setPenStyle\", { penStyle })\n    await this.initialized?.promise\n    this.penStyle = penStyle\n    const message: TWSMessageEvent = {\n      type: \"setPenStyle\",\n      style: StyleHelper.penStyleToCSS(penStyle)\n    }\n    return this.send(message)\n  }\n\n  async setPenStyleClasses(penStyleClasses: string): Promise<void>\n  {\n    await this.initialized?.promise\n    this.penStyleClasses = penStyleClasses\n    this.#logger.info(\"setPenStyleClasses\", { penStyleClasses })\n    const message: TWSMessageEvent = {\n      type: \"setPenStyleClasses\",\n      styleClasses: penStyleClasses\n    }\n    return this.send(message)\n  }\n\n  async setTheme(theme: TTheme): Promise<void>\n  {\n    this.#logger.info(\"setTheme\", { theme })\n    await this.initialized?.promise\n    this.theme = theme\n    const message: TWSMessageEvent = {\n      type: \"setTheme\",\n      theme: StyleHelper.themeToCSS(theme)\n    }\n    return this.send(message)\n  }\n\n  async export(model: Model, requestedMimeTypes?: string[]): Promise<Model>\n  {\n    this.#logger.info(\"export\", { model, requestedMimeTypes })\n    await this.initialized?.promise\n    this.exportDeferred = new DeferredPromise<TExport>()\n    const localModel = model.clone()\n    let mimeTypes: string[] = requestedMimeTypes || []\n    if (!mimeTypes.length) {\n      switch (this.recognitionConfiguration.type) {\n        case \"DIAGRAM\":\n          mimeTypes = this.recognitionConfiguration.diagram.mimeTypes\n          break\n        case \"MATH\":\n          mimeTypes = this.recognitionConfiguration.math.mimeTypes\n          break\n        case \"Raw Content\":\n          mimeTypes = [\"application/vnd.myscript.jiix\"]\n          break\n        case \"TEXT\":\n          mimeTypes = this.recognitionConfiguration.text.mimeTypes\n          break\n        default:\n          throw new Error(`Recognition type \"${ this.recognitionConfiguration.type }\" is unknown.\\n Possible types are:\\n -DIAGRAM\\n -MATH\\n -Raw Content\\n -TEXT`)\n      }\n    }\n\n    if (!mimeTypes.length) {\n      return Promise.reject(new Error(`Export failed, no mimeTypes define in recognition ${ this.recognitionConfiguration.type } configuration`))\n    }\n\n    const message: TWSMessageEvent = {\n      type: \"export\",\n      partId: this.currentPartId,\n      mimeTypes\n    }\n    await this.send(message)\n    const exports: TExport = await this.exportDeferred?.promise\n    localModel.updatePositionReceived()\n    localModel.mergeExport(exports)\n    this.#logger.debug(\"export\", { model: localModel })\n    return localModel\n  }\n\n  async import(model: Model, data: Blob, mimeType?: string): Promise<Model>\n  {\n    this.#logger.info(\"import\", { data, mimeType })\n    await this.initialized?.promise\n    const localModel = model.clone()\n    const chunkSize = this.serverConfiguration.websocket.fileChunkSize\n    const importFileId = Math.random().toString(10).substring(2, 6)\n    this.importDeferred = new DeferredPromise<TExport>()\n    const readBlob = (blob: Blob): Promise<string | never> =>\n    {\n      const fileReader = new FileReader()\n      return new Promise((resolve, reject) =>\n      {\n        fileReader.onloadend = (ev) => resolve(ev.target?.result as string)\n        fileReader.onerror = () => reject()\n        fileReader.readAsText(blob)\n      })\n    }\n\n    const importFileMessage: TWSMessageEvent = {\n      type: \"importFile\",\n      importFileId,\n      mimeType\n    }\n    await this.send(importFileMessage)\n    for (let i = 0; i < data.size; i += chunkSize) {\n      const blobPart = data.slice(i, i + chunkSize, data.type)\n      const partFileString = await readBlob(blobPart)\n      const fileChuckMessage: TWSMessageEvent = {\n        type: \"fileChunk\",\n        importFileId,\n        data: partFileString,\n        lastChunk: i + chunkSize > data.size\n      }\n      await this.send(fileChuckMessage)\n    }\n    const exports = await this.importDeferred?.promise\n    this.importDeferred = undefined\n    localModel.mergeExport(exports)\n    return localModel\n  }\n\n  async resize(model: Model): Promise<Model>\n  {\n    this.#logger.info(\"resize\", { model })\n    await this.initialized?.promise\n    this.resizeDeferred = new DeferredPromise<void>()\n    const localModel = model.clone()\n    this.viewSizeHeight = localModel.height\n    this.viewSizeWidth = localModel.width\n    const message: TWSMessageEvent = {\n      type: \"changeViewSize\",\n      height: this.viewSizeHeight,\n      width: this.viewSizeWidth,\n    }\n    await this.send(message)\n    await this.resizeDeferred?.promise\n    return localModel\n  }\n\n  async importPointEvents(strokes: Stroke[]): Promise<TExport>\n  {\n    this.#logger.info(\"importPointsEvents\", { strokes })\n    await this.initialized?.promise\n    this.importPointEventsDeferred = new DeferredPromise<TExport>()\n    const message: TWSMessageEvent = {\n      type: \"pointerEvents\",\n      events: strokes.map(s => s.formatToSend())\n    }\n    this.send(message)\n    const exportPoints = await this.importPointEventsDeferred?.promise\n    this.importPointEventsDeferred = undefined\n    this.#logger.debug(\"importPointEvents\", { exportPoints })\n    return exportPoints as TExport\n  }\n\n  async convert(model: Model, conversionState?: TConverstionState): Promise<Model>\n  {\n    this.#logger.info(\"convert\", { model, conversionState })\n    await this.initialized?.promise\n    this.convertDeferred = new DeferredPromise<TExport>()\n    const localModel = model.clone()\n    const message: TWSMessageEvent = {\n      type: \"convert\",\n      conversionState\n    }\n    await this.send(message)\n    const myExportConverted: TExport = await this.convertDeferred?.promise\n    localModel.updatePositionReceived()\n    localModel.mergeConvert(myExportConverted)\n    this.#logger.debug(\"convert\", { model: localModel })\n    return localModel\n  }\n\n  async waitForIdle(): Promise<void>\n  {\n    await this.initialized?.promise\n    this.waitForIdleDeferred = new DeferredPromise<void>()\n    const message: TWSMessageEvent = {\n      type: \"waitForIdle\",\n    }\n    await this.send(message)\n    return this.waitForIdleDeferred?.promise\n  }\n\n  async undo(model: Model): Promise<Model>\n  {\n    this.#logger.info(\"undo\", { model })\n    await this.initialized?.promise\n    const localModel = model.clone()\n    this.undoDeferred = new DeferredPromise<TExport>()\n    const message: TWSMessageEvent = {\n      type: \"undo\",\n    }\n    await this.send(message)\n    const undoExports = await this.undoDeferred?.promise\n    localModel.updatePositionReceived()\n    localModel.mergeExport(undoExports)\n    this.#logger.debug(\"undo\", { model: localModel })\n    this.undoDeferred = undefined\n    return localModel\n  }\n\n  async redo(model: Model): Promise<Model>\n  {\n    this.#logger.info(\"redo\", { model })\n    await this.initialized?.promise\n    const localModel = model.clone()\n    this.redoDeferred = new DeferredPromise<TExport>()\n    const message: TWSMessageEvent = {\n      type: \"redo\",\n    }\n    await this.send(message)\n    const redoExports = await this.redoDeferred?.promise\n    localModel.updatePositionReceived()\n    localModel.mergeExport(redoExports)\n    this.#logger.debug(\"redo\", { model: redoExports })\n    this.redoDeferred = undefined\n    return localModel\n  }\n\n  async clear(model: Model): Promise<Model>\n  {\n    this.#logger.info(\"clear\", { model })\n    await this.initialized?.promise\n    const localModel = model.clone()\n    localModel.modificationDate = Date.now()\n    this.clearDeferred = new DeferredPromise<TExport>()\n    const message: TWSMessageEvent = {\n      type: \"clear\",\n    }\n    await this.send(message)\n    const clearExports = await this.clearDeferred?.promise\n    localModel.updatePositionReceived()\n    localModel.mergeExport(clearExports)\n    this.clearDeferred = undefined\n    this.#logger.info(\"clear\", { model: localModel })\n    return localModel\n  }\n\n  close(code: number, reason: string): void\n  {\n    if (this.socket.readyState === this.socket.OPEN || this.socket.readyState === this.socket.CONNECTING) {\n      this.#logger.info(\"close\", { code, reason })\n      this.socket.removeEventListener(\"close\", this.closeCallback)\n      this.socket.removeEventListener(\"message\", this.messageCallback)\n      this.socket.removeEventListener(\"open\", this.openCallback)\n      this.socket.close(code, reason)\n    }\n  }\n\n  destroy(): void\n  {\n    this.#logger.info(\"destroy\")\n    this.connected = undefined\n    this.initialized = undefined\n    this.ackDeferred = undefined\n    this.addStrokeDeferred = undefined\n    this.exportDeferred = undefined\n    this.convertDeferred = undefined\n    this.importDeferred = undefined\n    this.resizeDeferred = undefined\n    this.undoDeferred = undefined\n    this.redoDeferred = undefined\n    this.clearDeferred = undefined\n    if (this.socket) {\n      this.socket.removeEventListener(\"close\", this.closeCallback)\n      this.socket.removeEventListener(\"message\", this.messageCallback)\n      this.socket.removeEventListener(\"open\", this.openCallback)\n      this.close(1000, \"Recognizer destroyed\")\n    }\n  }\n}\n","import { LoggerClass, LoggerManager } from \"../../logger\"\nimport { TPoint, TCanvasShapeEllipseSymbol, TCanvasShapeLineSymbol, TCanvasShapeTableSymbol, TSymbol } from \"../../primitive\"\n\n/**\n * @group Renderer\n */\nexport class CanvasRendererShape\n{\n  #logger = LoggerManager.getLogger(LoggerClass.RENDERER)\n\n  symbols = {\n    table: \"table\",\n    ellipse: \"ellipse\",\n    line: \"line\"\n  }\n\n  protected phi(angle: number): number\n  {\n    let returnedAngle = ((angle + Math.PI) % (Math.PI * 2)) - Math.PI\n    if (returnedAngle < -Math.PI) {\n      returnedAngle += Math.PI * 2\n    }\n    this.#logger.debug(\"phi\", { angle, returnedAngle })\n    return returnedAngle\n  }\n\n  protected drawEllipseArc(context2D: CanvasRenderingContext2D, shapeEllipse: TCanvasShapeEllipseSymbol): TPoint[]\n  {\n    this.#logger.debug(\"drawEllipseArc\", { context2D, shapeEllipse })\n    const { centerPoint, maxRadius, minRadius, orientation, startAngle, sweepAngle } = shapeEllipse\n    const angleStep = 0.02\n    const z1 = Math.cos(orientation) * maxRadius\n    const z2 = Math.cos(orientation) * minRadius\n    const z3 = Math.sin(orientation) * maxRadius\n    const z4 = Math.sin(orientation) * minRadius\n    const n = Math.floor(Math.abs(sweepAngle) / angleStep)\n    const boundariesPoints = []\n    context2D.save()\n    try {\n      context2D.beginPath()\n      for (let i = 0; i <= n; i++) {\n        const angle = startAngle + ((i / n) * sweepAngle)\n        const alpha = Math.atan2(Math.sin(angle) / minRadius, Math.cos(angle) / maxRadius)\n        const cosAlpha = Math.cos(alpha)\n        const sinAlpha = Math.sin(alpha)\n        const x = (centerPoint.x + (z1 * cosAlpha)) - (z4 * sinAlpha)\n        const y = (centerPoint.y + (z2 * sinAlpha)) + (z3 * cosAlpha)\n        if (i === 0) {\n          context2D.moveTo(x, y)\n        } else {\n          context2D.lineTo(x, y)\n        }\n        if (i === 0 || i === n) {\n          boundariesPoints.push({ x, y })\n        }\n      }\n      context2D.stroke()\n    } catch(error) {\n      this.#logger.error(\"drawEllipseArc\", { error })\n    } finally {\n      context2D.restore()\n    }\n    return boundariesPoints\n  }\n\n  protected drawLine(context2D: CanvasRenderingContext2D, p1: TPoint, p2: TPoint)\n  {\n    this.#logger.debug(\"drawLine\", { context2D, p1, p2 })\n    context2D.save()\n    try {\n      context2D.beginPath()\n      context2D.moveTo(p1.x, p1.y)\n      context2D.lineTo(p2.x, p2.y)\n      context2D.stroke()\n    } catch(error) {\n      this.#logger.error(\"drawLine\", { error })\n    } finally {\n      context2D.restore()\n    }\n  }\n\n  protected drawArrowHead(context2D: CanvasRenderingContext2D, headPoint: TPoint, angle: number, length: number)\n  {\n    this.#logger.debug(\"drawArrowHead\", { context2D, headPoint, angle, length })\n    const alpha = this.phi(angle + (Math.PI * (7 / 8)))\n    const beta = this.phi(angle - (Math.PI * (7 / 8)))\n    context2D.save()\n    try {\n      context2D.fillStyle = context2D.strokeStyle\n\n      context2D.moveTo(headPoint.x, headPoint.y)\n      context2D.beginPath()\n      context2D.lineTo(headPoint.x + (length * Math.cos(alpha)), headPoint.y + (length * Math.sin(alpha)))\n      context2D.lineTo(headPoint.x + (length * Math.cos(beta)), headPoint.y + (length * Math.sin(beta)))\n      context2D.lineTo(headPoint.x, headPoint.y)\n      context2D.fill()\n    } catch(error) {\n      this.#logger.error(\"drawArrowHead\", { error })\n    } finally {\n      context2D.restore()\n    }\n  }\n\n  protected drawShapeEllipse(context2D: CanvasRenderingContext2D, shapeEllipse: TCanvasShapeEllipseSymbol)\n  {\n    this.#logger.debug(\"drawShapeEllipse\", { context2D, shapeEllipse })\n    const points = this.drawEllipseArc(context2D, shapeEllipse)\n\n    if (shapeEllipse?.beginDecoration === \"ARROW_HEAD\") {\n      this.drawArrowHead(context2D, points[0], shapeEllipse.beginTangentAngle, 12.0)\n    }\n    if (shapeEllipse?.endDecoration === \"ARROW_HEAD\") {\n      this.drawArrowHead(context2D, points[1], shapeEllipse.endTangentAngle, 12.0)\n    }\n  }\n\n  protected drawShapeLine(context2D: CanvasRenderingContext2D, shapeLine: TCanvasShapeLineSymbol)\n  {\n    this.#logger.debug(\"drawShapeLine\", { context2D, shapeLine })\n    this.drawLine(context2D, shapeLine.firstPoint, shapeLine.lastPoint)\n    if (shapeLine.beginDecoration === \"ARROW_HEAD\") {\n      this.drawArrowHead(context2D, shapeLine.firstPoint, shapeLine.beginTangentAngle, 12.0)\n    }\n    if (shapeLine.endDecoration === \"ARROW_HEAD\") {\n      this.drawArrowHead(context2D, shapeLine.lastPoint, shapeLine.endTangentAngle, 12.0)\n    }\n  }\n\n  draw(context2D: CanvasRenderingContext2D, symbol: TSymbol)\n  {\n    this.#logger.info(\"draw\", { context2D, symbol })\n    context2D.save()\n    context2D.lineWidth = symbol.style.width as number\n    context2D.strokeStyle = symbol.style.color as string\n\n    switch (symbol.type) {\n      case this.symbols.table: {\n        const tableSymbols = symbol as TCanvasShapeTableSymbol\n        tableSymbols.lines.forEach(line => this.drawLine(context2D, line.p1, line.p2))\n        break\n      }\n      case this.symbols.ellipse: {\n        this.drawShapeEllipse(context2D, symbol as TCanvasShapeEllipseSymbol)\n        break\n      }\n      case this.symbols.line: {\n        this.drawShapeLine(context2D, symbol as TCanvasShapeLineSymbol)\n        break\n      }\n      default:\n        this.#logger.warn(\"draw\", `${ symbol.type } not implemented`)\n        break\n    }\n  }\n\n}\n","import { LoggerClass, LoggerManager } from \"../../logger\"\nimport { Stroke, TPointer } from \"../../primitive\"\nimport { computeAngleAxeRadian, computeLinksPointers, computeMiddlePointer } from \"../../utils\"\n\n/**\n * @group Renderer\n */\nexport class CanvasRendererStroke\n{\n  #logger = LoggerManager.getLogger(LoggerClass.RENDERER)\n\n  protected renderArc(context2d: CanvasRenderingContext2D, center: TPointer, radius: number): void\n  {\n    this.#logger.debug(\"renderArc\", { context2d, center, radius })\n    context2d.arc(center.x, center.y, radius, 0, Math.PI * 2, true)\n  }\n\n  protected renderLine(context2d: CanvasRenderingContext2D, begin: TPointer, end: TPointer, width: number): void\n  {\n    this.#logger.debug(\"renderLine\", { context2d, begin, end, width })\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, end), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(begin, end), width)\n\n    context2d.moveTo(linkPoints1[0].x, linkPoints1[0].y)\n    context2d.lineTo(linkPoints2[0].x, linkPoints2[0].y)\n    context2d.lineTo(linkPoints2[1].x, linkPoints2[1].y)\n    context2d.lineTo(linkPoints1[1].x, linkPoints1[1].y)\n  }\n\n  protected renderFinal(context2d: CanvasRenderingContext2D, begin: TPointer, end: TPointer, width: number): void\n  {\n    this.#logger.debug(\"renderFinal\", { context2d, begin, end, width })\n    const ARCSPLIT = 6\n    const angle = computeAngleAxeRadian(begin, end)\n    const linkPoints = computeLinksPointers(end, angle, width)\n    context2d.moveTo(linkPoints[0].x, linkPoints[0].y)\n    for (let i = 1; i <= ARCSPLIT; i++) {\n      const newAngle = angle - ((i * Math.PI) / ARCSPLIT)\n      context2d.lineTo(end.x - ((end.p * width) * Math.sin(newAngle)), end.y + (end.p * width * Math.cos(newAngle)))\n    }\n  }\n\n  protected renderQuadratic(context2d: CanvasRenderingContext2D, begin: TPointer, end: TPointer, ctrl: TPointer, width: number): void\n  {\n    this.#logger.debug(\"renderQuadratic\", { context2d, begin, end, ctrl, width })\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, ctrl), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(ctrl, end), width)\n    const linkPoints3 = computeLinksPointers(ctrl, computeAngleAxeRadian(begin, end), width)\n\n    context2d.moveTo(linkPoints1[0].x, linkPoints1[0].y)\n    context2d.quadraticCurveTo(linkPoints3[0].x, linkPoints3[0].y, linkPoints2[0].x, linkPoints2[0].y)\n    context2d.lineTo(linkPoints2[1].x, linkPoints2[1].y)\n    context2d.quadraticCurveTo(linkPoints3[1].x, linkPoints3[1].y, linkPoints1[1].x, linkPoints1[1].y)\n  }\n\n  draw(context2d: CanvasRenderingContext2D, stroke: Stroke): void\n  {\n    this.#logger.info(\"draw\", { context2d, stroke })\n    const NUMBER_POINTS = stroke.pointers.length\n    const NUMBER_QUADRATICS = NUMBER_POINTS - 2\n    const width = (stroke.style.width as number) > 0 ? (stroke.style.width as number) : context2d.lineWidth\n    const color = (stroke.style.color as string) ? (stroke.style.color as string) : context2d.strokeStyle\n    const firstPoint = stroke.pointers[0] as TPointer\n\n    context2d.save()\n    try {\n      context2d.beginPath()\n      if (NUMBER_POINTS < 3) {\n        this.renderArc(context2d, firstPoint, width * 0.6)\n      } else {\n        this.renderArc(context2d, firstPoint, width * firstPoint.p)\n        const secondPoint: TPointer = computeMiddlePointer(firstPoint, stroke.pointers[1])\n        this.renderLine(context2d, firstPoint, secondPoint, width)\n\n        // Possibility to try this (the start looks better when the ink is large)\n        // var first = computeMiddlePoint(stroke.pointers[0], stroke.pointers[1]);\n        // context2d.arc(first.x, first.y, width * first.p, 0, Math.PI * 2, true);\n\n        for (let i = 0; i < NUMBER_QUADRATICS; i++) {\n          const begin: TPointer = computeMiddlePointer(stroke.pointers[i], stroke.pointers[i + 1])\n          const end: TPointer = computeMiddlePointer(stroke.pointers[i + 1], stroke.pointers[i + 2])\n          const ctrl: TPointer = stroke.pointers[i + 1]\n          this.renderQuadratic(context2d, begin, end, ctrl, width)\n        }\n        const beginLine: TPointer = computeMiddlePointer(stroke.pointers[NUMBER_POINTS - 2], stroke.pointers[NUMBER_POINTS - 1])\n        const endLine: TPointer = stroke.pointers[NUMBER_POINTS - 1]\n        this.renderLine(context2d, beginLine, endLine, width)\n\n        const beginFinal: TPointer = stroke.pointers[NUMBER_POINTS - 2]\n        const endFinal: TPointer = stroke.pointers[NUMBER_POINTS - 1]\n        this.renderFinal(context2d, beginFinal, endFinal, width)\n      }\n      context2d.closePath()\n      if (color !== undefined) {\n        context2d.fillStyle = color\n        context2d.fill()\n      }\n      context2d.save()\n    }\n    catch (error) {\n      this.#logger.error(\"draw\", { error })\n    }\n    finally {\n      context2d.restore()\n    }\n  }\n}\n","import { LoggerClass, LoggerManager } from \"../../logger\"\nimport { TSymbol, TCanvasTextSymbol, TCanvasTextUnderlineSymbol, TCanvasUnderLineSymbol, TPoint } from \"../../primitive\"\n\n/**\n * @group Renderer\n */\nexport class CanvasRendererText\n{\n  #logger = LoggerManager.getLogger(LoggerClass.RENDERER)\n\n  symbols = {\n    char: \"char\",\n    string: \"string\",\n    textLine: \"textLine\"\n  }\n\n  protected drawUnderline(context2D: CanvasRenderingContext2D, textUnderline: TCanvasTextUnderlineSymbol, underline: TCanvasUnderLineSymbol)\n  {\n    this.#logger.debug(\"#drawUnderline\", { context2D, textUnderline, underline })\n    context2D.save()\n    try {\n      const delta = textUnderline.data.width / textUnderline.label.length\n      const p1: TPoint = {\n        x: textUnderline.data.topLeftPoint.x + (underline.data.firstCharacter * delta),\n        y: textUnderline.data.topLeftPoint.y + textUnderline.data.height\n      }\n      const p2: TPoint = {\n        x: textUnderline.data.topLeftPoint.x + (underline.data.lastCharacter * delta),\n        y: textUnderline.data.topLeftPoint.y + textUnderline.data.height\n      }\n      context2D.beginPath()\n      context2D.moveTo(p1.x, p1.y)\n      context2D.lineTo(p2.x, p2.y)\n      context2D.stroke()\n    } catch(error) {\n      this.#logger.error(\"#drawUnderline\", { error })\n    } finally {\n      context2D.restore()\n    }\n  }\n\n  protected drawText(context2D: CanvasRenderingContext2D, text: TCanvasTextSymbol)\n  {\n    this.#logger.debug(\"#drawText\", { context2D, text })\n    context2D.save()\n    try {\n      context2D.font = `${ text.data.textHeight }px serif`\n      context2D.textAlign = (text.data.justificationType === \"CENTER\") ? \"center\" : \"left\"\n      context2D.textBaseline = \"bottom\"\n      context2D.fillStyle = context2D.strokeStyle\n      context2D.fillText(text.label, text.data.topLeftPoint.x, (text.data.topLeftPoint.y + text.data.height))\n    } catch(error) {\n      this.#logger.error(\"#drawText\", { error })\n    } finally {\n      context2D.restore()\n    }\n  }\n\n  protected drawTextLine(context2D: CanvasRenderingContext2D, textUnderline: TCanvasTextUnderlineSymbol)\n  {\n    this.#logger.debug(\"#drawTextLine\", { context2D, textUnderline })\n    this.drawText(context2D, textUnderline)\n    textUnderline.underlineList.forEach((underline) =>\n    {\n      this.drawUnderline(context2D, textUnderline, underline)\n    })\n  }\n\n  draw(context2D: CanvasRenderingContext2D, symbol: TSymbol)\n  {\n    this.#logger.info(\"draw\", { context2D, symbol })\n    context2D.lineWidth = (symbol.style.width as number)\n    context2D.strokeStyle = (symbol.style.color as string)\n    switch (symbol.type) {\n      case this.symbols.char:\n      case this.symbols.string:\n        this.drawText(context2D, symbol as TCanvasTextSymbol)\n        break\n      case this.symbols.textLine:\n        this.drawTextLine(context2D, symbol as TCanvasTextUnderlineSymbol)\n        break\n      default:\n        this.#logger.warn(\"draw\", `${symbol.type} not implemented`)\n        break\n    }\n  }\n}\n","import { TRenderingConfiguration } from \"../../configuration\"\nimport { LoggerClass, LoggerManager } from \"../../logger\"\nimport { IModel } from \"../../model\"\nimport { Stroke, TSymbol } from \"../../primitive\"\nimport { CanvasRendererShape } from \"./CanvasRendererShape\"\nimport { CanvasRendererStroke } from \"./CanvasRendererStroke\"\nimport { CanvasRendererText } from \"./CanvasRendererText\"\n\n/**\n * @group Renderer\n */\nexport class CanvasRenderer\n{\n  #logger = LoggerManager.getLogger(LoggerClass.RENDERER)\n  configuration: TRenderingConfiguration\n  strokeRenderer: CanvasRendererStroke\n  shapeRenderer: CanvasRendererShape\n  textRenderer: CanvasRendererText\n  context!: {\n    parent: HTMLElement\n    renderingCanvas: HTMLCanvasElement\n    renderingCanvasContext: CanvasRenderingContext2D\n    capturingCanvas: HTMLCanvasElement\n    capturingCanvasContext: CanvasRenderingContext2D\n  }\n\n  constructor(config: TRenderingConfiguration)\n  {\n    this.#logger.info(\"constructor\", { config })\n    this.configuration = config\n    this.strokeRenderer = new CanvasRendererStroke()\n    this.shapeRenderer = new CanvasRendererShape()\n    this.textRenderer = new CanvasRendererText()\n  }\n\n  protected createCanvas(type: string): HTMLCanvasElement\n  {\n    this.#logger.debug(\"createCanvas\", { type })\n    const canvas: HTMLCanvasElement = document.createElement(\"canvas\")\n    canvas.id = type\n    canvas.classList.add(type)\n    canvas.classList.add(\"ms-canvas\")\n    return canvas\n  }\n\n  protected resizeContent(): void\n  {\n    const pixelRatio: number = window.devicePixelRatio\n    const elements: HTMLCanvasElement[] = [this.context.renderingCanvas, this.context.capturingCanvas]\n    elements.forEach((canvas) =>\n    {\n      const domElement = canvas.parentNode as HTMLElement\n      const width = Math.max(this.configuration.minWidth, domElement.clientWidth)\n      const height = Math.max(this.configuration.minHeight, domElement.clientHeight)\n      canvas.width = width * pixelRatio\n      canvas.height = height * pixelRatio\n      canvas.getContext(\"2d\")?.scale(pixelRatio, pixelRatio)\n      canvas.style.width = `${ width }px`\n      canvas.style.height = `${ height }px`\n    })\n  }\n\n  protected drawSymbol(context2D: CanvasRenderingContext2D, symbol: TSymbol)\n  {\n    this.#logger.debug(\"drawSymbol\", { symbol })\n    if (symbol.type === \"stroke\") {\n      const stroke = symbol as Stroke\n      if (stroke.pointerType !== \"eraser\") {\n        this.strokeRenderer.draw(context2D, stroke)\n      }\n    } else if (Object.keys(this.textRenderer.symbols).includes(symbol.type)) {\n      this.textRenderer.draw(context2D, symbol)\n    } else if (Object.keys(this.shapeRenderer.symbols).includes(symbol.type)) {\n      this.shapeRenderer.draw(context2D, symbol)\n    } else {\n      this.#logger.warn(\"drawSymbol\", `symbol type unknow: ${symbol.type}`)\n    }\n  }\n\n  init(element: HTMLElement): void\n  {\n    this.#logger.info(\"init\", { element })\n    const renderingCanvas: HTMLCanvasElement = this.createCanvas(\"ms-rendering-canvas\")\n    element.appendChild(renderingCanvas)\n\n    const capturingCanvas: HTMLCanvasElement = this.createCanvas(\"ms-capture-canvas\")\n    element.appendChild(capturingCanvas)\n\n    this.context = {\n      parent: element,\n      renderingCanvas,\n      renderingCanvasContext: renderingCanvas.getContext(\"2d\") as CanvasRenderingContext2D,\n      capturingCanvas,\n      capturingCanvasContext: capturingCanvas.getContext(\"2d\") as CanvasRenderingContext2D\n    }\n\n    this.resizeContent()\n  }\n\n  drawModel(model: IModel): void\n  {\n    this.#logger.info(\"drawModel\", { model })\n    this.context.renderingCanvasContext?.clearRect(0, 0, this.context.renderingCanvas.width, this.context.renderingCanvas.height)\n    model.symbols.forEach(symbol => this.drawSymbol(this.context.renderingCanvasContext, symbol))\n    this.context.capturingCanvasContext.clearRect(0, 0, this.context.capturingCanvas.width, this.context.capturingCanvas.height)\n  }\n\n  drawPendingStroke(stroke: Stroke | undefined): void\n  {\n    this.#logger.info(\"drawPendingStroke\", { stroke })\n    this.context.capturingCanvasContext.clearRect(0, 0, this.context.capturingCanvas.width, this.context.capturingCanvas.height)\n    if (stroke && stroke?.pointerType !== \"eraser\") {\n      this.strokeRenderer.draw(this.context.capturingCanvasContext, stroke)\n    }\n  }\n\n  resize(model: IModel): void\n  {\n    this.#logger.info(\"resize\", { model })\n    this.resizeContent()\n    this.drawModel(model)\n  }\n\n  destroy(): void\n  {\n    this.#logger.info(\"destroy\")\n    if (this.context.parent) {\n      this.context.parent.innerHTML = \"\"\n    }\n  }\n}\n","\n/**\n * @group Renderer\n */\nexport const OISVGRendererConst =\n{\n  arrowHeadStartMarker: \"arrow-head-start\",\n  arrowHeadEndMaker: \"arrow-head-end\",\n  selectionFilterId: \"selection-filter\",\n  removalFilterId: \"removal-filter\",\n  crossMarker: \"cross-marker\",\n  noSelection: \"pointer-events: none; -webkit-touch-callout: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;\",\n}\n","import { TBoundingBox, TPoint } from \"../../primitive\"\n\nconst XMLNS = \"http://www.w3.org/2000/svg\"\n/**\n * @group Renderer\n */\nexport class SVGBuilder\n{\n  static createLayer(boundingBox: TBoundingBox, attrs: { [key: string]: string } = {}): SVGElement\n  {\n    const svgEl = document.createElementNS(XMLNS, \"svg\")\n    svgEl.setAttribute(\"width\", `${ boundingBox.width }px`)\n    svgEl.setAttribute(\"height\", `${ boundingBox.height }px`)\n    svgEl.setAttribute(\"viewBox\", `${boundingBox.x}, ${boundingBox.y}, ${boundingBox. width }, ${ boundingBox.height }`)\n    Object.keys(attrs).forEach(k =>\n    {\n      svgEl.setAttribute(k, attrs[k])\n    })\n    return svgEl\n  }\n\n  static createFilter(id: string, attrs: { [key: string]: string } = {}): SVGFilterElement\n  {\n    const filter = document.createElementNS(XMLNS, \"filter\")\n    filter.id = id\n    Object.keys(attrs).forEach(k =>\n    {\n      filter.setAttribute(k, attrs[k])\n    })\n    return filter\n  }\n\n  static createDefs(): SVGDefsElement\n  {\n    return document.createElementNS(XMLNS, \"defs\")\n  }\n\n  static createMarker(id: string, attrs: { [key: string]: string } = {}): SVGMarkerElement\n  {\n    const marker = document.createElementNS(XMLNS, \"marker\")\n    marker.setAttribute(\"id\", id)\n    Object.keys(attrs).forEach(k =>\n    {\n      marker.setAttribute(k, attrs[k])\n    })\n    return marker\n  }\n\n  static createComponentTransfert(): SVGFEComponentTransferElement\n  {\n    return document.createElementNS(XMLNS, \"feComponentTransfer\")\n  }\n\n  static createDropShadow({ dx = 0, dy = 0, deviation = 0, color = \"#3e68ff\", opacity = 1 }): SVGFEDropShadowElement\n  {\n    const shadow = document.createElementNS(XMLNS, \"feDropShadow\")\n    shadow.setAttribute(\"dx\", dx.toString())\n    shadow.setAttribute(\"dy\", dy.toString())\n    shadow.setAttribute(\"stdDeviation\", deviation.toString())\n    shadow.setAttribute(\"flood-color\", color)\n    shadow.setAttribute(\"flood-opacity\", opacity.toString())\n    return shadow\n  }\n\n  static createTransfertFunctionTable(type: \"feFuncA\" | \"feFuncB\" | \"feFuncG\" | \"feFuncR\", values: string): SVGFEFuncAElement\n  {\n    const feFunc = document.createElementNS(XMLNS, type)\n    feFunc.setAttribute(\"type\", \"table\")\n    feFunc.setAttribute(\"tableValues\", values)\n    return feFunc\n  }\n\n  static createGroup(attrs: { [key: string]: string } = {}): SVGGElement\n  {\n    const groupEl = document.createElementNS(XMLNS, \"g\")\n    Object.keys(attrs).forEach(k =>\n    {\n      groupEl.setAttribute(k, attrs[k])\n    })\n    return groupEl\n  }\n\n  static createLine(p1: TPoint, p2: TPoint, attrs: { [key: string]: string } = {}): SVGLineElement\n  {\n    const lineEl = document.createElementNS(XMLNS, \"line\")\n    lineEl.setAttribute(\"x1\", p1.x.toString())\n    lineEl.setAttribute(\"y1\", p1.y.toString())\n    lineEl.setAttribute(\"x2\", p2.x.toString())\n    lineEl.setAttribute(\"y2\", p2.y.toString())\n    Object.keys(attrs).forEach(k =>\n    {\n      lineEl.setAttribute(k, attrs[k])\n    })\n    return lineEl\n  }\n\n  static createCircle(p: TPoint, r: number, attrs: { [key: string]: string } = {}): SVGCircleElement\n  {\n    const circleEl = document.createElementNS(XMLNS, \"circle\")\n    circleEl.setAttribute(\"cx\", p.x.toString())\n    circleEl.setAttribute(\"cy\", p.y.toString())\n    circleEl.setAttribute(\"r\", r.toString())\n    Object.keys(attrs).forEach(k =>\n    {\n      circleEl.setAttribute(k, attrs[k])\n    })\n    return circleEl\n  }\n\n  static createPath(attrs: { [key: string]: string } = {}): SVGPathElement\n  {\n    const pathEl = document.createElementNS(XMLNS, \"path\")\n    Object.keys(attrs).forEach(k =>\n    {\n      pathEl.setAttribute(k, attrs[k])\n    })\n    return pathEl\n  }\n\n  static createPolygon(points: number[], attrs: { [key: string]: string } = {}): SVGPolylineElement\n  {\n    const polygonEl = document.createElementNS(XMLNS, \"polygon\")\n    polygonEl.setAttribute(\"points\", points.join(\",\"))\n    Object.keys(attrs).forEach(k =>\n    {\n      polygonEl.setAttribute(k, attrs[k])\n    })\n    return polygonEl\n  }\n\n  static createRect(box: TBoundingBox, attrs: { [key: string]: string } = {}): SVGRectElement\n  {\n    const rectEl = document.createElementNS(XMLNS, \"rect\")\n    rectEl.setAttribute(\"x\", box.x.toString())\n    rectEl.setAttribute(\"y\", box.y.toString())\n    rectEl.setAttribute(\"width\", box.width.toString())\n    rectEl.setAttribute(\"height\", box.height.toString())\n    Object.keys(attrs).forEach(k =>\n    {\n      rectEl.setAttribute(k, attrs[k])\n    })\n    return rectEl\n  }\n\n  static createTSpan(text: string, attrs: { [key: string]: string } = {}): SVGTSpanElement\n  {\n    const tSpanEl = document.createElementNS(XMLNS, \"tspan\")\n    tSpanEl.textContent = text\n    Object.keys(attrs).forEach(k =>\n    {\n      tSpanEl.setAttribute(k, attrs[k])\n    })\n    return tSpanEl\n  }\n\n  static createForeignObject(box: TBoundingBox, node: HTMLElement, attrs: { [key: string]: string } = {}): SVGForeignObjectElement\n  {\n    const objEl = document.createElementNS(XMLNS, \"foreignObject\")\n    objEl.setAttribute(\"x\", box.x.toString())\n    objEl.setAttribute(\"y\", box.y.toString())\n    objEl.setAttribute(\"width\", box.width.toString())\n    objEl.setAttribute(\"height\", box.height.toString())\n    Object.keys(attrs).forEach(k =>\n    {\n      objEl.setAttribute(k, attrs[k])\n    })\n    objEl.appendChild(node)\n    return objEl\n  }\n\n  static createText(p: TPoint, text: string, attrs: { [key: string]: string } = {}): SVGTextElement\n  {\n    const textEl = document.createElementNS(XMLNS, \"text\")\n    textEl.textContent = text\n    textEl.setAttribute(\"x\", p.x.toString())\n    textEl.setAttribute(\"y\", p.y.toString())\n    Object.keys(attrs).forEach(k =>\n    {\n      textEl.setAttribute(k, attrs[k])\n    })\n    return textEl\n  }\n}\n","import { EdgeDecoration, EdgeKind, OIEdgeArc, OIEdgeLine, OIEdgePolyLine, TOIEdge } from \"../../primitive\"\nimport { DefaultStyle } from \"../../style\"\nimport { OISVGRendererConst } from \"./OISVGRendererConst\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class OISVGRendererEdgeUtil\n{\n  static getLinePath(line: OIEdgeLine): string\n  {\n    return `M ${ line.start.x } ${ line.start.y } L ${ line.end.x } ${ line.end.y }`\n  }\n\n  static getPolyLinePath(line: OIEdgePolyLine): string\n  {\n    return `M ${ line.vertices[0].x } ${ line.vertices[0].y } ${ line.vertices.map(p => `L ${ p.x } ${ p.y }`).join(\" \") }`\n  }\n\n  static getArcPath(arc: OIEdgeArc): string\n  {\n    return `M ${ arc.vertices[0].x } ${ arc.vertices[0].y } Q ${ arc.vertices.map(p => `${ p.x } ${ p.y }`).join(\" \") }`\n  }\n\n  static getSVGPath(edge: TOIEdge): string\n  {\n    switch (edge.kind) {\n      case EdgeKind.Line:\n        return OISVGRendererEdgeUtil.getLinePath(edge)\n      case EdgeKind.PolyEdge:\n        return OISVGRendererEdgeUtil.getPolyLinePath(edge)\n      case EdgeKind.Arc:\n        return OISVGRendererEdgeUtil.getArcPath(edge)\n      default:\n        throw new Error(`Can't getSVGPath for edge cause kind is unknow: \"${ JSON.stringify(edge) }\"`)\n    }\n  }\n\n  static getSVGElement(edge: TOIEdge): SVGGraphicsElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": edge.id,\n      \"type\": edge.type,\n      \"kind\": edge.kind,\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n    }\n    if (edge.selected) {\n      attrs[\"filter\"] = `url(#${ OISVGRendererConst.selectionFilterId })`\n    }\n    if (edge.deleting) {\n      attrs[\"filter\"] = `url(#${ OISVGRendererConst.removalFilterId })`\n    }\n    const group = SVGBuilder.createGroup(attrs)\n\n    const pathAttrs: { [key: string]: string } = {\n      \"fill\": \"transparent\",\n      \"stroke\": edge.style.color || DefaultStyle.color!,\n      \"stroke-width\": (edge.style.width || DefaultStyle.width!).toString(),\n      \"opacity\": (edge.style.opacity || DefaultStyle.opacity!).toString(),\n      \"d\": OISVGRendererEdgeUtil.getSVGPath(edge),\n    }\n\n    if (edge.startDecoration === EdgeDecoration.Arrow) {\n      pathAttrs[\"marker-start\"] = `url(#${ OISVGRendererConst.arrowHeadStartMarker })`\n    }\n    if (edge.endDecoration === EdgeDecoration.Arrow) {\n      pathAttrs[\"marker-end\"] = `url(#${ OISVGRendererConst.arrowHeadEndMaker })`\n    }\n    group.appendChild(SVGBuilder.createPath(pathAttrs))\n    return group\n  }\n\n\n}\n","import { OIEraser, TPointer } from \"../../primitive\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class OISVGRendererEraserUtil\n{\n  static getSVGPath(eraser: OIEraser): string\n  {\n    if (eraser.pointers.length < 1) return \"\"\n\n    const firstPoint = eraser.pointers.at(0) as TPointer\n\n    if (eraser.pointers.length === 1) {\n      const strokeWith = eraser.style.width || 4\n      return `C ${ firstPoint.x - strokeWith / 2 } ${ firstPoint.y } Q ${ firstPoint.x  + strokeWith / 2 } ${ firstPoint.y }`\n    }\n\n    const middlePoints = eraser.pointers.slice(1)\n\n    const startPathMoveTo = `M ${ firstPoint.x } ${ firstPoint.y }`\n\n\n    const middlePathQuadratic = middlePoints.reduce((acc, point) => {\n      return `${ acc } ${ point.x } ${ point.y }`\n    }, \"Q\")\n\n    return `${ startPathMoveTo } ${ middlePathQuadratic }`\n  }\n\n  static getSVGElement(eraser: OIEraser): SVGPathElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": eraser.id,\n      \"type\": \"eraser\",\n      \"stroke-width\": \"12\",\n      \"stroke\": \"grey\",\n      \"opacity\": \"0.2\",\n      \"shadowBlur\": \"5\",\n      \"stroke-linecap\": \"round\",\n      \"fill\": \"transparent\",\n      \"d\": OISVGRendererEraserUtil.getSVGPath(eraser)\n    }\n    return SVGBuilder.createPath(attrs)\n  }\n\n}\n","import { Box, DecoratorKind, OIDecorator, TBoundingBox } from \"../../primitive\"\nimport { DefaultStyle, TStyle } from \"../../style\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class OISVGRendererDecoratorUtil\n{\n  static getSVGElement(decorator: OIDecorator, { deleting, style, bounds }: { deleting: boolean, style: TStyle, bounds: Box }): SVGGeometryElement | undefined\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": decorator.id,\n      \"type\": \"decorator\",\n      \"kind\": decorator.kind,\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n    }\n    attrs[\"opacity\"] = (decorator.style.opacity || DefaultStyle.opacity!).toString()\n    if (deleting) {\n      attrs[\"opacity\"] = ((decorator.style.opacity || DefaultStyle.opacity!) * 0.5).toString()\n    }\n\n    let element: SVGGeometryElement | undefined\n\n    switch (decorator.kind) {\n      case DecoratorKind.Highlight: {\n        attrs[\"opacity\"] = deleting ? \"0.25\" : \"0.5\"\n        attrs[\"stroke\"] = \"transparent\"\n        attrs[\"fill\"] = decorator.style.color || DefaultStyle.color!\n        const boundingBox: TBoundingBox = {\n          x: bounds.x - +(style.width || DefaultStyle.width!),\n          y: bounds.y - +(style.width || DefaultStyle.width!),\n          height: bounds.height + +(style.width || DefaultStyle.width!) * 2,\n          width: bounds.width + +(style.width || DefaultStyle.width!) * 2,\n        }\n        element = SVGBuilder.createRect(boundingBox, attrs)\n        break\n      }\n      case DecoratorKind.Surround: {\n        attrs[\"fill\"] = \"transparent\"\n        attrs[\"stroke\"] = decorator.style.color || DefaultStyle.color!\n        attrs[\"stroke-width\"] = (decorator.style.width || DefaultStyle.width!).toString()\n        const boundingBox: TBoundingBox = {\n          x: bounds.x - +(style.width || DefaultStyle.width!),\n          y: bounds.y - +(style.width || DefaultStyle.width!),\n          height: bounds.height + +(style.width || DefaultStyle.width!) * 2,\n          width: bounds.width + +(style.width || DefaultStyle.width!) * 2,\n        }\n        element = SVGBuilder.createRect(boundingBox, attrs)\n        break\n      }\n      case DecoratorKind.Strikethrough: {\n        attrs[\"fill\"] = \"transparent\"\n        attrs[\"stroke\"] = decorator.style.color || DefaultStyle.color!\n        attrs[\"stroke-width\"] = (decorator.style.width || DefaultStyle.width!).toString()\n        const p1 = {\n          x: bounds.xMin,\n          y: bounds.yMid\n        }\n        const p2 = {\n          x: bounds.xMax,\n          y: bounds.yMid\n        }\n        element = SVGBuilder.createLine(p1, p2, attrs)\n        break\n      }\n      case DecoratorKind.Underline: {\n        attrs[\"fill\"] = \"transparent\"\n        attrs[\"stroke\"] = decorator.style.color || DefaultStyle.color!\n        attrs[\"stroke-width\"] = (decorator.style.width || DefaultStyle.width!).toString()\n        const p1 = {\n          x: bounds.xMin,\n          y: bounds.yMax + +(style.width || DefaultStyle.width!)\n        }\n        const p2 = {\n          x: bounds.xMax,\n          y: bounds.yMax + +(style.width || DefaultStyle.width!)\n        }\n        element = SVGBuilder.createLine(p1, p2, attrs)\n        break\n      }\n    }\n\n    return element\n  }\n}\n","import { OIShapeCircle, OIShapeEllipse, OIShapePolygon, ShapeKind, TOIShape } from \"../../primitive\"\nimport { DefaultStyle } from \"../../style\"\nimport { convertRadianToDegree } from \"../../utils\"\nimport { OISVGRendererConst } from \"./OISVGRendererConst\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class OISVGRendererShapeUtil\n{\n  static getPolygonePath(polygon: OIShapePolygon): string\n  {\n    return `M ${polygon.points[0].x} ${polygon.points[0].y} ${polygon.points.slice(1).map(p => `L ${p.x} ${p.y}`).join(\" \")} Z`\n  }\n\n  static getCirclePath(circle: OIShapeCircle): string\n  {\n    return `M ${circle.center.x - circle.radius} ${circle.center.y} a ${circle.radius} ${circle.radius} 0 1 1 ${circle.radius * 2} 0 a ${circle.radius} ${circle.radius} 0 1 1 -${circle.radius * 2} 0 Z`\n  }\n\n  static getEllipsePath(ellipse: OIShapeEllipse): string\n  {\n    return `M ${ellipse.center.x - ellipse.radiusX} ${ellipse.center.y} a ${ellipse.radiusX} ${ellipse.radiusY} 0 1 1 ${ellipse.radiusX * 2} 0 a ${ellipse.radiusX} ${ellipse.radiusY} 0 1 1 -${ellipse.radiusX * 2} 0 Z`\n  }\n\n  static getSVGPath(shape: TOIShape): string\n  {\n    switch(shape.kind) {\n      case ShapeKind.Polygon:\n        return OISVGRendererShapeUtil.getPolygonePath(shape as OIShapePolygon)\n      case ShapeKind.Circle:\n        return OISVGRendererShapeUtil.getCirclePath(shape as OIShapeCircle)\n      case ShapeKind.Ellipse:\n        return OISVGRendererShapeUtil.getEllipsePath(shape as OIShapeEllipse)\n      default:\n        throw new Error(`Can't getSVGPath for shape cause kind is unknow: \"${ JSON.stringify(shape) }\"`)\n    }\n  }\n\n  static getSVGElement(shape: TOIShape): SVGGraphicsElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": shape.id,\n      \"type\": shape.type,\n      \"kind\": shape.kind,\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n    }\n    if (shape.selected) {\n      attrs[\"filter\"] = `url(#${ OISVGRendererConst.selectionFilterId })`\n    }\n    if (shape.deleting) {\n      attrs[\"filter\"] = `url(#${ OISVGRendererConst.removalFilterId })`\n    }\n\n    const group = SVGBuilder.createGroup(attrs)\n\n    const pathAttrs: { [key: string]: string } = {\n      \"fill\": shape.style.fill || \"transparent\",\n      \"stroke\": shape.style.color || DefaultStyle.color!,\n      \"stroke-width\": (shape.style.width || DefaultStyle.width!).toString(),\n      \"opacity\": (shape.style.opacity || DefaultStyle.opacity!).toString(),\n      \"d\": OISVGRendererShapeUtil.getSVGPath(shape),\n    }\n    if (shape.kind === ShapeKind.Ellipse) {\n      pathAttrs.transform = `rotate(${ convertRadianToDegree(shape.orientation) }, ${shape.center.x}, ${shape.center.y})`\n    }\n\n    group.appendChild(SVGBuilder.createPath(pathAttrs))\n\n    return group\n  }\n}\n","import { DecoratorKind, OIStroke, TPointer } from \"../../primitive\"\nimport { DefaultStyle } from \"../../style\"\nimport { computeAngleAxeRadian, computeLinksPointers, computeMiddlePointer } from \"../../utils\"\nimport { OISVGRendererDecoratorUtil } from \"./OISVGRendererDecoratorUtil\"\nimport { OISVGRendererConst } from \"./OISVGRendererConst\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class OISVGRendererStrokeUtil\n{\n\n  protected static getArcPath(center: TPointer, radius: number): string\n  {\n    const svgPath = [\n      `M ${ center.x } ${ center.y }`,\n      `m ${ -radius } 0`,\n      `a ${ radius } ${ radius } 0 1 0 ${ radius * 2 } 0`,\n      `a ${ radius } ${ radius } 0 1 0 ${ -(radius * 2) } 0`\n    ].join(\" \")\n    return svgPath\n  }\n\n  protected static getLinePath(begin: TPointer, end: TPointer, width: number): string\n  {\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, end), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(begin, end), width)\n    const svgPath = [\n      `M ${ linkPoints1[0].x } ${ linkPoints1[0].y }`,\n      `L ${ linkPoints2[0].x } ${ linkPoints2[0].y }`,\n      `L ${ linkPoints2[1].x } ${ linkPoints2[1].y }`,\n      `L ${ linkPoints1[1].x } ${ linkPoints1[1].y }`\n    ].join(\" \")\n    return svgPath\n  }\n\n  protected static getFinalPath(begin: TPointer, end: TPointer, width: number): string\n  {\n    const ARCSPLIT = 6\n    const angle = computeAngleAxeRadian(begin, end)\n    const linkPoints = computeLinksPointers(end, angle, width)\n    const parts = [`M ${ linkPoints[0].x } ${ linkPoints[0].y }`]\n    for (let i = 1; i <= ARCSPLIT; i++) {\n      const newAngle = angle - (i * (Math.PI / ARCSPLIT))\n      const x = +(end.x - (end.p * width * Math.sin(newAngle))).toFixed(3)\n      const y = +(end.y + (end.p * width * Math.cos(newAngle))).toFixed(3)\n      parts.push(`L ${ x } ${ y }`)\n    }\n    const svgPath = parts.join(\" \")\n    return svgPath\n  }\n\n  protected static getQuadraticPath(begin: TPointer, end: TPointer, central: TPointer, width: number): string\n  {\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, central), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(central, end), width)\n    const linkPoints3 = computeLinksPointers(central, computeAngleAxeRadian(begin, end), width)\n    const svgPath = [\n      `M ${ linkPoints1[0].x } ${ linkPoints1[0].y }`,\n      `Q ${ linkPoints3[0].x } ${ linkPoints3[0].y } ${ linkPoints2[0].x } ${ linkPoints2[0].y }`,\n      `L ${ linkPoints2[1].x } ${ linkPoints2[1].y }`,\n      `Q ${ linkPoints3[1].x } ${ linkPoints3[1].y } ${ linkPoints1[1].x } ${ linkPoints1[1].y }`\n    ].join(\" \")\n    return svgPath\n  }\n\n  static getSVGPath(stroke: OIStroke): string\n  {\n    const STROKE_LENGTH = stroke.pointers.length\n    if (!STROKE_LENGTH) return \"\"\n    const STROKE_WIDTH = (stroke.style.width as number)\n    const NB_QUADRATICS = STROKE_LENGTH - 2\n    const firstPoint = stroke.pointers[0]\n\n    const parts = []\n    if (STROKE_LENGTH < 3) {\n      parts.push(this.getArcPath(firstPoint, STROKE_WIDTH * 0.6))\n    } else {\n      parts.push(this.getArcPath(firstPoint, STROKE_WIDTH * firstPoint.p))\n      parts.push(this.getLinePath(firstPoint, computeMiddlePointer(firstPoint, stroke.pointers[1]), STROKE_WIDTH))\n\n      for (let i = 0; i < NB_QUADRATICS; i++) {\n        const begin = computeMiddlePointer(stroke.pointers[i], stroke.pointers[i + 1])\n        const end = computeMiddlePointer(stroke.pointers[i + 1], stroke.pointers[i + 2])\n        const central = stroke.pointers[i + 1]\n        parts.push(this.getQuadraticPath(begin, end, central, STROKE_WIDTH)\n        )\n      }\n      const beforeLastPoint = stroke.pointers[STROKE_LENGTH - 2]\n      const lastPoint = stroke.pointers[STROKE_LENGTH - 1]\n      parts.push(this.getLinePath(computeMiddlePointer(beforeLastPoint, lastPoint), lastPoint, STROKE_WIDTH))\n      parts.push(this.getFinalPath(beforeLastPoint, lastPoint, STROKE_WIDTH))\n    }\n    return parts.join(\" \")\n  }\n\n  static getSVGElement(stroke: OIStroke): SVGGraphicsElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": stroke.id,\n      \"type\": \"stroke\",\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n    }\n    if (stroke.selected) {\n      attrs[\"filter\"] = `url(#${ OISVGRendererConst.selectionFilterId })`\n    }\n    if (stroke.deleting) {\n      attrs[\"filter\"] = `url(#${ OISVGRendererConst.removalFilterId })`\n    }\n\n    const strokeGroup = SVGBuilder.createGroup(attrs)\n\n    const strokeAttrs: { [key: string]: string } = {\n      \"fill\": stroke.style.color || DefaultStyle.color!,\n      \"stroke-width\": (stroke.style.width || DefaultStyle.width!).toString(),\n      \"opacity\": (stroke.style.opacity || DefaultStyle.opacity!).toString(),\n      \"d\": OISVGRendererStrokeUtil.getSVGPath(stroke)\n    }\n    strokeGroup.append(SVGBuilder.createPath(strokeAttrs))\n\n    stroke.decorators.forEach(d =>\n    {\n      const deco = OISVGRendererDecoratorUtil.getSVGElement(d, stroke)\n      if (deco) {\n        if (d.kind === DecoratorKind.Highlight) {\n          strokeGroup.prepend(deco)\n        }\n        else {\n          strokeGroup.append(deco)\n        }\n      }\n    })\n\n    return strokeGroup\n  }\n\n}\n","import { DecoratorKind, OIText } from \"../../primitive\"\nimport { DefaultStyle } from \"../../style\"\nimport { OISVGRendererDecoratorUtil } from \"./OISVGRendererDecoratorUtil\"\nimport { OISVGRendererConst } from \"./OISVGRendererConst\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class OISVGRendererTextUtil\n{\n  static getSVGElement(text: OIText): SVGGraphicsElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": text.id,\n      \"type\": text.type,\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n      \"style\": OISVGRendererConst.noSelection,\n      \"opacity\": (text.style.opacity || DefaultStyle.opacity!).toString(),\n    }\n    if (text.rotation) {\n      attrs.transform = `rotate(${ text.rotation.degree }, ${ text.rotation.center.x }, ${ text.rotation.center.y })`\n    }\n    if (text.selected) {\n      attrs[\"filter\"] = `url(#${ OISVGRendererConst.selectionFilterId })`\n    }\n    if (text.deleting) {\n      attrs[\"filter\"] = `url(#${ OISVGRendererConst.removalFilterId })`\n    }\n\n    const textGroup = SVGBuilder.createGroup(attrs)\n\n    const textElement = SVGBuilder.createText(text.point, \"\")\n\n    text.chars.forEach(c =>\n    {\n      const attrs: { [key: string]: string } = {\n        id: c.id,\n        fill: c.color,\n        \"font-size\": `${ c.fontSize }px`,\n        \"font-weight\": c.fontWeight.toString(),\n      }\n      textElement.appendChild(SVGBuilder.createTSpan(c.label, attrs))\n    })\n    textGroup.append(textElement)\n\n    text.decorators.forEach(d =>\n    {\n      const deco = OISVGRendererDecoratorUtil.getSVGElement(d, text)\n      if (deco) {\n        if (d.kind === DecoratorKind.Highlight) {\n          textGroup.prepend(deco)\n        }\n        else {\n          textGroup.append(deco)\n        }\n      }\n    })\n\n    return textGroup\n  }\n}\n","import { DecoratorKind, OIEraser, OISymbolGroup, SymbolType, TOISymbol } from \"../../primitive\"\nimport { DefaultStyle } from \"../../style\"\nimport { OISVGRendererDecoratorUtil } from \"./OISVGRendererDecoratorUtil\"\nimport { OISVGRendererEdgeUtil } from \"./OISVGRendererEdgeUtil\"\nimport { OISVGRendererShapeUtil } from \"./OISVGRendererShapeUtil\"\nimport { OISVGRendererStrokeUtil } from \"./OISVGRendererStrokeUtil\"\nimport { OISVGRendererConst } from \"./OISVGRendererConst\"\nimport { SVGBuilder } from \"./SVGBuilder\"\nimport { OISVGRendererTextUtil } from \"./OISVGRendererTextUtil\"\n\n/**\n * @group Renderer\n */\nexport class OISVGRendererGroupUtil\n{\n\n  static getChildElement(symbol: TOISymbol | OIEraser): SVGGraphicsElement | undefined\n  {\n    let element: SVGGraphicsElement | undefined\n    switch (symbol.type) {\n      case SymbolType.Stroke:\n        element = OISVGRendererStrokeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Shape:\n        element = OISVGRendererShapeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Edge:\n        element = OISVGRendererEdgeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Text:\n        element = OISVGRendererTextUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Group:\n        element = OISVGRendererGroupUtil.getSVGElement(symbol)\n        break\n    }\n    return element\n  }\n\n  static getSVGElement(symbolGroup: OISymbolGroup): SVGGraphicsElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": symbolGroup.id,\n      \"type\": \"group\",\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n      \"fill\": symbolGroup.style.color || DefaultStyle.color!,\n      \"stroke-width\": (symbolGroup.style.width || DefaultStyle.width!).toString(),\n      \"opacity\": (symbolGroup.style.opacity || DefaultStyle.opacity!).toString(),\n    }\n    if (symbolGroup.selected) {\n      attrs[\"filter\"] = `url(#${ OISVGRendererConst.selectionFilterId })`\n    }\n    if (symbolGroup.deleting) {\n      attrs[\"filter\"] = `url(#${ OISVGRendererConst.removalFilterId })`\n    }\n\n    const groupEl = SVGBuilder.createGroup(attrs)\n\n    symbolGroup.children.forEach(sym =>\n    {\n      groupEl.append(OISVGRendererGroupUtil.getChildElement(sym)!)\n    })\n\n    symbolGroup.decorators.forEach(d =>\n    {\n      const deco = OISVGRendererDecoratorUtil.getSVGElement(d, symbolGroup)\n      if (deco) {\n        if (d.kind === DecoratorKind.Highlight) {\n          groupEl.prepend(deco)\n        }\n        else {\n          groupEl.append(deco)\n        }\n      }\n    })\n\n    return groupEl\n  }\n\n}\n","\n/**\n * @group Gesture\n * @description List all authorized gestures\n */\nexport type TGestureType = \"UNDERLINE\" | \"SCRATCH\" | \"JOIN\" | \"INSERT\" | \"STRIKETHROUGH\" | \"SURROUND\"\n\n/**\n * @group Gesture\n * @remarks\n *  when gestureType = \"INSERT\", subStrokes represent the two parts\n *  when gestureType = \"SCRATCH\", subStrokes represent the part to substract at the stroke corresponding fullStrokeId\n */\nexport type TGesture = {\n  gestureType: TGestureType\n  gestureStrokeId: string\n  strokeIds: string[]\n  strokeBeforeIds: string[]\n  strokeAfterIds: string[]\n  subStrokes?: { fullStrokeId: string, x: number[], y: number[] }[]\n}\n\n/**\n * @group Gesture\n * @description List all action allowed on surround detected\n * @remarks only usable in the case of offscreen\n */\nexport enum SurroundAction\n{\n  Select = \"select\",\n  Surround = \"surround\",\n  Highlight = \"highlight\"\n}\n\n/**\n * @group Gesture\n * @description List all action allowed on strikeThrough detected\n * @remarks only usable in the case of offscreen\n */\nexport enum StrikeThroughAction\n{\n  Erase = \"erase\",\n  Draw = \"draw\"\n}\n\n/**\n * @group Gesture\n * @description List all action allowed on split detected\n * @remarks only usable in the case of offscreen\n */\nexport enum InsertAction\n{\n  /**\n   * Add lien break on gesture place\n   */\n  LineBreak = \"line-break\",\n  /**\n   * Insert place in gesture place\n   */\n  Insert = \"insert\"\n}\n","import { SvgElementRole } from \"../../Constants\"\nimport { TRenderingConfiguration } from \"../../configuration\"\nimport { LoggerClass, LoggerManager } from \"../../logger\"\nimport { TOISymbol, TPoint, TBoundingBox, Box, OIEraser, SymbolType } from \"../../primitive\"\nimport { getClosestPoints } from \"../../utils\"\nimport { OISVGRendererConst } from \"./OISVGRendererConst\"\nimport { OISVGRendererEdgeUtil } from \"./OISVGRendererEdgeUtil\"\nimport { OISVGRendererEraserUtil } from \"./OISVGRendererEraserUtil\"\nimport { OISVGRendererGroupUtil } from \"./OISVGRendererGroupUtil\"\nimport { OISVGRendererShapeUtil } from \"./OISVGRendererShapeUtil\"\nimport { OISVGRendererStrokeUtil } from \"./OISVGRendererStrokeUtil\"\nimport { OISVGRendererTextUtil } from \"./OISVGRendererTextUtil\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class OISVGRenderer\n{\n  #logger = LoggerManager.getLogger(LoggerClass.RENDERER)\n  groupGuidesId = \"guides-wrapper\"\n\n  configuration: TRenderingConfiguration\n  parent!: HTMLElement\n  layer!: SVGElement\n  definitionGroup!: SVGGElement\n\n  verticalGuides: number[] = []\n  horizontalGuides: number[] = []\n\n  constructor(configuration: TRenderingConfiguration)\n  {\n    this.#logger.info(\"constructor\", { configuration })\n    this.configuration = configuration\n  }\n\n  protected initLayer(): void\n  {\n    const width = Math.max(this.configuration.minWidth, this.parent.clientWidth)\n    const height = Math.max(this.configuration.minHeight, this.parent.clientHeight)\n    this.layer = SVGBuilder.createLayer({ x: 0, y: 0, width, height })\n    this.layer.style.setProperty(\"height\", \"auto\")\n    this.layer.style.setProperty(\"width\", \"auto\")\n    this.layer.appendChild(this.createSVGTools())\n    this.parent.style.setProperty(\"overflow\", \"auto\")\n    this.parent.appendChild(this.layer)\n  }\n\n  protected createDefs(): SVGDefsElement\n  {\n    const defs = SVGBuilder.createDefs()\n\n    const SIZE = 5\n    const REFX = SIZE - 1, REFY = SIZE / 2\n    const arrowHeadMarkerAttrs = {\n      style: OISVGRendererConst.noSelection,\n      fill: \"context-stroke\",\n      markerWidth: SIZE.toString(),\n      markerHeight: SIZE.toString(),\n      refX: REFX.toString(),\n      refY: REFY.toString(),\n    }\n\n    const arrowHeadStart = SVGBuilder.createMarker(OISVGRendererConst.arrowHeadStartMarker, { ...arrowHeadMarkerAttrs, orient: \"auto-start-reverse\" })\n    arrowHeadStart.appendChild(SVGBuilder.createPolygon([0, 0, SIZE, REFY, 0, SIZE], arrowHeadMarkerAttrs))\n    defs.appendChild(arrowHeadStart)\n\n    const arrowHeadEnd = SVGBuilder.createMarker(OISVGRendererConst.arrowHeadEndMaker, { ...arrowHeadMarkerAttrs, orient: \"auto\" })\n    arrowHeadEnd.appendChild(SVGBuilder.createPolygon([0, 0, SIZE, REFY, 0, SIZE], arrowHeadMarkerAttrs))\n    defs.appendChild(arrowHeadEnd)\n\n    const crossMarkerAttrs = {\n      style: OISVGRendererConst.noSelection,\n      markerWidth: \"5\",\n      markerHeight: \"5\",\n      refX: \"0\",\n      refY: \"0\",\n      viewBox: \"-5 -5 10 10\"\n    }\n    const cross = SVGBuilder.createMarker(OISVGRendererConst.crossMarker, crossMarkerAttrs)\n    cross.appendChild(SVGBuilder.createPath({ d: \"M -4,-4 L 4,4 M -4,4 L 4,-4\", stroke: \"white\", \"stroke-width\": \"3\" }))\n    cross.appendChild(SVGBuilder.createPath({ d: \"M -4,-4 L 4,4 M -4,4 L 4,-4\", stroke: \"context-stroke\", \"stroke-width\": \"2\" }))\n    defs.appendChild(cross)\n\n    return defs\n  }\n\n  protected createFilters(): SVGGElement\n  {\n    const filtersGroup = SVGBuilder.createGroup({ id: \"definition-group\" })\n    const removalFilter = SVGBuilder.createFilter(OISVGRendererConst.removalFilterId, { filterUnits: \"userSpaceOnUse\" })\n    const bfeComponentTransfer = SVGBuilder.createComponentTransfert()\n    const bfeFuncA = SVGBuilder.createTransfertFunctionTable(\"feFuncA\", \"0 0.25\")\n    bfeComponentTransfer.appendChild(bfeFuncA)\n    removalFilter.appendChild(bfeComponentTransfer)\n    filtersGroup.appendChild(removalFilter)\n\n    const selectionFilter = SVGBuilder.createFilter(OISVGRendererConst.selectionFilterId, { filterUnits: \"userSpaceOnUse\" })\n    selectionFilter.appendChild(SVGBuilder.createDropShadow({ dx: -1, dy: -1, deviation: 1 }))\n    filtersGroup.appendChild(selectionFilter)\n\n    return filtersGroup\n  }\n\n  protected drawGuides(): void\n  {\n    this.verticalGuides = []\n    this.horizontalGuides = []\n    const height = Number(this.layer.getAttribute(\"height\")?.replace(\"px\", \"\"))\n    const width = Number(this.layer.getAttribute(\"width\")?.replace(\"px\", \"\"))\n    const offSet = this.configuration.guides.gap\n    const subOffSet = this.configuration.guides.gap / 5\n    const attrs = {\n      id: this.groupGuidesId,\n      stroke: \"grey\",\n      opacity: \"0.5\",\n      style: OISVGRendererConst.noSelection,\n      role: SvgElementRole.Guide\n    }\n    const guidesGroup = SVGBuilder.createGroup(attrs)\n    switch (this.configuration.guides.type) {\n      case \"line\":\n        for (let y = offSet; y < height; y += offSet) {\n          const begin: TPoint = { x: offSet, y }\n          const end: TPoint = { x: width - offSet, y }\n          this.horizontalGuides.push(y)\n          const svgLine = SVGBuilder.createLine(begin, end, { \"stroke-width\": \"1\", style: OISVGRendererConst.noSelection })\n          guidesGroup.appendChild(svgLine)\n        }\n        break\n      case \"grid\":\n        for (let y = 0; y < height; y += offSet) {\n          const begin: TPoint = { x: 0, y }\n          const end: TPoint = { x: width, y }\n          const svgLine = SVGBuilder.createLine(begin, end, { \"stroke-width\": \"1\", style: OISVGRendererConst.noSelection })\n          guidesGroup.appendChild(svgLine)\n          this.horizontalGuides.push(y)\n          for (let subY = y + subOffSet; subY < y + offSet; subY += subOffSet) {\n            this.horizontalGuides.push(subY)\n            const svgLine = SVGBuilder.createLine({ x: 0, y: subY }, { x: width, y: subY }, { \"stroke-width\": \"0.25\", style: OISVGRendererConst.noSelection })\n            guidesGroup.appendChild(svgLine)\n          }\n        }\n        for (let x = 0; x < width; x += offSet) {\n          const begin: TPoint = { x, y: 0 }\n          const end: TPoint = { x, y: height }\n          const svgLine = SVGBuilder.createLine(begin, end, { \"stroke-width\": \"1\", style: OISVGRendererConst.noSelection })\n          guidesGroup.appendChild(svgLine)\n          this.verticalGuides.push(x)\n          for (let subX = x + subOffSet; subX < x + offSet; subX += subOffSet) {\n            this.verticalGuides.push(subX)\n            const svgLine = SVGBuilder.createLine({ x: subX, y: 0 }, { x: subX, y: height }, { \"stroke-width\": \"0.25\", style: OISVGRendererConst.noSelection })\n            guidesGroup.appendChild(svgLine)\n          }\n        }\n        break\n      case \"point\":\n        for (let x = offSet; x < width; x += offSet) {\n          this.verticalGuides.push(x)\n          for (let y = offSet; y < height; y += offSet) {\n            this.horizontalGuides.push(y)\n            const svgPoint = SVGBuilder.createCircle({ x, y }, 1)\n            guidesGroup.appendChild(svgPoint)\n          }\n        }\n        break\n      default:\n        this.#logger.error(\"drawGuides\", `Guide type unknow: ${ this.configuration.guides.type }`)\n        break\n    }\n    this.horizontalGuides = [...new Set(this.horizontalGuides)]\n    this.verticalGuides = [...new Set(this.verticalGuides)]\n    this.definitionGroup.appendChild(guidesGroup)\n  }\n\n  protected removeGuides(): void\n  {\n    this.verticalGuides = []\n    this.horizontalGuides = []\n    this.layer.querySelector(`#${ this.groupGuidesId }`)?.remove()\n  }\n\n  protected createSVGTools(): SVGGElement\n  {\n    this.definitionGroup = SVGBuilder.createGroup({ id: \"definition-group\" })\n    this.definitionGroup.appendChild(this.createDefs())\n    this.definitionGroup.appendChild(this.createFilters())\n    if (this.configuration.guides.enable) {\n      this.drawGuides()\n    }\n    return this.definitionGroup\n  }\n\n  init(element: HTMLElement): void\n  {\n    this.#logger.info(\"init\", { element })\n    this.parent = element\n    this.parent.oncontextmenu = () => false\n    this.initLayer()\n  }\n\n  getAttribute(id: string, name: string): string | undefined | null\n  {\n    const element = this.layer.querySelector(`#${ id }`) as HTMLElement | null\n    return element?.getAttribute(name)\n  }\n\n  setAttribute(id: string, name: string, value: string): void\n  {\n    const element = this.layer.querySelector(`#${ id }`) as HTMLElement | null\n    element?.setAttribute(name, value)\n  }\n\n  buildElementFromSymbol(symbol: TOISymbol | OIEraser): SVGGraphicsElement | undefined\n  {\n    let element: SVGGraphicsElement | undefined\n    switch (symbol.type) {\n      case SymbolType.Stroke:\n        element = OISVGRendererStrokeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Eraser:\n        element = OISVGRendererEraserUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Shape:\n        element = OISVGRendererShapeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Edge:\n        element = OISVGRendererEdgeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Text:\n        element = OISVGRendererTextUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Group:\n        element = OISVGRendererGroupUtil.getSVGElement(symbol)\n        break\n      default:\n        this.#logger.error(\"buildElementFromSymbol\", `symbol unknow: \"${ JSON.stringify(symbol) }\"`)\n    }\n    return element\n  }\n\n  prependElement(el: Element): void\n  {\n    this.layer.prepend(el)\n  }\n\n  changeOrderSymbol(symbolToMove: TOISymbol, position: \"first\" | \"last\" | \"forward\" | \"backward\"): void\n  {\n    const moveEl = this.layer.querySelector(`#${ symbolToMove.id }`)\n    if (!moveEl) return\n    switch (position) {\n      case \"first\":\n        this.definitionGroup.insertAdjacentElement(\"afterend\", moveEl)\n        break\n      case \"last\":\n        this.layer.insertAdjacentElement(\"beforeend\", moveEl)\n        break\n      case \"forward\":\n        moveEl.nextElementSibling?.insertAdjacentElement(\"afterend\", moveEl)\n        break\n      case \"backward\":\n        if (moveEl.previousElementSibling !== this.definitionGroup) {\n          moveEl.previousElementSibling?.insertAdjacentElement(\"beforebegin\", moveEl)\n        }\n        break\n    }\n  }\n\n  appendElement(el: Element): void\n  {\n    this.layer.appendChild(el)\n  }\n\n  removeElement(id: string): void\n  {\n    this.#logger.debug(\"Element\", { id })\n    const oldStroke = this.layer.querySelector(`#${ id }`)\n    if (oldStroke) {\n      oldStroke.remove()\n    }\n  }\n\n  drawSymbol(symbol: TOISymbol | OIEraser): SVGGraphicsElement | undefined\n  {\n    this.#logger.debug(\"drawSymbol\", { symbol })\n    const oldNode = this.layer.querySelector(`#${ symbol?.id }`)\n    const svgEl = this.buildElementFromSymbol(symbol)\n\n    if (svgEl) {\n      if (oldNode) {\n        oldNode.replaceWith(svgEl)\n      }\n      else {\n        this.layer.appendChild(svgEl)\n      }\n    }\n    return svgEl\n  }\n\n  replaceSymbol(id: string, symbols: TOISymbol[]): SVGGraphicsElement[] | undefined\n  {\n    this.#logger.debug(\"drawSymbol\", { symbols })\n    const oldNode = this.layer.querySelector(`#${ id }`)\n    const elements = symbols.map(s => this.buildElementFromSymbol(s)).filter(x => !!x) as SVGGraphicsElement[]\n\n    if (elements.length) {\n      if (oldNode) {\n        elements.forEach(e => oldNode.insertAdjacentElement(\"beforebegin\", e))\n        oldNode.remove()\n      }\n      else {\n        elements.forEach(e => this.layer.appendChild(e))\n      }\n    }\n    return elements\n  }\n\n  removeSymbol(id: string): void\n  {\n    this.#logger.debug(\"removeSymbol\", { id })\n    this.removeElement(id)\n  }\n\n  drawCircle(point: TPoint, radius: number, attrs: { [key: string]: string } = {}): void\n  {\n    this.#logger.info(\"drawCircle\", { point, radius, attrs })\n    this.layer.appendChild(SVGBuilder.createCircle(point, radius, attrs))\n  }\n\n  drawRect(box: TBoundingBox, attrs: { [key: string]: string } = {}): void\n  {\n    this.#logger.info(\"drawCircle\", { box, attrs })\n    this.layer.appendChild(SVGBuilder.createRect(box, attrs))\n  }\n\n  drawLine(p1: TPoint, p2: TPoint, attrs: { [key: string]: string } = {}): void\n  {\n    this.#logger.info(\"drawLine\", { p1, p2, attrs })\n    this.layer.appendChild(SVGBuilder.createLine(p1, p2, attrs))\n  }\n\n  drawConnectionBetweenBox(id: string, box1: TBoundingBox, box2: TBoundingBox, attrs?: { [key: string]: string }): void\n  {\n    const points1: TPoint[] = new Box(box1).corners\n    const points2: TPoint[] = new Box(box2).corners\n    const { p1, p2 } = getClosestPoints(points1, points2)\n    const attrsLine = {\n      id,\n      fill: \"transparent\",\n      style: OISVGRendererConst.noSelection,\n      ...attrs\n    }\n    this.drawLine(p1, p2, attrsLine)\n  }\n\n  resize(height: number, width: number): void\n  {\n    this.#logger.info(\"resize\", { height, width })\n    this.layer.setAttribute(\"width\", `${ width }px`)\n    this.layer.setAttribute(\"height\", `${ height }px`)\n    this.layer.setAttribute(\"viewBox\", `0, 0, ${ width }, ${ height }`)\n    this.removeGuides()\n    if (this.configuration.guides.enable) {\n      this.drawGuides()\n    }\n  }\n\n  getElementById(id: string): SVGGraphicsElement | null\n  {\n    return this.layer.querySelector(`#${ id }`) as SVGGraphicsElement | null\n  }\n\n  getElements({ tagName, attrs }: { tagName?: string, attrs?: { [key: string]: string } }): NodeListOf<Element>\n  {\n    this.#logger.info(\"getElements\", { tagName, attrs })\n    let query = tagName || \"*\"\n    if (attrs) {\n      Object.keys(attrs).forEach(k =>\n      {\n        query += `[${ k }=${ attrs[k] }]`\n      })\n    }\n    return this.layer.querySelectorAll(query)\n  }\n\n  clearElements({ tagName, attrs }: { tagName?: string, attrs?: { [key: string]: string } }): void\n  {\n    this.#logger.info(\"clearElements\", { tagName, attrs })\n    this.getElements({ tagName, attrs })\n      .forEach(e => e.remove())\n  }\n\n  clear(): void\n  {\n    this.#logger.info(\"clear\")\n    if (this.layer) {\n      while (this.layer.firstChild) {\n        this.layer.firstChild.remove()\n      }\n      this.layer.appendChild(this.createSVGTools())\n    }\n  }\n\n  destroy(): void\n  {\n    if (this.layer) {\n      this.layer.remove()\n    }\n  }\n}\n","import { TPointer, TStroke } from \"../../primitive\"\nimport { computeAngleAxeRadian, computeLinksPointers, computeMiddlePointer } from \"../../utils\"\n\n/**\n * @group Renderer\n */\nexport class SVGStroker\n{\n\n  protected getArcPath(center: TPointer, radius: number): string\n  {\n    const svgPath = [\n      `M ${ center.x },${ center.y }`,\n      `m ${ -radius },0`,\n      `a ${ radius },${ radius } 0 1 0 ${ radius * 2 },0`,\n      `a ${ radius },${ radius } 0 1 0 ${ -(radius * 2) },0`\n    ].join(\" \")\n    return svgPath\n  }\n\n  protected getLinePath(begin: TPointer, end: TPointer, width: number): string\n  {\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, end), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(begin, end), width)\n    const svgPath = [\n      `M ${ linkPoints1[0].x },${ linkPoints1[0].y }`,\n      `L ${ linkPoints2[0].x },${ linkPoints2[0].y }`,\n      `L ${ linkPoints2[1].x },${ linkPoints2[1].y }`,\n      `L ${ linkPoints1[1].x },${ linkPoints1[1].y }`\n    ].join(\" \")\n    return svgPath\n  }\n\n  protected getFinalPath(begin: TPointer, end: TPointer, width: number): string\n  {\n    const ARCSPLIT = 6\n    const angle = computeAngleAxeRadian(begin, end)\n    const linkPoints = computeLinksPointers(end, angle, width)\n    const parts = [`M ${ linkPoints[0].x },${ linkPoints[0].y }`]\n    for (let i = 1; i <= ARCSPLIT; i++) {\n      const newAngle = angle - (i * (Math.PI / ARCSPLIT))\n      parts.push(`L ${ end.x - (end.p * width * Math.sin(newAngle)) },${ end.y + (end.p * width * Math.cos(newAngle)) }`)\n    }\n    const svgPath = parts.join(\" \")\n    return svgPath\n  }\n\n  protected getQuadraticPath(begin: TPointer, end: TPointer, central: TPointer, width: number): string\n  {\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, central), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(central, end), width)\n    const linkPoints3 = computeLinksPointers(central, computeAngleAxeRadian(begin, end), width)\n    const svgPath = [\n      `M ${ linkPoints1[0].x },${ linkPoints1[0].y }`,\n      `Q ${ linkPoints3[0].x },${ linkPoints3[0].y } ${ linkPoints2[0].x },${ linkPoints2[0].y }`,\n      `L ${ linkPoints2[1].x },${ linkPoints2[1].y }`,\n      `Q ${ linkPoints3[1].x },${ linkPoints3[1].y } ${ linkPoints1[1].x },${ linkPoints1[1].y }`\n    ].join(\" \")\n    return svgPath\n  }\n\n  protected buildSVGPath(stroke: TStroke): string\n  {\n    const STROKE_LENGTH = stroke.pointers.length\n    const STROKE_WIDTH = (stroke.style.width as number)\n    const NB_QUADRATICS = STROKE_LENGTH - 2\n    const firstPoint = stroke.pointers[0]\n\n    const parts = []\n    if (STROKE_LENGTH < 3) {\n      parts.push(this.getArcPath(firstPoint, STROKE_WIDTH * 0.6))\n    } else {\n      parts.push(this.getArcPath(firstPoint, STROKE_WIDTH * firstPoint.p))\n      parts.push(this.getLinePath(firstPoint, computeMiddlePointer(firstPoint, stroke.pointers[1]), STROKE_WIDTH))\n\n      for (let i = 0; i < NB_QUADRATICS; i++) {\n        const begin = computeMiddlePointer(stroke.pointers[i], stroke.pointers[i + 1])\n        const end = computeMiddlePointer(stroke.pointers[i + 1], stroke.pointers[i + 2])\n        const central = stroke.pointers[i + 1]\n        parts.push(this.getQuadraticPath(begin, end, central, STROKE_WIDTH)\n        )\n      }\n      const beforeLastPoint = stroke.pointers[STROKE_LENGTH - 2]\n      const lastPoint = stroke.pointers[STROKE_LENGTH - 1]\n      parts.push(this.getLinePath(computeMiddlePointer(beforeLastPoint, lastPoint), lastPoint, STROKE_WIDTH))\n      parts.push(this.getFinalPath(beforeLastPoint, lastPoint, STROKE_WIDTH))\n    }\n    return parts.join(\" \")\n  }\n\n  drawStroke(svgElement: SVGElement, stroke: TStroke, attrs?: { name: string, value: string }[]): void\n  {\n    const svgPathElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"path\")\n    svgPathElement.classList.add(\"pending-stroke\")\n    svgPathElement.setAttribute(\"id\", stroke.id)\n    svgPathElement.setAttribute(\"type\", stroke.pointerType)\n    attrs?.forEach(a =>\n    {\n      svgPathElement.setAttribute(a.name, a.value)\n    })\n    const svgPath = this.buildSVGPath(stroke)\n    svgPathElement.setAttribute(\"d\", `${ svgPath }Z`)\n    svgElement.appendChild(svgPathElement)\n  }\n}\n","import { TRenderingConfiguration } from \"../../configuration\"\nimport { LoggerClass, LoggerManager } from \"../../logger\"\nimport { IModel } from \"../../model\"\nimport { TStroke } from \"../../primitive\"\nimport { TUpdatePatch, TUpdatePatchAppendChild, TUpdatePatchInsertBefore, TUpdatePatchRemoveAttribut, TUpdatePatchRemoveChild, TUpdatePatchRemoveElement, TUpdatePatchReplaceAll, TUpdatePatchReplaceELement, TUpdatePatchSetAttribut } from \"../../recognizer\"\nimport { SVGStroker } from \"./SVGStroker\"\n\n/**\n * @group Renderer\n */\nexport class WSSVGRenderer\n{\n  #logger = LoggerManager.getLogger(LoggerClass.RENDERER)\n\n  config: TRenderingConfiguration\n  stroker: SVGStroker\n  context!: {\n    parent: HTMLElement\n  }\n\n  constructor(config: TRenderingConfiguration)\n  {\n    this.#logger.info(\"constructor\", { config })\n    this.config = config\n    this.stroker = new SVGStroker()\n  }\n\n  init(element: HTMLElement): void\n  {\n    this.#logger.info(\"init\", { element })\n    element.style.fontSize = \"10px\"\n    this.context = {\n      parent: element\n    }\n  }\n\n  protected drawStroke(svgElement: SVGElement, stroke: TStroke)\n  {\n    let style: string\n    if (stroke.pointerType === \"eraser\") {\n      stroke.style.width = 12\n      style = \"fill:grey;stroke:transparent;shadowBlur:5;opacity:0.2;\"\n    } else {\n      style = `fill:${ stroke.style.color };stroke:transparent;`\n    }\n    this.stroker.drawStroke(svgElement, stroke, [{ name: \"style\", value: style }])\n  }\n\n  protected replaceAll(layerName: string, update: TUpdatePatchReplaceAll): void\n  {\n    const oldLayer = this.context.parent.querySelector(`svg[data-layer=\"${ layerName }\"]`) as SVGElement | null\n    oldLayer?.remove()\n    this.context.parent.insertAdjacentHTML(\"beforeend\", update.svg)\n    const layer = this.context.parent.querySelector(`svg[data-layer=\"${ layerName }\"]`) as SVGElement\n    if (layerName === \"MODEL\") {\n      const pendingStrokesGroup = document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\")\n      pendingStrokesGroup.id = \"pendingStrokes\"\n      layer.appendChild(pendingStrokesGroup)\n    }\n  }\n\n  protected replaceElement(update: TUpdatePatchReplaceELement): void\n  {\n    const elementToRemove = this.context.parent.querySelector(`#${ update.id }`) as HTMLElement | null\n    if (elementToRemove) {\n      const parent = elementToRemove.parentNode as HTMLElement | null | undefined\n      elementToRemove?.remove()\n      parent?.insertAdjacentHTML(\"beforeend\", update.svg)\n    }\n  }\n\n  protected appendChild(layerName: string, update: TUpdatePatchAppendChild): void\n  {\n    const parentSelector = update.parentId ? `#${ update.parentId }` : `svg[data-layer=\"${ layerName }\"]`\n    const parent = this.context.parent.querySelector(parentSelector) as HTMLElement\n    parent?.insertAdjacentHTML(\"beforeend\", update.svg)\n  }\n\n  protected removeChild(update: TUpdatePatchRemoveChild): void\n  {\n    this.context.parent.querySelector(`#${ update.parentId } > *:nth-child(${ update.index + 1 })`)?.remove()\n  }\n\n  protected removeElement(update: TUpdatePatchRemoveElement): void\n  {\n    const elementToRemove = this.context.parent.querySelector(`#${ update.id }`)\n    if (elementToRemove) {\n      if (update.id.includes(\"s\") || update.id.includes(\"MODEL\")) {\n        elementToRemove.remove()\n      } else {\n        elementToRemove.setAttribute(\"class\", \"removed-stroke\")\n        setTimeout(() =>\n        {\n          elementToRemove?.remove()\n        }, 100)\n      }\n    }\n  }\n\n  protected insertBefore(update: TUpdatePatchInsertBefore): void\n  {\n    const parent = this.context.parent.querySelector(`#${ update.refId }`) as HTMLElement | null\n    parent?.insertAdjacentHTML(\"beforebegin\", update.svg)\n  }\n\n  protected setAttribute(update: TUpdatePatchSetAttribut): void\n  {\n    const selector = update.id ? `#${ update.id }` : \"svg\"\n    const element = this.context.parent.querySelector(selector) as HTMLElement | null\n    element?.setAttribute(update.name, update.value)\n  }\n\n  protected removeAttribute(update: TUpdatePatchRemoveAttribut): void\n  {\n    const selector = update.id ? `#${ update.id }` : \"svg\"\n    const element = this.context.parent.querySelector(selector) as HTMLElement | null\n    element?.removeAttribute(update.name)\n  }\n\n  updateLayer(layerName: string, update: TUpdatePatch): void\n  {\n    this.#logger.info(\"updateLayer\", { layerName, update })\n    switch (update.type) {\n      case \"REPLACE_ALL\":\n        this.replaceAll(layerName, update as TUpdatePatchReplaceAll)\n        break\n      case \"REPLACE_ELEMENT\":\n        this.replaceElement(update as TUpdatePatchReplaceELement)\n        break\n      case \"APPEND_CHILD\":\n        this.appendChild(layerName, update as TUpdatePatchAppendChild)\n        break\n      case \"REMOVE_ELEMENT\":\n        this.removeElement(update as TUpdatePatchRemoveElement)\n        break\n      case \"REMOVE_CHILD\":\n        this.removeChild(update as TUpdatePatchRemoveChild)\n        break\n      case \"INSERT_BEFORE\":\n        this.insertBefore(update as TUpdatePatchInsertBefore)\n        break\n      case \"SET_ATTRIBUTE\":\n        this.setAttribute(update as TUpdatePatchSetAttribut)\n        break\n      case \"REMOVE_ATTRIBUTE\":\n        this.removeAttribute(update as TUpdatePatchRemoveAttribut)\n        break\n      default:\n        this.#logger.warn(\"updateLayer\", `update.type unknow ${update.type}`)\n        break\n    }\n  }\n\n  updatesLayer(layerName: string, updates: TUpdatePatch[]): void\n  {\n    this.#logger.info(\"updatesLayer\", { layerName, updates })\n    updates.forEach(u => this.updateLayer(layerName, u))\n    this.clearPendingStroke()\n  }\n\n  clearPendingStroke(): void\n  {\n    this.#logger.info(\"clearPendingStroke\")\n    const pendingStrokeGroup = this.context.parent.querySelector(\"#pendingStrokes\") as SVGElement\n    if (pendingStrokeGroup) {\n      pendingStrokeGroup.innerHTML = \"\"\n    }\n  }\n\n  drawPendingStroke(stroke: TStroke): void\n  {\n    this.#logger.info(\"drawPendingStroke\", { stroke })\n    if (stroke) {\n      const pendingStrokeGroup = this.context.parent.querySelector(\"#pendingStrokes\") as SVGElement\n      if (pendingStrokeGroup) {\n        const oldStroke = pendingStrokeGroup.querySelector(`#${ stroke?.id }`)\n        if (oldStroke) {\n          oldStroke.remove()\n        }\n        this.drawStroke(pendingStrokeGroup, stroke)\n      }\n    }\n  }\n\n  clearErasingStrokes(): void\n  {\n    const erasingStrokeList = this.context.parent.querySelectorAll(\"[type=eraser]\") as NodeListOf<SVGElement>\n    erasingStrokeList.forEach(erasingStroke => {\n      erasingStroke.remove()\n    })\n  }\n\n  resize(model: IModel): void\n  {\n    this.#logger.info(\"resize\", { model })\n    const rect = this.context.parent.getBoundingClientRect()\n    const svgList = this.context.parent.querySelectorAll(\"svg\")\n    const width = Math.max(rect.width, model.width)\n    const height = Math.max(rect.height, model.height)\n    svgList.forEach(svg =>\n    {\n      svg.setAttribute(\"viewBox\", `0 0 ${ width }, ${ height }`)\n      svg.setAttribute(\"width\", `${ width }px`)\n      svg.setAttribute(\"height\", `${ height }px`)\n    })\n  }\n\n  destroy(): void\n  {\n    this.#logger.info(\"destroy\", { context: this.context })\n    if (this.context?.parent) {\n      this.context.parent.querySelectorAll(\"svg\").forEach(n => n.remove())\n    }\n  }\n}\n","import { OIBehaviors } from \"../behaviors\"\nimport { LoggerManager, LoggerClass } from \"../logger\"\nimport\n{\n  OIModel,\n  TJIIXChar,\n  TJIIXEdgeArc,\n  TJIIXEdgeElement,\n  JIIXEdgeKind,\n  TJIIXEdgeLine,\n  TJIIXEdgePolyEdge,\n  TJIIXExport,\n  TJIIXNodeCircle,\n  TJIIXNodeElement,\n  TJIIXNodeEllipse,\n  JIIXNodeKind,\n  TJIIXNodeParrallelogram,\n  TJIIXNodePolygon,\n  TJIIXNodeRectangle,\n  TJIIXNodeRhombus,\n  TJIIXNodeTriangle,\n  TJIIXTextElement,\n  TJIIXWord\n} from \"../model\"\nimport\n{\n  Box,\n  DecoratorKind,\n  OIDecorator,\n  OIEdgeArc,\n  OIEdgeLine,\n  OIEdgePolyLine,\n  OIShapeCircle,\n  OIShapeEllipse,\n  OIShapePolygon,\n  OIStroke,\n  OISymbolGroup,\n  OIText,\n  SymbolType,\n  TOIEdge,\n  TOIShape,\n  TOISymbol,\n  TOISymbolChar,\n  TPoint\n} from \"../primitive\"\nimport { computeAngleAxeRadian, computeAverage, convertBoundingBoxMillimeterToPixel, convertMillimeterToPixel, createUUID } from \"../utils\"\n\n/**\n * @group Manager\n */\nexport class OIConversionManager\n{\n  #logger = LoggerManager.getLogger(LoggerClass.CONVERTER)\n  behaviors: OIBehaviors\n  fontSize?: number\n  fontWeight?: \"bold\" | \"normal\"\n\n  constructor(behaviors: OIBehaviors, fontStyle?: { size?: number | undefined, weight?: (\"bold\" | \"normal\") | undefined })\n  {\n    this.#logger.info(\"constructor\")\n    this.behaviors = behaviors\n    this.fontSize = fontStyle?.size\n    this.fontWeight = fontStyle?.weight\n  }\n\n  get model(): OIModel\n  {\n    return this.behaviors.model\n  }\n\n  get rowHeight(): number\n  {\n    return this.behaviors.configuration.rendering.guides.gap\n  }\n\n  protected computeFontSize(chars: TJIIXChar[]): number\n  {\n    if (chars.some(c => c[\"bounding-box\"])) {\n      const height = convertMillimeterToPixel(computeAverage(chars.map(c => c[\"bounding-box\"]?.height || 1)))\n      return Math.round(Math.round(height * this.rowHeight) / this.rowHeight / 2) * 2\n    }\n    return Math.round(this.rowHeight / 2)\n  }\n\n  buildChar(char: TJIIXChar, strokes: OIStroke[], fontSize: number): TOISymbolChar\n  {\n    const points = char.grid.map(p => ({\n      x: convertMillimeterToPixel(p.x),\n      y: convertMillimeterToPixel(p.y),\n    }))\n    let fontWeight = this.fontWeight\n    if (!fontWeight) {\n      fontWeight = (strokes[0].style.width || 1) > 2 ? \"bold\" : \"normal\"\n    }\n\n    const color = strokes[0].style.color || \"black\"\n    return {\n      id: `text-char-${ createUUID() }`,\n      label: char.label,\n      color,\n      fontSize,\n      fontWeight,\n      bounds: Box.createFromPoints(points)\n    }\n  }\n\n  buildWord(word: TJIIXWord, chars: TJIIXChar[], strokes: OIStroke[], fontSize?: number): OIText\n  {\n    const boundingBox = Box.createFromBoxes([convertBoundingBoxMillimeterToPixel(word[\"bounding-box\"])])\n    const charSymbols: TOISymbolChar[] = []\n    fontSize = fontSize || this.computeFontSize(chars)\n\n    chars.forEach(char =>\n    {\n      const charStrokes = strokes.filter(s => char.items?.some(i => i[\"full-id\"] === s.id)) as OIStroke[]\n      if (charStrokes.length) {\n        charSymbols.push(this.buildChar(char, charStrokes, fontSize!))\n      }\n    })\n    const point: TPoint = {\n      x: boundingBox.xMin,\n      y: boundingBox.yMax\n    }\n    const text = new OIText(charSymbols, point, boundingBox, strokes[0].style)\n    const decorators = strokes.flatMap(s => s.decorators)\n    strokes.forEach(s =>\n    {\n      const sym = this.model.getRootSymbol(s.id)\n      if (sym?.type === SymbolType.Group) {\n        const g = sym as OISymbolGroup\n        const hightlight = g.decorators.find(d => d.kind === DecoratorKind.Highlight)\n        if (hightlight) decorators.push(hightlight)\n        const strikethrough = g.decorators.find(d => d.kind === DecoratorKind.Strikethrough)\n        if (strikethrough) decorators.push(strikethrough)\n        const surround = g.decorators.find(d => d.kind === DecoratorKind.Surround)\n        if (surround) decorators.push(surround)\n        const underline = g.decorators.find(d => d.kind === DecoratorKind.Underline)\n        if (underline) decorators.push(underline)\n      }\n    })\n    if (decorators.length) {\n      const hightlight = decorators.find(d => d.kind === DecoratorKind.Highlight)\n      if (hightlight) {\n        text.decorators.push(new OIDecorator(DecoratorKind.Highlight, hightlight.style))\n      }\n      const strikethrough = decorators.find(d => d.kind === DecoratorKind.Strikethrough)\n      if (strikethrough) {\n        text.decorators.push(new OIDecorator(DecoratorKind.Strikethrough, strikethrough.style))\n      }\n      const surround = decorators.find(d => d.kind === DecoratorKind.Surround)\n      if (surround) {\n        text.decorators.push(new OIDecorator(DecoratorKind.Surround, surround.style))\n      }\n      const underline = decorators.find(d => d.kind === DecoratorKind.Underline)\n      if (underline) {\n        text.decorators.push(new OIDecorator(DecoratorKind.Underline, underline.style))\n      }\n    }\n\n    return text\n  }\n\n  convertText(text: TJIIXTextElement, strokes: OIStroke[], onlyText: boolean): { symbol: OIText, strokes: OIStroke[] }[] | undefined\n  {\n    if (!text.words) {\n      throw new Error(\"You need to active configuration.recognition.export.jiix.text.words = true\")\n    }\n    if (!text.chars) {\n      throw new Error(\"You need to active configuration.recognition.export.jiix.text.chars = true\")\n    }\n    if (!text.chars.some(c => c.items)) {\n      throw new Error(\"You need to active configuration.recognition.export.jiix.strokes = true\")\n    }\n\n    const jiixWords = text.words as TJIIXWord[]\n    const jiixChars = text.chars as TJIIXChar[]\n\n    const result: { symbol: OIText, strokes: OIStroke[] }[] = []\n\n    const textBounds = convertBoundingBoxMillimeterToPixel(text[\"bounding-box\"])\n    let fontSize = this.fontSize\n    if (onlyText && !fontSize) {\n      fontSize = Math.round(this.computeFontSize(jiixChars.filter(c => c.items?.length)) / 2) * 2\n    }\n\n    let isNewLine = false\n    let currentY = textBounds.y + this.rowHeight\n    let currentX = convertMillimeterToPixel(jiixWords[0][\"bounding-box\"]?.x || 0)\n    jiixWords.forEach(word =>\n    {\n      if (word.label === \" \") {\n        currentX += this.behaviors.texter.getSpaceWidth(result.at(-1)?.symbol.chars[0].fontSize || (this.rowHeight / 2))\n        return\n      }\n      const wordStrokes = strokes.filter(s => word.items?.some(i => i[\"full-id\"] === s.id)) as OIStroke[]\n      if (wordStrokes.length) {\n        const chars = jiixChars.slice(word[\"first-char\"] as number, (word[\"last-char\"] || 0) + 1)\n        const textSymbol = this.buildWord(word, chars, wordStrokes, fontSize)\n\n        if (onlyText) {\n          if (isNewLine) {\n            isNewLine = false\n            const nbRow = Math.round((textSymbol.point.y - currentY) / this.rowHeight) || 1\n            currentY += nbRow * this.rowHeight\n            if (Math.abs(textSymbol.point.x - textBounds.x) < this.behaviors.texter.getSpaceWidth(fontSize!) * 2) {\n              currentX = textBounds.x\n            }\n          }\n          textSymbol.point.x = currentX\n          textSymbol.point.y = this.model.roundToLineGuide(currentY)\n        }\n\n        this.behaviors.texter.setBounds(textSymbol)\n        currentX += textSymbol.bounds.width\n        result.push({\n          symbol: textSymbol,\n          strokes: wordStrokes\n        })\n      }\n      isNewLine = word.label === \"\\n\"\n    })\n\n    return result\n  }\n\n  buildCircle(circle: TJIIXNodeCircle, strokes: OIStroke[]): OIShapeCircle\n  {\n    const center: TPoint = {\n      x: convertMillimeterToPixel(circle.cx),\n      y: convertMillimeterToPixel(circle.cy)\n    }\n    return new OIShapeCircle(center, convertMillimeterToPixel(circle.r), strokes[0]?.style)\n  }\n\n  buildEllipse(ellipse: TJIIXNodeEllipse, strokes: OIStroke[]): OIShapeEllipse\n  {\n    const center: TPoint = {\n      x: convertMillimeterToPixel(ellipse.cx),\n      y: convertMillimeterToPixel(ellipse.cy),\n    }\n    return new OIShapeEllipse(center, convertMillimeterToPixel(ellipse.rx), convertMillimeterToPixel(ellipse.ry), ellipse.orientation, strokes[0]?.style)\n  }\n\n  buildRectangle(rectangle: TJIIXNodeRectangle, strokes: OIStroke[]): OIShapePolygon\n  {\n    const height = convertMillimeterToPixel(rectangle.height)\n    const width = convertMillimeterToPixel(rectangle.width)\n    const x = convertMillimeterToPixel(rectangle.x)\n    const y = convertMillimeterToPixel(rectangle.y)\n    const points: TPoint[] = [\n      { x, y },\n      { x: x + width, y },\n      { x: x + width, y: y + height },\n      { x, y: y + height }\n    ]\n    return new OIShapePolygon(points, strokes[0]?.style)\n  }\n\n  buildPolygon(polygon: TJIIXNodePolygon, strokes: OIStroke[]): OIShapePolygon\n  {\n    const points: TPoint[] = []\n    for (let i = 0; i < polygon.points.length; i += 2) {\n      points.push({\n        x: convertMillimeterToPixel(polygon.points[i]),\n        y: convertMillimeterToPixel(polygon.points[i + 1])\n      })\n    }\n\n    return new OIShapePolygon(points, strokes[0]?.style)\n  }\n\n  buildRhombus(polygon: TJIIXNodeRhombus, strokes: OIStroke[]): OIShapePolygon\n  {\n    const points: TPoint[] = []\n    for (let i = 0; i < polygon.points.length; i += 2) {\n      points.push({\n        x: convertMillimeterToPixel(polygon.points[i]),\n        y: convertMillimeterToPixel(polygon.points[i + 1])\n      })\n    }\n\n    return new OIShapePolygon(points, strokes[0]?.style)\n  }\n\n  buildTriangle(polygon: TJIIXNodeTriangle, strokes: OIStroke[]): OIShapePolygon\n  {\n    const points: TPoint[] = []\n    for (let i = 0; i < polygon.points.length; i += 2) {\n      points.push({\n        x: convertMillimeterToPixel(polygon.points[i]),\n        y: convertMillimeterToPixel(polygon.points[i + 1])\n      })\n    }\n\n    return new OIShapePolygon(points, strokes[0]?.style)\n  }\n\n  buildParallelogram(polygon: TJIIXNodeParrallelogram, strokes: OIStroke[]): OIShapePolygon\n  {\n    const points: TPoint[] = []\n    for (let i = 0; i < polygon.points.length; i += 2) {\n      points.push({\n        x: convertMillimeterToPixel(polygon.points[i]),\n        y: convertMillimeterToPixel(polygon.points[i + 1])\n      })\n    }\n\n    return new OIShapePolygon(points, strokes[0]?.style)\n  }\n\n  convertNode(node: TJIIXNodeElement, strokes: OIStroke[]): { symbol: TOIShape, strokes: OIStroke[] } | undefined\n  {\n    const associatedStroke = strokes.filter(s => node.items?.some(i => i[\"full-id\"] === s.id))\n    if (!associatedStroke.length) return\n\n    const uniqStrokes = associatedStroke.filter((a, i) => associatedStroke.findIndex((s) => a.id === s.id) === i)\n\n    let shape: TOIShape\n    switch (node.kind) {\n      case JIIXNodeKind.Circle:\n        shape = this.buildCircle(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Ellipse:\n        shape = this.buildEllipse(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Rectangle:\n        shape = this.buildRectangle(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Triangle:\n        shape = this.buildTriangle(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Parallelogram:\n        shape = this.buildParallelogram(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Polygon:\n        shape = this.buildPolygon(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Rhombus:\n        shape = this.buildRhombus(node, uniqStrokes)\n        break\n      default:\n        this.#logger.warn(\"convertNode\", `Conversion of Node with kind equal to ${ JSON.stringify(node) } is unknow`)\n        return\n    }\n    return { symbol: shape, strokes: uniqStrokes }\n  }\n\n  buildLine(line: TJIIXEdgeLine, strokes: OIStroke[]): OIEdgeLine\n  {\n    const point1: TPoint = { x: convertMillimeterToPixel(line.x1), y: convertMillimeterToPixel(line.y1) }\n    const point2: TPoint = { x: convertMillimeterToPixel(line.x2), y: convertMillimeterToPixel(line.y2) }\n    const angle = computeAngleAxeRadian(point1, point2)\n\n    if (Math.abs(angle % Math.PI) < 0.1) {\n      // to adjust the line with the horizontal\n      point1.y = +((point1.y + point2.y) / 2).toFixed(3)\n      point2.y = point1.y\n    }\n    else if (Math.abs(angle % (Math.PI / 2)) < 0.1) {\n      // to adjust the line with the vertical\n      point1.x = +((point1.x + point2.x) / 2).toFixed(3)\n      point2.x = point1.x\n    }\n    return new OIEdgeLine(point1, point2, line.p1Decoration, line.p2Decoration, strokes[0]?.style)\n  }\n\n  buildPolyEdge(polyline: TJIIXEdgePolyEdge, strokes: OIStroke[]): OIEdgePolyLine\n  {\n    const start: TPoint = { x: convertMillimeterToPixel(polyline.edges[0].x1), y: convertMillimeterToPixel(polyline.edges[0].y1) }\n    const points = polyline.edges.map(e => ({ x: convertMillimeterToPixel(e.x2), y: convertMillimeterToPixel(e.y2) }))\n    points.unshift(start)\n    for (let index = 0; index < points.length - 1; index++) {\n      const p1 = points[index]\n      const p2 = points[index + 1]\n      const angle = computeAngleAxeRadian(p1, p2)\n      if (Math.abs(angle % Math.PI) < 0.1) {\n        p1.y = +((p1.y + p2.y) / 2).toFixed(3)\n        p2.y = p1.y\n      }\n      else if (Math.abs(angle % (Math.PI / 2)) < 0.1) {\n        p1.x = +((p1.x + p2.x) / 2).toFixed(3)\n        p2.x = p1.x\n      }\n    }\n\n    return new OIEdgePolyLine(points, polyline.edges[0].p1Decoration, polyline.edges.at(-1)!.p2Decoration, strokes[0]?.style)\n  }\n\n  buildArc(arc: TJIIXEdgeArc, strokes: OIStroke[]): OIEdgeArc\n  {\n    const center: TPoint = { x: convertMillimeterToPixel(arc.cx), y: convertMillimeterToPixel(arc.cy) }\n    const radiusX = convertMillimeterToPixel(arc.rx)\n    const radiusY = convertMillimeterToPixel(arc.ry)\n    return new OIEdgeArc(center, arc.startAngle, arc.sweepAngle, radiusX, radiusY, arc.phi, arc.startDecoration, arc.endDecoration, strokes[0]?.style)\n  }\n\n  convertEdge(edge: TJIIXEdgeElement, strokes: OIStroke[]): { symbol: TOIEdge, strokes: OIStroke[] } | undefined\n  {\n    switch (edge.kind) {\n      case JIIXEdgeKind.Line: {\n        const associatedStroke = strokes.filter(s => edge.items?.some(i => i[\"full-id\"] === s.id))\n        if (!associatedStroke.length) return\n        const uniqStrokes = associatedStroke.filter((a, i) => associatedStroke.findIndex((s) => a.id === s.id) === i)\n        const oiEdge = this.buildLine(edge, uniqStrokes)\n        return {\n          symbol: oiEdge,\n          strokes: uniqStrokes\n        }\n      }\n      case JIIXEdgeKind.Arc: {\n        const associatedStroke = strokes.filter(s => edge.items?.some(i => i[\"full-id\"] === s.id))\n        if (!associatedStroke.length) return\n        const uniqStrokes = associatedStroke.filter((a, i) => associatedStroke.findIndex((s) => a.id === s.id) === i)\n        const oiEdge = this.buildArc(edge, uniqStrokes)\n        return {\n          symbol: oiEdge,\n          strokes: uniqStrokes\n        }\n      }\n      case JIIXEdgeKind.PolyEdge: {\n        const associatedStroke = strokes.filter(s => edge.edges.flatMap(e => e.items)?.some(i => i![\"full-id\"] === s.id))\n        if (!associatedStroke.length) return\n        const uniqStrokes = associatedStroke.filter((a, i) => associatedStroke.findIndex((s) => a.id === s.id) === i)\n        const oiEdge = this.buildPolyEdge(edge, uniqStrokes)\n        return {\n          symbol: oiEdge,\n          strokes: uniqStrokes\n        }\n      }\n      default:\n        this.#logger.error(\"convertEdge\", `Conversion of Edge with kind equal to ${ JSON.stringify(edge) } is unknow`)\n        return\n    }\n  }\n\n  async apply(symbols: TOISymbol[] = []): Promise<void>\n  {\n    this.#logger.info(\"convert\")\n    if (!this.model.exports?.[\"application/vnd.myscript.jiix\"]) {\n      await this.behaviors.export([\"application/vnd.myscript.jiix\"])\n    }\n    this.behaviors.selector.removeSelectedGroup()\n    const jiix = this.model.exports?.[\"application/vnd.myscript.jiix\"] as TJIIXExport\n    if (jiix?.elements?.length) {\n      const strokesToConvert = this.behaviors.extractStrokesFromSymbols(symbols.length ? symbols : this.model.symbols)\n\n      const onlyText = !jiix.elements?.some(e => e.type !== \"Text\")\n      const conversionResults: { symbol: TOISymbol, strokes: OIStroke[] }[] = []\n      jiix.elements.forEach(el =>\n      {\n        switch (el.type) {\n          case \"Text\": {\n            const conversion = this.convertText(el, strokesToConvert, onlyText)\n            if (conversion) {\n              conversionResults.push(...conversion)\n            }\n            break\n          }\n          case \"Node\": {\n            const conversion = this.convertNode(el, strokesToConvert)\n            if (conversion) {\n              conversionResults.push(conversion)\n            }\n            break\n          }\n          case \"Edge\": {\n            const conversion = this.convertEdge(el, strokesToConvert)\n            if (conversion) {\n              conversionResults.push(conversion)\n            }\n            break\n          }\n          default: {\n            this.#logger.warn(\"buildConversions\", `Unknow jiix element type: ${ el.type }`)\n          }\n        }\n      })\n\n      this.behaviors.addSymbols(conversionResults.map(cs => cs.symbol), false)\n      this.behaviors.removeSymbols(conversionResults.flatMap(cs => cs.strokes.map(s => s.id)), false)\n      this.behaviors.history.push(this.model, { added: conversionResults.map(c => c.symbol), erased: conversionResults.flatMap(cs => cs.strokes) })\n    }\n  }\n}\n","import { Intention } from \"../Constants\"\nimport { OIBehaviors } from \"../behaviors\"\nimport { LoggerManager, LoggerClass } from \"../logger\"\nimport { OIModel } from \"../model\"\nimport\n{\n  OIDecorator,\n  OIStroke,\n  SymbolType,\n  OIText,\n  DecoratorKind,\n  OISymbolGroup,\n  TOISymbol,\n  Box,\n  TPoint,\n} from \"../primitive\"\nimport { OIRecognizer } from \"../recognizer\"\nimport { OISVGRenderer } from \"../renderer\"\nimport { TStyle } from \"../style\"\nimport { OIHistoryManager, TOIHistoryChanges } from \"../history\"\nimport { computeAverage, isBetween } from \"../utils\"\nimport { TGesture, StrikeThroughAction, SurroundAction, InsertAction } from \"../gesture\"\nimport { OITranslateManager } from \"./OITranslateManager\"\nimport { OITextManager } from \"./OITextManager\"\n\n/**\n * @group Manager\n */\nexport class OIGestureManager\n{\n  #logger = LoggerManager.getLogger(LoggerClass.GESTURE)\n\n  insertAction: InsertAction = InsertAction.LineBreak\n  surroundAction: SurroundAction = SurroundAction.Select\n  strikeThroughAction: StrikeThroughAction = StrikeThroughAction.Draw\n  behaviors: OIBehaviors\n\n  constructor(behaviors: OIBehaviors, gestureAction?: { surround?: SurroundAction, strikeThrough?: StrikeThroughAction, insert?: InsertAction })\n  {\n    this.#logger.info(\"constructor\")\n    this.behaviors = behaviors\n    this.surroundAction = gestureAction?.surround || SurroundAction.Select\n    this.strikeThroughAction = gestureAction?.strikeThrough || StrikeThroughAction.Draw\n    this.insertAction = gestureAction?.insert || InsertAction.LineBreak\n  }\n\n  get renderer(): OISVGRenderer\n  {\n    return this.behaviors.renderer\n  }\n\n  get recognizer(): OIRecognizer\n  {\n    return this.behaviors.recognizer\n  }\n\n  get translator(): OITranslateManager\n  {\n    return this.behaviors.translator\n  }\n\n  get texter(): OITextManager\n  {\n    return this.behaviors.texter\n  }\n\n  get model(): OIModel\n  {\n    return this.behaviors.model\n  }\n\n  get history(): OIHistoryManager\n  {\n    return this.behaviors.history\n  }\n\n  get currentStyle(): TStyle\n  {\n    return this.behaviors.styler.currentPenStyle\n  }\n\n  get rowHeight(): number\n  {\n    return this.behaviors.configuration.rendering.guides.gap\n  }\n\n  get strokeSpaceWidth(): number\n  {\n    return this.behaviors.configuration.rendering.guides.gap / 2\n  }\n\n  async applySurroundGesture(gestureStroke: OIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.info(\"applySurroundGesture\", { gestureStroke, gesture })\n    const changes: TOIHistoryChanges = {}\n    const ids = this.model.symbols.filter(s => gestureStroke.bounds.contains(s.bounds)).map(s => s.id)\n    switch (this.surroundAction) {\n      case SurroundAction.Select: {\n        if (ids.length) {\n          this.behaviors.internalEvent.emitIntention(Intention.Select)\n          this.behaviors.select(ids)\n        }\n        break\n      }\n      case SurroundAction.Highlight: {\n        const symbolIds: string[] = []\n        changes.decorator = []\n        ids.forEach(id =>\n        {\n          const sym = this.model.getRootSymbol(id)\n          if (sym && [SymbolType.Group, SymbolType.Stroke, SymbolType.Text].includes(sym.type) && !symbolIds.includes(sym.id)) {\n            const symWithDec = sym as (OIText | OIStroke | OISymbolGroup)\n            const highlight = new OIDecorator(DecoratorKind.Highlight, this.currentStyle)\n            const index = symWithDec.decorators.findIndex(d => d.kind === DecoratorKind.Highlight)\n            const added = index === -1\n            added ? symWithDec.decorators.push(highlight) : symWithDec.decorators.splice(index, 1)\n            this.model.updateSymbol(symWithDec)\n            this.renderer.drawSymbol(symWithDec)\n            symbolIds.push(symWithDec.id)\n            changes.decorator!.push({ symbol: symWithDec, decorator: highlight, added })\n          }\n        })\n        if (changes.decorator.length) {\n          this.history.push(this.model, changes)\n        }\n        break\n      }\n      case SurroundAction.Surround: {\n        const symbolIds: string[] = []\n        changes.decorator = []\n        ids.forEach(id =>\n        {\n          const sym = this.model.getRootSymbol(id)\n          if (sym && [SymbolType.Group, SymbolType.Stroke, SymbolType.Text].includes(sym.type) && !symbolIds.includes(sym.id)) {\n            const symWithDec = sym as (OIText | OIStroke | OISymbolGroup)\n            const surround = new OIDecorator(DecoratorKind.Surround, this.currentStyle)\n            const index = symWithDec.decorators.findIndex(d => d.kind === DecoratorKind.Surround)\n            const added = index === -1\n            added ? symWithDec.decorators.push(surround) : symWithDec.decorators.splice(index, 1)\n            this.model.updateSymbol(symWithDec)\n            this.renderer.drawSymbol(symWithDec)\n            changes.decorator!.push({ symbol: symWithDec, decorator: surround, added })\n            symbolIds.push(symWithDec.id)\n          }\n        })\n        this.history.push(this.model, changes)\n        break\n      }\n      default:\n        this.#logger.error(\"applySurroundGesture\", `Unknow surroundAction: ${ this.surroundAction }, values allowed are: ${ SurroundAction.Highlight }, ${ SurroundAction.Select }, ${ SurroundAction.Surround }`)\n        break\n    }\n    return\n  }\n\n  protected computeScratchOnStrokes(gesture: TGesture, stroke: OIStroke): OIStroke[]\n  {\n    const newStrokes: OIStroke[] = []\n    const partPointersToRemove = gesture.subStrokes?.find(ss => ss.fullStrokeId === stroke.id)\n    if (partPointersToRemove) {\n      const strokePartToErase = new OIStroke()\n      partPointersToRemove.x.forEach((x, i) => strokePartToErase.addPointer({ x, y: partPointersToRemove.y[i], p: 1, t: 1 }))\n      const subStrokes = OIStroke.substract(stroke, strokePartToErase)\n      if (subStrokes.before) newStrokes.push(subStrokes.before)\n      if (subStrokes.after) newStrokes.push(subStrokes.after)\n    }\n    return newStrokes\n  }\n\n  protected computeScratchOnText(gestureStroke: OIStroke, textSymbol: OIText): OIText | undefined\n  {\n    const charsToRemove = textSymbol.getCharsOverlaps(gestureStroke.pointers)\n    if (textSymbol.chars.length == charsToRemove.length) {\n      return\n    }\n    else {\n      charsToRemove.forEach(c =>\n      {\n        const cIndex = textSymbol.chars.findIndex(c1 => c1.id === c.id)\n        textSymbol.chars.splice(cIndex, 1)\n      })\n      this.texter.updateBounds(textSymbol)\n      return textSymbol\n    }\n  }\n\n  protected computeScratchOnSymbol(gestureStroke: OIStroke, gesture: TGesture, symbol: TOISymbol): { erased?: boolean, replaced?: TOISymbol[] }\n  {\n    switch (symbol.type) {\n      case SymbolType.Stroke: {\n        const strokesScratchedResult = this.computeScratchOnStrokes(gesture, symbol)\n        if (strokesScratchedResult.length) {\n          return {\n            replaced: strokesScratchedResult\n          }\n        }\n        else {\n          return { erased: true }\n        }\n      }\n      case SymbolType.Group: {\n        const childrenNotTouch = symbol.extractSymbols().filter(s => !gestureStroke.bounds.overlaps(s.bounds))\n        const childrenTouch = symbol.extractSymbols().filter(s => gestureStroke.bounds.overlaps(s.bounds))\n        const results = childrenTouch.map(s =>\n        {\n          return {\n            symbol: s,\n            result: this.computeScratchOnSymbol(gestureStroke, gesture, s)\n          }\n        })\n        if (childrenNotTouch.length === 0 && results.every(r => r.result.erased)) {\n          return { erased: true }\n        }\n        else {\n          const symbolsGroup: TOISymbol[] = childrenNotTouch\n          results.forEach(r =>\n          {\n            if (r.result.replaced) {\n              symbolsGroup.push(...r.result.replaced)\n            }\n          })\n          const newGroup = new OISymbolGroup(symbolsGroup, symbol.style)\n          newGroup.decorators = symbol.decorators\n          return {\n            replaced: [newGroup]\n          }\n        }\n      }\n      case SymbolType.Text: {\n        const textScratchedResult = this.computeScratchOnText(gestureStroke, symbol)\n        if (textScratchedResult) {\n          return {\n            replaced: [textScratchedResult]\n          }\n        }\n        else {\n          return {\n            erased: true\n          }\n        }\n      }\n      case SymbolType.Shape:\n      case SymbolType.Edge:\n        return {\n          erased: true\n        }\n    }\n  }\n\n  async applyScratch(gestureStroke: OIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.debug(\"applyScratchGesture\", { gestureStroke, gesture })\n    if (!gesture.strokeIds.length) {\n      this.#logger.warn(\"applyScratchGesture\", \"Unable to apply underline because there are no strokes\")\n      return\n    }\n    const symbolsToUpdate: TOISymbol[] = []\n    const symbolsToErase: TOISymbol[] = []\n    const symbolsToReplace: { oldSymbols: TOISymbol[], newSymbols: TOISymbol[] } = { oldSymbols: [], newSymbols: [] }\n\n    gesture.strokeIds.forEach(id =>\n    {\n      const sym = this.model.getRootSymbol(id)\n      if (sym && !symbolsToErase.some(s => s.id === sym.id) && !symbolsToReplace.oldSymbols.some(s => s.id === sym.id)) {\n        const result = this.computeScratchOnSymbol(gestureStroke, gesture, sym)\n        if (result.erased) symbolsToErase.push(sym)\n        else if (result.replaced) {\n          symbolsToReplace.newSymbols.push(...result.replaced)\n          symbolsToReplace.oldSymbols.push(sym)\n        }\n      }\n    })\n\n    const promises: Promise<void | TOISymbol[]>[] = []\n    const changes: TOIHistoryChanges = {}\n    if (symbolsToUpdate.length) {\n      promises.push(this.behaviors.updateSymbols(symbolsToUpdate, false))\n      changes.updated = symbolsToUpdate\n    }\n\n    if (symbolsToErase.length) {\n      promises.push(this.behaviors.removeSymbols(symbolsToErase.map(s => s.id), false))\n      changes.erased = symbolsToErase\n    }\n\n    if (symbolsToReplace.newSymbols.length) {\n      changes.replaced = symbolsToReplace\n      promises.push(this.behaviors.replaceSymbols(symbolsToReplace.oldSymbols, symbolsToReplace.newSymbols, false))\n    }\n\n    this.history.push(this.model, changes)\n    await Promise.all(promises)\n  }\n\n  async applyJoinGesture(gestureStroke: OIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.debug(\"applyJoinGesture\", { gestureStroke, gesture })\n\n    const symbolsAbove = this.model.symbols.filter(s => this.model.isSymbolAbove(gestureStroke, s))\n    const symbolsRow = this.model.symbols.filter(s => gestureStroke.id !== s.id && this.model.isSymbolInRow(gestureStroke, s))\n\n    const symbolsBeforeGestureInRow = symbolsRow.filter(s => s.bounds.xMax <= gestureStroke.bounds.xMid)\n    const symbolsOnGestureInRow = symbolsRow.filter(s => s.bounds.xMax > gestureStroke.bounds.xMid && s.bounds.xMin <= gestureStroke.bounds.xMid)\n    const symbolsAfterGestureInRow = symbolsRow.filter(s => s.bounds.xMin > gestureStroke.bounds.xMid)\n    const symbolsBelow = this.model.symbols.filter(s => this.model.isSymbolBelow(gestureStroke, s))\n\n    const changes: TOIHistoryChanges = {}\n    const translate: { symbols: TOISymbol[], tx: number, ty: number }[] = []\n    if (symbolsOnGestureInRow.length) {\n      const symbolToJoin = symbolsOnGestureInRow[0]\n      if (symbolToJoin?.type === SymbolType.Group) {\n        const children = symbolToJoin.extractSymbols().map(c => c.clone())\n        const childBefore = children.filter(c => c.bounds.xMid <= gestureStroke.bounds.xMid)\n        const childAfter = children.filter(c => c.bounds.xMid > gestureStroke.bounds.xMid)\n        if (childBefore.length && childAfter.length) {\n          const tx = Math.max(...childBefore.map(c => c.bounds.xMax)) - Math.min(...childAfter.map(c => c.bounds.xMin))\n          childAfter.forEach(c => this.translator.applyToSymbol(c, tx, 0))\n          const newGroup = new OISymbolGroup(children, symbolToJoin.style)\n          newGroup.decorators = symbolToJoin.decorators.map(d => d.clone())\n          changes.replaced = {\n            oldSymbols: [symbolToJoin],\n            newSymbols: [newGroup]\n          }\n          if (symbolsAfterGestureInRow.length) {\n            translate.push({ symbols: symbolsAfterGestureInRow, tx, ty: 0 })\n          }\n          const symbolsAfterNextRow = symbolsBelow.filter(s => this.model.isSymbolBelow(symbolToJoin, s))\n          if (symbolsAfterNextRow.length) {\n            translate.push({ symbols: symbolsAfterNextRow, tx: 0, ty: -this.rowHeight })\n          }\n        }\n        else if (symbolsAfterGestureInRow.length) {\n          const tx = symbolToJoin.bounds.xMax - Math.min(...symbolsAfterGestureInRow.map(s => s.bounds.xMin))\n          translate.push({ symbols: symbolsAfterGestureInRow, tx, ty: 0 })\n        }\n      }\n    }\n    else if (symbolsBeforeGestureInRow.length && symbolsAfterGestureInRow.length) {\n      const lastSymbBefore = this.model.getLastSymbol(symbolsBeforeGestureInRow)!\n      const firstSymbolAfter = this.model.getFirstSymbol(symbolsAfterGestureInRow)!\n\n      const lastXBefore = Math.max(...symbolsBeforeGestureInRow.map(s => s.bounds.xMax))\n      const firstXAfter = Math.min(...symbolsAfterGestureInRow.map(s => s.bounds.xMin))\n      const translateX = lastXBefore - firstXAfter\n\n      const lastSymbBeforeClone = lastSymbBefore.clone()\n      const firstSymbolAfterClone = firstSymbolAfter.clone()\n      this.translator.applyToSymbol(firstSymbolAfterClone, translateX, 0)\n      const symbolsToGroup = lastSymbBefore.type === SymbolType.Group ? (lastSymbBeforeClone as OISymbolGroup).extractSymbols() : [lastSymbBeforeClone]\n      symbolsToGroup.push(...(firstSymbolAfterClone.type === SymbolType.Group ? (firstSymbolAfterClone as OISymbolGroup).extractSymbols() : [firstSymbolAfterClone]))\n\n      if (symbolsToGroup.every(s => s.type === SymbolType.Text)) {\n        const texts = symbolsToGroup as OIText[]\n        const text = new OIText(texts.flatMap(s => s.chars), texts[0].point, Box.createFromBoxes(texts.map(t => t.bounds)))\n        this.texter.setBounds(text)\n        changes.replaced = {\n          oldSymbols: [lastSymbBefore, firstSymbolAfter],\n          newSymbols: [text]\n        }\n      }\n      else {\n        const group = new OISymbolGroup(symbolsToGroup, lastSymbBefore.style)\n        if ([SymbolType.Group, SymbolType.Stroke, SymbolType.Text].includes(lastSymbBefore.type)) {\n          (lastSymbBefore as OIStroke).decorators.forEach(d =>\n          {\n            group.decorators.push(new OIDecorator(d.kind, d.style))\n          })\n        }\n        if ([SymbolType.Group, SymbolType.Stroke, SymbolType.Text].includes(firstSymbolAfter.type)) {\n          (firstSymbolAfter as OIStroke).decorators.forEach(d =>\n          {\n            if (!group.decorators.some(d1 => d1.kind == d.kind)) {\n              group.decorators.push(new OIDecorator(d.kind, d.style))\n            }\n          })\n        }\n\n        changes.replaced = {\n          oldSymbols: [lastSymbBefore, firstSymbolAfter],\n          newSymbols: [group]\n        }\n      }\n\n      const rest = symbolsAfterGestureInRow.filter(s => s.id !== firstSymbolAfter.id)\n      if (rest.length) {\n        translate.push({ symbols: rest, tx: translateX, ty: 0 })\n      }\n    }\n    else if (symbolsBeforeGestureInRow.length) {\n      const lastSymbolBeforeGesture = this.model.getLastSymbol(symbolsBeforeGestureInRow)!\n      const firstSymbolAfterGesture = this.model.getFirstSymbol(symbolsBelow)\n      if (firstSymbolAfterGesture) {\n        if (this.model.roundToLineGuide(lastSymbolBeforeGesture.bounds.yMid) >= this.model.roundToLineGuide(firstSymbolAfterGesture.bounds.yMid - this.rowHeight)) {\n          const symbolInNextRow = symbolsBelow.filter(s => this.model.isSymbolInRow(firstSymbolAfterGesture, s))\n          if (symbolInNextRow.length) {\n            const translateX = lastSymbolBeforeGesture.bounds.xMax + this.strokeSpaceWidth - firstSymbolAfterGesture.bounds.xMin\n            translate.push({ symbols: symbolInNextRow, tx: translateX, ty: -this.rowHeight })\n          }\n          const symbolsAfterNextRow = symbolsBelow.filter(s => this.model.isSymbolBelow(firstSymbolAfterGesture, s))\n          if (symbolsAfterNextRow.length) {\n            translate.push({ symbols: symbolsAfterNextRow, tx: 0, ty: -this.rowHeight })\n          }\n        }\n      }\n      else {\n        translate.push({ symbols: symbolsBelow, tx: 0, ty: -this.rowHeight })\n      }\n    }\n    else if (symbolsAfterGestureInRow.length) {\n      const firstSymbolAfterGesture = this.model.getFirstSymbol(symbolsAfterGestureInRow)!\n      const lastSymbolAbove = this.model.getLastSymbol(symbolsAbove)\n      if (lastSymbolAbove) {\n        if (this.model.roundToLineGuide(lastSymbolAbove.bounds.yMid) >= this.model.roundToLineGuide(firstSymbolAfterGesture.bounds.yMid - this.rowHeight)) {\n          const translateX = lastSymbolAbove.bounds.xMax + this.strokeSpaceWidth - firstSymbolAfterGesture.bounds.xMin\n          translate.push({ symbols: symbolsAfterGestureInRow, tx: translateX, ty: -this.rowHeight })\n        }\n        else {\n          translate.push({ symbols: symbolsAfterGestureInRow, tx: 0, ty: -this.rowHeight })\n        }\n\n        if (symbolsBelow.length) {\n          translate.push({ symbols: symbolsBelow, tx: 0, ty: -this.rowHeight })\n        }\n      }\n      else {\n        translate.push({ symbols: symbolsAfterGestureInRow.concat(...symbolsBelow), tx: 0, ty: -this.rowHeight })\n      }\n\n    }\n    if (changes.replaced?.oldSymbols.length) {\n      this.behaviors.replaceSymbols(changes.replaced.oldSymbols, changes.replaced.newSymbols, false)\n    }\n    if (translate.length) {\n      changes.translate = translate\n      Promise.all(translate.map(tr => this.translator.translate(tr.symbols, tr.tx, tr.ty, false)))\n    }\n    this.history.push(this.model, changes)\n  }\n\n  protected createStrokesFromGestureSubStroke(strokeOrigin: OIStroke, subStrokes: { x: number[], y: number[] }[]): OIStroke[]\n  {\n    const strokes: OIStroke[] = []\n    if (subStrokes[0]) {\n      const subStroke = new OIStroke(strokeOrigin.style)\n      subStrokes![0].x.forEach((x, i) =>\n      {\n        subStroke.pointers.push({\n          x,\n          y: subStrokes![0].y[i],\n          p: strokeOrigin.pointers.at(i)?.p || 1,\n          t: strokeOrigin.pointers.at(i)?.t || Math.max(...subStroke.pointers.map(p => p.t + 20))\n        })\n      })\n      strokes.push(subStroke)\n    }\n    if (subStrokes[1]) {\n      const subStroke = new OIStroke(strokeOrigin.style)\n      subStrokes[1].x.forEach((x, i) =>\n      {\n        subStroke.pointers.push({\n          x,\n          y: subStrokes![1].y[i],\n          p: strokeOrigin.pointers.at(subStroke.pointers.length + i)?.p || 1,\n          t: strokeOrigin.pointers.at(subStroke.pointers.length + i)?.t || Math.max(...subStroke.pointers.map(p => p.t + 20))\n        })\n      })\n      strokes.push(subStroke)\n    }\n    return strokes\n  }\n\n  protected computeSplitStroke(strokeOrigin: OIStroke, subStrokes: { x: number[], y: number[] }[]): { before?: OIStroke, after?: OIStroke }\n  {\n    let after: OIStroke | undefined\n    const newStrokes = this.createStrokesFromGestureSubStroke(strokeOrigin, subStrokes)\n\n    if (newStrokes[1]) {\n      after = newStrokes[1]\n      this.translator.applyToSymbol(after, this.strokeSpaceWidth, 0)\n    }\n    return {\n      before: newStrokes[0],\n      after\n    }\n  }\n\n  protected computeSplitStrokeInGroup(gestureStroke: OIStroke, group: OISymbolGroup, subStrokes: { fullStrokeId: string, x: number[], y: number[] }[]): OISymbolGroup[]\n  {\n    const newGroups: OISymbolGroup[] = []\n    const groupSymbols = group.extractSymbols()\n\n    const symbolsBefore: TOISymbol[] = []\n    const symbolsAfter: TOISymbol[] = []\n\n    const strokeIdToSplit = subStrokes[0].fullStrokeId\n\n    groupSymbols.forEach(gs =>\n    {\n      if (gs.id === strokeIdToSplit) {\n        const subStroke = this.computeSplitStroke(gs as OIStroke, subStrokes)\n        if (subStroke.before) {\n          symbolsBefore.push(subStroke.before)\n        }\n        if (subStroke.after) {\n          symbolsAfter.push(subStroke.after)\n        }\n      }\n      else if (gs.bounds.xMid < gestureStroke.bounds.xMid) {\n        symbolsBefore.push(gs)\n      }\n      else if (gs.bounds.xMid > gestureStroke.bounds.xMid) {\n        this.translator.applyToSymbol(gs, this.strokeSpaceWidth, 0)\n        symbolsAfter.push(gs)\n      }\n    })\n\n    if (symbolsBefore.length) {\n      newGroups.push(new OISymbolGroup(symbolsBefore, group.style))\n    }\n    if (symbolsAfter.length) {\n      newGroups.push(new OISymbolGroup(symbolsAfter, group.style))\n    }\n    return newGroups\n  }\n\n  protected computeChangesOnSplitStroke(gestureStroke: OIStroke, strokeIdToSplit: string, subStrokes: { fullStrokeId: string, x: number[], y: number[] }[]): TOIHistoryChanges\n  {\n    const translate: { symbols: TOISymbol[], tx: number, ty: number }[] = []\n    const replaced: { oldSymbols: TOISymbol[], newSymbols: TOISymbol[] } = { oldSymbols: [], newSymbols: [] }\n\n    const symbolsAfterGestureInRow = this.model.symbols.filter(s => gestureStroke.id !== s.id && this.model.isSymbolInRow(gestureStroke, s) && gestureStroke.bounds.xMid < s.bounds.xMin)\n\n    const symbolToSplit = this.model.getRootSymbol(strokeIdToSplit)\n    if (symbolToSplit?.type === SymbolType.Group) {\n      const newGroups = this.computeSplitStrokeInGroup(gestureStroke, symbolToSplit, subStrokes)\n      replaced.newSymbols.push(...newGroups)\n      replaced.oldSymbols.push(symbolToSplit)\n    }\n    else if (symbolToSplit?.type === SymbolType.Stroke) {\n      const newStrokes = this.computeSplitStroke(symbolToSplit, subStrokes)\n      if (newStrokes.before) {\n        replaced.newSymbols.push(newStrokes.before)\n      }\n      if (newStrokes.after) {\n        replaced.newSymbols.push(newStrokes.after)\n      }\n      replaced.oldSymbols.push(symbolToSplit)\n    }\n    if (symbolsAfterGestureInRow.length) {\n      translate.push({ symbols: symbolsAfterGestureInRow, tx: this.strokeSpaceWidth, ty: 0 })\n    }\n\n    return {\n      translate,\n      replaced\n    }\n  }\n\n  protected computeChangesOnSplitGroup(gestureStroke: OIStroke, groupToSplit: OISymbolGroup): TOIHistoryChanges\n  {\n    const translate: { symbols: TOISymbol[], tx: number, ty: number }[] = []\n    const replaced: { oldSymbols: TOISymbol[], newSymbols: TOISymbol[] } = { oldSymbols: [], newSymbols: [] }\n\n    const symbolsAfterGestureInRow = this.model.symbols.filter(s => gestureStroke.id !== s.id && this.model.isSymbolInRow(gestureStroke, s) && gestureStroke.bounds.xMid < s.bounds.xMin)\n\n    const groupSymbolsBefore = groupToSplit.children.filter(s => s.bounds.xMid <= gestureStroke.bounds.xMid)\n    const groupsSymbolsAfter = groupToSplit.children.filter(s => s.bounds.xMid > gestureStroke.bounds.xMid)\n\n    replaced.oldSymbols.push(groupToSplit)\n    if (groupSymbolsBefore.length) {\n      const groupBefore = new OISymbolGroup(groupSymbolsBefore.map(s => s.clone()), groupToSplit.style)\n      groupBefore.decorators = groupToSplit.decorators.map(d => new OIDecorator(d.kind, d.style))\n      replaced.newSymbols.push(groupBefore)\n    }\n    if (groupsSymbolsAfter.length) {\n      const grouAfter = new OISymbolGroup(groupsSymbolsAfter.map(s => s.clone()), groupToSplit.style)\n      grouAfter.decorators = groupToSplit.decorators.map(d => new OIDecorator(d.kind, d.style))\n      this.translator.applyToSymbol(grouAfter, this.strokeSpaceWidth, 0)\n      replaced.newSymbols.push(grouAfter)\n    }\n    if (symbolsAfterGestureInRow?.length) {\n      translate.push({ symbols: symbolsAfterGestureInRow.filter(s => s.id !== groupToSplit.id), tx: this.strokeSpaceWidth, ty: 0 })\n    }\n\n    return {\n      translate,\n      replaced\n    }\n  }\n\n  protected computeChangesOnSplitText(gestureStroke: OIStroke, textToSplit: OIText): TOIHistoryChanges\n  {\n    const translate: { symbols: TOISymbol[], tx: number, ty: number }[] = []\n    const replaced: { oldSymbols: TOISymbol[], newSymbols: TOISymbol[] } = { oldSymbols: [], newSymbols: [] }\n\n    const symbolsAfterGestureInRow = this.model.symbols.filter(s => gestureStroke.id !== s.id && this.model.isSymbolInRow(gestureStroke, s) && gestureStroke.bounds.xMid < s.bounds.xMin)\n\n    const charsBefore = textToSplit.chars.filter(c => c.bounds.x + c.bounds.width / 2 <= gestureStroke.bounds.xMid)\n    const charsAfter = textToSplit.chars.filter(c => c.bounds.x + c.bounds.width / 2 > gestureStroke.bounds.xMid)\n    const newTexts: OIText[] = []\n    if (charsBefore.length && charsAfter.length) {\n      const textBefore = new OIText(charsBefore, textToSplit.point, Box.createFromBoxes(charsBefore.map(c => c.bounds)))\n      this.texter.setBounds(textBefore)\n      newTexts.push(textBefore)\n      const pointAfter: TPoint = {\n        x: textBefore.point.x + textBefore.bounds.width + this.texter.getSpaceWidth(computeAverage(textBefore.chars.map(c => c.fontSize))),\n        y: textBefore.point.y\n      }\n      const textAfter = new OIText(charsAfter, pointAfter, Box.createFromBoxes(charsAfter.map(c => c.bounds)))\n      this.texter.setBounds(textAfter)\n      newTexts.push(textAfter)\n      replaced.newSymbols = newTexts\n      replaced.oldSymbols = [textToSplit]\n    }\n    if (symbolsAfterGestureInRow?.length) {\n      translate.push({ symbols: symbolsAfterGestureInRow.filter(s => s.id !== gestureStroke.id), tx: this.strokeSpaceWidth, ty: 0 })\n    }\n\n    return {\n      translate,\n      replaced\n    }\n  }\n\n  async applyInsertGesture(gestureStroke: OIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.debug(\"applyInsertGesture\", { gestureStroke, gesture })\n\n    const symbolsRow = this.model.symbols.filter(s => gestureStroke.id !== s.id && this.model.isSymbolInRow(gestureStroke, s))\n    const textToSplit = symbolsRow.find(s => s.type === SymbolType.Text && isBetween(gestureStroke.bounds.xMid, s.bounds.xMin, s.bounds.xMax)) as OIText | undefined\n    const groupToSplit = symbolsRow.find(s => s.type === SymbolType.Group && isBetween(gestureStroke.bounds.xMid, s.bounds.xMin, s.bounds.xMax)) as OISymbolGroup | undefined\n\n    const symbolsBeforeGestureInRow = symbolsRow.filter(s => gestureStroke.bounds.xMid > s.bounds.xMax)\n    const symbolsAfterGestureInRow = symbolsRow.filter(s => gestureStroke.bounds.xMid < s.bounds.xMin)\n\n    const symbolsBelow = this.model.symbols.filter(s => this.model.isSymbolBelow(gestureStroke, s))\n\n\n    let changes: TOIHistoryChanges | undefined\n    if (gesture.strokeIds.length && gesture.subStrokes?.length) {\n      changes = this.computeChangesOnSplitStroke(gestureStroke, gesture.strokeIds[0], gesture.subStrokes)\n    }\n    else if (groupToSplit) {\n      changes = this.computeChangesOnSplitGroup(gestureStroke, groupToSplit)\n    }\n    else if (textToSplit) {\n      changes = this.computeChangesOnSplitText(gestureStroke, textToSplit)\n    }\n    else if (symbolsAfterGestureInRow.length) {\n      const translate: { symbols: TOISymbol[], tx: number, ty: number }[] = []\n      let translateX = 0\n      if (symbolsBeforeGestureInRow.length) {\n        translateX = Math.min(...symbolsBeforeGestureInRow.map(s => s.bounds.xMin)) - Math.min(...symbolsAfterGestureInRow.map(s => s.bounds.xMin))\n      }\n\n      switch (this.insertAction) {\n        case InsertAction.LineBreak:\n          translate.push({ symbols: symbolsAfterGestureInRow, tx: translateX, ty: this.rowHeight })\n          if (symbolsBelow.length) {\n            translate.push({ symbols: symbolsBelow, tx: 0, ty: this.rowHeight })\n          }\n          break\n        case InsertAction.Insert:\n          translate.push({ symbols: symbolsAfterGestureInRow, tx: this.strokeSpaceWidth * 2, ty: 0 })\n          break\n      }\n      changes = { translate }\n    }\n    else if (symbolsBeforeGestureInRow.length && symbolsBelow.length && this.insertAction === InsertAction.LineBreak) {\n      changes = { translate: [{ symbols: symbolsBelow, tx: 0, ty: this.rowHeight }] }\n    }\n\n    if (changes) {\n      const promises: Promise<void>[] = []\n      if (changes.translate?.length) {\n        promises.push(...changes.translate.map(tr => this.translator.translate(tr.symbols, tr.tx, tr.ty, false)))\n      }\n      if (changes.replaced?.newSymbols.length) {\n        promises.push(this.behaviors.replaceSymbols(changes.replaced.oldSymbols, changes.replaced.newSymbols, false))\n      }\n      this.history.push(this.model, changes)\n      await Promise.all(promises)\n    }\n  }\n\n  async applyUnderlineGesture(gestureStroke: OIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.debug(\"applyUnderlineGesture\", { gestureStroke, gesture })\n    if (!gesture.strokeIds.length) {\n      this.#logger.warn(\"applyUnderlineGesture\", \"Unable to apply underline because there are no strokes\")\n      return\n    }\n\n    const changes: TOIHistoryChanges = { decorator: [] }\n    const symbolIds: string[] = []\n    gesture.strokeIds.forEach(id =>\n    {\n      const sym = this.model.getRootSymbol(id)\n      if (sym && [SymbolType.Group, SymbolType.Stroke, SymbolType.Text].includes(sym.type) && !symbolIds.includes(sym.id)) {\n        const symWithDec = sym as (OIText | OIStroke | OISymbolGroup)\n        const underline = new OIDecorator(DecoratorKind.Underline, this.currentStyle)\n        const index = symWithDec.decorators.findIndex(d => d.kind === DecoratorKind.Underline)\n        const added = index === -1\n        added ? symWithDec.decorators.push(underline) : symWithDec.decorators.splice(index, 1)\n        this.model.updateSymbol(symWithDec)\n        this.renderer.drawSymbol(symWithDec)\n        changes.decorator?.push({ symbol: symWithDec, decorator: underline, added })\n        symbolIds.push(symWithDec.id)\n      }\n    })\n    if (changes.decorator?.length) {\n      this.history.push(this.model, changes)\n    }\n  }\n\n  async applyStrikeThroughGesture(gestureStroke: OIStroke, gesture: TGesture): Promise<void | TOISymbol[]>\n  {\n    this.#logger.debug(\"applyStrikeThroughGesture\", { gestureStroke, gesture })\n    if (!gesture.strokeIds.length) {\n      this.#logger.warn(\"applyStrikeThroughGesture\", \"Unable to apply strikethrough because there are no strokes\")\n      return\n    }\n    switch (this.strikeThroughAction) {\n      case StrikeThroughAction.Draw: {\n        const changes: TOIHistoryChanges = { decorator: [] }\n        const symbolIds: string[] = []\n        gesture.strokeIds.forEach(id =>\n        {\n          const symbol = this.model.getRootSymbol(id)\n          if (symbol && [SymbolType.Group, SymbolType.Stroke, SymbolType.Text].includes(symbol.type) && !symbolIds.includes(symbol.id)) {\n            const symWithDec = symbol as (OIText | OIStroke | OISymbolGroup)\n            const strikethrough = new OIDecorator(DecoratorKind.Strikethrough, this.currentStyle)\n            const index = symWithDec.decorators.findIndex(d => d.kind === DecoratorKind.Strikethrough)\n            const added = index === -1\n            added ? symWithDec.decorators.push(strikethrough) : symWithDec.decorators.splice(index, 1)\n            this.model.updateSymbol(symWithDec)\n            this.renderer.drawSymbol(symWithDec)\n            changes.decorator?.push({ symbol: symWithDec, decorator: strikethrough, added })\n            symbolIds.push(symWithDec.id)\n          }\n        })\n        if (changes.decorator?.length) {\n          this.history.push(this.model, changes)\n        }\n        break\n      }\n      case StrikeThroughAction.Erase: {\n        return this.behaviors.removeSymbols(gesture.strokeIds)\n      }\n      default:\n        this.#logger.warn(\"#applyStrikeThroughGesture\", `Unknow OnStrikeThrough: ${ this.strikeThroughAction }, values allowed are: ${ StrikeThroughAction.Draw }, ${ StrikeThroughAction.Erase }`)\n        break\n    }\n  }\n\n  async apply(gestureStroke: OIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.info(\"apply\", { gestureStroke, gesture })\n    this.behaviors.updateSymbolsStyle([gestureStroke.id], { opacity: (gestureStroke.style.opacity || 1) / 2 }, false)\n    await this.behaviors.groupStrokesByJIIXElement()\n    await this.behaviors.removeSymbol(gestureStroke.id, false)\n    switch (gesture.gestureType) {\n      case \"UNDERLINE\":\n        await this.applyUnderlineGesture(gestureStroke, gesture)\n        break\n      case \"SCRATCH\":\n        await this.applyScratch(gestureStroke, gesture)\n        break\n      case \"JOIN\":\n        await this.applyJoinGesture(gestureStroke, gesture)\n        break\n      case \"INSERT\":\n        await this.applyInsertGesture(gestureStroke, gesture)\n        break\n      case \"STRIKETHROUGH\":\n        await this.applyStrikeThroughGesture(gestureStroke, gesture)\n        break\n      case \"SURROUND\":\n        await this.applySurroundGesture(gestureStroke, gesture)\n        break\n      default:\n        this.#logger.warn(\"apply\", `Gesture unknow: ${ gesture.gestureType }`)\n        break\n    }\n\n    this.behaviors.svgDebugger.apply()\n    return Promise.resolve()\n  }\n\n  async getGestureFromContextLess(gestureStroke: OIStroke): Promise<TGesture | undefined>\n  {\n    const gesture = await this.recognizer.recognizeGesture(gestureStroke)\n    if (!gesture) return\n    switch (gesture.gestureType) {\n      case \"surround\": {\n        const hasSymbolsToSurrond = this.model.symbols.some(s =>\n        {\n          if (s.id !== gestureStroke.id && gestureStroke.bounds.contains(s.bounds)) {\n            return this.surroundAction === SurroundAction.Select || [SymbolType.Group, SymbolType.Stroke, SymbolType.Text].includes(s.type)\n          }\n          return false\n        })\n        if (hasSymbolsToSurrond) {\n          return {\n            gestureType: \"SURROUND\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: [],\n          }\n        }\n        return\n      }\n      case \"left-right\":\n      case \"right-left\": {\n        const symbolsToUnderline = this.model.symbols.filter(s =>\n        {\n          return [SymbolType.Text, SymbolType.Stroke, SymbolType.Group].includes(s.type) &&\n            isBetween(s.bounds.xMid, gestureStroke.bounds.xMin, gestureStroke.bounds.xMax) &&\n            isBetween(gestureStroke.bounds.yMid, s.bounds.y + s.bounds.height * 3 / 4, s.bounds.y + s.bounds.height * 5 / 4)\n        })\n        if (symbolsToUnderline.length) {\n          return {\n            gestureType: \"UNDERLINE\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: symbolsToUnderline.map(s => s.id),\n          }\n        }\n        const symbolsToStrikeThrough = this.model.symbols.filter(s =>\n        {\n          return [SymbolType.Text, SymbolType.Stroke, SymbolType.Group].includes(s.type) &&\n            isBetween(s.bounds.xMid, gestureStroke.bounds.xMin, gestureStroke.bounds.xMax) &&\n            isBetween(gestureStroke.bounds.yMid, s.bounds.y + s.bounds.height / 4, s.bounds.y + s.bounds.height * 3 / 4)\n        })\n        if (symbolsToStrikeThrough.length) {\n          return {\n            gestureType: \"STRIKETHROUGH\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: symbolsToStrikeThrough.map(s => s.id),\n          }\n        }\n        return\n      }\n      case \"scratch\": {\n        const symbolsToErase = this.model.symbols.filter(s =>\n        {\n          return s.id !== gestureStroke.id &&\n            (\n              gestureStroke.bounds.overlaps(s.bounds) && [SymbolType.Stroke, SymbolType.Text, SymbolType.Group].includes(s.type) ||\n              gestureStroke.bounds.contains(s.bounds) && [SymbolType.Shape, SymbolType.Edge].includes(s.type)\n            )\n        })\n\n        if (symbolsToErase.length) {\n          return {\n            gestureType: \"SCRATCH\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: symbolsToErase.map(s => s.id),\n          }\n        }\n        return\n      }\n      case \"bottom-top\": {\n        const hasSymbolsInRow = this.model.symbols.some(s =>\n          s.id !== gestureStroke.id &&\n          [SymbolType.Text, SymbolType.Stroke, SymbolType.Group].includes(s.type) &&\n          isBetween(s.bounds.yMid, gestureStroke.bounds.yMin, gestureStroke.bounds.yMax)\n        )\n        if (hasSymbolsInRow) {\n          return {\n            gestureType: \"JOIN\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: [],\n          }\n        }\n        return\n      }\n      case \"top-bottom\": {\n        const hasSymbolsInRow = this.model.symbols.some(s =>\n          s.id !== gestureStroke.id &&\n          [SymbolType.Text, SymbolType.Stroke, SymbolType.Group].includes(s.type) &&\n          isBetween(s.bounds.yMid, gestureStroke.bounds.yMin, gestureStroke.bounds.yMax)\n        )\n        if (hasSymbolsInRow) {\n          return {\n            gestureType: \"INSERT\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: [],\n          }\n        }\n        return\n      }\n      case \"none\":\n      default:\n        return\n    }\n  }\n}\n","import { ResizeDirection, SvgElementRole } from \"../Constants\"\nimport { OIBehaviors } from \"../behaviors\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { OIModel } from \"../model\"\nimport\n{\n  Box,\n  EdgeKind,\n  OIStroke,\n  OISymbolGroup,\n  OIText,\n  ShapeKind,\n  SymbolType,\n  TOIEdge,\n  TOIShape,\n  TOISymbol,\n  TPoint\n} from \"../primitive\"\n\n/**\n * @group Manager\n */\nexport class OIResizeManager\n{\n  #logger = LoggerManager.getLogger(LoggerClass.TRANSFORMER)\n  behaviors: OIBehaviors\n\n  interactElementsGroup?: SVGElement\n  direction!: ResizeDirection\n  boundingBox!: Box\n  transformOrigin!: TPoint\n  keepRatio = false\n\n  constructor(behaviors: OIBehaviors)\n  {\n    this.#logger.info(\"constructor\")\n    this.behaviors = behaviors\n  }\n\n  get model(): OIModel\n  {\n    return this.behaviors.model\n  }\n\n  protected applyToStroke(stroke: OIStroke, origin: TPoint, scaleX: number, scaleY: number): OIStroke\n  {\n    this.#logger.debug(\"applyToStroke\", { stroke, origin, scaleX, scaleY })\n    stroke.pointers.forEach(p =>\n    {\n      p.x = +(origin.x + scaleX * (p.x - origin.x)).toFixed(3)\n      p.y = +(origin.y + scaleY * (p.y - origin.y)).toFixed(3)\n    })\n    return stroke\n  }\n\n  protected applyToShape(shape: TOIShape, origin: TPoint, scaleX: number, scaleY: number): TOIShape\n  {\n    this.#logger.debug(\"applyToShape\", { shape, origin, scaleX, scaleY })\n    switch (shape.kind) {\n      case ShapeKind.Ellipse: {\n        const cosPhi = Math.cos(shape.orientation)\n        const sinPhi = Math.sin(shape.orientation)\n        shape.center.x = +(shape.center.x + ((scaleX - 1) * cosPhi + (scaleY - 1) * sinPhi) * (shape.center.x - origin.x)).toFixed(3)\n        shape.center.y = +(shape.center.y + ((scaleX - 1) * -sinPhi + (scaleY - 1) * cosPhi) * (shape.center.y - origin.y)).toFixed(3)\n        shape.radiusX = +(Math.abs(shape.radiusX * (scaleX * cosPhi - scaleY * sinPhi))).toFixed(3)\n        shape.radiusY = +(Math.abs(shape.radiusY * (scaleX * sinPhi + scaleY * cosPhi))).toFixed(3)\n        return shape\n      }\n      case ShapeKind.Circle: {\n        shape.radius = +(shape.radius * (scaleX + scaleY) / 2).toFixed(3)\n        shape.center.x = +(origin.x + scaleX * (shape.center.x - origin.x)).toFixed(3)\n        shape.center.y = +(origin.y + scaleY * (shape.center.y - origin.y)).toFixed(3)\n        return shape\n      }\n      case ShapeKind.Polygon: {\n        shape.points.forEach(p =>\n        {\n          p.x = +(origin.x + scaleX * (p.x - origin.x)).toFixed(3)\n          p.y = +(origin.y + scaleY * (p.y - origin.y)).toFixed(3)\n        })\n        return shape\n      }\n      default:\n        throw new Error(`Can't apply resize on shape, kind unknow: ${ JSON.stringify(shape) }`)\n    }\n  }\n\n  protected applyToEdge(edge: TOIEdge, origin: TPoint, scaleX: number, scaleY: number): TOIEdge\n  {\n    this.#logger.debug(\"applyToEdge\", { edge, origin, scaleX, scaleY })\n    switch (edge.kind) {\n      case EdgeKind.Arc: {\n        const cosPhi = Math.cos(edge.phi)\n        const sinPhi = Math.sin(edge.phi)\n        edge.center.x = +(edge.center.x + ((scaleX - 1) * cosPhi + (scaleY - 1) * sinPhi) * (edge.center.x - origin.x)).toFixed(3)\n        edge.center.y = +(edge.center.y + ((scaleX - 1) * -sinPhi + (scaleY - 1) * cosPhi) * (edge.center.y - origin.y)).toFixed(3)\n        edge.radiusX = +(edge.radiusX * Math.abs(scaleX * cosPhi + scaleY * sinPhi)).toFixed(3)\n        edge.radiusY = +(edge.radiusY * Math.abs(scaleX * sinPhi + scaleY * cosPhi)).toFixed(3)\n\n        if (scaleX < 0) {\n          edge.startAngle = +(Math.PI - edge.startAngle).toFixed(3)\n          edge.sweepAngle *= -1\n        }\n        else if (scaleY < 0) {\n          edge.sweepAngle *= -1\n        }\n        return edge\n      }\n      case EdgeKind.Line: {\n        edge.start.x = +(origin.x + scaleX * (edge.start.x - origin.x)).toFixed(3)\n        edge.start.y = +(origin.y + scaleY * (edge.start.y - origin.y)).toFixed(3)\n        edge.end.x = +(origin.x + scaleX * (edge.end.x - origin.x)).toFixed(3)\n        edge.end.y = +(origin.y + scaleY * (edge.end.y - origin.y)).toFixed(3)\n        return edge\n      }\n      case EdgeKind.PolyEdge: {\n        edge.points.forEach(p =>\n        {\n          p.x = +(origin.x + scaleX * (p.x - origin.x)).toFixed(3)\n          p.y = +(origin.y + scaleY * (p.y - origin.y)).toFixed(3)\n          return p\n        })\n        return edge\n      }\n      default:\n        throw new Error(`Can't apply resize on edge, kind unknow: ${ JSON.stringify(edge) }`)\n    }\n  }\n\n  protected applyOnText(text: OIText, origin: TPoint, scaleX: number, scaleY: number): OIText\n  {\n    text.point.x = +(origin.x + scaleX * (text.point.x - origin.x)).toFixed(3)\n    text.point.y = +(origin.y + scaleY * (text.point.y - origin.y)).toFixed(3)\n\n    text.chars.forEach(c =>\n    {\n      c.fontSize = +(c.fontSize * (scaleX + scaleY) / 2).toFixed(3)\n    })\n    return this.behaviors.texter.updateBounds(text)\n  }\n\n  protected applyOnGroup(group: OISymbolGroup, origin: TPoint, scaleX: number, scaleY: number): OISymbolGroup\n  {\n    group.children.forEach(s => this.applyToSymbol(s, origin, scaleX, scaleY))\n    return group\n  }\n\n  applyToSymbol(symbol: TOISymbol, origin: TPoint, scaleX: number, scaleY: number): TOISymbol\n  {\n    this.#logger.info(\"applyToSymbol\", { symbol, scaleX, scaleY })\n    switch (symbol.type) {\n      case SymbolType.Stroke:\n        return this.applyToStroke(symbol, origin, scaleX, scaleY)\n      case SymbolType.Shape:\n        return this.applyToShape(symbol, origin, scaleX, scaleY)\n      case SymbolType.Edge:\n        return this.applyToEdge(symbol, origin, scaleX, scaleY)\n      case SymbolType.Text:\n        return this.applyOnText(symbol, origin, scaleX, scaleY)\n      case SymbolType.Group:\n        return this.applyOnGroup(symbol, origin, scaleX, scaleY)\n      default:\n        throw new Error(`Can't apply resize on symbol, type unknow: ${ JSON.stringify(symbol) }`)\n    }\n  }\n\n  setTransformOrigin(id: string, originX: number, originY: number): void\n  {\n    this.behaviors.renderer.setAttribute(id, \"transform-origin\", `${ originX }px ${ originY }px`)\n  }\n\n  scaleElement(id: string, sx: number, sy: number): void\n  {\n    this.#logger.info(\"scaleElement\", { id, sx, sy })\n    this.behaviors.renderer.setAttribute(id, \"transform\", `scale(${ sx },${ sy })`)\n  }\n\n  start(target: Element, origin: TPoint): void\n  {\n    this.#logger.info(\"start\", { target })\n    this.interactElementsGroup = (target.closest(`[role=${ SvgElementRole.InteractElementsGroup }]`) as unknown) as SVGGElement\n    this.direction = target.getAttribute(\"resize-direction\") as ResizeDirection\n\n    this.keepRatio = this.model.symbolsSelected.some(s => s.type === SymbolType.Text || (s.type === SymbolType.Shape && (s as TOIShape).kind === ShapeKind.Circle))\n\n    this.transformOrigin = origin\n    this.boundingBox = Box.createFromPoints(this.model.symbolsSelected.flatMap(s => s.vertices))\n    this.setTransformOrigin(this.interactElementsGroup!.id, this.transformOrigin.x, this.transformOrigin.y)\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.setTransformOrigin(s.id, this.transformOrigin.x, this.transformOrigin.y)\n    })\n\n    this.behaviors.selector.hideInteractElements()\n  }\n\n  continue(point: TPoint): { scaleX: number, scaleY: number }\n  {\n    this.#logger.info(\"continue\", { point })\n    if (!this.interactElementsGroup) {\n      throw new Error(\"Can't resize, you must call start before\")\n    }\n    const localPoint = point\n    const horizontalResize = [\n      ResizeDirection.East,\n      ResizeDirection.NorthEast,\n      ResizeDirection.SouthEast,\n      ResizeDirection.West,\n      ResizeDirection.NorthWest,\n      ResizeDirection.SouthWest\n    ].includes(this.direction)\n    const verticalResize = [\n      ResizeDirection.North,\n      ResizeDirection.NorthEast,\n      ResizeDirection.NorthWest,\n      ResizeDirection.South,\n      ResizeDirection.SouthEast,\n      ResizeDirection.SouthWest\n    ].includes(this.direction)\n    const { x, y } = this.behaviors.snaps.snapResize(point, horizontalResize, verticalResize)\n    localPoint.x = x\n    localPoint.y = y\n\n    let deltaX = 0, deltaY = 0\n    if ([ResizeDirection.East, ResizeDirection.NorthEast, ResizeDirection.SouthEast].includes(this.direction)) {\n      deltaX = localPoint.x - this.boundingBox.xMax\n    }\n    else if ([ResizeDirection.West, ResizeDirection.NorthWest, ResizeDirection.SouthWest].includes(this.direction)) {\n      deltaX = this.boundingBox.xMin - localPoint.x\n    }\n\n    if ([ResizeDirection.North, ResizeDirection.NorthEast, ResizeDirection.NorthWest].includes(this.direction)) {\n      deltaY = this.boundingBox.yMin - localPoint.y\n    }\n    else if ([ResizeDirection.South, ResizeDirection.SouthEast, ResizeDirection.SouthWest].includes(this.direction)) {\n      deltaY = localPoint.y - this.boundingBox.yMax\n    }\n\n    let scaleX = this.boundingBox.width ? 1 + (deltaX / this.boundingBox.width) : 1\n    let scaleY = this.boundingBox.height ? 1 + (deltaY / this.boundingBox.height) : 1\n\n    if (this.keepRatio) {\n      if ([ResizeDirection.North, ResizeDirection.South].includes(this.direction)) {\n        scaleX = scaleY\n      }\n      else if ([ResizeDirection.East, ResizeDirection.West].includes(this.direction)) {\n        scaleY = scaleX\n      }\n      else {\n        scaleX = Math.max(scaleX, scaleY)\n        scaleY = scaleX\n      }\n    }\n    this.scaleElement(this.interactElementsGroup.id, scaleX, scaleY)\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.scaleElement(s.id, scaleX, scaleY)\n    })\n    return {\n      scaleX,\n      scaleY\n    }\n  }\n\n  async end(point: TPoint): Promise<void>\n  {\n    this.#logger.info(\"end\", { point })\n    const { scaleX, scaleY } = this.continue(point)\n    this.behaviors.snaps.clearSnapToElementLines()\n    const oldSymbols = this.model.symbolsSelected.map(s => s.clone())\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.applyToSymbol(s, this.transformOrigin, scaleX, scaleY)\n      this.behaviors.renderer.drawSymbol(s)\n      this.model.updateSymbol(s)\n    })\n\n    const strokesFromSymbols = this.behaviors.extractStrokesFromSymbols(this.model.symbolsSelected)\n    this.behaviors.recognizer.transformScale(strokesFromSymbols.map(s => s.id), scaleX, scaleY, this.transformOrigin.x, this.transformOrigin.y)\n    this.behaviors.history.push(this.model, { scale: [{ symbols: oldSymbols, origin: {...this.transformOrigin}, scaleX, scaleY }] })\n\n    this.behaviors.selector.resetSelectedGroup(this.model.symbolsSelected)\n    this.interactElementsGroup = undefined\n    this.behaviors.selector.showInteractElements()\n    this.behaviors.svgDebugger.apply()\n  }\n}\n","import { SvgElementRole } from \"../Constants\"\nimport { OIBehaviors } from \"../behaviors\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { OIModel } from \"../model\"\nimport\n{\n  Box,\n  EdgeKind,\n  OIStroke,\n  OISymbolGroup,\n  OIText,\n  ShapeKind,\n  SymbolType,\n  TOIEdge,\n  TOIShape,\n  TOISymbol,\n  TPoint\n} from \"../primitive\"\nimport { computeAngleRadian, convertDegreeToRadian, convertRadianToDegree, computeRotatedPoint } from \"../utils\"\n\n/**\n * @group Manager\n */\nexport class OIRotationManager\n{\n  #logger = LoggerManager.getLogger(LoggerClass.TRANSFORMER)\n  behaviors: OIBehaviors\n  interactElementsGroup?: SVGElement\n  center!: TPoint\n  origin!: TPoint\n\n  constructor(behaviors: OIBehaviors)\n  {\n    this.#logger.info(\"constructor\")\n    this.behaviors = behaviors\n  }\n\n  get model(): OIModel\n  {\n    return this.behaviors.model\n  }\n\n  protected applyToStroke(stroke: OIStroke, center: TPoint, angleRad: number): OIStroke\n  {\n    stroke.pointers.forEach(p =>\n    {\n      const { x, y } = computeRotatedPoint(p, center, angleRad)\n      p.x = x\n      p.y = y\n    })\n    return stroke\n  }\n\n  protected applyToShape(shape: TOIShape, center: TPoint, angleRad: number): TOIShape\n  {\n    switch (shape.kind) {\n      case ShapeKind.Ellipse: {\n        shape.center = computeRotatedPoint(shape.center, center, angleRad)\n        shape.orientation = (shape.orientation + angleRad) % (2 * Math.PI)\n        return shape\n      }\n      case ShapeKind.Circle: {\n        shape.center = computeRotatedPoint(shape.center, center, angleRad)\n        return shape\n      }\n      case ShapeKind.Polygon: {\n        shape.points.forEach(p =>\n        {\n          const { x, y } = computeRotatedPoint(p, center, angleRad)\n          p.x = x\n          p.y = y\n        })\n        return shape\n      }\n      default:\n        throw new Error(`Can't apply rotate on shape, kind unknow: ${ JSON.stringify(shape) }`)\n    }\n  }\n\n  protected applyToEdge(edge: TOIEdge, center: TPoint, angleRad: number): TOIEdge\n  {\n    switch (edge.kind) {\n      case EdgeKind.Arc: {\n        edge.phi = (edge.phi - angleRad) % (2 * Math.PI)\n        edge.center = computeRotatedPoint(edge.center, center, angleRad)\n        return edge\n      }\n      case EdgeKind.Line: {\n        edge.start = computeRotatedPoint(edge.start, center, angleRad)\n        edge.end = computeRotatedPoint(edge.end, center, angleRad)\n        return edge\n      }\n      case EdgeKind.PolyEdge: {\n        edge.points = edge.points.map(p => computeRotatedPoint(p, center, angleRad))\n        return edge\n      }\n      default:\n        throw new Error(`Can't apply rotate on edge, kind unknow: ${ JSON.stringify(edge) }`)\n    }\n    return edge\n  }\n\n  protected applyOnText(text: OIText, center: TPoint, angleRad: number): OIText\n  {\n    text.rotation = {\n      degree: convertRadianToDegree(angleRad) + (text.rotation?.degree || 0),\n      center: center\n    }\n    return this.behaviors.texter.updateBounds(text)\n  }\n\n  protected applyOnGroup(group: OISymbolGroup, center: TPoint, angleRad: number): OISymbolGroup\n  {\n    group.children.forEach(s => this.applyToSymbol(s, center, angleRad))\n    return group\n  }\n\n  applyToSymbol(symbol: TOISymbol, center: TPoint, angleRad: number): TOISymbol\n  {\n    switch (symbol.type) {\n      case SymbolType.Stroke:\n        return this.applyToStroke(symbol, center, angleRad)\n      case SymbolType.Shape:\n        return this.applyToShape(symbol, center, angleRad)\n      case SymbolType.Edge:\n        return this.applyToEdge(symbol, center, angleRad)\n      case SymbolType.Text:\n        return this.applyOnText(symbol, center, angleRad)\n      case SymbolType.Group:\n        return this.applyOnGroup(symbol, center, angleRad)\n      default:\n        throw new Error(`Can't apply rotate on symbol, type unknow: ${ JSON.stringify(symbol) }`)\n    }\n  }\n\n  setTransformOrigin(id: string, originX: number, originY: number): void\n  {\n    this.behaviors.renderer.setAttribute(id, \"transform-origin\", `${ originX }px ${ originY }px`)\n  }\n\n  rotateElement(id: string, degree: number): void\n  {\n    this.#logger.info(\"rotateElement\", { id, degree })\n    this.behaviors.renderer.setAttribute(id, \"transform\", `rotate(${ degree })`)\n  }\n\n  start(target: Element, origin: TPoint): void\n  {\n    this.#logger.info(\"start\", { target })\n    this.interactElementsGroup = (target.closest(`[role=${ SvgElementRole.InteractElementsGroup }]`) as unknown) as SVGGElement\n    const boundingBox = Box.createFromPoints(this.model.symbolsSelected.flatMap(s => s.vertices))\n\n    this.center = {\n      x: boundingBox.xMin + boundingBox.width / 2,\n      y: boundingBox.yMid\n    }\n    this.origin = origin\n    this.setTransformOrigin(this.interactElementsGroup.id, this.center.x, this.center.y)\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.setTransformOrigin(s.id, this.center.x, this.center.y)\n    })\n    this.behaviors.selector.hideInteractElements()\n  }\n\n  continue(point: TPoint): number\n  {\n    this.#logger.info(\"continue\", { point })\n    if (!this.interactElementsGroup) {\n      throw new Error(\"Can't rotate, you must call start before\")\n    }\n    let angleDegree = Math.round(convertRadianToDegree(computeAngleRadian(this.origin, this.center, point)))\n\n    angleDegree = this.behaviors.snaps.snapRotation(angleDegree)\n\n    if (point.x - this.center.x < 0) {\n      angleDegree = 360 - angleDegree\n    }\n\n    this.rotateElement(this.interactElementsGroup.id, angleDegree)\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.rotateElement(s.id, angleDegree)\n    })\n    return angleDegree\n  }\n\n  async end(point: TPoint): Promise<void>\n  {\n    this.#logger.info(\"end\", { point })\n    const angleDegree = this.continue(point)\n    const angleRad = convertDegreeToRadian(angleDegree) % (2 * Math.PI)\n    const oldSymbols = this.model.symbolsSelected.map(s => s.clone())\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.applyToSymbol(s, this.center, angleRad)\n      this.behaviors.renderer.drawSymbol(s)\n      this.model.updateSymbol(s)\n    })\n    const strokesFromSymbols = this.behaviors.extractStrokesFromSymbols(this.model.symbolsSelected)\n    this.behaviors.recognizer.transformRotate(strokesFromSymbols.map(s => s.id), angleRad, this.center.x, this.center.y)\n    this.behaviors.history.push(this.model, { rotate: [{ symbols: oldSymbols, angle: angleRad, center: {...this.center}, }] })\n\n    this.behaviors.selector.resetSelectedGroup(this.model.symbolsSelected)\n    this.interactElementsGroup = undefined\n    this.behaviors.selector.showInteractElements()\n    this.behaviors.svgDebugger.apply()\n  }\n}\n","import { ResizeDirection, SELECTION_MARGIN, SvgElementRole } from \"../Constants\"\nimport { OIBehaviors } from \"../behaviors\"\nimport { InternalEvent } from \"../event\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { OIModel } from \"../model\"\nimport { Box, OIText, SymbolType, TBoundingBox, TOISymbol, TPoint } from \"../primitive\"\nimport { OISVGRenderer, SVGBuilder } from \"../renderer\"\nimport { OIResizeManager } from \"./OIResizeManager\"\nimport { OIRotationManager } from \"./OIRotationManager\"\nimport { OITranslateManager } from \"./OITranslateManager\"\n\n/**\n * @group Manager\n */\nexport class OISelectionManager\n{\n  #logger = LoggerManager.getLogger(LoggerClass.SELECTION)\n  #selectingId = \"selecting-rect\"\n  startSelectionPoint?: TPoint\n  endSelectionPoint?: TPoint\n  selectedGroup?: SVGGElement\n\n  behaviors: OIBehaviors\n\n  constructor(behaviors: OIBehaviors)\n  {\n    this.#logger.info(\"constructor\")\n    this.behaviors = behaviors\n  }\n\n  get model(): OIModel\n  {\n    return this.behaviors.model\n  }\n\n  get renderer(): OISVGRenderer\n  {\n    return this.behaviors.renderer\n  }\n\n  get internalEvent(): InternalEvent\n  {\n    return this.behaviors.internalEvent\n  }\n\n  get rotator(): OIRotationManager\n  {\n    return this.behaviors.rotator\n  }\n\n  get translator(): OITranslateManager\n  {\n    return this.behaviors.translator\n  }\n\n  get resizer(): OIResizeManager\n  {\n    return this.behaviors.resizer\n  }\n\n  get selectionBox(): Box | undefined\n  {\n    if (this.startSelectionPoint && this.endSelectionPoint) {\n      return Box.createFromPoints([this.startSelectionPoint, this.endSelectionPoint])\n    }\n    return\n  }\n\n  drawSelectingRect(box: TBoundingBox): void\n  {\n    this.clearSelectingRect()\n    const attrs = {\n      id: this.#selectingId,\n      fill: \"transparent\",\n      stroke: \"grey\",\n      opacity: \"0.25\",\n    }\n    this.renderer.appendElement(SVGBuilder.createRect(box, attrs))\n  }\n\n  clearSelectingRect(): void\n  {\n    this.renderer.clearElements({ attrs: { id: this.#selectingId } })\n  }\n\n  protected getPoint(ev: PointerEvent): TPoint\n  {\n    const { clientLeft, scrollLeft, clientTop, scrollTop } = this.renderer.parent\n    const rect: DOMRect = this.renderer.parent.getBoundingClientRect()\n    return {\n      x: ev.clientX - rect.left - clientLeft + scrollLeft,\n      y: ev.clientY - rect.top - clientTop + scrollTop,\n    }\n  }\n\n  protected createTranslateRect(box: TBoundingBox): SVGRectElement\n  {\n    const attrs = {\n      role: SvgElementRole.Translate,\n      style: \"cursor:move\",\n      fill: \"transparent\",\n      stroke: \"transparent\",\n    }\n    const boxWithMarge: TBoundingBox = {\n      height: box.height,\n      width: box.width,\n      x: box.x,\n      y: box.y\n    }\n    const translateEl = SVGBuilder.createRect(boxWithMarge, attrs)\n    const handler = (ev: PointerEvent) =>\n    {\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.translator.continue(this.getPoint(ev))\n    }\n    const endHandler = (ev: PointerEvent) =>\n    {\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.translator.end(this.getPoint(ev))\n      this.renderer.layer.removeEventListener(\"pointermove\", handler)\n      this.renderer.layer.removeEventListener(\"pointercancel\", endHandler)\n      this.renderer.layer.removeEventListener(\"pointerleave\", endHandler)\n      this.renderer.layer.removeEventListener(\"pointerup\", endHandler)\n    }\n\n    translateEl.addEventListener(\"pointerdown\", (ev) =>\n    {\n      if (ev.button !== 0 || ev.buttons !== 1) {\n        return\n      }\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.translator.start(ev.target as Element, this.getPoint(ev))\n      this.renderer.layer.addEventListener(\"pointermove\", handler)\n      this.renderer.layer.addEventListener(\"pointercancel\", endHandler)\n      this.renderer.layer.addEventListener(\"pointerleave\", endHandler)\n      this.renderer.layer.addEventListener(\"pointerup\", endHandler)\n    })\n    return translateEl\n  }\n\n  protected createRotateGroup(box: TBoundingBox): SVGGElement\n  {\n    const group = SVGBuilder.createGroup({\n      role: SvgElementRole.Rotate,\n      \"vector-effect\": \"non-scaling-size\",\n      \"style\": \"cursor:pointer;\",\n      \"opacity\": \"1\",\n    })\n    const radius = 8\n    const center: TPoint = {\n      x: (box.x + box.width / 2),\n      y: box.y - 4 * SELECTION_MARGIN\n    }\n    const attrs1 = {\n      role: SvgElementRole.Rotate,\n      \"stroke-width\": \"2\",\n      \"stroke\": \"black\",\n      fill: \"white\",\n    }\n    group.appendChild(SVGBuilder.createCircle(center, radius, attrs1))\n\n    const attrs2 = {\n      role: SvgElementRole.Rotate,\n      fill: \"black\",\n    }\n\n    group.appendChild(SVGBuilder.createCircle(center, radius / 2, attrs2))\n    const attrs3 = {\n      role: SvgElementRole.Rotate,\n      stroke: \"black\",\n      \"stroke-width\": \"2\"\n    }\n    group.appendChild(SVGBuilder.createLine({ x: center.x, y: center.y + radius }, { x: center.x, y: box.y - SELECTION_MARGIN }, attrs3))\n\n    const handler = (ev: PointerEvent) =>\n    {\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.rotator.continue(this.getPoint(ev))\n    }\n    const endHandler = (ev: PointerEvent) =>\n    {\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.rotator.end(this.getPoint(ev))\n      this.renderer.layer.removeEventListener(\"pointermove\", handler)\n      this.renderer.layer.removeEventListener(\"pointercancel\", endHandler)\n      this.renderer.layer.removeEventListener(\"pointerleave\", endHandler)\n      this.renderer.layer.removeEventListener(\"pointerup\", endHandler)\n    }\n\n    group.addEventListener(\"pointerdown\", (ev) =>\n    {\n      if (ev.button !== 0 || ev.buttons !== 1) {\n        return\n      }\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.rotator.start(ev.target as Element, this.getPoint(ev))\n      this.renderer.layer.addEventListener(\"pointermove\", handler)\n      this.renderer.layer.addEventListener(\"pointercancel\", endHandler)\n      this.renderer.layer.addEventListener(\"pointerleave\", endHandler)\n      this.renderer.layer.addEventListener(\"pointerup\", endHandler)\n    })\n    return group\n  }\n\n  protected createResizeGroup(box: TBoundingBox): SVGGElement\n  {\n    const group = SVGBuilder.createGroup({\n      role: SvgElementRole.Resize,\n      \"vector-effect\": \"non-scaling-size\",\n      \"stroke-width\": \"4\",\n      \"stroke\": \"#3e68ff\",\n    })\n    const P_NW: TPoint = { x: box.x - SELECTION_MARGIN, y: box.y - SELECTION_MARGIN }\n    const P_NE: TPoint = { x: box.x + box.width + SELECTION_MARGIN, y: box.y - SELECTION_MARGIN }\n    const P_SE: TPoint = { x: box.x + box.width + SELECTION_MARGIN, y: box.y + box.height + SELECTION_MARGIN }\n    const P_SW: TPoint = { x: box.x - SELECTION_MARGIN, y: box.y + box.height + SELECTION_MARGIN }\n\n    const bindEl = (el: SVGElement, transformOrigin: TPoint) =>\n    {\n      const handler = (ev: PointerEvent) =>\n      {\n        ev.preventDefault()\n        ev.stopPropagation()\n        this.resizer.continue(this.getPoint(ev))\n      }\n      const endHandler = (ev: PointerEvent) =>\n      {\n        ev.preventDefault()\n        ev.stopPropagation()\n        this.resizer.end(this.getPoint(ev))\n        this.renderer.layer.removeEventListener(\"pointermove\", handler)\n        this.renderer.layer.removeEventListener(\"pointercancel\", endHandler)\n        this.renderer.layer.removeEventListener(\"pointerleave\", endHandler)\n        this.renderer.layer.removeEventListener(\"pointerup\", endHandler)\n      }\n\n      el.addEventListener(\"pointerdown\", (ev) =>\n      {\n        if (ev.button !== 0 || ev.buttons !== 1) {\n          return\n        }\n        ev.preventDefault()\n        ev.stopPropagation()\n        this.resizer.start(ev.target as Element, transformOrigin)\n        this.renderer.layer.addEventListener(\"pointermove\", handler)\n        this.renderer.layer.addEventListener(\"pointercancel\", endHandler)\n        this.renderer.layer.addEventListener(\"pointerleave\", endHandler)\n        this.renderer.layer.addEventListener(\"pointerup\", endHandler)\n      })\n    }\n\n    const sideResizeDefs = [\n      { direction: ResizeDirection.North, p1: P_NW, p2: P_NE, transformOrigin: { x: box.x + box.width / 2, y: box.y + box.height } },\n      { direction: ResizeDirection.East, p1: P_NE, p2: P_SE, transformOrigin: { x: box.x, y: box.y + box.height / 2 } },\n      { direction: ResizeDirection.South, p1: P_SW, p2: P_SE, transformOrigin: { x: box.x + box.width / 2, y: box.y } },\n      { direction: ResizeDirection.West, p1: P_NW, p2: P_SW, transformOrigin: { x: box.x + box.width, y: box.y + box.height / 2 } },\n    ]\n    sideResizeDefs.forEach(def =>\n    {\n      const attrs = {\n        role: SvgElementRole.Resize,\n        \"resize-direction\": def.direction,\n        \"transform-origin\": JSON.stringify(def.transformOrigin),\n        style: `cursor:${ def.direction };`\n      }\n      const lineResize = SVGBuilder.createLine(def.p1, def.p2, attrs)\n      bindEl(lineResize, def.transformOrigin)\n      group.appendChild(lineResize)\n    })\n    const cornerResizeDefs = [\n      { direction: ResizeDirection.NorthWest, p: P_NW, transformOrigin: { x: box.x + box.width, y: box.y + box.height } },\n      { direction: ResizeDirection.NorthEast, p: P_NE, transformOrigin: { x: box.x, y: box.y + box.height } },\n      { direction: ResizeDirection.SouthEast, p: P_SE, transformOrigin: { x: box.x, y: box.y } },\n      { direction: ResizeDirection.SouthWest, p: P_SW, transformOrigin: { x: box.x + box.width, y: box.y } },\n    ]\n    cornerResizeDefs.forEach(def =>\n    {\n      const attrs = {\n        \"stroke-width\": \"4\",\n        role: SvgElementRole.Resize,\n        \"resize-direction\": def.direction,\n        \"transform-origin\": JSON.stringify(def.transformOrigin),\n        transform: \"scale(1, 1)\",\n        fill: \"white\",\n        style: `cursor:${ def.direction };`\n      }\n      const cornerResize = SVGBuilder.createCircle(def.p, 5, attrs)\n      bindEl(cornerResize, def.transformOrigin)\n      group.appendChild(cornerResize)\n    })\n    return group\n  }\n\n  protected createInteractElementsGroup(symbols: TOISymbol[]): SVGGElement | undefined\n  {\n    this.#logger.info(\"createInteractElementsGroup\", { symbols })\n\n    if (!symbols.length) return\n\n    const symbolElementMap = symbols.map(s =>\n    {\n      return {\n        symbol: s,\n        element: this.renderer.getElementById(s.id),\n      }\n    })\n\n    const box1 = Box.createFromBoxes(symbols.map(s =>\n    {\n      return {\n        x: s.bounds.x - (s.style.width || 1),\n        y: s.bounds.y - (s.style.width || 1),\n        height: s.bounds.height + (s.style.width || 1) * 2,\n        width: s.bounds.width + (s.style.width || 1) * 2,\n      }\n    }))\n\n    const box2 = Box.createFromPoints(symbols.flatMap(s => s.vertices))\n    const box = Box.createFromBoxes([box1, box2])\n\n    const attrs = {\n      id: `selected-${ Date.now() }`,\n      role: SvgElementRole.InteractElementsGroup,\n    }\n    const surroundGroup = SVGBuilder.createGroup(attrs)\n    surroundGroup.appendChild(this.createTranslateRect(box))\n    surroundGroup.appendChild(this.createResizeGroup(box))\n    surroundGroup.appendChild(this.createRotateGroup(box))\n    const SURROUND_ATTRS = {\n      style: \"pointer-events: none\",\n      fill: \"transparent\",\n      stroke: \"#3e68ff\",\n      \"stroke-width\": \"1\",\n      \"stroke-dasharray\": \"4\",\n      \"vector-effect\": \"non-scaling-size\",\n      transform: \"rotate(0, 0, 0)\"\n    }\n    symbolElementMap.forEach(s =>\n    {\n      if (s.element) {\n        const bounds: TBoundingBox = {\n          x: s.symbol.bounds.x - (s.symbol.style.width || 1),\n          y: s.symbol.bounds.y - (s.symbol.style.width || 1),\n          height: s.symbol.bounds.height + (s.symbol.style.width || 1) * 2,\n          width: s.symbol.bounds.width + (s.symbol.style.width || 1) * 2,\n        }\n        if (s.symbol.type === SymbolType.Text) {\n          const t = s.symbol as OIText\n          SURROUND_ATTRS.transform = `rotate(${ t.rotation?.degree || 0 }, ${ t.rotation?.center.x || 0 }, ${ t.rotation?.center.y || 0 })`\n        }\n        else {\n          SURROUND_ATTRS.transform = \"rotate(0, 0, 0)\"\n        }\n        surroundGroup.prepend(SVGBuilder.createRect(bounds, SURROUND_ATTRS))\n      }\n    })\n    return surroundGroup\n  }\n\n  drawSelectedGroup(symbols: TOISymbol[]): void\n  {\n    if (!symbols.length) return\n    this.selectedGroup = this.createInteractElementsGroup(symbols)\n    if (this.selectedGroup) {\n      this.renderer.layer.appendChild(this.selectedGroup)\n      const groupBox = this.selectedGroup.getBBox()\n      this.behaviors.menu.context.position.x = groupBox.x + groupBox.width / 2 - this.renderer.parent.clientLeft\n      this.behaviors.menu.context.position.y = groupBox.y + groupBox.height - this.renderer.parent.clientTop\n      this.behaviors.menu.context.show()\n    }\n    this.behaviors.menu.update()\n  }\n\n  resetSelectedGroup(symbols: TOISymbol[]): void\n  {\n    this.#logger.info(\"resetSelectedGroup\", { symbols })\n    this.removeSelectedGroup()\n    this.drawSelectedGroup(symbols)\n  }\n\n  removeSelectedGroup(): void\n  {\n    this.#logger.info(\"removeSelectedGroup\")\n    this.behaviors.menu.context.hide()\n    this.selectedGroup?.remove()\n    this.selectedGroup = undefined\n  }\n\n  hideInteractElements(): void\n  {\n    this.behaviors.menu.context.hide()\n    const query = `[role=${ SvgElementRole.Resize }],[role=${ SvgElementRole.Rotate }],[role=${ SvgElementRole.Translate }]`\n    this.selectedGroup?.querySelectorAll(query)\n      .forEach(el =>\n      {\n        el.setAttribute(\"visibility\", \"hidden\")\n      })\n  }\n\n  showInteractElements(): void\n  {\n    this.behaviors.menu.context.show()\n    const query = `[role=${ SvgElementRole.Resize }],[role=${ SvgElementRole.Rotate }],[role=${ SvgElementRole.Translate }]`\n    this.selectedGroup?.querySelectorAll(query)\n      .forEach(el => el.setAttribute(\"visibility\", \"visible\"))\n  }\n\n  start(point: TPoint): void\n  {\n    this.startSelectionPoint = point\n    this.endSelectionPoint = point\n    this.drawSelectingRect(this.selectionBox!)\n  }\n\n  continue(point: TPoint): TOISymbol[]\n  {\n    if (!this.startSelectionPoint) {\n      throw new Error(\"You need to call startSelectionByBox before\")\n    }\n    this.endSelectionPoint = point\n    const updatedSymbols: TOISymbol[] = []\n    this.model.symbols.forEach(s =>\n    {\n      if (s.selected !== s.overlaps(this.selectionBox!)) {\n        s.selected = s.overlaps(this.selectionBox!)\n        updatedSymbols.push(s)\n        this.renderer.drawSymbol(s)\n      }\n    })\n    this.drawSelectingRect(this.selectionBox!)\n    return updatedSymbols\n  }\n\n  end(point: TPoint): TOISymbol[]\n  {\n    this.endSelectionPoint = point\n    const updatedSymbols = this.continue(point)\n    this.startSelectionPoint = undefined\n    this.endSelectionPoint = undefined\n    this.clearSelectingRect()\n    this.drawSelectedGroup(this.model.symbolsSelected)\n    this.internalEvent.emitSelected(this.model.symbolsSelected)\n    this.behaviors.menu.style.update()\n    return updatedSymbols\n  }\n}\n","import { OIBehaviors } from \"../behaviors\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { OIModel } from \"../model\"\nimport { Box, TPoint, TSegment } from \"../primitive\"\nimport { OISVGRenderer } from \"../renderer\"\nimport { OISVGRendererConst } from \"../renderer/svg/OISVGRendererConst\"\n\n/**\n * @group Snap\n */\nexport type TSnapNudge = TPoint\n\n/**\n * @group Snap\n */\nexport type TSnapLineInfos = {\n  nudge: TSnapNudge,\n  verticales: TSegment[]\n  horizontales: TSegment[]\n}\n\n/**\n * @group Manager\n */\nexport class OISnapManager\n{\n  #logger = LoggerManager.getLogger(LoggerClass.CONVERTER)\n  behaviors: OIBehaviors\n  snapToGrid: boolean\n  snapToElement: boolean\n  snapAngle: number\n\n  constructor(behaviors: OIBehaviors, options?: { grid?: boolean, element?: boolean, angle?: number })\n  {\n    this.#logger.info(\"constructor\")\n    this.behaviors = behaviors\n    this.snapToElement = options?.element !== undefined ? options.element : true\n    this.snapToGrid = options?.grid !== undefined ? options.grid : true\n    this.snapAngle = options?.angle !== undefined ? options.angle : 0\n  }\n\n  get model(): OIModel\n  {\n    return this.behaviors.model\n  }\n\n  get renderer(): OISVGRenderer\n  {\n    return this.behaviors.renderer\n  }\n\n  get selectionSnapPoints(): TPoint[]\n  {\n    return Box.createFromPoints(this.model.symbolsSelected.flatMap(s => s.snapPoints)).snapPoints\n  }\n\n  get otherSnapPoints(): TPoint[]\n  {\n    const selectSymbolIds = this.model.symbolsSelected.map(s => s.id)\n    return this.model.symbols.filter(s => !selectSymbolIds.includes(s.id)).flatMap(s => s.snapPoints)\n  }\n\n  get snapThreshold(): number\n  {\n    return this.behaviors.configuration.rendering.guides.gap / 2\n  }\n\n  protected getNearestVerticalGuide(x: number): number\n  {\n    if (this.renderer.verticalGuides.length) {\n      return this.renderer.verticalGuides.reduce((prev, curr) =>\n      {\n        return (Math.abs(curr - x) < Math.abs(prev - x) ? curr : prev)\n      })\n    }\n    return x\n  }\n\n  protected getNearestHorizontalGuide(y: number): number\n  {\n    if (this.renderer.horizontalGuides.length) {\n      return this.renderer.horizontalGuides.reduce((prev, curr) =>\n      {\n        return (Math.abs(curr - y) < Math.abs(prev - y) ? curr : prev)\n      })\n    }\n    return y\n  }\n\n  protected getGuidePointToSnap(point: TPoint): TPoint\n  {\n    return {\n      x: this.getNearestVerticalGuide(point.x),\n      y: this.getNearestHorizontalGuide(point.y)\n    }\n  }\n\n  drawSnapToElementLines(lines: TSegment[]): void\n  {\n    const attrs = {\n      role: \"snap-to-element\",\n      fill: \"transparent\",\n      stroke: \"blue\",\n      \"stroke-width\": \"2\",\n      style: OISVGRendererConst.noSelection,\n      \"marker-start\": `url(#${ OISVGRendererConst.crossMarker })`,\n      \"marker-end\": `url(#${ OISVGRendererConst.crossMarker })`\n    }\n    lines.forEach(seg =>\n    {\n      this.renderer.drawLine(seg.p1, seg.p2, attrs)\n    })\n  }\n\n  clearSnapToElementLines(): void\n  {\n    this.renderer.clearElements({ attrs: { role: \"snap-to-element\" } })\n  }\n\n  protected getSnapLinesInfos(sourcePoints: TPoint[], targetPoints: TPoint[]): TSnapLineInfos\n  {\n    const infos: TSnapLineInfos = {\n      nudge: {\n        x: Infinity,\n        y: Infinity\n      },\n      verticales: [],\n      horizontales: [],\n    }\n    if (!sourcePoints.length || !targetPoints.length) return infos\n\n    sourcePoints.forEach(p1 =>\n    {\n      targetPoints.forEach(p2 =>\n      {\n        if (this.snapThreshold > Math.abs(p2.x - p1.x)) {\n          if (Math.abs(infos.nudge.x) > Math.abs(p2.x - p1.x)) {\n            infos.nudge.x = p2.x - p1.x\n            infos.verticales = [{ p1: { ...p1 }, p2 }]\n          }\n          else if (infos.nudge.x === p2.x - p1.x) {\n            infos.verticales.push({ p1: { ...p1 }, p2 })\n          }\n        }\n        if (this.snapThreshold > Math.abs(p2.y - p1.y)) {\n          if (Math.abs(infos.nudge.y) > Math.abs(p2.y - p1.y)) {\n            infos.nudge.y = p2.y - p1.y\n            infos.horizontales = [{ p1: { ...p1 }, p2 }]\n          }\n          else if (infos.nudge.y === p2.y - p1.y) {\n            infos.horizontales.push({ p1: { ...p1 }, p2 })\n          }\n        }\n      })\n    })\n\n    return infos\n  }\n\n  snapResize(point: TPoint, horizontal = true, vertical = true): TPoint\n  {\n    this.clearSnapToElementLines()\n    if (!this.snapToElement && !this.snapToGrid) return point\n\n    let localPoint: TPoint = {\n      x: Infinity,\n      y: Infinity\n    }\n    if (this.snapToGrid) {\n      localPoint = this.getGuidePointToSnap(point)\n    }\n    const snapLines: TSegment[] = []\n\n    if (this.snapToElement) {\n      const snapLinesInfos = this.getSnapLinesInfos([point], this.otherSnapPoints)\n      if (horizontal && Math.abs(snapLinesInfos.nudge.x) <= Math.abs(point.x - localPoint.x)) {\n        localPoint.x = point.x + snapLinesInfos.nudge.x\n        snapLines.push(...snapLinesInfos.verticales)\n      }\n      if (vertical && Math.abs(snapLinesInfos.nudge.y) <= Math.abs(point.y - localPoint.y)) {\n        localPoint.y = point.y + snapLinesInfos.nudge.y\n        snapLines.push(...snapLinesInfos.horizontales)\n      }\n    }\n\n    if (localPoint.x === Infinity) localPoint.x = point.x\n    if (localPoint.y === Infinity) localPoint.y = point.y\n\n    snapLines.forEach(s => s.p1 = localPoint)\n    this.drawSnapToElementLines(snapLines)\n    return localPoint\n  }\n\n  snapTranslate(tx: number, ty: number): TSnapNudge\n  {\n    this.clearSnapToElementLines()\n    const nudge: TSnapNudge = { x: tx, y: ty }\n    if (!this.snapToElement && !this.snapToGrid) return nudge\n\n    const selectionSymbolPoints = this.selectionSnapPoints.map(p => ({ x: p.x + tx, y: p.y + ty }))\n\n    let lastDeltaX = Infinity\n    let lastDeltaY = Infinity\n\n    if (this.snapToGrid) {\n      selectionSymbolPoints.forEach(p =>\n      {\n        const gridPoint = this.getGuidePointToSnap(p)\n        if (lastDeltaX > Math.abs(gridPoint.x - p.x)) {\n          nudge.x = gridPoint.x - p.x + tx\n          lastDeltaX = Math.abs(gridPoint.x - p.x)\n        }\n        if (lastDeltaY > Math.abs(gridPoint.y - p.y)) {\n          nudge.y = gridPoint.y - p.y + ty\n          lastDeltaY = Math.abs(gridPoint.y - p.y)\n        }\n      })\n    }\n\n    const snapLines: TSegment[] = []\n    if (this.snapToElement) {\n      const snapLinesInfos = this.getSnapLinesInfos(selectionSymbolPoints, this.otherSnapPoints)\n      if (lastDeltaX >= Math.abs(snapLinesInfos.nudge.x) && snapLinesInfos.verticales.length) {\n        nudge.x = snapLinesInfos.nudge.x + tx\n        snapLines.push(...snapLinesInfos.verticales)\n      }\n      if (lastDeltaY >= Math.abs(snapLinesInfos.nudge.y) && snapLinesInfos.horizontales.length) {\n        nudge.y = snapLinesInfos.nudge.y + ty\n        snapLines.push(...snapLinesInfos.horizontales)\n      }\n    }\n    if (snapLines.length) {\n      snapLines.forEach(l =>\n      {\n        l.p1.x += nudge.x - tx\n        l.p1.y += nudge.y - ty\n      })\n      this.drawSnapToElementLines(snapLines)\n    }\n    return nudge\n  }\n\n  snapRotation(angleDegree: number): number\n  {\n    if (this.snapAngle > 0) {\n      return this.snapAngle * Math.round(angleDegree / this.snapAngle)\n    }\n    return angleDegree\n  }\n}\n","import { OIBehaviors } from \"../behaviors\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { OIModel } from \"../model\"\nimport { Box, OIText, SymbolType, TOISymbol, TOISymbolChar } from \"../primitive\"\nimport { OISVGRenderer } from \"../renderer\"\n\n/**\n * @group Manager\n */\nexport class OITextManager\n{\n  #logger = LoggerManager.getLogger(LoggerClass.CONVERTER)\n  behaviors: OIBehaviors\n\n  constructor(behaviors: OIBehaviors)\n  {\n    this.#logger.info(\"constructor\")\n    this.behaviors = behaviors\n  }\n\n  get renderer(): OISVGRenderer\n  {\n    return this.behaviors.renderer\n  }\n\n  get rowHeight(): number\n  {\n    return this.behaviors.configuration.rendering.guides.gap\n  }\n\n  get model(): OIModel\n  {\n    return this.behaviors.model\n  }\n\n  protected drawSymbolHidden(text: OIText): SVGGElement\n  {\n    const clone = text.clone()\n    clone.id = \"text-to-measure\"\n    clone.chars.forEach(c => c.id += \"to-measure\")\n    this.renderer.layer.querySelector(`#${ clone.id }`)?.remove()\n    const el = this.renderer.buildElementFromSymbol(clone)!\n    el.setAttribute(\"visibility\", \"hidden\")\n    this.renderer.prependElement(el)\n    return el\n  }\n\n  setCharsBounds(text: OIText, textGroupEl: SVGGElement): OIText\n  {\n    const textEl = textGroupEl.querySelector(\"text\")\n    if (textEl) {\n      for (let i = 0; i < textEl.getNumberOfChars(); i++) {\n        const char = text.chars.at(i)\n        if (char) {\n          const ext = textEl.getExtentOfChar(i)\n          char.bounds = new Box(ext)\n        }\n      }\n    }\n    return text\n  }\n\n  setBounds(text: OIText): void\n  {\n    const element = this.drawSymbolHidden(text)\n    text.bounds = this.getElementBoundingBox(element)\n    this.setCharsBounds(text, element)\n  }\n\n  getElementBoundingBox(textElement: SVGElement): Box\n  {\n    return new Box(textElement.querySelector(\"text\")!.getBBox({ stroke: true, markers: true, clipped: true, fill: true }))\n  }\n\n  getBoundingBox(text: OIText): Box\n  {\n    const element = this.drawSymbolHidden(text)\n    return this.getElementBoundingBox(element)\n  }\n\n  getSpaceWidth(fontSize: number): number\n  {\n    const boundingBox = new Box({ height: 0, width: 0, x: 0, y: 0 })\n    const charSymbol: TOISymbolChar = {\n      id: `text-char-space`,\n      label: \"-\",\n      color: \"\",\n      fontSize,\n      fontWeight: \"normal\",\n      bounds: boundingBox\n    }\n    return this.getBoundingBox(new OIText([charSymbol], { x: 0, y: 0 }, boundingBox))?.width as number\n  }\n\n  updateBounds(textSymbol: OIText): OIText\n  {\n    this.setBounds(textSymbol)\n    this.model.updateSymbol(textSymbol)\n    return textSymbol\n  }\n\n  moveTextAfter(text: OIText, tx: number): TOISymbol[] | undefined\n  {\n    const row = this.model.getSymbolsByRowOrdered().find(r => r.rowIndex === this.model.getSymbolRowIndex(text))\n    if (row) {\n      const textsAfter = row.symbols.filter(s => s.type === SymbolType.Text && s.bounds.xMid > text.bounds.xMid) as OIText[]\n      textsAfter.forEach(symbol => {\n        symbol.point.x += tx\n        this.updateBounds(symbol)\n        this.model.updateSymbol(symbol)\n        this.renderer.drawSymbol(symbol)\n      })\n      return textsAfter\n    }\n    return\n  }\n}\n","import { SvgElementRole } from \"../Constants\"\nimport { OIBehaviors } from \"../behaviors\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { OIModel } from \"../model\"\nimport\n{\n  EdgeKind,\n  OIStroke,\n  OIText,\n  OISymbolGroup,\n  ShapeKind,\n  SymbolType,\n  TOIEdge,\n  TOIShape,\n  TOISymbol,\n  TPoint\n} from \"../primitive\"\n\n/**\n * @group Manager\n */\nexport class OITranslateManager\n{\n  #logger = LoggerManager.getLogger(LoggerClass.TRANSFORMER)\n  behaviors: OIBehaviors\n  interactElementsGroup?: SVGElement\n  transformOrigin!: TPoint\n\n  constructor(behaviors: OIBehaviors)\n  {\n    this.#logger.info(\"constructor\")\n    this.behaviors = behaviors\n  }\n\n  get model(): OIModel\n  {\n    return this.behaviors.model\n  }\n\n  protected applyToStroke(stroke: OIStroke, tx: number, ty: number): OIStroke\n  {\n    stroke.pointers.forEach(p =>\n    {\n      p.x += tx\n      p.y += ty\n    })\n    return stroke\n  }\n\n  protected applyToShape(shape: TOIShape, tx: number, ty: number): TOIShape\n  {\n    switch (shape.kind) {\n      case ShapeKind.Ellipse:\n      case ShapeKind.Circle: {\n        shape.center.x += tx\n        shape.center.y += ty\n        return shape\n      }\n      case ShapeKind.Polygon: {\n        shape.points.forEach(p =>\n        {\n          p.x += tx\n          p.y += ty\n        })\n        return shape\n      }\n      default:\n        throw new Error(`Can't apply translate on shape, kind unknow: ${ JSON.stringify(shape) }`)\n    }\n  }\n\n  protected applyToEdge(edge: TOIEdge, tx: number, ty: number): TOIEdge\n  {\n    switch (edge.kind) {\n      case EdgeKind.Arc: {\n        edge.center.x += tx\n        edge.center.y += ty\n        return edge\n      }\n      case EdgeKind.Line: {\n        edge.start.x += tx\n        edge.start.y += ty\n        edge.end.x += tx\n        edge.end.y += ty\n        return edge\n      }\n      case EdgeKind.PolyEdge: {\n        edge.points.forEach(p =>\n        {\n          p.x += tx\n          p.y += ty\n        })\n        return edge\n      }\n    }\n\n    return edge\n  }\n\n  protected applyOnText(text: OIText, tx: number, ty: number): OIText\n  {\n    if (text.rotation) {\n      text.rotation.center = { x: text.rotation.center.x + tx, y: text.rotation.center.y + ty }\n    }\n    text.point.x += tx\n    text.point.y += ty\n    return this.behaviors.texter.updateBounds(text)\n  }\n\n  protected applyOnGroup(group: OISymbolGroup, tx: number, ty: number): OISymbolGroup\n  {\n    group.children.forEach(s => this.applyToSymbol(s, tx, ty))\n    return group\n  }\n\n  applyToSymbol(symbol: TOISymbol, tx: number, ty: number): TOISymbol\n  {\n    this.#logger.info(\"applyToSymbol\", { symbol, tx, ty })\n    switch (symbol.type) {\n      case SymbolType.Stroke:\n        return this.applyToStroke(symbol, tx, ty)\n      case SymbolType.Shape:\n        return this.applyToShape(symbol, tx, ty)\n      case SymbolType.Edge:\n        return this.applyToEdge(symbol, tx, ty)\n      case SymbolType.Text:\n        return this.applyOnText(symbol, tx, ty)\n      case SymbolType.Group:\n        return this.applyOnGroup(symbol, tx, ty)\n      default:\n        throw new Error(`Can't apply translate on symbol, type unknow: ${ JSON.stringify(symbol) }`)\n    }\n  }\n\n  translate(symbols: TOISymbol[], tx: number, ty: number, addToHistory = true): Promise<void>\n  {\n    this.#logger.info(\"translate\", { symbols, tx, ty })\n    symbols.forEach(s =>\n    {\n      this.applyToSymbol(s, tx, ty)\n      this.model.updateSymbol(s)\n      this.behaviors.renderer.drawSymbol(s)\n    })\n    if (addToHistory) {\n      this.behaviors.history.push(this.model, { translate: [{ symbols: this.model.symbolsSelected, tx, ty }] })\n    }\n    const strokes = this.behaviors.extractStrokesFromSymbols(symbols)\n    return this.behaviors.recognizer.transformTranslate(strokes.map(s => s.id), tx, ty)\n  }\n\n  translateElement(id: string, tx: number, ty: number): void\n  {\n    this.#logger.info(\"translateElement\", { id, tx, ty })\n    this.behaviors.renderer.setAttribute(id, \"transform\", `translate(${ tx },${ ty })`)\n  }\n\n  start(target: Element, origin: TPoint): void\n  {\n    this.#logger.info(\"start\", { origin })\n    this.interactElementsGroup = (target.closest(`[role=${ SvgElementRole.InteractElementsGroup }]`) as unknown) as SVGGElement\n    this.transformOrigin = origin\n    this.behaviors.selector.hideInteractElements()\n  }\n\n  continue(point: TPoint): { tx: number, ty: number }\n  {\n    this.#logger.info(\"continue\", { point })\n    if (!this.interactElementsGroup) {\n      throw new Error(\"Can't translate, you must call start before\")\n    }\n\n    let tx = point.x - this.transformOrigin.x\n    let ty = point.y - this.transformOrigin.y\n\n    const nudge = this.behaviors.snaps.snapTranslate(tx, ty)\n    tx = nudge.x\n    ty = nudge.y\n\n    this.translateElement(this.interactElementsGroup.id as string, tx, ty)\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.translateElement(s.id as string, tx, ty)\n    })\n    return {\n      tx,\n      ty\n    }\n  }\n\n  async end(point: TPoint): Promise<void>\n  {\n    this.#logger.info(\"end\", { point })\n    const { tx, ty } = this.continue(point)\n    this.behaviors.snaps.clearSnapToElementLines()\n    this.translate(this.model.symbolsSelected, tx, ty)\n\n    this.behaviors.selector.resetSelectedGroup(this.model.symbolsSelected)\n    this.interactElementsGroup = undefined\n    this.behaviors.svgDebugger.apply()\n  }\n\n}\n","import { SELECTION_MARGIN, WriteTool } from \"../Constants\"\nimport { OIBehaviors } from \"../behaviors\"\nimport { TGesture } from \"../gesture\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { OIModel } from \"../model\"\nimport\n{\n  EdgeDecoration,\n  EdgeKind,\n  OIEdgeLine,\n  OIShapePolygon,\n  OIShapeCircle,\n  OIShapeEllipse,\n  OIStroke,\n  SymbolType,\n  TOIEdge,\n  TOISymbol,\n  TPoint,\n  TPointer,\n  Box\n} from \"../primitive\"\nimport { OIRecognizer } from \"../recognizer\"\nimport { OISVGRenderer } from \"../renderer\"\nimport { TStyle } from \"../style\"\nimport { OIHistoryManager } from \"../history\"\nimport { OIGestureManager } from \"./OIGestureManager\"\nimport { OISnapManager } from \"./OISnapManager\"\n\n\n/**\n * @group Manager\n */\nexport class OIWriteManager\n{\n  #logger = LoggerManager.getLogger(LoggerClass.WRITE)\n  behaviors: OIBehaviors\n\n  #tool: WriteTool = WriteTool.Pencil\n  detectGesture: boolean = true\n\n  currentSymbolOrigin?: TPoint\n\n  constructor(behaviors: OIBehaviors)\n  {\n    this.#logger.info(\"constructor\")\n    this.behaviors = behaviors\n  }\n\n  get tool(): WriteTool\n  {\n    return this.#tool\n  }\n  set tool(wt: WriteTool)\n  {\n    this.#tool = wt\n    if (wt !== WriteTool.Pencil) {\n      this.renderer.parent.classList.add(\"shape\")\n    }\n    else {\n      this.renderer.parent.classList.remove(\"shape\")\n    }\n    this.behaviors.unselectAll()\n  }\n\n  get model(): OIModel\n  {\n    return this.behaviors.model\n  }\n\n  get renderer(): OISVGRenderer\n  {\n    return this.behaviors.renderer\n  }\n\n  get history(): OIHistoryManager\n  {\n    return this.behaviors.history\n  }\n\n  get gestureManager(): OIGestureManager\n  {\n    return this.behaviors.gesture\n  }\n\n  get snaps(): OISnapManager\n  {\n    return this.behaviors.snaps\n  }\n\n  get recognizer(): OIRecognizer\n  {\n    return this.behaviors.recognizer\n  }\n\n  protected needContextLessGesture(stroke: OIStroke): boolean\n  {\n    const strokeBoundsWithMargin = new Box(stroke.bounds)\n    strokeBoundsWithMargin.x -= SELECTION_MARGIN\n    strokeBoundsWithMargin.y -= SELECTION_MARGIN\n    strokeBoundsWithMargin.width += 2 * SELECTION_MARGIN\n    strokeBoundsWithMargin.height += 2 * SELECTION_MARGIN\n    return this.detectGesture && this.model.symbols.some(s =>\n    {\n      switch (s.type) {\n        case SymbolType.Stroke:\n          return false\n        case SymbolType.Group:\n          if (s.containsOnlyStroke()) {\n            return false\n          }\n          else {\n            return s.extractSymbols().some(subS => subS.bounds.overlaps(strokeBoundsWithMargin))\n          }\n        default:\n          return s.bounds.overlaps(strokeBoundsWithMargin)\n      }\n    })\n  }\n\n  protected createCurrentSymbol(pointer: TPointer, style: TStyle, pointerType: string): TOISymbol\n  {\n    this.#logger.debug(\"createCurrentSymbol\", { pointer, style, pointerType })\n\n    switch (this.tool) {\n      case WriteTool.Pencil:\n        this.model.currentSymbol = new OIStroke(style, pointerType)\n        break\n      case WriteTool.Rectangle:\n        this.model.currentSymbol = OIShapePolygon.createRectangleBetweenPoints(pointer, pointer, style)\n        break\n      case WriteTool.Triangle:\n        this.model.currentSymbol = OIShapePolygon.createTriangleBetweenPoints(pointer, pointer, style)\n        break\n      case WriteTool.Parallelogram:\n        this.model.currentSymbol = OIShapePolygon.createParallelogramBetweenPoints(pointer, pointer, style)\n        break\n      case WriteTool.Rhombus:\n        this.model.currentSymbol = OIShapePolygon.createRhombusBetweenPoints(pointer, pointer, style)\n        break\n      case WriteTool.Circle:\n        this.model.currentSymbol = OIShapeCircle.createBetweenPoints(pointer, pointer, style)\n        break\n      case WriteTool.Ellipse:\n        this.model.currentSymbol = OIShapeEllipse.createBetweenPoints(pointer, pointer, style)\n        break\n      case WriteTool.Line:\n      case WriteTool.Arrow:\n      case WriteTool.DoubleArrow: {\n        let startDecoration, endDecoration\n        if (this.tool === WriteTool.Arrow) {\n          endDecoration = EdgeDecoration.Arrow\n        }\n        else if (this.tool === WriteTool.DoubleArrow) {\n          startDecoration = EdgeDecoration.Arrow\n          endDecoration = EdgeDecoration.Arrow\n        }\n        this.model.currentSymbol = new OIEdgeLine(pointer, pointer, startDecoration, endDecoration, style)\n        break\n      }\n      default:\n        throw new Error(`Can't create symbol, tool is unknow: \"${ this.tool }\"`)\n    }\n    return this.updateCurrentSymbol(pointer)\n  }\n\n  protected updateCurrentSymbolShape(pointer: TPointer): void\n  {\n    switch (this.tool) {\n      case WriteTool.Rectangle:\n        OIShapePolygon.updateRectangleBetweenPoints(this.model.currentSymbol as OIShapePolygon, this.currentSymbolOrigin!, pointer)\n        break\n      case WriteTool.Triangle:\n        OIShapePolygon.updateTriangleBetweenPoints(this.model.currentSymbol as OIShapePolygon, this.currentSymbolOrigin!, pointer)\n        break\n      case WriteTool.Parallelogram:\n        OIShapePolygon.updateParallelogramBetweenPoints(this.model.currentSymbol as OIShapePolygon, this.currentSymbolOrigin!, pointer)\n        break\n      case WriteTool.Rhombus:\n        OIShapePolygon.updateRhombusBetweenPoints(this.model.currentSymbol as OIShapePolygon, this.currentSymbolOrigin!, pointer)\n        break\n      case WriteTool.Circle:\n        OIShapeCircle.updateBetweenPoints(this.model.currentSymbol as OIShapeCircle, this.currentSymbolOrigin!, pointer)\n        break\n      case WriteTool.Ellipse:\n        OIShapeEllipse.updateBetweenPoints(this.model.currentSymbol as OIShapeEllipse, this.currentSymbolOrigin!, pointer)\n        break\n    }\n  }\n\n  protected updateCurrentSymbolEdge(pointer: TPointer): void\n  {\n    const edge = this.model.currentSymbol as TOIEdge\n    switch (edge.kind) {\n      case EdgeKind.Line:\n        edge.end = pointer\n        break\n    }\n  }\n\n  protected updateCurrentSymbol(pointer: TPointer): TOISymbol\n  {\n    this.#logger.debug(\"updateCurrentSymbol\", { pointer })\n    if (!this.model.currentSymbol) {\n      throw new Error(\"Can't update current symbol because currentSymbol is undefined\")\n    }\n\n    switch (this.model.currentSymbol.type) {\n      case SymbolType.Stroke:\n        this.model.currentSymbol!.addPointer(pointer)\n        break\n      case SymbolType.Shape:\n        this.updateCurrentSymbolShape(pointer)\n        break\n      case SymbolType.Edge:\n        this.updateCurrentSymbolEdge(pointer)\n        break\n    }\n    return this.model.currentSymbol\n  }\n\n  start(style: TStyle, pointer: TPointer, pointerType: string): void\n  {\n    this.#logger.info(\"startWriting\", { style, pointer, pointerType })\n    const localPointer = pointer\n    if (this.tool !== WriteTool.Pencil) {\n      const { x, y } = this.snaps.snapResize(pointer)\n      localPointer.x = x\n      localPointer.y = y\n    }\n    this.currentSymbolOrigin = localPointer\n    this.createCurrentSymbol(localPointer, style, pointerType)\n    this.renderer.drawSymbol(this.model.currentSymbol!)\n  }\n\n  continue(pointer: TPointer): void\n  {\n    this.#logger.info(\"continueWriting\", { pointer })\n    const localPointer = pointer\n    if (this.tool !== WriteTool.Pencil) {\n      const { x, y } = this.snaps.snapResize(pointer)\n      localPointer.x = x\n      localPointer.y = y\n    }\n    this.updateCurrentSymbol(localPointer)\n    this.renderer.drawSymbol(this.model.currentSymbol!)\n  }\n\n  protected async interactWithBackend(stroke: OIStroke): Promise<void>\n  {\n    const localStroke = stroke.clone()\n    let gestureFromContextLess: TGesture | undefined\n    if (this.needContextLessGesture(stroke)) {\n      gestureFromContextLess = await this.gestureManager.getGestureFromContextLess(localStroke)\n    }\n    if (gestureFromContextLess) {\n      this.history.pop()\n      this.recognizer.addStrokes([localStroke], this.detectGesture)\n      this.gestureManager.apply(localStroke, gestureFromContextLess)\n    }\n    else {\n      const gesture = await this.recognizer.addStrokes([localStroke], this.detectGesture)\n      if (gesture) {\n        this.history.pop()\n        this.gestureManager.apply(this.model.getRootSymbol(gesture.gestureStrokeId) as OIStroke, gesture)\n      }\n    }\n  }\n\n  async end(pointer: TPointer): Promise<void>\n  {\n    this.#logger.info(\"finishWriting\", { pointer })\n    const localPointer = pointer\n    if (this.tool !== WriteTool.Pencil) {\n      const { x, y } = this.snaps.snapResize(pointer)\n      localPointer.x = x\n      localPointer.y = y\n    }\n    const localSymbol = this.updateCurrentSymbol(localPointer)\n    this.model.currentSymbol = undefined\n    this.currentSymbolOrigin = undefined\n    this.snaps.clearSnapToElementLines()\n\n    this.renderer.drawSymbol(localSymbol!)\n    this.model.addSymbol(localSymbol)\n    this.history.push(this.model, { added: [localSymbol] })\n\n    if (localSymbol.type === SymbolType.Stroke) {\n      await this.interactWithBackend(localSymbol)\n    }\n  }\n}\n","import { OIBehaviors } from \"../behaviors\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { OIModel } from \"../model\"\nimport { OIEraser, TPointer, TSegment } from \"../primitive\"\nimport { OISVGRenderer } from \"../renderer\"\n\n/**\n * @group Manager\n */\nexport class OIEraseManager\n{\n  #logger = LoggerManager.getLogger(LoggerClass.WRITE)\n  behaviors: OIBehaviors\n\n  currentEraser?: OIEraser\n\n  constructor(behaviors: OIBehaviors)\n  {\n    this.#logger.info(\"constructor\")\n    this.behaviors = behaviors\n  }\n\n  get model(): OIModel\n  {\n    return this.behaviors.model\n  }\n\n  get renderer(): OISVGRenderer\n  {\n    return this.behaviors.renderer\n  }\n\n  start(pointer: TPointer): void\n  {\n    this.#logger.info(\"startErase\", { pointer })\n    this.currentEraser = new OIEraser()\n    this.currentEraser.pointers.push(pointer)\n    this.renderer.drawSymbol(this.currentEraser!)\n  }\n\n  continue(pointer: TPointer): void\n  {\n    this.#logger.info(\"continueErase\", { pointer })\n    if (!this.currentEraser) {\n      throw new Error(\"Can't update current eraser because currentEraser is undefined\")\n    }\n    this.currentEraser.pointers.push(pointer)\n    this.renderer.drawSymbol(this.currentEraser)\n    const lastSeg: TSegment = {\n      p1: this.currentEraser.pointers.at(-1)!,\n      p2: this.currentEraser.pointers.at(-2)!\n    }\n    this.model.symbols.forEach(s => {\n      if (s.isIntersected(lastSeg))\n      {\n        s.deleting = true\n      }\n    })\n    this.model.symbolsToDelete.map(s => this.renderer.drawSymbol(s))\n  }\n\n  async end(pointer: TPointer): Promise<void>\n  {\n    this.#logger.info(\"finishErasing\", { pointer })\n    this.continue(pointer)\n\n    this.renderer.removeSymbol(this.currentEraser!.id)\n    this.currentEraser = undefined\n    this.behaviors.removeSymbols(this.model.symbolsToDelete.map(s => s.id))\n  }\n}\n","import { OIBehaviors } from \"../behaviors\"\nimport { LoggerManager, LoggerClass } from \"../logger\"\nimport { OIModel, JIIXEdgeKind } from \"../model\"\nimport { Box, OIText, SymbolType, TBoundingBox, TOISymbol } from \"../primitive\"\nimport { OISVGRenderer, OISVGRendererConst, SVGBuilder } from \"../renderer\"\nimport { convertBoundingBoxMillimeterToPixel, createUUID } from \"../utils\"\n\n/**\n * @group Manager\n */\nexport class OIDebugSVGManager\n{\n  #logger = LoggerManager.getLogger(LoggerClass.SVGDEBUG)\n  #snapPointsVisibility = false\n  #verticesVisibility = false\n  #boundingBoxVisibility = false\n  #recognitionBoxVisibility = false\n  #recognitionItemBoxVisibility = false\n\n  behaviors: OIBehaviors\n\n  constructor(behaviors: OIBehaviors)\n  {\n    this.#logger.info(\"constructor\")\n    this.behaviors = behaviors\n  }\n\n  get model(): OIModel\n  {\n    return this.behaviors.model\n  }\n\n  get renderer(): OISVGRenderer\n  {\n    return this.behaviors.renderer\n  }\n\n  get snapPointsVisibility(): boolean\n  {\n    return this.#snapPointsVisibility\n  }\n  set snapPointsVisibility(show: boolean)\n  {\n    this.#snapPointsVisibility = show\n    this.debugSnapPoints()\n  }\n\n  get verticesVisibility(): boolean\n  {\n    return this.#verticesVisibility\n  }\n  set verticesVisibility(show: boolean)\n  {\n    this.#verticesVisibility = show\n    this.debugVertices()\n  }\n\n  get boundingBoxVisibility(): boolean\n  {\n    return this.#boundingBoxVisibility\n  }\n  set boundingBoxVisibility(show: boolean)\n  {\n    this.#boundingBoxVisibility = show\n    this.#boundingBoxVisibility ? this.showBoundingBox() : this.hideBoundingBox()\n  }\n\n  get recognitionBoxVisibility(): boolean\n  {\n    return this.#recognitionBoxVisibility\n  }\n  set recognitionBoxVisibility(show: boolean)\n  {\n    this.#recognitionBoxVisibility = show\n    this.debugRecognitionBox()\n  }\n\n  get recognitionItemBoxVisibility(): boolean\n  {\n    return this.#recognitionItemBoxVisibility\n  }\n  set recognitionItemBoxVisibility(show: boolean)\n  {\n    this.#recognitionItemBoxVisibility = show\n    this.debugRecognitionItemBox()\n  }\n\n  protected showSnapPoints(): void\n  {\n    this.#logger.info(\"showSnapPoints\")\n    if (this.model.currentSymbol) {\n      this.model.currentSymbol.snapPoints.forEach(p => this.renderer.drawCircle(p, 2, { fill: \"blue\", \"debug\": \"snap-points\" }))\n    }\n    this.model.symbols.forEach(s => s.snapPoints.forEach(p => this.renderer.drawCircle(p, 2, { fill: \"blue\", \"debug\": \"snap-points\" })))\n  }\n  protected hideSnapPoints(): void\n  {\n    this.#logger.info(\"hideSnapPoints\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"snap-points\" } })\n  }\n  debugSnapPoints(): void\n  {\n    this.hideSnapPoints()\n    if (this.snapPointsVisibility) {\n      this.showSnapPoints()\n    }\n  }\n\n  protected showVertices(): void\n  {\n    this.#logger.info(\"showVertices\")\n    if (this.model.currentSymbol) {\n      this.model.currentSymbol.vertices.forEach(p => this.renderer.drawCircle(p, 2, { fill: \"red\", \"debug\": \"vertices\" }))\n    }\n    this.model.symbols.forEach(s => s.vertices.forEach(p => this.renderer.drawCircle(p, 2, { fill: \"red\", \"debug\": \"vertices\" })))\n  }\n  protected hideVertices(): void\n  {\n    this.#logger.info(\"hideVertices\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"vertices\" } })\n  }\n  debugVertices(): void\n  {\n    this.hideVertices()\n    if (this.verticesVisibility) {\n      this.showVertices()\n    }\n  }\n\n  protected drawBoundingBox(symbols: TOISymbol[]): void\n  {\n    const symbolAttrs = {\n      style: \"pointer-events: none\",\n      fill: \"transparent\",\n      stroke: \"red\",\n      \"stroke-width\": \"1\",\n      \"stroke-dasharray\": \"5 5\",\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"debug\": \"bounding-box\"\n    }\n    const charAttrs = {\n      style: \"pointer-events: none\",\n      fill: \"transparent\",\n      stroke: \"orange\",\n      \"stroke-width\": \"1\",\n      \"stroke-dasharray\": \"0 5 0\",\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"debug\": \"bounding-box\"\n    }\n    symbols.forEach(s =>\n    {\n      const symEl = this.renderer.getElementById(s.id)\n      if (symEl) {\n        if (s.type === SymbolType.Text) {\n          const text = s as OIText\n          let transform: string = \"\"\n          if (text.rotation) {\n            transform = `rotate(${ text.rotation.degree }, ${ text.rotation.center.x }, ${ text.rotation.center.y })`\n          }\n          text.chars.forEach(c =>\n          {\n            const ca = {\n              ...charAttrs,\n              char: c.label,\n              transform\n            }\n            symEl.insertAdjacentElement(\"beforebegin\", SVGBuilder.createRect(c.bounds, ca))\n          })\n          const sa = {\n            ...symbolAttrs,\n            symbol: s.id,\n            transform\n          }\n          symEl.insertAdjacentElement(\"beforebegin\", SVGBuilder.createRect(s.bounds, sa))\n        }\n        else {\n          const sa = {\n            ...symbolAttrs,\n            symbol: s.id,\n          }\n          symEl.insertAdjacentElement(\"beforebegin\", SVGBuilder.createRect(s.bounds, sa))\n        }\n      }\n    })\n  }\n  protected showBoundingBox(): void\n  {\n    this.#logger.info(\"showBoundingBox\")\n    if (this.model.currentSymbol) {\n      this.drawBoundingBox([this.model.currentSymbol])\n    }\n    this.drawBoundingBox(this.model.symbols)\n  }\n  protected hideBoundingBox(): void\n  {\n    this.#logger.info(\"hideBoundingBox\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"bounding-box\" } })\n  }\n  debugBoundingBox(): void\n  {\n    this.hideBoundingBox()\n    if (this.boundingBoxVisibility) {\n      this.showBoundingBox()\n    }\n  }\n\n  protected drawRecognitionBox(box: TBoundingBox, infos?: string[]): void\n  {\n    const COLOR = \"green\"\n    const TEXT_HEIGHT = 20\n    const recognitionGroup = SVGBuilder.createGroup({ \"debug\": \"recognition-box\" })\n\n    const rect = SVGBuilder.createRect(box, { fill: \"transparent\", stroke: COLOR, style: OISVGRendererConst.noSelection })\n    recognitionGroup.appendChild(rect)\n\n    const infosGroup = SVGBuilder.createGroup({ id: `infos-group-${ createUUID() }` })\n    const infoX = box.x + box.width\n    let infoY = box.y + TEXT_HEIGHT / 2\n    infos?.forEach(w =>\n    {\n      infosGroup.appendChild(SVGBuilder.createText({ x: infoX, y: infoY }, w, { stroke: COLOR, style: OISVGRendererConst.noSelection }))\n      infoY += TEXT_HEIGHT\n    })\n    recognitionGroup.appendChild(infosGroup)\n    this.renderer.layer.appendChild(recognitionGroup)\n\n    const infosGroupBox = infosGroup.getBBox()\n    const rectBox = {\n      width: infosGroupBox.width + 10,\n      height: infosGroupBox.height + 10,\n      x: infosGroupBox.x - 5,\n      y: infosGroupBox.y - 5,\n    }\n    const rectTranslate = SVGBuilder.createRect(rectBox, { fill: \"white\", style: \"cursor:move\", stroke: COLOR })\n    infosGroup.prepend(rectTranslate)\n\n    const translateEl = (e: PointerEvent) =>\n    {\n      e.preventDefault()\n      e.stopPropagation()\n      const originX = Number(this.renderer.getAttribute(infosGroup.id, \"originX\"))\n      const originY = Number(this.renderer.getAttribute(infosGroup.id, \"originY\"))\n      const tx = e.clientX - originX\n      const ty = e.clientY - originY\n      this.renderer.setAttribute(infosGroup.id, \"transform\", `translate(${ tx },${ ty })`)\n      const newRectBox = {\n        width: rectBox.width,\n        height: rectBox.height,\n        x: rectBox.x + tx,\n        y: rectBox.y + ty,\n      }\n      this.renderer.removeSymbol(`connection-${ infosGroup.id }`)\n      this.renderer.drawConnectionBetweenBox(`connection-${ infosGroup.id }`, box, newRectBox, { stroke: COLOR, debug: \"recognition-box-link\" })\n    }\n\n    rectTranslate.addEventListener(\"pointerdown\", e =>\n    {\n      e.preventDefault()\n      e.stopPropagation()\n      if (!this.renderer.getAttribute(infosGroup.id, \"originX\")) {\n        this.renderer.setAttribute(infosGroup.id, \"originX\", e.clientX.toString())\n        this.renderer.setAttribute(infosGroup.id, \"originY\", e.clientY.toString())\n      }\n      this.renderer.layer.addEventListener(\"pointermove\", translateEl)\n      this.renderer.layer.addEventListener(\"pointerup\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n      this.renderer.layer.addEventListener(\"pointerleave\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n      this.renderer.layer.addEventListener(\"pointercancel\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n    })\n  }\n\n  protected async showRecognitionBox(): Promise<void>\n  {\n    this.#logger.info(\"showRecognitionBox\")\n    await this.behaviors.export([\"application/vnd.myscript.jiix\"])\n    const jiix = this.model.exports?.[\"application/vnd.myscript.jiix\"]\n    this.#logger.debug(\"showRecognitionBox\", { jiix })\n    if (jiix) {\n      if (!jiix[\"bounding-box\"]) {\n        this.#logger.warn(\"drawRecognitionBox\", \"You must to enabled configuration.recognition.exports[\\\"bounding-box\\\"]\")\n        return\n      }\n      jiix.elements?.forEach(el =>\n      {\n        switch (el.type) {\n          case \"Node\": {\n            if (el[\"bounding-box\"]) {\n              const box = convertBoundingBoxMillimeterToPixel(el[\"bounding-box\"])\n              const hideProperties = [\"bounding-box\", \"items\", \"id\"]\n              const infos = Object.keys(el).filter(k => !hideProperties.includes(k)).map(k => `${ k }: ${ JSON.stringify(el[k as keyof typeof el]) }`)\n              this.drawRecognitionBox(box, infos)\n            }\n            break\n          }\n          case \"Text\": {\n            el.words?.forEach(w =>\n            {\n              if (w?.[\"bounding-box\"]) {\n                const box = convertBoundingBoxMillimeterToPixel(w[\"bounding-box\"])\n                this.drawRecognitionBox(box, [`type: ${ el.type }`, `candidates: ${ JSON.stringify(w.candidates || []) }`])\n              }\n            })\n            break\n          }\n          case \"Edge\": {\n            if (el.kind === JIIXEdgeKind.PolyEdge) {\n              const infos = [\n                `type: ${ el.type }`,\n                `kind: ${ el.kind }`,\n              ]\n              el.edges.forEach((e, i) =>\n              {\n                let inf = `edge-${ i }: [{ x1: ${ e.x1 }, y2: ${ e.y1 } },{ x2: ${ e.x2 }, y2: ${ e.y2 } }]`\n                if (e.p1Decoration) {\n                  inf += `, p1Decoration: ${ e.p1Decoration }`\n                }\n                if (e.p2Decoration) {\n                  inf += `, p2Decoration: ${ e.p2Decoration }`\n                }\n                infos.push(inf)\n              })\n              const box = convertBoundingBoxMillimeterToPixel(Box.createFromBoxes(el.edges.map(e => e[\"bounding-box\"] as TBoundingBox)))\n              this.drawRecognitionBox(box, infos)\n            }\n            else if (el[\"bounding-box\"]) {\n              const box = convertBoundingBoxMillimeterToPixel(el[\"bounding-box\"])\n              const hideProperties = [\"bounding-box\", \"items\", \"id\", \"ports\", \"connected\"]\n              const infos = Object.keys(el).filter(k => !hideProperties.includes(k)).map(k => `${ k }: ${ JSON.stringify(el[k as keyof typeof el]) }`)\n              this.drawRecognitionBox(box, infos)\n            }\n            break\n          }\n          default: {\n            this.#logger.warn(\"drawRecognitionBox\", `Unknow jiix element type: ${ el.type }`)\n            break\n          }\n        }\n      })\n    }\n  }\n  protected clearRecognitionBox(): void\n  {\n    this.#logger.info(\"clearRecognitionBox\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"recognition-box\" } })\n    this.renderer.clearElements({ attrs: { \"debug\": \"recognition-box-link\" } })\n  }\n  async debugRecognitionBox(): Promise<void>\n  {\n    this.clearRecognitionBox()\n    if (this.#recognitionBoxVisibility) {\n      this.showRecognitionBox()\n    }\n  }\n\n  protected drawRecognitionItemBox(box: TBoundingBox, label?: string, chars?: string[]): void\n  {\n    const COLOR = \"blue\"\n    const CHAR_SIZE = 14\n\n    const recognitionItemGroup = SVGBuilder.createGroup({ \"debug\": \"recognition-item-box\" })\n    const rect = SVGBuilder.createRect(box, { fill: \"transparent\", stroke: COLOR, style: OISVGRendererConst.noSelection })\n    recognitionItemGroup.appendChild(rect)\n\n    const charX = box.x\n    let charY = box.y - CHAR_SIZE\n\n    const charsGroup = SVGBuilder.createGroup({ id: `chars-group-${ createUUID() }` })\n    if (label) {\n      charsGroup.appendChild(SVGBuilder.createText({ x: charX, y: charY }, `label: ${ label }`, { fill: COLOR, \"font-size\": CHAR_SIZE.toString(), style: OISVGRendererConst.noSelection }))\n    }\n    if (chars?.length) {\n      charY += CHAR_SIZE\n      charsGroup.appendChild(SVGBuilder.createText({ x: charX, y: charY }, `[${ chars.join(\", \") }]`, { fill: COLOR, \"font-size\": CHAR_SIZE.toString(), style: OISVGRendererConst.noSelection }))\n    }\n\n    recognitionItemGroup.appendChild(charsGroup)\n    this.renderer.layer.appendChild(recognitionItemGroup)\n\n    const charsGroupBox = charsGroup.getBBox()\n    const rectBox = {\n      width: charsGroupBox.width + 10,\n      height: charsGroupBox.height + 10,\n      x: charsGroupBox.x - 5,\n      y: charsGroupBox.y - 5,\n    }\n    const rectTranslate = SVGBuilder.createRect(rectBox, { fill: \"white\", style: \"cursor:move\", stroke: COLOR })\n    charsGroup.prepend(rectTranslate)\n\n    const translateEl = (e: PointerEvent) =>\n    {\n      e.preventDefault()\n      e.stopPropagation()\n      const originX = Number(this.renderer.getAttribute(charsGroup.id, \"originX\"))\n      const originY = Number(this.renderer.getAttribute(charsGroup.id, \"originY\"))\n      const tx = e.clientX - originX\n      const ty = e.clientY - originY\n      this.renderer.setAttribute(charsGroup.id, \"transform\", `translate(${ tx },${ ty })`)\n      const newRectBox = {\n        width: rectBox.width,\n        height: rectBox.height,\n        x: rectBox.x + tx,\n        y: rectBox.y + ty,\n      }\n      this.renderer.removeSymbol(`connection-${ charsGroup.id }`)\n      this.renderer.drawConnectionBetweenBox(`connection-${ charsGroup.id }`, box, newRectBox, { stroke: COLOR, debug: \"recognition-item-box-link\" })\n    }\n\n    rectTranslate.addEventListener(\"pointerdown\", e =>\n    {\n      e.preventDefault()\n      e.stopPropagation()\n      if (!this.renderer.getAttribute(charsGroup.id, \"originX\")) {\n        this.renderer.setAttribute(charsGroup.id, \"originX\", e.clientX.toString())\n        this.renderer.setAttribute(charsGroup.id, \"originY\", e.clientY.toString())\n      }\n      this.renderer.layer.addEventListener(\"pointermove\", translateEl)\n    })\n    this.renderer.layer.addEventListener(\"pointerup\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n    this.renderer.layer.addEventListener(\"pointerleave\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n    this.renderer.layer.addEventListener(\"pointercancel\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n\n  }\n  protected async showRecognitionItemBox(): Promise<void>\n  {\n    this.#logger.info(\"showRecognitionBoxItem\")\n    await this.behaviors.export([\"application/vnd.myscript.jiix\"])\n    const jiix = this.model.exports?.[\"application/vnd.myscript.jiix\"]\n    this.#logger.debug(\"showRecognitionBoxItem\", { jiix })\n    if (jiix) {\n      jiix.elements?.forEach(el =>\n      {\n        switch (el.type) {\n          case \"Text\": {\n            el.chars?.forEach(c =>\n            {\n              if (c?.[\"bounding-box\"]) {\n                const box = convertBoundingBoxMillimeterToPixel(c[\"bounding-box\"])\n                this.drawRecognitionItemBox(box, c.label, c.candidates)\n              }\n            })\n            break\n          }\n          case \"Node\": {\n            if (el?.[\"bounding-box\"]) {\n              const box = convertBoundingBoxMillimeterToPixel(el[\"bounding-box\"])\n              this.drawRecognitionItemBox(box, el.kind)\n            }\n            break\n          }\n          case \"Edge\": {\n            if (el.kind === JIIXEdgeKind.PolyEdge) {\n              el.edges.forEach(e =>\n              {\n                const box = convertBoundingBoxMillimeterToPixel(e[\"bounding-box\"])\n                this.drawRecognitionItemBox(box, e.kind)\n              })\n            }\n            else if (el[\"bounding-box\"]) {\n              const box = convertBoundingBoxMillimeterToPixel(el[\"bounding-box\"])\n              this.drawRecognitionItemBox(box, el.kind)\n            }\n            break\n          }\n          default:\n            this.#logger.warn(\"drawRecognitionBoxItem\", `Unknow jiix element type: ${ el.type }`)\n            break\n        }\n      })\n    }\n  }\n  protected clearRecognitionItemBox(): void\n  {\n    this.#logger.info(\"clearRecognitionBoxItem\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"recognition-item-box\" } })\n    this.renderer.clearElements({ attrs: { \"debug\": \"recognition-item-box-link\" } })\n  }\n  async debugRecognitionItemBox(): Promise<void>\n  {\n    this.clearRecognitionItemBox()\n    if (this.#recognitionItemBoxVisibility) {\n      this.showRecognitionItemBox()\n    }\n  }\n\n  apply(): void\n  {\n    this.debugBoundingBox()\n    this.debugVertices()\n    this.debugSnapPoints()\n    this.debugRecognitionBox()\n    this.debugRecognitionItemBox()\n  }\n}\n","import ArrowDown from \"../assets/svg/nav-arrow-down.svg\"\n\n/**\n * @group Menu\n */\nexport type TMenuItem = {\n  id: string,\n  label: string,\n  type: \"button\" | \"checkbox\" | \"select\" | \"list\" | \"colors\"\n  disabled?: boolean\n}\n\n/**\n * @group Menu\n */\nexport type TMenuItemButton = TMenuItem & {\n  type: \"button\"\n  tooltip?: {\n    label: string,\n    position: \"top\" | \"left\" | \"right\" | \"bottom\"\n  },\n  icon?: string\n  callback: () => void\n}\n\n/**\n * @group Menu\n */\nexport type TMenuItemButtonList = TMenuItem & {\n  type: \"list\"\n  tooltip?: {\n    label: string,\n    position: \"top\" | \"left\" | \"right\" | \"bottom\"\n  }\n  initValue: string,\n  values: { label: string, value: string }[]\n  callback: (value: string) => void\n}\n\n/**\n * @group Menu\n */\nexport type TMenuItemColorList = TMenuItem & {\n  type: \"colors\"\n  tooltip?: {\n    label: string,\n    position: \"top\" | \"left\" | \"right\" | \"bottom\"\n  },\n  initValue: string,\n  values: string[]\n  fill: boolean\n  callback: (value: string) => void\n}\n\n/**\n * @group Menu\n */\nexport type TMenuItemBoolean = TMenuItem & {\n  type: \"checkbox\",\n  initValue: boolean | \"indeterminate\",\n  callback: (value: boolean) => void\n}\n\n/**\n * @group Menu\n */\nexport type TMenuItemSelect = TMenuItem & {\n  type: \"select\",\n  initValue: string,\n  values: { label: string, value: string }[]\n  callback: (value: string) => void\n}\n\n/**\n * @group Menu\n */\nexport abstract class OIMenu\n{\n  thicknessList = [\n    { label: \"S\", value: 1 },\n    { label: \"M\", value: 2 },\n    { label: \"L\", value: 4 },\n    { label: \"XL\", value: 8 },\n  ]\n\n  fontSizeList = [\n    { label: \"Auto\", value: 0 },\n    { label: \"S\", value: 0.5 },\n    { label: \"M\", value: 0.75 },\n    { label: \"L\", value: 1 },\n  ]\n\n  fontWeightList = [\n    { label: \"Auto\", value: undefined },\n    { label: \"Normal\", value: \"normal\" },\n    { label: \"Bold\", value: \"bold\" },\n  ]\n\n  colors = [\n    \"#000000\", \"#808080\", \"#ffffff\", \"transparent\",\n    \"#ff0000\", \"#ff6400\", \"#ffc800\", \"#ffff00\",\n    \"#0000ff\", \"#0064ff\", \"#00c8ff\", \"#00ffff\",\n    \"#008000\", \"#00af00\", \"#00e100\", \"#00ff00\"\n  ]\n\n  protected createToolTip(el: HTMLElement, text: string, position: \"top\" | \"left\" | \"right\" | \"bottom\" = \"top\"): HTMLElement\n  {\n    el.classList.add(\"ms-tooltip\")\n    const tooltipContent = document.createElement(\"span\")\n    tooltipContent.classList.add(\"ms-tooltip-content\", position)\n    tooltipContent.textContent = text\n    el.appendChild(tooltipContent)\n    return el\n  }\n\n  protected createWrapCollapsible(el: Node, title: string): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.classList.add(\"collapsible-wrapper\")\n    const head = document.createElement(\"div\")\n    head.classList.add(\"collapsible-header\")\n    head.textContent = title\n    const btn = document.createElement(\"span\")\n    btn.classList.add(\"collapsible-header-icon\")\n    btn.innerHTML = ArrowDown\n    head.appendChild(btn)\n    head.style.setProperty(\"pointer\", \"cursor\")\n    const content = document.createElement(\"div\")\n    content.classList.add(\"collapsible-content\")\n    head.addEventListener(\"pointerup\", () => wrapper.classList.toggle(\"active\"))\n    wrapper.appendChild(head)\n    content.appendChild(el)\n    wrapper.appendChild(content)\n    return wrapper\n  }\n\n  protected createSeparatorHorizontal(): HTMLHRElement\n  {\n    const separator = document.createElement(\"hr\")\n    separator.classList.add(\"separator\")\n    separator.classList.add(\"horizontal\")\n    return separator\n  }\n\n  protected createSeparatorVertical(): HTMLHRElement\n  {\n    const separator = document.createElement(\"hr\")\n    separator.classList.add(\"separator\")\n    separator.classList.add(\"vertical\")\n    return separator\n  }\n\n  protected createMenuItemBoolean(item: TMenuItemBoolean): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.classList.add(\"ms-menu-item\", item.type)\n    const labelEl = document.createElement(\"span\")\n    labelEl.textContent = item.label\n    wrapper.appendChild(labelEl)\n    const checkbox = document.createElement(\"input\")\n    checkbox.id = item.id\n    checkbox.setAttribute(\"type\", \"checkbox\")\n    if (item.disabled) {\n      checkbox.disabled = true\n    }\n    if (item.initValue === \"indeterminate\") {\n      checkbox.indeterminate = true\n    } else {\n      checkbox.checked = item.initValue\n    }\n    checkbox.addEventListener(\"change\", (e) => item.callback((e.target as HTMLInputElement).checked))\n    wrapper.appendChild(checkbox)\n    return wrapper\n  }\n\n  protected createMenuItemSelect(item: TMenuItemSelect): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.classList.add(\"ms-menu-item\", item.type)\n    const labelEl = document.createElement(\"span\")\n    labelEl.textContent = item.label\n    wrapper.appendChild(labelEl)\n    const select = document.createElement(\"select\")\n    select.id = item.id\n    if (item.disabled) {\n      select.disabled = true\n    }\n    item.values.forEach(v =>\n    {\n      const selected = v.value === item.initValue\n      const opt = new Option(v.label, v.value.toString(), selected, selected)\n      select.appendChild(opt)\n    })\n    select.addEventListener(\"change\", (e) => item.callback((e.target as HTMLInputElement).value))\n    wrapper.appendChild(select)\n    return wrapper\n  }\n\n  protected createMenuItemButton(item: TMenuItemButton): HTMLElement\n  {\n    const btn = document.createElement(\"button\")\n    btn.classList.add(\"ms-menu-item\", \"ms-menu-button\")\n    btn.innerHTML = item.icon || item.label\n    btn.addEventListener(\"pointerup\", item.callback)\n    if (item.tooltip) {\n      return this.createToolTip(btn, item.tooltip.label, item.tooltip.position)\n    }\n    else {\n      return btn\n    }\n  }\n\n  protected createMenuItemButtonList(item: TMenuItemButtonList): HTMLElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.classList.add(\"ms-menu-item\", item.type)\n    wrapper.id = item.id\n    const labelEl = document.createElement(\"span\")\n    labelEl.textContent = item.label\n    wrapper.appendChild(labelEl)\n    item.values.forEach((v) =>\n    {\n      const btn = document.createElement(\"button\")\n      if (item.disabled) {\n        btn.disabled = true\n      }\n      btn.id = `${item.id}-${ v.value }-btn`\n      if (item.initValue === v.value) {\n        btn.classList.add(\"active\")\n      }\n      btn.textContent = v.label\n      btn.addEventListener(\"pointerup\", () =>\n      {\n        item.callback(v.value)\n        wrapper.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n        btn.classList.add(\"active\")\n      })\n      wrapper.appendChild(btn)\n    })\n    return wrapper\n  }\n\n  protected createMenuItemColorList(item: TMenuItemColorList): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.classList.add(\"ms-menu-item\", item.type)\n    wrapper.id = item.id\n    const labelEl = document.createElement(\"span\")\n    labelEl.textContent = item.label\n    wrapper.appendChild(labelEl)\n    wrapper.appendChild(this.createColorList(item))\n    return wrapper\n  }\n\n  protected createColorList(item: TMenuItemColorList): HTMLDivElement\n  {\n    const list = document.createElement(\"div\")\n    list.id = `${ item.id }-list`\n    list.classList.add(\"ms-menu-row\", \"color-list\")\n    item.values.forEach((color) =>\n    {\n      const btn = document.createElement(\"button\")\n      if (item.disabled) {\n        btn.disabled = true\n      }\n      btn.id = `${ item.id }-${ color.replace(\"#\", \"\") }-btn`\n      btn.classList.add(\"ms-menu-button\", \"square\")\n      const colorEl = document.createElement(\"div\")\n      colorEl.classList.add(\"color\")\n      if (item.fill) {\n        colorEl.style.setProperty(\"background-color\", color)\n        colorEl.style.setProperty(\"border\", \"1px solid lightgrey\")\n      } else {\n        colorEl.style.setProperty(\"background-color\", \"transparent\")\n        colorEl.style.setProperty(\"border\", `3px solid ${ color }`)\n      }\n      if (color === \"#ffffff\") {\n        colorEl.style.setProperty(\"border\", \"1px solid black\")\n      }\n      if (color === \"transparent\") {\n        colorEl.style.setProperty(\"background-image\", \"linear-gradient(45deg, #AAA 10%, transparent 20%, #AAA 30%, transparent 40%, #AAA 50%, transparent 60%, #AAA 70%, transparent 80%, #AAA 90%, transparent 100%)\")\n      }\n      if (item.initValue === color) {\n        btn.classList.add(\"active\")\n      }\n      btn.appendChild(colorEl)\n      btn.addEventListener(\"pointerup\", (e) =>\n      {\n        e.preventDefault()\n        e.stopPropagation()\n        item.callback(color)\n        list.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n        btn.classList.add(\"active\")\n      })\n      list!.appendChild(btn)\n    })\n    return list\n  }\n\n  protected createMenuItem(item: TMenuItem): HTMLElement\n  {\n    switch (item.type) {\n      case \"checkbox\":\n        return this.createMenuItemBoolean(item as TMenuItemBoolean)\n      case \"select\":\n        return this.createMenuItemSelect(item as TMenuItemSelect)\n      case \"list\":\n        return this.createMenuItemButtonList(item as TMenuItemButtonList)\n      case \"colors\":\n        return this.createMenuItemColorList(item as TMenuItemColorList)\n      case \"button\":\n      default:\n        return this.createMenuItemButton(item as TMenuItemButton)\n    }\n  }\n\n  abstract render(domElement: HTMLElement): void\n\n  abstract update(): void\n\n  abstract show(): void\n\n  abstract hide(): void\n\n  abstract destroy(): void\n}\n","/**\n * @group Menu\n */\nexport type TSubMenuParam =\n{\n  trigger: HTMLElement,\n  menuTitle?: string,\n  subMenu: HTMLElement,\n  position: \"top\" | \"left\" | \"right\" | \"right-top\" | \"bottom\" | \"bottom-left\" | \"bottom-right\"\n}\nexport class OIMenuSub {\n  element: HTMLDivElement\n  content: HTMLElement\n\n  constructor(param : TSubMenuParam) {\n    this.element = document.createElement(\"div\")\n    this.element.classList.add(\"sub-menu\")\n    this.element.appendChild(param.trigger)\n    this.content = document.createElement(\"div\")\n    if(param.menuTitle) {\n      const menuTitleElement = document.createElement(\"h3\")\n      menuTitleElement.classList.add(\"ms-menu-title\")\n      menuTitleElement.textContent = param.menuTitle\n      this.content.appendChild(menuTitleElement)\n    }\n    this.content.classList.add(\"sub-menu-content\", param.position)\n    this.content.appendChild(param.subMenu)\n    this.element.appendChild(this.content)\n\n    param.trigger.addEventListener(\"pointerdown\", () => this.toggle())\n    document.addEventListener(\"pointerdown\", (e) => {\n      if (!this.element.contains(e.target as HTMLElement)) {\n        this.close()\n      }\n    })\n  }\n\n  open(): void {\n    this.content.classList.add(\"open\")\n  }\n\n  close(): void {\n    this.content.classList.remove(\"open\")\n  }\n\n  toggle(): void {\n    this.content.classList.toggle(\"open\")\n  }\n\n  unwrap(): void {\n    this.content.classList.remove(\"sub-menu-content\")\n    this.element.insertAdjacentElement(\"beforebegin\", this.content)\n    this.element.style.display = \"none\"\n  }\n\n  wrap(): void {\n    this.content.classList.add(\"sub-menu-content\")\n    this.element.appendChild(this.content)\n    this.element.style.display = \"block\"\n  }\n\n}\n","import menuIcon from \"../assets/svg/menu.svg\"\nimport languageIcon from \"../assets/svg/language.svg\"\nimport trashIcon from \"../assets/svg/trash.svg\"\nimport undoIcon from \"../assets/svg/undo.svg\"\nimport redoIcon from \"../assets/svg/redo.svg\"\nimport translateIcon from \"../assets/svg/translate.svg\"\nimport gestureIcon from \"../assets/svg/spock-hand-gesture.svg\"\nimport guideIcon from \"../assets/svg/orthogonal-view.svg\"\nimport snapIcon from \"../assets/svg/arrow-to-dot.svg\"\nimport debugIcon from \"../assets/svg/wolf.svg\"\nimport downloadIcon from \"../assets/svg/download.svg\"\nimport uploadIcon from \"../assets/svg/upload.svg\"\nimport { Intention, WriteTool } from \"../Constants\"\nimport { OIBehaviors } from \"../behaviors\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { OIModel } from \"../model\"\nimport { OIMenu, TMenuItemBoolean, TMenuItemButton, TMenuItemButtonList, TMenuItemSelect } from \"./OIMenu\"\nimport { TOISymbol } from \"../primitive\"\nimport { InsertAction, StrikeThroughAction, SurroundAction } from \"../gesture\"\nimport { OIMenuSub, TSubMenuParam } from \"./OIMenuSub\"\nimport { getAvailableLanguageList, PartialDeep } from \"../utils\"\n\n/**\n * @group Menu\n */\nexport class OIMenuAction extends OIMenu\n{\n  #logger = LoggerManager.getLogger(LoggerClass.MENU)\n\n  behaviors: OIBehaviors\n  id: string\n  wrapper?: HTMLElement\n  menuLanguage!: OIMenuSub\n  menuClear?: HTMLButtonElement\n  menuUndo?: HTMLButtonElement\n  menuRedo?: HTMLButtonElement\n  menuConvert?: HTMLButtonElement\n\n  guideGaps = [\n    { label: \"S\", value: \"25\" },\n    { label: \"M\", value: \"50\" },\n    { label: \"L\", value: \"100\" },\n    { label: \"XL\", value: \"150\" },\n  ]\n\n  constructor(behaviors: OIBehaviors, id = \"ms-menu-action\")\n  {\n    super()\n    this.id = id\n    this.behaviors = behaviors\n  }\n\n  get model(): OIModel\n  {\n    return this.behaviors.model\n  }\n\n  get isMobile(): boolean\n  {\n    return this.behaviors.renderer.parent.clientWidth < 700\n  }\n\n  protected createMenuClear(): HTMLElement\n  {\n    this.menuClear = document.createElement(\"button\")\n    this.menuClear.id = `${ this.id }-clear`\n    this.menuClear.classList.add(\"ms-menu-button\", \"square\")\n    this.menuClear.innerHTML = trashIcon\n    this.menuClear.addEventListener(\"pointerup\", () =>\n    {\n      this.#logger.info(`${ this.id }.clear`)\n      this.behaviors.clear()\n    })\n    return this.createToolTip(this.menuClear, \"Clear\", \"bottom\")\n  }\n\n  protected createMenuLanguage(): HTMLElement\n  {\n    const triggerBtn = document.createElement(\"button\")\n    triggerBtn.id = this.id\n    triggerBtn.classList.add(\"ms-menu-button\", \"square\")\n    triggerBtn.innerHTML = languageIcon\n\n    const select = document.createElement(\"select\")\n    select.classList.add(\"select-language\")\n    select.id = `${ this.id }-language`\n    getAvailableLanguageList(this.behaviors.configuration)\n      .then(json =>\n      {\n        const languages = json.result as { [key: string]: string }\n        Object.keys(languages).forEach(key =>\n        {\n          const selected = key === this.behaviors.configuration.recognition.lang\n          const opt = new Option(languages[key], key, selected, selected)\n          select.appendChild(opt)\n        })\n      })\n    select.addEventListener(\"change\", (e) =>\n    {\n      this.#logger.info(`${ this.id }.selectLanguage`)\n      const value = (e.target as HTMLInputElement).value\n      this.behaviors.changeLanguage(value)\n    })\n    const params: TSubMenuParam = {\n      trigger: triggerBtn,\n      subMenu: select,\n      position: \"bottom-right\"\n    }\n    this.menuLanguage = new OIMenuSub(params)\n    return this.menuLanguage.element\n  }\n\n  protected createMenuUndo(): HTMLElement\n  {\n    this.menuUndo = document.createElement(\"button\")\n    this.menuUndo.id = `${ this.id }-undo`\n    this.menuUndo.classList.add(\"ms-menu-button\", \"square\")\n    this.menuUndo.innerHTML = undoIcon\n    this.menuUndo.addEventListener(\"pointerup\", async () =>\n    {\n      this.#logger.info(`${ this.id }.undo`)\n      await this.behaviors.undo()\n    })\n    return this.createToolTip(this.menuUndo, \"Undo\", \"bottom\")\n  }\n\n  protected createMenuRedo(): HTMLElement\n  {\n    this.menuRedo = document.createElement(\"button\")\n    this.menuRedo.id = `${ this.id }-redo`\n    this.menuRedo.classList.add(\"ms-menu-button\", \"square\")\n    this.menuRedo.innerHTML = redoIcon\n    this.menuRedo.addEventListener(\"pointerup\", async () =>\n    {\n      this.#logger.info(`${ this.id }.redo`)\n      await this.behaviors.redo()\n    })\n    return this.createToolTip(this.menuRedo, \"Redo\", \"bottom\")\n  }\n\n  protected createMenuConvert(): HTMLElement\n  {\n    this.menuConvert = document.createElement(\"button\")\n    this.menuConvert.id = `${ this.id }-convert`\n    this.menuConvert.classList.add(\"ms-menu-button\", \"square\")\n    this.menuConvert.innerHTML = translateIcon\n    this.menuConvert.addEventListener(\"pointerup\", () =>\n    {\n      this.#logger.info(`${ this.id }.convert`)\n      this.behaviors.convert()\n    })\n    return this.createToolTip(this.menuConvert, \"Convert\", \"bottom\")\n  }\n\n  protected createMenuGesture(): HTMLDivElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-gesture`\n    trigger.classList.add(\"ms-menu-button\", \"square\")\n    trigger.innerHTML = gestureIcon\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n\n    const surroundActionValues: { label: string, value: string }[] = []\n    for (const key in SurroundAction) {\n      const value = SurroundAction[key as keyof typeof SurroundAction]\n      surroundActionValues.push({ label: key, value })\n    }\n    const strikeThroughActionValues: { label: string, value: string }[] = []\n    for (const key in StrikeThroughAction) {\n      const value = StrikeThroughAction[key as keyof typeof StrikeThroughAction]\n      strikeThroughActionValues.push({ label: key, value })\n    }\n    const splitActionValues: { label: string, value: string }[] = []\n    for (const key in InsertAction) {\n      const value = InsertAction[key as keyof typeof InsertAction]\n      splitActionValues.push({ label: key, value })\n    }\n    const menuItems: (TMenuItemBoolean | TMenuItemSelect)[] = [\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-gesture-detect`,\n        label: \"Detect gesture\",\n        initValue: this.behaviors.writer.detectGesture,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.gesture-detect`, { value })\n          this.behaviors.writer.detectGesture = value\n          this.behaviors.intention = Intention.Write\n          this.behaviors.writer.tool = WriteTool.Pencil\n        }\n      },\n      {\n        type: \"select\",\n        id: `${ this.id }-gesture-surround`,\n        label: \"On surround\",\n        values: surroundActionValues,\n        initValue: this.behaviors.gesture.surroundAction,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.gesture-surround`, { value })\n          this.behaviors.gesture.surroundAction = value as SurroundAction\n          this.behaviors.intention = Intention.Write\n          this.behaviors.writer.tool = WriteTool.Pencil\n        }\n      },\n      {\n        type: \"select\",\n        id: `${ this.id }-gesture-strikethrough`,\n        label: \"On strikethrough\",\n        values: strikeThroughActionValues,\n        initValue: this.behaviors.gesture.strikeThroughAction,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.gesture-strikethrough`, { value })\n          this.behaviors.gesture.strikeThroughAction = value as StrikeThroughAction\n          this.behaviors.intention = Intention.Write\n          this.behaviors.writer.tool = WriteTool.Pencil\n        }\n      },\n      {\n        type: \"select\",\n        id: `${ this.id }-gesture-strikethrough`,\n        label: \"On insert\",\n        values: splitActionValues,\n        initValue: this.behaviors.gesture.insertAction,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.gesture-InsertAction`, { value })\n          this.behaviors.gesture.insertAction = value as InsertAction\n          this.behaviors.intention = Intention.Write\n          this.behaviors.writer.tool = WriteTool.Pencil\n        }\n      },\n    ]\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Gesture\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new OIMenuSub(params).element\n  }\n\n  protected createMenuGuide(): HTMLDivElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-guide`\n    trigger.classList.add(\"ms-menu-button\", \"square\")\n    trigger.innerHTML = guideIcon\n\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n\n    const menuItems: (TMenuItemBoolean | TMenuItemSelect | TMenuItemButtonList)[] = [\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-guide-enable`,\n        label: \"Show guide\",\n        initValue: this.behaviors.configuration.rendering.guides.enable,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.guide-enable`, { value })\n          this.behaviors.configuration.rendering.guides.enable = value as boolean\n          this.behaviors.renderingConfiguration = this.behaviors.configuration.rendering\n        }\n      },\n      {\n        type: \"select\",\n        id: `${ this.id }-guide-type`,\n        label: \"Guide style\",\n        values: [\n          { label: \"Line\", value: \"line\" },\n          { label: \"Grid\", value: \"grid\" },\n          { label: \"Point\", value: \"point\" },\n        ],\n        initValue: this.behaviors.configuration.rendering.guides.type,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.guide-type`, { value })\n          this.behaviors.configuration.rendering.guides.type = value as (\"line\" | \"grid\" | \"point\")\n          this.behaviors.renderingConfiguration = this.behaviors.configuration.rendering\n        }\n      },\n      {\n        type: \"list\",\n        id: `${ this.id }-guide-size`,\n        label: \"Guide style\",\n        values: this.guideGaps,\n        initValue: this.behaviors.configuration.rendering.guides.gap.toString(),\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.guide-size`, { value })\n          this.behaviors.configuration.rendering.guides.gap = +value\n          this.behaviors.renderingConfiguration = this.behaviors.configuration.rendering\n        }\n      },\n    ]\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Guide\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new OIMenuSub(params).element\n  }\n\n  protected createMenuSnap(): HTMLDivElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-snap`\n    trigger.classList.add(\"ms-menu-button\", \"square\")\n    trigger.innerHTML = snapIcon\n\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n\n    const menuItems: (TMenuItemBoolean | TMenuItemSelect)[] = [\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-snap-to-guide`,\n        label: \"Snap to guide\",\n        initValue: this.behaviors.snaps.snapToGrid,\n        callback: (value) => this.behaviors.snaps.snapToGrid = value\n      },\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-snap-to-element`,\n        label: \"Snap to element\",\n        initValue: this.behaviors.snaps.snapToElement,\n        callback: (value) => this.behaviors.snaps.snapToElement = value\n      },\n      {\n        type: \"select\",\n        id: `${ this.id }-snap-angle`,\n        label: \"Snap angle\",\n        values: [\n          { label: \"None\", value: \"0\" },\n          { label: \"10°\", value: \"10\" },\n          { label: \"30°\", value: \"30\" },\n          { label: \"45°\", value: \"45\" },\n          { label: \"90°\", value: \"90\" },\n          { label: \"180°\", value: \"180\" },\n        ],\n        initValue: this.behaviors.snaps.snapAngle.toString(),\n        callback: (angle) => this.behaviors.snaps.snapAngle = +angle\n      },\n    ]\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Snap\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new OIMenuSub(params).element\n  }\n\n  protected createMenuDebug(): HTMLDivElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-debug`\n    trigger.classList.add(\"ms-menu-button\", \"square\")\n    trigger.innerHTML = debugIcon\n\n    const menuItems: TMenuItemBoolean[] = [\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-debug-bounding-box`,\n        label: \"Show bounding box\",\n        initValue: this.behaviors.svgDebugger.boundingBoxVisibility,\n        callback: (debug) => this.behaviors.svgDebugger.boundingBoxVisibility = debug\n      },\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-debug-recognition-box`,\n        label: \"Show recognition box\",\n        initValue: this.behaviors.svgDebugger.recognitionBoxVisibility,\n        callback: (debug) => this.behaviors.svgDebugger.recognitionBoxVisibility = debug\n      },\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-debug-bounding-item-box`,\n        label: \"Show recognition item box\",\n        initValue: this.behaviors.svgDebugger.recognitionItemBoxVisibility,\n        callback: (debug) => this.behaviors.svgDebugger.recognitionItemBoxVisibility = debug\n      },\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-debug-snap-points`,\n        label: \"Show snap points\",\n        initValue: this.behaviors.svgDebugger.snapPointsVisibility,\n        callback: (debug) => this.behaviors.svgDebugger.snapPointsVisibility = debug\n      },\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-debug-vertices`,\n        label: \"Show vertices\",\n        initValue: this.behaviors.svgDebugger.verticesVisibility,\n        callback: (debug) => this.behaviors.svgDebugger.verticesVisibility = debug\n      },\n    ]\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Debug\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new OIMenuSub(params).element\n  }\n\n  protected createMenuExport(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-export`\n    trigger.classList.add(\"ms-menu-button\", \"square\")\n    trigger.innerHTML = downloadIcon\n\n    const menuItems: TMenuItemButton[] = [\n      {\n        type: \"button\",\n        id: `${ this.id }-export-json`,\n        label: \"json\",\n        callback: () =>\n        {\n          this.behaviors.downloadAsJson()\n        }\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-export-svg`,\n        label: \"svg\",\n        callback: () =>\n        {\n          this.behaviors.downloadAsSVG()\n        }\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-export-png`,\n        label: \"png\",\n        callback: () =>\n        {\n          this.behaviors.downloadAsPNG()\n        }\n      },\n    ]\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Export\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new OIMenuSub(params).element\n  }\n\n  protected async readFileAsText(file: File): Promise<string>\n  {\n    return new Promise((resolve, reject) =>\n    {\n      const reader = new FileReader()\n      reader.onerror = reject;\n      reader.onload = () => {\n        resolve(reader.result as string)\n      }\n      if (file) {\n        reader.readAsText(file)\n      }\n    })\n  }\n\n  protected createMenuImport(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-import`\n    trigger.classList.add(\"ms-menu-button\", \"square\")\n    trigger.innerHTML = uploadIcon\n\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n\n    const importInput = document.createElement(\"input\")\n    importInput.type = \"file\"\n    importInput.accept = \".json\"\n    importInput.multiple = false\n    importInput.addEventListener(\"change\", () => {\n      importBtn.disabled = !importInput.files?.length\n    })\n\n    subMenuWrapper.appendChild(importInput)\n    const importBtn = document.createElement(\"button\")\n    importBtn.classList.add(\"ms-menu-button\")\n    importBtn.innerText = \"Import\"\n    importBtn.disabled = true\n    subMenuWrapper.appendChild(importBtn)\n    importBtn.addEventListener(\"pointerup\", async (e) =>\n    {\n      e.preventDefault()\n      e.stopPropagation()\n      try {\n        if (importInput.files?.length) {\n          const fileString = await this.readFileAsText(importInput.files[0])\n          const symbols = JSON.parse(fileString) as PartialDeep<TOISymbol>[]\n\n          await this.behaviors.createSymbols(symbols)\n          importInput.value = \"\"\n          importBtn.disabled = true\n        }\n      } catch (error) {\n        this.behaviors.internalEvent.emitError(new Error(error as string))\n      }\n\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Import\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new OIMenuSub(params).element\n  }\n\n  protected unselectAll(): void\n  {\n    this.wrapper?.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n  }\n\n  protected closeAllSubMenu(): void\n  {\n    this.wrapper?.querySelectorAll(\".open\").forEach(e => e.classList.remove(\"open\"))\n  }\n\n  render(layer: HTMLElement): void\n  {\n    if (this.behaviors.configuration.menu.action.enable) {\n      const menuTrigger = document.createElement(\"button\")\n      menuTrigger.id = this.id\n      menuTrigger.classList.add(\"ms-menu-button\", \"square\")\n      menuTrigger.innerHTML = menuIcon\n\n      const subMenuWrapper = document.createElement(\"div\")\n      subMenuWrapper.classList.add(\"ms-menu-colmun\")\n      subMenuWrapper.appendChild(this.createMenuGesture())\n      subMenuWrapper.appendChild(this.createMenuGuide())\n      subMenuWrapper.appendChild(this.createMenuSnap())\n      subMenuWrapper.appendChild(this.createMenuDebug())\n      subMenuWrapper.appendChild(this.createMenuImport())\n      subMenuWrapper.appendChild(this.createMenuExport())\n\n      this.wrapper = document.createElement(\"div\")\n      this.wrapper.classList.add(\"ms-menu\", \"ms-menu-top-left\", \"ms-menu-row\")\n      this.wrapper.appendChild(new OIMenuSub({ trigger: menuTrigger, subMenu: subMenuWrapper, position: \"bottom\" }).element)\n      this.wrapper.appendChild(this.createMenuLanguage())\n      this.wrapper.appendChild(this.createMenuClear())\n      this.wrapper.appendChild(this.createMenuUndo())\n      this.wrapper.appendChild(this.createMenuRedo())\n      this.wrapper.appendChild(this.createMenuConvert())\n\n      layer.appendChild(this.wrapper)\n      this.update()\n      this.show()\n    }\n  }\n\n  update(): void\n  {\n    if (this.menuLanguage) {\n      this.isMobile ? this.menuLanguage.wrap() : this.menuLanguage.unwrap()\n    }\n    if (this.menuClear) {\n      this.menuClear.disabled = this.behaviors.history.context.empty\n    }\n    if (this.menuUndo) {\n      this.menuUndo.disabled = !this.behaviors.history.context.canUndo\n    }\n    if (this.menuRedo) {\n      this.menuRedo.disabled = !this.behaviors.history.context.canRedo\n    }\n    if (this.menuConvert) {\n      this.menuConvert.disabled = !this.behaviors.extractStrokesFromSymbols(this.model.symbols).length\n    }\n  }\n\n  show(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"visible\"\n    }\n  }\n\n  hide(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"hidden\"\n    }\n  }\n\n  destroy(): void\n  {\n    if (this.wrapper) {\n      while (this.wrapper.lastChild) {\n        this.wrapper.removeChild(this.wrapper.lastChild)\n      }\n      this.wrapper.remove()\n      this.wrapper = undefined\n      this.menuClear = undefined\n      this.menuUndo = undefined\n      this.menuRedo = undefined\n      this.menuConvert = undefined\n    }\n  }\n}\n","import pencilIcon from \"../assets/svg/edit-pencil.svg\"\nimport cursorIcon from \"../assets/svg/frame-select.svg\"\nimport eraseIcon from \"../assets/svg/erase.svg\"\nimport handIcon from \"../assets/svg/drag-hand-gesture.svg\"\nimport rectangleIcon from \"../assets/svg/rectangle.svg\"\nimport rhombusIcon from \"../assets/svg/rhombus.svg\"\nimport circleIcon from \"../assets/svg/circle.svg\"\nimport ellipseIcon from \"../assets/svg/ellipse.svg\"\nimport triangleIcon from \"../assets/svg/triangle.svg\"\nimport lineIcon from \"../assets/svg/linear.svg\"\nimport arrowIcon from \"../assets/svg/linear-arrow.svg\"\nimport doubleArrowIcon from \"../assets/svg/linear-double-arrow.svg\"\nimport { Intention, WriteTool } from \"../Constants\"\nimport { OIBehaviors } from \"../behaviors\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { OIMenu } from \"./OIMenu\"\nimport { OIMenuSub } from \"./OIMenuSub\"\nimport { TSubMenuParam } from \"./OIMenuSub\"\n\n/**\n * @group Menu\n */\nexport class OIMenuIntention extends OIMenu\n{\n  #logger = LoggerManager.getLogger(LoggerClass.MENU)\n\n  behaviors: OIBehaviors\n  id: string\n  wrapper?: HTMLDivElement\n  writeBtn?: HTMLButtonElement\n  menuSelect?: HTMLButtonElement\n  menuMove?: HTMLButtonElement\n  menuErase?: HTMLButtonElement\n  menuShape?: HTMLButtonElement\n  subMenuShape?: {\n    rectangle: HTMLButtonElement,\n    circle: HTMLButtonElement,\n    triangle: HTMLButtonElement,\n    ellipse: HTMLButtonElement\n    rhombus: HTMLButtonElement\n  }\n  menuEdge?: HTMLButtonElement\n  subMenuEdge?: {\n    line: HTMLButtonElement,\n    arrow: HTMLButtonElement,\n    doubleArrow: HTMLButtonElement,\n  }\n\n  constructor(behaviors: OIBehaviors, id = \"ms-menu-intention\")\n  {\n    super()\n    this.id = id\n    this.#logger.info(\"constructor\")\n    this.behaviors = behaviors\n  }\n\n  protected createMenuWrite(): HTMLElement\n  {\n    this.writeBtn = document.createElement(\"button\")\n    this.writeBtn.id = `${this.id}-write-pencil`\n    this.writeBtn.classList.add(\"ms-menu-button\", \"square\")\n    this.writeBtn.innerHTML = pencilIcon\n    this.writeBtn.addEventListener(\"pointerup\", () =>\n    {\n      this.unselectAll()\n      this.writeBtn!.classList.add(\"active\")\n      this.behaviors.intention = Intention.Write\n      this.behaviors.writer.tool = WriteTool.Pencil\n    })\n    return this.createToolTip(this.writeBtn, \"Write\")\n  }\n\n  protected createMenuMove(): HTMLElement\n  {\n    this.menuMove = document.createElement(\"button\")\n    this.menuMove.id = `${this.id}-move`\n    this.menuMove.classList.add(\"ms-menu-button\", \"square\")\n    this.menuMove.innerHTML = handIcon\n    this.menuMove.addEventListener(\"pointerup\", () =>\n    {\n      this.unselectAll()\n      this.menuMove!.classList.add(\"active\")\n      this.behaviors.intention = Intention.Move\n    })\n    return this.createToolTip(this.menuMove, \"Move\")\n  }\n\n  protected createMenuSelect(): HTMLElement\n  {\n    this.menuSelect = document.createElement(\"button\")\n    this.menuSelect.id = `${this.id}-select`\n    this.menuSelect.classList.add(\"ms-menu-button\", \"square\")\n    this.menuSelect.innerHTML = cursorIcon\n    this.menuSelect.addEventListener(\"pointerup\", () =>\n    {\n      this.unselectAll()\n      this.menuSelect!.classList.add(\"active\")\n      this.behaviors.intention = Intention.Select\n    })\n    return this.createToolTip(this.menuSelect, \"Select\")\n  }\n\n  protected createMenuErase(): HTMLElement\n  {\n    this.menuErase = document.createElement(\"button\")\n    this.menuErase.id = `${this.id}-erase`\n    this.menuErase.classList.add(\"ms-menu-button\", \"square\")\n    this.menuErase.innerHTML = eraseIcon\n    this.menuErase.addEventListener(\"pointerup\", () =>\n    {\n      this.unselectAll()\n      this.menuErase!.classList.add(\"active\")\n      this.behaviors.intention = Intention.Erase\n    })\n    return this.createToolTip(this.menuErase, \"Erase\")\n  }\n\n  protected createShapeSubMenu(icon: string, tool: WriteTool): HTMLButtonElement\n  {\n    const subMenuShape = document.createElement(\"button\")\n    subMenuShape.id = `${this.id}-write-shape-${tool}`\n    subMenuShape.classList.add(\"ms-menu-button\", \"square\")\n    subMenuShape.innerHTML = icon\n    subMenuShape.addEventListener(\"pointerup\", () =>\n    {\n      this.unselectAll()\n      this.behaviors.intention = Intention.Write\n      this.behaviors.writer.tool = tool\n      subMenuShape.classList.add(\"active\")\n      this.menuShape!.innerHTML = icon\n      this.menuShape!.classList.add(\"active\")\n      const subMenuContent = this.menuShape!.nextSibling\n      if (subMenuContent) {\n        (subMenuContent as HTMLElement).classList.remove(\"open\")\n      }\n    })\n    return this.createToolTip(subMenuShape, tool.toString()) as HTMLButtonElement\n  }\n\n  protected createMenuShape(): HTMLElement\n  {\n    this.menuShape = document.createElement(\"button\")\n    this.menuShape.id = `${this.id}-write-shape`\n    this.menuShape.classList.add(\"ms-menu-button\", \"square\")\n    this.menuShape.innerHTML = rectangleIcon\n    this.subMenuShape = {\n      circle: this.createShapeSubMenu(circleIcon, WriteTool.Circle),\n      rectangle: this.createShapeSubMenu(rectangleIcon, WriteTool.Rectangle),\n      triangle: this.createShapeSubMenu(triangleIcon, WriteTool.Triangle),\n      ellipse: this.createShapeSubMenu(ellipseIcon, WriteTool.Ellipse),\n      rhombus: this.createShapeSubMenu(rhombusIcon, WriteTool.Rhombus),\n    }\n    const subMenuContent = document.createElement(\"div\")\n    subMenuContent.id = `${this.id}-write-shape-list`\n    subMenuContent.classList.add(\"ms-menu-row\", \"sub-menu-content-shape\")\n    subMenuContent.appendChild(this.subMenuShape.rectangle)\n    subMenuContent.appendChild(this.subMenuShape.circle)\n    subMenuContent.appendChild(this.subMenuShape.ellipse)\n    subMenuContent.appendChild(this.subMenuShape.triangle)\n    subMenuContent.appendChild(this.subMenuShape.rhombus)\n\n    const params: TSubMenuParam = {\n      trigger: this.menuShape,\n      subMenu: subMenuContent,\n      position: \"top\"\n    }\n\n    return new OIMenuSub(params).element\n  }\n\n  protected createEdgeSubMenu(square: string, tool: WriteTool): HTMLButtonElement\n  {\n    const subMenuEdge = document.createElement(\"button\")\n    subMenuEdge.id = `${this.id}-write-edge-${tool}`\n    subMenuEdge.classList.add(\"ms-menu-button\", \"square\")\n    subMenuEdge.innerHTML = square\n    subMenuEdge.addEventListener(\"pointerup\", () =>\n    {\n      this.unselectAll()\n      this.behaviors.intention = Intention.Write\n      this.behaviors.writer.tool = tool\n      subMenuEdge.classList.add(\"active\")\n      this.menuEdge!.innerHTML = square\n      this.menuEdge!.classList.add(\"active\")\n      const subMenuContent = this.menuEdge!.nextSibling\n      if (subMenuContent) {\n        (subMenuContent as HTMLElement).classList.remove(\"open\")\n      }\n    })\n    return this.createToolTip(subMenuEdge, tool.toString()) as HTMLButtonElement\n  }\n\n  protected createMenuEdge(): HTMLElement\n  {\n    this.menuEdge = document.createElement(\"button\")\n    this.menuEdge.id = `${this.id}-write-edge`\n    this.menuEdge.classList.add(\"ms-menu-button\", \"square\")\n    this.menuEdge.innerHTML = lineIcon\n    this.subMenuEdge = {\n      line: this.createEdgeSubMenu(lineIcon, WriteTool.Line),\n      arrow: this.createEdgeSubMenu(arrowIcon, WriteTool.Arrow),\n      doubleArrow: this.createEdgeSubMenu(doubleArrowIcon, WriteTool.DoubleArrow),\n    }\n    const subMenuContent = document.createElement(\"div\")\n    subMenuContent.id = `${this.id}-write-edge-list`\n    subMenuContent.classList.add(\"ms-menu-row\", \"sub-menu-content-edge\")\n    subMenuContent.appendChild(this.subMenuEdge.line)\n    subMenuContent.appendChild(this.subMenuEdge.arrow)\n    subMenuContent.appendChild(this.subMenuEdge.doubleArrow)\n\n    const params: TSubMenuParam = {\n      trigger: this.menuEdge,\n      subMenu: subMenuContent,\n      position: \"top\"\n    }\n\n    return new OIMenuSub(params).element\n  }\n\n  protected unselectAll(): void\n  {\n    this.wrapper?.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n  }\n\n  update(): void\n  {\n    this.unselectAll()\n    switch (this.behaviors.intention) {\n      case Intention.Erase:\n        this.menuErase?.classList.add(\"active\")\n        break;\n      case Intention.Move:\n        this.menuMove?.classList.add(\"active\")\n        break;\n      case Intention.Select:\n        this.menuSelect?.classList.add(\"active\")\n        break;\n      case Intention.Write:\n        switch (this.behaviors.writer.tool) {\n          case WriteTool.Circle:\n            this.menuShape?.classList.add(\"active\")\n            this.subMenuShape?.circle?.classList.add(\"active\")\n            break;\n          case WriteTool.Ellipse:\n            this.menuShape?.classList.add(\"active\")\n            this.subMenuShape?.ellipse?.classList.add(\"active\")\n            break;\n          case WriteTool.Triangle:\n            this.menuShape?.classList.add(\"active\")\n            this.subMenuShape?.triangle?.classList.add(\"active\")\n            break;\n          case WriteTool.Rectangle:\n            this.menuShape?.classList.add(\"active\")\n            this.subMenuShape?.rectangle?.classList.add(\"active\")\n            break;\n          case WriteTool.Line:\n            this.menuEdge?.classList.add(\"active\")\n            this.subMenuEdge?.line?.classList.add(\"active\")\n            break;\n          case WriteTool.Arrow:\n            this.menuEdge?.classList.add(\"active\")\n            this.subMenuEdge?.arrow?.classList.add(\"active\")\n            break;\n          case WriteTool.DoubleArrow:\n            this.menuEdge?.classList.add(\"active\")\n            this.subMenuEdge?.doubleArrow?.classList.add(\"active\")\n            break;\n          default:\n            this.writeBtn?.classList.add(\"active\")\n            break;\n        }\n        break;\n    }\n  }\n\n  render(domElement: HTMLElement): void\n  {\n    if (this.behaviors.configuration.menu.intention.enable) {\n      this.wrapper = document.createElement(\"div\")\n      this.wrapper.classList.add(\"ms-menu\", \"ms-menu-bottom\", \"ms-menu-row\")\n\n      this.wrapper.appendChild(this.createMenuWrite())\n      this.wrapper.appendChild(this.createMenuMove())\n      this.wrapper.appendChild(this.createMenuSelect())\n      this.wrapper.appendChild(this.createMenuErase())\n      this.wrapper.appendChild(this.createMenuEdge())\n      this.wrapper.appendChild(this.createMenuShape())\n\n      domElement.appendChild(this.wrapper)\n      this.update()\n      this.show()\n    }\n  }\n\n  show(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"visible\"\n    }\n  }\n\n  hide(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"hidden\"\n    }\n  }\n\n  destroy(): void\n  {\n    if (this.wrapper) {\n      while (this.wrapper.lastChild) {\n        this.wrapper.removeChild(this.wrapper.lastChild)\n      }\n      this.wrapper.remove()\n      this.writeBtn = undefined\n      this.menuSelect = undefined\n      this.menuMove = undefined\n      this.menuErase = undefined\n      this.menuShape = undefined\n      this.subMenuShape = undefined\n      this.menuEdge = undefined\n      this.subMenuEdge = undefined\n      this.wrapper = undefined\n    }\n  }\n}\n","import styleIcon from \"../assets/svg/palette.svg\"\nimport { Intention, WriteTool } from \"../Constants\"\nimport { OIBehaviors } from \"../behaviors\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { OIModel } from \"../model\"\nimport { SymbolType, TOISymbol } from \"../primitive\"\nimport { OIMenu, TMenuItemColorList } from \"./OIMenu\"\nimport { OIMenuSub } from \"./OIMenuSub\"\nimport { TSubMenuParam } from \"./OIMenuSub\"\n\n/**\n * @group Menu\n */\nexport class OIMenuStyle extends OIMenu\n{\n  #logger = LoggerManager.getLogger(LoggerClass.MENU)\n\n  behaviors: OIBehaviors\n  id: string\n  wrapper?: HTMLDivElement\n  subMenu?: OIMenuSub\n  triggerBtn?: HTMLButtonElement\n  menuColorStroke?: HTMLDivElement\n  menuColorFill?: HTMLDivElement\n  menuThickness?: HTMLDivElement\n  menuFontSize?: HTMLDivElement\n  menuFontWeight?: HTMLDivElement\n  menuStrokeOpacity?: HTMLDivElement\n\n  constructor(behaviors: OIBehaviors, id = \"ms-menu-style\")\n  {\n    super()\n    this.id = id\n    this.#logger.info(\"constructor\")\n    this.behaviors = behaviors\n  }\n\n  get model(): OIModel\n  {\n    return this.behaviors.model\n  }\n\n  get symbolsSelected(): TOISymbol[]\n  {\n    return this.model.symbolsSelected\n  }\n\n  get writeShape(): boolean\n  {\n    return ![WriteTool.Arrow, WriteTool.DoubleArrow, WriteTool.Line, WriteTool.Pencil].includes(this.behaviors.writer.tool)\n  }\n\n  get rowHeight(): number\n  {\n    return this.behaviors.configuration.rendering.guides.gap\n  }\n\n  get isMobile(): boolean\n  {\n    return this.behaviors.renderer.parent.clientWidth < 700\n  }\n\n  protected createMenuStroke(): HTMLDivElement\n  {\n    const symbolsStyles = this.symbolsSelected.map(s => s.style)\n    const hasUniqColor = symbolsStyles.length && symbolsStyles.every(st => st.color === symbolsStyles[0]?.color)\n    const color = hasUniqColor && symbolsStyles[0]?.color ? symbolsStyles[0]?.color : (this.behaviors.currentPenStyle.color || \"rgb(0, 0, 0)\") as string\n    const menuColorStrokeDef: TMenuItemColorList = {\n      type: \"colors\",\n      label: \"Colors\",\n      id: `${ this.id }-color`,\n      fill: false,\n      values: this.colors,\n      initValue: color,\n      callback: (color) =>\n      {\n        this.behaviors.setPenStyle({ color })\n        this.behaviors.updateSymbolsStyle(this.symbolsSelected.map(s => s.id), { color })\n      },\n    }\n    const menuColor = this.createColorList(menuColorStrokeDef)\n    this.menuColorStroke = this.createWrapCollapsible(menuColor, \"Colors\")\n    this.menuColorStroke.id = `${ this.id }-color`\n    return this.menuColorStroke\n  }\n\n  protected createMenuColorFill(): HTMLDivElement\n  {\n    const symbolsStyles = this.symbolsSelected.map(s => s.style)\n    const hasUniqColor = symbolsStyles.length && symbolsStyles.every(st => st.color === symbolsStyles[0]?.color)\n    const color = hasUniqColor && symbolsStyles[0]?.color ? symbolsStyles[0]?.color : (this.behaviors.currentPenStyle.color || \"rgb(0, 0, 0)\") as string\n    const menuColorStrokeDef: TMenuItemColorList = {\n      type: \"colors\",\n      label: \"Fill\",\n      id: `${ this.id }-fill`,\n      fill: true,\n      values: this.colors,\n      initValue: color,\n      callback: (fill) =>\n      {\n        this.behaviors.setPenStyle({ fill })\n        this.behaviors.updateSymbolsStyle(this.symbolsSelected.map(s => s.id), { fill })\n      },\n    }\n    const menuColor = this.createColorList(menuColorStrokeDef)\n    this.menuColorFill = this.createWrapCollapsible(menuColor, \"Fill\")\n    this.menuColorFill.id = `${ this.id }-fill`\n    return this.menuColorFill\n  }\n\n  protected createMenuThickness(): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.id = `${ this.id }-thickness-list`\n    wrapper.classList.add(\"ms-menu-row\", \"thickness-list\")\n\n    const symbolsStyles = this.symbolsSelected.map(s => s.style)\n    const hasUniqWidth = symbolsStyles.length && symbolsStyles.every(st => st.width === symbolsStyles[0]?.width)\n    const width = hasUniqWidth ? symbolsStyles[0]?.width : (this.behaviors.currentPenStyle.width || 2)\n\n    this.thicknessList.forEach((size) =>\n    {\n      const btn = document.createElement(\"button\")\n      btn.id = `${ this.id }-thickness-${ size.label }-btn`\n      btn.classList.add(\"ms-menu-button\", \"square\")\n      btn.textContent = size.label\n      if (width === size.value) {\n        btn.classList.add(\"active\")\n      }\n      btn.addEventListener(\"pointerup\", (e) =>\n      {\n        e.preventDefault()\n        e.stopPropagation()\n        this.behaviors.setPenStyle({ width: size.value })\n        wrapper.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n        btn.classList.add(\"active\")\n        if (this.symbolsSelected.length) {\n          this.behaviors.updateSymbolsStyle(this.symbolsSelected.map(s => s.id), { width: size.value })\n          this.behaviors.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      })\n      wrapper.appendChild(btn)\n    })\n    this.menuThickness = this.createWrapCollapsible(wrapper, \"Thickness\")\n    this.menuThickness.id = `${ this.id }-thickness`\n    return this.menuThickness\n  }\n\n  protected createMenuFontSize(): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.id = `${ this.id }-font-size-list`\n    wrapper.classList.add(\"ms-menu-row\", \"font-size-list\")\n\n    this.fontSizeList.forEach((size) =>\n    {\n      const btn = document.createElement(\"button\")\n      btn.id = `${ this.id }-font-size-${ size.label }-btn`\n      btn.classList.add(\"ms-menu-button\", \"square\")\n      btn.textContent = size.label\n      if ((this.behaviors.converter.fontSize || 0) === size.value * this.rowHeight) {\n        btn.classList.add(\"active\")\n      }\n      btn.addEventListener(\"pointerup\", (e) =>\n      {\n        e.preventDefault()\n        e.stopPropagation()\n        wrapper.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n        btn.classList.add(\"active\")\n        if (size.value === 0) {\n          this.behaviors.converter.fontSize = undefined\n        }\n        else {\n          const fontSize = size.value * this.rowHeight\n          this.behaviors.converter.fontSize = fontSize\n          const textSymbols = this.symbolsSelected.filter(s => s.type === SymbolType.Text || (s.type === SymbolType.Group && s.extractSymbols().some(c => c.type === SymbolType.Text)))\n          this.behaviors.updateTextFontStyle(textSymbols.map(s => s.id), { fontSize })\n          this.behaviors.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      })\n      wrapper.appendChild(btn)\n    })\n    this.menuFontSize = this.createWrapCollapsible(wrapper, \"Font size\")\n    this.menuFontSize.id = `${ this.id }-font-size`\n    return this.menuFontSize\n  }\n\n  protected createMenuFontWeight(): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.id = `${ this.id }-font-weight-list`\n    wrapper.classList.add(\"ms-menu-row\", \"font-weight-list\")\n\n    this.fontWeightList.forEach((weight) =>\n    {\n      const btn = document.createElement(\"button\")\n      btn.id = `${ this.id }-font-weight-${ weight.label }-btn`\n      btn.classList.add(\"ms-menu-button\", \"center\")\n      btn.textContent = weight.label\n      if (this.behaviors.converter.fontWeight === weight.value) {\n        btn.classList.add(\"active\")\n      }\n      btn.addEventListener(\"pointerup\", (e) =>\n      {\n        e.preventDefault()\n        e.stopPropagation()\n        wrapper.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n        btn.classList.add(\"active\")\n        this.behaviors.converter.fontWeight = weight.value === \"\" ? undefined : weight.value as \"normal\" | \"bold\"\n        if (this.behaviors.converter.fontWeight) {\n          const textSymbols = this.symbolsSelected.filter(s => s.type === SymbolType.Text || (s.type === SymbolType.Group && s.extractSymbols().some(c => c.type === SymbolType.Text)))\n          this.behaviors.updateTextFontStyle(textSymbols.map(s => s.id), { fontWeight: this.behaviors.converter.fontWeight })\n          this.behaviors.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      })\n      wrapper.appendChild(btn)\n    })\n    this.menuFontWeight = this.createWrapCollapsible(wrapper, \"Font weight\")\n    this.menuFontWeight.id = `${ this.id }-font-weight`\n    return this.menuFontWeight\n  }\n\n  protected createMenuOpacity(): HTMLDivElement\n  {\n    const symbolsStyles = this.symbolsSelected.map(s => s.style)\n    const hasUniqOpacity = symbolsStyles.length && symbolsStyles.every(st => st.opacity === symbolsStyles[0]?.opacity)\n    const currentOpacity = (hasUniqOpacity && symbolsStyles[0]?.opacity ? symbolsStyles[0]?.opacity : (this.behaviors.currentPenStyle.opacity || 1)) * 100 as number\n\n    const wrapper = document.createElement(\"div\")\n    wrapper.id = `${ this.id }-opacity-input-wrapper`\n    const input = document.createElement(\"input\")\n    input.id = `${ this.id }-opacity-input`\n    input.setAttribute(\"name\", `opacity`)\n    input.setAttribute(\"type\", \"range\")\n    input.setAttribute(\"step\", \"1\")\n    input.setAttribute(\"min\", \"1\")\n    input.setAttribute(\"max\", \"100\")\n    wrapper.appendChild(input)\n\n    const output = document.createElement(\"output\")\n    output.setAttribute(\"for\", `opacity`)\n    output.classList.add(\"tooltip\")\n    output.innerHTML = currentOpacity ? `${ currentOpacity }` : \"-\"\n    wrapper.appendChild(output)\n\n    if (currentOpacity) {\n      input.setAttribute(\"value\", currentOpacity.toString())\n    }\n    input.addEventListener(\"input\", (evt) =>\n    {\n      const value = (evt.target as HTMLInputElement).value as unknown as number\n      output.innerHTML = `${ value }%`\n      this.behaviors.setPenStyle({ opacity: value / 100 })\n      if (this.symbolsSelected.length) {\n        this.behaviors.updateSymbolsStyle(this.symbolsSelected.map(s => s.id), { opacity: value / 100 })\n      }\n    })\n    this.menuStrokeOpacity = this.createWrapCollapsible(wrapper, \"Opacity\")\n    this.menuStrokeOpacity.id = `${ this.id }-opacity`\n    return this.menuStrokeOpacity\n  }\n\n  render(layer: HTMLElement): void\n  {\n    if (this.behaviors.configuration.menu.style.enable) {\n      this.triggerBtn = document.createElement(\"button\")\n      this.triggerBtn.id = this.id\n      this.triggerBtn.classList.add(\"ms-menu-button\", \"square\")\n      this.triggerBtn.innerHTML = styleIcon\n\n      const subMenuContent = document.createElement(\"div\")\n      subMenuContent.classList.add(\"ms-menu-colmun\")\n      subMenuContent.appendChild(this.createMenuStroke())\n      subMenuContent.appendChild(this.createMenuColorFill())\n      subMenuContent.appendChild(this.createMenuThickness())\n      subMenuContent.appendChild(this.createMenuFontSize())\n      subMenuContent.appendChild(this.createMenuFontWeight())\n      subMenuContent.appendChild(this.createMenuOpacity())\n\n      const params: TSubMenuParam = {\n        trigger: this.triggerBtn,\n        subMenu: subMenuContent,\n        position: \"bottom-left\",\n      }\n      this.subMenu = new OIMenuSub(params)\n\n      this.wrapper = document.createElement(\"div\")\n      this.wrapper.classList.add(\"ms-menu\", \"ms-menu-top-right\")\n      this.wrapper.appendChild(this.subMenu.element)\n      layer.appendChild(this.wrapper)\n      this.update()\n    }\n  }\n\n  update(): void\n  {\n    if (this.subMenu) {\n      this.isMobile ? this.subMenu.wrap() : this.subMenu.unwrap()\n    }\n\n    if (this.behaviors.intention === Intention.Write) {\n      this.show()\n      if (this.menuColorStroke) {\n        this.menuColorStroke.style.display = \"block\"\n      }\n      if (this.menuColorFill) {\n        this.menuColorFill.style.display = this.writeShape ? \"block\" : \"none\"\n      }\n      if (this.menuThickness) {\n        this.menuThickness.style.display = \"block\"\n      }\n      if (this.menuFontSize) {\n        this.menuFontSize.style.display = \"block\"\n      }\n      if (this.menuFontWeight) {\n        this.menuFontWeight.style.display = \"block\"\n      }\n      if (this.menuStrokeOpacity) {\n        this.menuStrokeOpacity.style.display = \"block\"\n      }\n    }\n    else if (this.behaviors.intention === Intention.Select) {\n      this.show()\n      if (this.menuColorStroke) {\n        this.menuColorStroke.style.display = \"block\"\n      }\n      if (this.menuColorFill) {\n        const shapeSelected = this.model.symbolsSelected.length && this.model.symbolsSelected.some(s => s.type === SymbolType.Shape)\n        this.menuColorFill.style.display = shapeSelected ? \"block\" : \"none\"\n      }\n      if (this.menuThickness) {\n        this.menuThickness.style.display = \"block\"\n      }\n      if (this.menuFontSize) {\n        this.menuFontSize.style.display = \"block\"\n      }\n      if (this.menuFontWeight) {\n        this.menuFontWeight.style.display = \"block\"\n      }\n      if (this.menuStrokeOpacity) {\n        this.menuStrokeOpacity.style.display = \"block\"\n      }\n    }\n    else {\n      this.hide()\n    }\n  }\n\n  show(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"visible\"\n    }\n  }\n\n  hide(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"hidden\"\n    }\n  }\n\n  destroy(): void\n  {\n    if (this.wrapper) {\n      while (this.wrapper.lastChild) {\n        this.wrapper.removeChild(this.wrapper.lastChild)\n      }\n      this.wrapper.remove()\n      this.wrapper = undefined\n      this.subMenu = undefined\n      this.triggerBtn = undefined\n      this.menuColorStroke = undefined\n      this.menuColorFill = undefined\n      this.menuThickness = undefined\n      this.menuFontSize = undefined\n      this.menuFontWeight = undefined\n      this.menuStrokeOpacity = undefined\n    }\n  }\n}\n","import ArrowDown from \"../assets/svg/nav-arrow-down.svg\"\nimport { SELECTION_MARGIN } from \"../Constants\"\nimport { OIBehaviors } from \"../behaviors\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { DecoratorKind, OIDecorator, OIStroke, OISymbolGroup, OIText, SymbolType, TOISymbol } from \"../primitive\"\nimport { OIMenu, TMenuItemBoolean, TMenuItemButton, TMenuItemColorList } from \"./OIMenu\"\nimport { createUUID } from \"../utils\"\nimport { OIMenuSub, TSubMenuParam } from \"./OIMenuSub\"\n/**\n * @group Menu\n */\nexport class OIMenuContext extends OIMenu\n{\n  #logger = LoggerManager.getLogger(LoggerClass.MENU)\n  behaviors: OIBehaviors\n  id: string\n  wrapper?: HTMLElement\n  editMenu?: HTMLDivElement\n  editInput?: HTMLInputElement\n  editSaveBtn?: HTMLButtonElement\n  reorderMenu?: HTMLDivElement\n  decoratorMenu?: HTMLDivElement\n  menuExport?: HTMLDivElement\n  duplicateBtn?: HTMLButtonElement\n  groupBtn?: HTMLButtonElement\n  convertBtn?: HTMLButtonElement\n  removeBtn?: HTMLButtonElement\n\n  position: {\n    x: number,\n    y: number,\n    scrollTop: number,\n    scrollLeft: number\n  }\n\n  constructor(behaviors: OIBehaviors, id = \"ms-menu-context\")\n  {\n    super()\n    this.id = id\n    this.#logger.info(\"constructor\")\n    this.behaviors = behaviors\n    this.position = { x: 0, y: 0, scrollLeft: 0, scrollTop: 0 }\n  }\n\n  get symbolsSelected(): TOISymbol[]\n  {\n    return this.behaviors.model.symbolsSelected\n  }\n  get haveSymbolsSelected(): boolean\n  {\n    return this.symbolsSelected.length > 0\n  }\n\n  get symbolsDecorable(): (OIStroke | OIText | OISymbolGroup)[]\n  {\n    return this.symbolsSelected.filter(s => [SymbolType.Stroke.toString(), SymbolType.Text.toString(), SymbolType.Group.toString()].includes(s.type)) as (OIStroke | OIText)[]\n  }\n  get showDecorator(): boolean\n  {\n    return this.symbolsDecorable.length > 0\n  }\n\n  protected createMenuEdit(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-edit-trigger`\n    trigger.classList.add(\"ms-menu-button\")\n    const label = document.createElement(\"span\")\n    label.innerText = \"Edit\"\n    trigger.appendChild(label)\n    const icon = document.createElement(\"span\")\n    icon.style.setProperty(\"width\", \"32px\")\n    icon.style.setProperty(\"transform\", \"rotate(270deg)\")\n    icon.innerHTML = ArrowDown\n    trigger.appendChild(icon)\n\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    this.editInput = document.createElement(\"input\")\n    subMenuWrapper.appendChild(this.editInput)\n    this.editSaveBtn = document.createElement(\"button\")\n    this.editSaveBtn.classList.add(\"ms-menu-button\")\n    this.editSaveBtn.innerText = \"Save\"\n    subMenuWrapper.appendChild(this.editSaveBtn)\n    this.editSaveBtn.addEventListener(\"pointerdown\", async (e) =>\n    {\n      e.stopPropagation()\n      const textSymbol = this.behaviors.model.symbolsSelected.find(s => s.type === SymbolType.Text) as OIText\n      if (textSymbol) {\n        const firstChar = textSymbol.chars[0]\n        textSymbol.chars = []\n        for (let i = 0; i < this.editInput!.value.length; i++) {\n          textSymbol.chars.push({\n            label: this.editInput!.value.charAt(i),\n            id: createUUID(),\n            color: firstChar.color,\n            fontSize: firstChar.fontSize,\n            fontWeight: firstChar.fontWeight,\n            bounds: firstChar.bounds\n          })\n        }\n        await this.behaviors.updateSymbol(textSymbol)\n        this.behaviors.selector.resetSelectedGroup([textSymbol])\n      }\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      subMenu: subMenuWrapper,\n      position: \"right\"\n    }\n    this.editMenu = new OIMenuSub(params).element\n\n    return this.editMenu\n  }\n\n  protected createMenuDuplicate(): HTMLElement\n  {\n    this.duplicateBtn = document.createElement(\"button\")\n    this.duplicateBtn.id = `${ this.id }-duplicate`\n    this.duplicateBtn.textContent = \"Duplicate\"\n    this.duplicateBtn.classList.add(\"ms-menu-button\")\n    this.duplicateBtn.addEventListener(\"pointerup\", async () =>\n    {\n      const symbolsToDuplicate = this.symbolsSelected\n      const duplicatedSymbols = symbolsToDuplicate.map(s =>\n      {\n        const clone = s.clone()\n        while (this.behaviors.model.symbols.find(s => s.id === clone.id)) {\n          clone.id = clone.id.slice(0, -36) + `-${ createUUID() }`\n          if (clone.type === SymbolType.Group) {\n            const groupClone = clone as OISymbolGroup\n            groupClone.extractSymbols().forEach(s => s.id = s.id.slice(0, -36) + `-${ createUUID() }`)\n          }\n        }\n        clone.selected = true\n        this.behaviors.translator.applyToSymbol(clone, SELECTION_MARGIN, SELECTION_MARGIN)\n        return clone\n      })\n\n      this.behaviors.unselectAll()\n      await this.behaviors.addSymbols(duplicatedSymbols)\n      this.behaviors.selector.drawSelectedGroup(duplicatedSymbols)\n    })\n    return this.duplicateBtn\n  }\n\n  protected createMenuGroup(): HTMLElement\n  {\n    this.groupBtn = document.createElement(\"button\")\n    this.groupBtn.id = `${ this.id }-duplicate`\n    this.groupBtn.textContent = \"Group\"\n    this.groupBtn.classList.add(\"ms-menu-button\")\n    this.groupBtn.addEventListener(\"pointerup\", async () =>\n    {\n      if (this.symbolsSelected.length === 1 && this.symbolsSelected[0].type === SymbolType.Group) {\n        const symbols = this.behaviors.ungroupSymbol(this.symbolsSelected[0] as OISymbolGroup)\n        this.behaviors.select(symbols.map(s => s.id))\n      }\n      else {\n        const symbols = this.symbolsSelected.slice()\n        this.behaviors.unselectAll()\n        const group = this.behaviors.groupSymbols(symbols)\n        group.selected = true\n        this.behaviors.select([group.id])\n      }\n    })\n    return this.groupBtn\n  }\n\n  protected createMenuConvert(): HTMLElement\n  {\n    this.convertBtn = document.createElement(\"button\")\n    this.convertBtn.id = `${ this.id }-convert`\n    this.convertBtn.textContent = \"Convert\"\n    this.convertBtn.classList.add(\"ms-menu-button\")\n    this.convertBtn.addEventListener(\"pointerup\", async () =>\n    {\n      try {\n        this.behaviors.internalEvent.emitIdle(false)\n        await this.behaviors.converter.apply(this.symbolsSelected)\n      }\n      catch (error) {\n        this.#logger.error(\"convert\", error)\n        this.behaviors.internalEvent.emitError(error as Error)\n        throw error\n      }\n      finally {\n        this.behaviors.updateLayerInfos()\n      }\n    })\n    return this.convertBtn\n  }\n\n  protected createMenuRemove(): HTMLButtonElement\n  {\n    this.removeBtn = document.createElement(\"button\")\n    this.removeBtn.id = `${ this.id }-remove`\n    this.removeBtn.textContent = \"Remove\"\n    this.removeBtn.classList.add(\"ms-menu-button\")\n    this.removeBtn.addEventListener(\"pointerup\", async () =>\n    {\n      this.behaviors.selector.removeSelectedGroup()\n      await this.behaviors.removeSymbols(this.symbolsSelected.map(s => s.id))\n      this.behaviors.menu.update()\n    })\n    return this.removeBtn\n  }\n\n  protected createMenuReorder(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-reorder`\n    trigger.classList.add(\"ms-menu-button\")\n    const label = document.createElement(\"span\")\n    label.innerText = \"Reorder\"\n    trigger.appendChild(label)\n    const icon = document.createElement(\"span\")\n    icon.style.setProperty(\"width\", \"32px\")\n    icon.style.setProperty(\"transform\", \"rotate(270deg)\")\n    icon.innerHTML = ArrowDown\n    trigger.appendChild(icon)\n\n    const menuItems: TMenuItemButton[] = [\n      {\n        type: \"button\",\n        id: `${ this.id }-reorder-first`,\n        label: \"Bring to front\",\n        callback: () =>\n        {\n          this.behaviors.changeOrderSymbols(this.symbolsSelected, \"last\")\n          this.behaviors.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-reorder-forward`,\n        label: \"Bring forward\",\n        callback: () =>\n        {\n          this.behaviors.changeOrderSymbols(this.symbolsSelected, \"forward\")\n          this.behaviors.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-reorder-backward`,\n        label: \"Send backward\",\n        callback: () =>\n        {\n          this.behaviors.changeOrderSymbols(this.symbolsSelected, \"backward\")\n          this.behaviors.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-reorder-last`,\n        label: \"Send to back\",\n        callback: () =>\n        {\n          this.behaviors.changeOrderSymbols(this.symbolsSelected.slice().reverse(), \"first\")\n          this.behaviors.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      },\n    ]\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      subMenu: subMenuWrapper,\n      position: \"right\"\n    }\n    this.reorderMenu = new OIMenuSub(params).element\n    return this.reorderMenu\n  }\n\n  protected createDecoratorSubMenu(label: string, kind: DecoratorKind): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-decorator-${ kind }`\n    trigger.classList.add(\"ms-menu-button\")\n    const labelEL = document.createElement(\"span\")\n    labelEL.innerText = label\n    trigger.appendChild(labelEL)\n    const icon = document.createElement(\"span\")\n    icon.style.setProperty(\"width\", \"32px\")\n    icon.style.setProperty(\"transform\", \"rotate(270deg)\")\n    icon.innerHTML = ArrowDown\n    trigger.appendChild(icon)\n\n    const menuItems: (TMenuItemBoolean | TMenuItemColorList)[] = [\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-decorator-${ kind }-enable`,\n        label: \"Enable\",\n        initValue: false,\n        callback: (enable) =>\n        {\n          this.symbolsDecorable.forEach(s =>\n          {\n            if (enable) {\n              if (!s.decorators.some(d => d.kind === kind)) {\n                s.decorators.push(new OIDecorator(kind, this.behaviors.currentPenStyle))\n              }\n            }\n            else {\n              const decoIndex = s.decorators.findIndex(d => d.kind === kind)\n              if (decoIndex > -1) {\n                s.decorators.splice(decoIndex, 1)\n              }\n            }\n            this.behaviors.model.updateSymbol(s)\n            this.behaviors.renderer.drawSymbol(s)\n          })\n\n          document.querySelectorAll(`#${ this.id }-decorator-${ kind }-color button`).forEach(b =>\n          {\n            (b as HTMLButtonElement).disabled = !enable\n            b.classList.remove(\"active\")\n          })\n          if (enable) {\n            document.querySelector(`#${ this.id }-decorator-${ kind }-color button`)?.classList.add(\"active\")\n          }\n        }\n      },\n      {\n        type: \"colors\",\n        label: \"Colors\",\n        id: `${ this.id }-decorator-${ kind }-color`,\n        fill: false,\n        values: this.colors.filter((_c, i) => !(i % 4)),\n        initValue: this.colors[0],\n        disabled: true,\n        callback: (color) =>\n        {\n          this.symbolsDecorable.forEach(s =>\n          {\n            const deco = s.decorators.find(d => d.kind === kind)\n            if (deco) {\n              deco.style.color = color\n              this.behaviors.model.updateSymbol(s)\n              this.behaviors.renderer.drawSymbol(s)\n            }\n          })\n        },\n      }\n    ]\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      subMenu: subMenuWrapper,\n      position: \"right\"\n    }\n    return this.decoratorMenu = new OIMenuSub(params).element\n  }\n\n  protected createMenuDecorator(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-decorator`\n    trigger.classList.add(\"ms-menu-button\")\n    const label = document.createElement(\"span\")\n    label.innerText = \"Decorator\"\n    trigger.appendChild(label)\n    const icon = document.createElement(\"span\")\n    icon.style.setProperty(\"width\", \"32px\")\n    icon.style.setProperty(\"transform\", \"rotate(270deg)\")\n    icon.innerHTML = ArrowDown\n    trigger.appendChild(icon)\n\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    subMenuWrapper.appendChild(this.createDecoratorSubMenu(\"Hightlight\", DecoratorKind.Highlight))\n    subMenuWrapper.appendChild(this.createDecoratorSubMenu(\"Surround\", DecoratorKind.Surround))\n    subMenuWrapper.appendChild(this.createDecoratorSubMenu(\"Underline\", DecoratorKind.Underline))\n    subMenuWrapper.appendChild(this.createDecoratorSubMenu(\"Strikethrough\", DecoratorKind.Strikethrough))\n\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      subMenu: subMenuWrapper,\n      position: \"right\"\n    }\n    this.decoratorMenu = new OIMenuSub(params).element\n    return this.decoratorMenu\n  }\n\n  protected createMenuExport(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-export`\n    trigger.classList.add(\"ms-menu-button\")\n    const label = document.createElement(\"span\")\n    label.innerText = \"Export\"\n    trigger.appendChild(label)\n    const icon = document.createElement(\"span\")\n    icon.style.setProperty(\"width\", \"32px\")\n    icon.style.setProperty(\"transform\", \"rotate(270deg)\")\n    icon.innerHTML = ArrowDown\n    trigger.appendChild(icon)\n\n    const menuItems: TMenuItemButton[] = [\n      {\n        type: \"button\",\n        id: `${ this.id }-export-json`,\n        label: \"json\",\n        callback: () => this.behaviors.downloadAsJson(this.haveSymbolsSelected)\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-export-svg`,\n        label: \"svg\",\n        callback: () => this.behaviors.downloadAsSVG(this.haveSymbolsSelected)\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-export-png`,\n        label: \"png\",\n        callback: () => this.behaviors.downloadAsPNG(this.haveSymbolsSelected)\n      },\n    ]\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      subMenu: subMenuWrapper,\n      position: \"right\"\n    }\n    this.menuExport = new OIMenuSub(params).element\n    return this.menuExport\n  }\n\n  protected createMenuSelectAll(): HTMLElement\n  {\n    const btn = document.createElement(\"button\")\n    btn.id = `${ this.id }-duplicate`\n    btn.textContent = \"Select all\"\n    btn.classList.add(\"ms-menu-button\")\n    btn.addEventListener(\"pointerup\", async () => this.behaviors.selectAll())\n    return btn\n  }\n\n  protected updateDecoratorSubMenu(): void\n  {\n    if (this.showDecorator) {\n      this.decoratorMenu?.style.removeProperty(\"display\")\n\n      Object.values(DecoratorKind).forEach(kind =>\n      {\n        const checkbox = document.getElementById(`${ this.id }-decorator-${ kind }-enable`) as HTMLInputElement\n        if (checkbox) {\n          document.querySelectorAll(`#${ this.id }-decorator-${ kind }-color button`).forEach(e => e.classList.remove(\"active\"))\n          const decos = this.symbolsDecorable.flatMap(s => s.decorators).filter(d => d.kind === kind)\n\n          if (decos.length && decos.every(d => d.style.color === decos[0].style.color)) {\n            const btnToActivate = document.getElementById(`${ this.id }-decorator-${ kind }-color-${ decos[0].style.color?.replace(\"#\", \"\") }-btn`)\n            btnToActivate?.classList.add(\"active\")\n          }\n\n          if (this.symbolsDecorable.filter(s => s.decorators.some(d => d.kind === kind)).length === this.symbolsDecorable.length) {\n            checkbox.checked = true\n\n            document.querySelectorAll(`#${ this.id }-decorator-${ kind }-color button`).forEach(b =>\n            {\n              (b as HTMLButtonElement).disabled = false\n            })\n            checkbox.indeterminate = false\n          }\n          else if (this.symbolsDecorable.filter(s => !s.decorators.some(d => d.kind === kind)).length === this.symbolsDecorable.length) {\n            checkbox.checked = false\n            document.querySelectorAll(`#${ this.id }-decorator-${ kind }-color button`).forEach(b =>\n            {\n              (b as HTMLButtonElement).disabled = true\n            })\n            checkbox.indeterminate = false\n          }\n          else {\n            checkbox.setAttribute(\"indeterminate\", \"true\")\n            checkbox.indeterminate = true\n            document.querySelectorAll(`#${ this.id }-decorator-${ kind }-color button`).forEach(b =>\n            {\n              (b as HTMLButtonElement).disabled = false\n            })\n          }\n        }\n\n      })\n    }\n    else {\n      this.decoratorMenu?.style.setProperty(\"display\", \"none\")\n    }\n  }\n\n  protected updateGroupMenu(): void\n  {\n    if (this.groupBtn && this.haveSymbolsSelected) {\n      this.groupBtn.style.removeProperty(\"display\")\n      if (this.symbolsSelected.length === 1 && this.symbolsSelected[0].type === SymbolType.Group) {\n        this.groupBtn.textContent = \"UnGroup\"\n      }\n      else {\n        this.groupBtn.textContent = \"Group\"\n      }\n    }\n    else {\n      this.groupBtn?.style.setProperty(\"display\", \"none\")\n    }\n  }\n\n  update(): void\n  {\n    this.wrapper?.style.setProperty(\"left\", `${ this.position.x - this.position.scrollLeft }px`)\n    this.wrapper?.style.setProperty(\"top\", `${ this.position.y - this.position.scrollTop }px`)\n\n    if (this.haveSymbolsSelected) {\n      const textSymbol = this.behaviors.model.symbolsSelected.find(s => s.type === SymbolType.Text)\n      if (this.editMenu && this.editInput && this.behaviors.model.symbolsSelected.length === 1 && textSymbol) {\n        this.editMenu.style.removeProperty(\"display\")\n        this.editInput.value = (textSymbol as OIText).label\n      }\n      else {\n        this.editMenu?.style.setProperty(\"display\", \"none\")\n      }\n\n      if(this.behaviors.extractStrokesFromSymbols(this.symbolsSelected).length) {\n        this.convertBtn?.style.removeProperty(\"display\")\n      }\n      else {\n        this.convertBtn?.style.setProperty(\"display\", \"none\")\n      }\n\n\n      this.reorderMenu?.style.removeProperty(\"display\")\n      this.duplicateBtn?.style.removeProperty(\"display\")\n      this.removeBtn?.style.removeProperty(\"display\")\n      this.menuExport?.style.removeProperty(\"display\")\n    }\n    else {\n      this.editMenu?.style.setProperty(\"display\", \"none\")\n      this.convertBtn?.style.setProperty(\"display\", \"none\")\n      this.reorderMenu?.style.setProperty(\"display\", \"none\")\n      this.duplicateBtn?.style.setProperty(\"display\", \"none\")\n      this.removeBtn?.style.setProperty(\"display\", \"none\")\n      this.menuExport?.style.setProperty(\"display\", \"none\")\n    }\n    this.updateDecoratorSubMenu()\n    this.updateGroupMenu()\n  }\n\n  render(domElement: HTMLElement): void\n  {\n    this.wrapper = document.createElement(\"div\")\n    this.wrapper.id = `${ this.id }-wrapper`\n    this.wrapper.classList.add(\"ms-menu\", \"ms-menu-context\")\n    this.wrapper.appendChild(this.createMenuEdit())\n    this.wrapper.appendChild(this.createMenuDecorator())\n    this.wrapper.appendChild(this.createMenuReorder())\n    this.wrapper.appendChild(this.createMenuExport())\n    this.wrapper.appendChild(this.createMenuConvert())\n    this.wrapper.appendChild(this.createMenuGroup())\n    this.wrapper.appendChild(this.createMenuDuplicate())\n    this.wrapper.appendChild(this.createMenuRemove())\n    this.wrapper.appendChild(this.createMenuSelectAll())\n    this.wrapper.style.setProperty(\"display\", \"none\")\n    domElement.appendChild(this.wrapper)\n    domElement.parentElement?.addEventListener(\"scroll\", () =>\n    {\n      this.position.scrollLeft = domElement.parentElement?.scrollLeft || 0\n      this.position.scrollTop = domElement.parentElement?.scrollTop || 0\n      this.update()\n    })\n  }\n\n  show(): void\n  {\n    this.update()\n    this.wrapper?.style.setProperty(\"display\", \"block\")\n  }\n\n  hide(): void\n  {\n    this.wrapper?.style.setProperty(\"display\", \"none\")\n  }\n\n  destroy(): void\n  {\n\n  }\n}\n","import { OIBehaviors } from \"../behaviors\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { OIMenuAction, OIMenuIntention, OIMenuStyle, OIMenuContext } from \"../menu\"\nimport { PartialDeep } from \"../utils\"\n\n/**\n * @group Manager\n */\nexport class OIMenuManager\n{\n  #logger = LoggerManager.getLogger(LoggerClass.MENU)\n  behaviors: OIBehaviors\n  layer?: HTMLElement\n  action: OIMenuAction\n  intention: OIMenuIntention\n  context: OIMenuContext\n  style: OIMenuStyle\n\n  constructor(behaviors: OIBehaviors, custom?: PartialDeep<{ style?: OIMenuStyle, intention?: OIMenuIntention, action?: OIMenuAction, context?: OIMenuContext }>)\n  {\n    this.#logger.info(\"constructor\")\n    this.behaviors = behaviors\n\n    if (custom?.style) {\n      const CustomMenuStyle = custom.style as unknown as typeof OIMenuStyle\n      this.style = new CustomMenuStyle(this.behaviors)\n    }\n    else {\n      this.style = new OIMenuStyle(this.behaviors)\n    }\n    if (custom?.intention) {\n      const CustomMenuIntention = custom.intention as unknown as typeof OIMenuIntention\n      this.intention = new CustomMenuIntention(this.behaviors)\n    }\n    else {\n      this.intention = new OIMenuIntention(this.behaviors)\n    }\n    if (custom?.action) {\n      const CustomMenuAction = custom.action as unknown as typeof OIMenuAction\n      this.action = new CustomMenuAction(this.behaviors)\n    }\n    else {\n      this.action = new OIMenuAction(this.behaviors)\n    }\n    if (custom?.context) {\n      const CustomMenuAction = custom.context as unknown as typeof OIMenuContext\n      this.context = new CustomMenuAction(this.behaviors)\n    }\n    else {\n      this.context = new OIMenuContext(this.behaviors)\n    }\n  }\n\n  render(layer: HTMLElement): void\n  {\n    if (this.behaviors.configuration.menu.enable) {\n      this.layer = layer\n      if (this.behaviors.configuration.menu.action.enable) {\n        this.action.render(this.layer)\n      }\n      if (this.behaviors.configuration.menu.style.enable) {\n        this.style.render(this.layer)\n      }\n      if (this.behaviors.configuration.menu.intention.enable) {\n        this.intention.render(this.layer)\n      }\n      if (this.behaviors.configuration.menu.context.enable) {\n        this.context.render(this.layer)\n      }\n    }\n  }\n\n  update(): void\n  {\n    this.action.update()\n    this.intention.update()\n    this.style.update()\n  }\n\n  show(): void\n  {\n    this.action.show()\n    this.intention.show()\n    this.style.show()\n  }\n\n  hide(): void\n  {\n    this.action.hide()\n    this.intention.hide()\n    this.style.hide()\n  }\n\n  destroy(): void\n  {\n    this.action.destroy()\n    this.intention.destroy()\n    this.style.destroy()\n  }\n}\n","import { OIBehaviors } from \"../behaviors\"\nimport { OISVGRenderer } from \"../renderer\"\n\n/**\n * @group Manager\n */\nexport class OIMoveManager\n{\n  behaviors: OIBehaviors\n  origin?: {\n    left: number,\n    top: number,\n    x: number,\n    y: number\n  }\n\n  constructor(behaviors: OIBehaviors)\n  {\n    this.behaviors = behaviors\n  }\n\n  get renderer(): OISVGRenderer\n  {\n    return this.behaviors.renderer\n  }\n\n  start(evt: PointerEvent): void\n  {\n    this.origin = {\n      left: this.renderer.parent.scrollLeft,\n      top: this.renderer.parent.scrollTop,\n      x: evt.clientX,\n      y: evt.clientY,\n    }\n  }\n\n  continue(evt: PointerEvent): void\n  {\n    if (!this.origin) {\n      throw new Error(\"Can't move cause origin is undefined\")\n    }\n    const dx = evt.clientX - this.origin.x\n    const dy = evt.clientY - this.origin.y\n\n    this.renderer.parent.scrollTop = this.origin.top - dy\n    this.renderer.parent.scrollLeft = this.origin.left - dx\n  }\n\n  async end(evt: PointerEvent): Promise<void>\n  {\n    this.continue(evt)\n    this.origin = undefined\n  }\n}\n","/**\n * @group History\n */\nexport type TUndoRedoContext = {\n  canUndo: boolean\n  canRedo: boolean\n  empty: boolean\n  stackIndex: number\n  possibleUndoCount: number\n}\n\n/**\n * @group History\n */\nexport const getInitialUndoRedoContext = (): TUndoRedoContext => {\n  return {\n    stackIndex: 0,\n    possibleUndoCount: 0,\n    canRedo: false,\n    canUndo: false,\n    empty: true,\n  }\n}\n","import { TUndoRedoConfiguration } from \"../configuration\"\nimport { InternalEvent } from \"../event\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { IModel } from \"../model\"\nimport { IHistoryManager } from \"./IHistoryManager\"\nimport { TUndoRedoContext, getInitialUndoRedoContext } from \"./UndoRedoContext\"\n\n/**\n * @group History\n */\nexport class HistoryManager implements IHistoryManager\n{\n  #logger = LoggerManager.getLogger(LoggerClass.HISTORY)\n\n  configuration: TUndoRedoConfiguration\n  context: TUndoRedoContext\n  stack: IModel[]\n\n  constructor(configuration: TUndoRedoConfiguration)\n  {\n    this.#logger.info(\"constructor\", { configuration })\n    this.configuration = configuration\n    this.context = getInitialUndoRedoContext()\n    this.stack = []\n  }\n\n  get internalEvent(): InternalEvent\n  {\n    return InternalEvent.getInstance()\n  }\n\n  private updateContext(): void\n  {\n    this.context.canRedo = this.stack.length - 1 > this.context.stackIndex\n    this.context.canUndo = this.context.stackIndex > 0\n    this.context.empty = this.stack[this.context.stackIndex].symbols.length === 0\n  }\n\n  push(model: IModel): void\n  {\n    this.#logger.info(\"push\", { model })\n    if (this.context.stackIndex + 1 < this.stack.length) {\n      this.stack.splice(this.context.stackIndex + 1)\n    }\n\n    this.stack.push(model.clone())\n    this.context.stackIndex = this.stack.length - 1\n\n    if (this.stack.length > this.configuration.maxStackSize) {\n      this.stack.shift()\n      this.context.stackIndex--\n    }\n\n    this.updateContext()\n    this.internalEvent.emitContextChange(this.context)\n  }\n\n  updateStack(model: IModel): void\n  {\n    this.#logger.info(\"updateStack\", { model })\n    const index = this.stack.findIndex(m => m.modificationDate === model.modificationDate)\n    if (index > -1) {\n      this.stack.splice(index, 1, model.clone())\n    }\n    this.updateContext()\n    this.internalEvent.emitContextChange(this.context)\n  }\n\n  undo(): IModel\n  {\n    this.#logger.info(\"undo\")\n    if (this.context.canUndo) {\n      this.context.stackIndex--\n      this.updateContext()\n      this.internalEvent.emitContextChange(this.context)\n    }\n    const previousModel = this.stack[this.context.stackIndex].clone()\n    this.#logger.debug(\"undo\", previousModel)\n    return previousModel\n  }\n\n  redo(): IModel\n  {\n    this.#logger.info(\"redo\")\n    if (this.context.canRedo) {\n      this.context.stackIndex++\n      this.updateContext()\n      this.internalEvent.emitContextChange(this.context)\n    }\n    const nextModel = this.stack[this.context.stackIndex].clone()\n    this.#logger.debug(\"redo\", nextModel)\n    return nextModel\n  }\n}\n","import { TUndoRedoConfiguration } from \"../configuration\"\nimport { InternalEvent } from \"../event\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { OIModel } from \"../model\"\nimport { OIDecorator, OIStroke, TOISymbol, TPoint } from \"../primitive\"\nimport { TStyle } from \"../style\"\nimport { MatrixTransform, TMatrixTransform } from \"../transform\"\nimport { IHistoryManager } from \"./IHistoryManager\"\nimport { TUndoRedoContext, getInitialUndoRedoContext } from \"./UndoRedoContext\"\n\n/**\n * @group History\n */\nexport type TOIHistoryChanges = {\n  added?: TOISymbol[]\n  updated?: TOISymbol[]\n  erased?: TOISymbol[]\n  replaced?: { oldSymbols: TOISymbol[], newSymbols: TOISymbol[] }\n  matrix?: { symbols: TOISymbol[], matrix: TMatrixTransform }\n  translate?: { symbols: TOISymbol[], tx: number, ty: number }[]\n  scale?: { symbols: TOISymbol[], scaleX: number, scaleY: number, origin: TPoint }[]\n  rotate?: { symbols: TOISymbol[], angle: number, center: TPoint }[]\n  style?: { symbols: TOISymbol[], style?: TStyle, fontSize?: number }\n  order?: { symbols: TOISymbol[], position: \"first\" | \"last\" | \"forward\" | \"backward\" }\n  decorator?: { symbol: TOISymbol, decorator: OIDecorator, added: boolean }[]\n  group?: { symbols: TOISymbol[] }\n  ungroup?: { group: TOISymbol }\n}\n\n/**\n * @group History\n * @remarks used to send messages to the backend on undo or redo\n */\nexport type TOIHistoryBackendChanges = {\n  added?: OIStroke[]\n  erased?: OIStroke[]\n  replaced?: { oldStrokes: OIStroke[], newStrokes: OIStroke[] }\n  matrix?: { strokes: OIStroke[], matrix: TMatrixTransform },\n  translate?: { strokes: OIStroke[], tx: number, ty: number }[]\n  scale?: { strokes: OIStroke[], scaleX: number, scaleY: number, origin: TPoint }[]\n  rotate?: { strokes: OIStroke[], angle: number, center: TPoint }[]\n}\n\n/**\n * @group History\n */\nexport type TOIHistoryStackItem = {\n  changes: TOIHistoryChanges\n  model: OIModel\n}\n\n/**\n * @group History\n */\nexport class OIHistoryManager implements IHistoryManager\n{\n  #logger = LoggerManager.getLogger(LoggerClass.HISTORY)\n\n  configuration: TUndoRedoConfiguration\n  context: TUndoRedoContext\n  stack: TOIHistoryStackItem[]\n\n  constructor(configuration: TUndoRedoConfiguration)\n  {\n    this.#logger.info(\"constructor\", { configuration })\n    this.configuration = configuration\n    this.context = getInitialUndoRedoContext()\n    this.stack = []\n  }\n\n  get internalEvent(): InternalEvent\n  {\n    return InternalEvent.getInstance()\n  }\n\n  private updateContext(): void\n  {\n    this.context.canRedo = this.stack.length - 1 > this.context.stackIndex\n    this.context.canUndo = this.context.stackIndex > 0\n    this.context.empty = this.stack[this.context.stackIndex].model.symbols.length === 0\n  }\n\n  isChangesEmpty(changes: TOIHistoryChanges): boolean\n  {\n    return !(\n      changes.added?.length ||\n      changes.updated?.length ||\n      changes.erased?.length ||\n      changes.replaced?.oldSymbols.length ||\n      changes.matrix?.symbols.length ||\n      changes.translate?.length ||\n      changes.rotate?.length ||\n      changes.scale?.length ||\n      changes.style?.symbols?.length ||\n      changes.order?.symbols?.length ||\n      changes.decorator?.length ||\n      changes.group?.symbols.length ||\n      changes.ungroup?.group\n    )\n  }\n\n  init(model: OIModel): void\n  {\n    this.stack.push({ model: model.clone(), changes: {} })\n    this.internalEvent.emitContextChange(this.context)\n  }\n\n  push(model: OIModel, changes: TOIHistoryChanges): void\n  {\n    this.#logger.info(\"push\", { model, changes })\n    if (this.isChangesEmpty(changes)) return\n\n    if (this.context.stackIndex + 1 < this.stack.length) {\n      this.stack.splice(this.context.stackIndex + 1)\n    }\n\n    this.stack.push({ model: model.clone(), changes })\n    this.context.stackIndex = this.stack.length - 1\n\n    if (this.stack.length > this.configuration.maxStackSize) {\n      this.stack.shift()\n      this.context.stackIndex--\n    }\n\n    this.updateContext()\n    this.internalEvent.emitContextChange(this.context)\n  }\n\n  pop(): void\n  {\n    this.#logger.info(\"pop\")\n    this.stack.pop()\n    this.context.stackIndex = this.stack.length - 1\n    this.updateContext()\n  }\n\n  protected reverseChanges(changes: TOIHistoryChanges): TOIHistoryChanges\n  {\n    const reversedChanges: TOIHistoryChanges = {}\n    if (changes.added) {\n      reversedChanges.erased = changes.added\n    }\n    if (changes.erased) {\n      reversedChanges.added = changes.erased\n    }\n    if (changes.replaced) {\n      reversedChanges.replaced = {\n        newSymbols: changes.replaced.oldSymbols,\n        oldSymbols: changes.replaced.newSymbols\n      }\n    }\n    if (changes.matrix) {\n      reversedChanges.matrix = {\n        symbols: changes.matrix.symbols,\n        matrix: new MatrixTransform(changes.matrix.matrix.xx, changes.matrix.matrix.yx, changes.matrix.matrix.xy, changes.matrix.matrix.yy, changes.matrix.matrix.tx, changes.matrix.matrix.ty).invert()\n      }\n    }\n    if (changes.translate?.length) {\n      reversedChanges.translate = changes.translate.map(tr =>\n      {\n        return {\n          symbols: tr.symbols,\n          tx: -tr.tx,\n          ty: -tr.ty,\n        }\n      })\n    }\n    if (changes.rotate?.length) {\n      reversedChanges.rotate = changes.rotate.map(tr =>\n      {\n        return {\n          symbols: tr.symbols,\n          angle: 2 * Math.PI - tr.angle,\n          center: tr.center\n        }\n      })\n    }\n    if (changes.scale?.length) {\n      reversedChanges.scale = changes.scale.map(tr =>\n      {\n        return {\n          symbols: tr.symbols,\n          origin: tr.origin,\n          scaleX: 1 / tr.scaleX,\n          scaleY: 1 / tr.scaleY\n        }\n      })\n    }\n\n    return reversedChanges\n  }\n\n  undo(): TOIHistoryStackItem\n  {\n    this.#logger.info(\"undo\")\n    const currentStackItem = this.stack[this.context.stackIndex]\n    if (this.context.canUndo) {\n      this.context.stackIndex--\n      this.updateContext()\n      this.internalEvent.emitContextChange(this.context)\n    }\n    const previousStackItem = this.stack[this.context.stackIndex]\n    this.#logger.debug(\"undo\", previousStackItem)\n    return {\n      model: previousStackItem.model,\n      changes: this.reverseChanges(currentStackItem.changes)\n    }\n  }\n\n  redo(): TOIHistoryStackItem\n  {\n    this.#logger.info(\"redo\")\n    if (this.context.canRedo) {\n      this.context.stackIndex++\n      this.updateContext()\n      this.internalEvent.emitContextChange(this.context)\n    }\n    const nextStackItem = this.stack[this.context.stackIndex]\n    this.#logger.debug(\"redo\", nextStackItem)\n    return nextStackItem\n  }\n\n  clear(): void\n  {\n    this.context = getInitialUndoRedoContext()\n    this.stack = []\n  }\n}\n","import { Intention, SELECTION_MARGIN } from \"../Constants\"\nimport { Configuration, TConfiguration, TRenderingConfiguration } from \"../configuration\"\nimport { InternalEvent } from \"../event\"\nimport { OIPointerEventGrabber } from \"../grabber\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { OIModel, TExport, TJIIXTextElement } from \"../model\"\nimport\n{\n  Box,\n  EdgeKind,\n  OIDecorator,\n  TOIEdge,\n  OIEdgeArc,\n  OIEdgeLine,\n  OIEdgePolyLine,\n  TOIShape,\n  OIShapeCircle,\n  OIShapeEllipse,\n  OIShapePolygon,\n  OIStroke,\n  OISymbolGroup,\n  OIText,\n  ShapeKind,\n  SymbolType,\n  TOISymbol,\n  TPoint,\n  TPointer,\n  convertPartialStrokesToOIStrokes\n} from \"../primitive\"\nimport { OIRecognizer } from \"../recognizer\"\nimport { OISVGRenderer, SVGBuilder } from \"../renderer\"\nimport { DefaultStyle, StyleManager, TStyle, TTheme } from \"../style\"\nimport\n{\n  OIConversionManager,\n  OISnapManager,\n  OIWriteManager,\n  OIGestureManager,\n  OISelectionManager,\n  OIResizeManager,\n  OIRotationManager,\n  OITranslateManager,\n  OITextManager,\n  OIEraseManager,\n  OIDebugSVGManager,\n  OIMoveManager,\n  OIMenuManager\n} from \"../manager\"\nimport { OIHistoryManager, TOIHistoryBackendChanges, TOIHistoryChanges } from \"../history\"\nimport { PartialDeep, mergeDeep } from \"../utils\"\nimport { IBehaviors } from \"./IBehaviors\"\nimport { TBehaviorOptions } from \"./TBehaviorOptions\"\n\n/**\n * @group Behavior\n */\nexport class OIBehaviors implements IBehaviors\n{\n  name = \"OIBehaviors\"\n  #logger = LoggerManager.getLogger(LoggerClass.BEHAVIORS)\n  #configuration: TConfiguration\n  #model: OIModel\n  #intention: Intention\n  #layerInfosTimer?: ReturnType<typeof setTimeout>\n  layerInfos: HTMLDivElement\n\n  grabber: OIPointerEventGrabber\n  renderer: OISVGRenderer\n  recognizer: OIRecognizer\n\n  styler: StyleManager\n  history: OIHistoryManager\n  writer: OIWriteManager\n  eraser: OIEraseManager\n  gesture: OIGestureManager\n  resizer: OIResizeManager\n  rotator: OIRotationManager\n  translator: OITranslateManager\n  converter: OIConversionManager\n  texter: OITextManager\n  selector: OISelectionManager\n  svgDebugger: OIDebugSVGManager\n  snaps: OISnapManager\n  move: OIMoveManager\n  menu: OIMenuManager\n\n  constructor(options: PartialDeep<TBehaviorOptions>, layerInfos: HTMLDivElement)\n  {\n    this.#logger.info(\"constructor\", { options })\n    this.#configuration = new Configuration(options?.configuration)\n    this.layerInfos = layerInfos\n    this.styler = new StyleManager(Object.assign({}, DefaultStyle, options?.penStyle), options?.theme)\n\n    this.grabber = new OIPointerEventGrabber(this.#configuration.grabber)\n    this.recognizer = new OIRecognizer(this.#configuration.server, this.#configuration.recognition)\n    this.renderer = new OISVGRenderer(this.#configuration.rendering)\n\n    this.history = new OIHistoryManager(this.#configuration[\"undo-redo\"])\n    this.writer = new OIWriteManager(this)\n    this.eraser = new OIEraseManager(this)\n    this.gesture = new OIGestureManager(this, options.behaviors?.gesture)\n    this.resizer = new OIResizeManager(this)\n    this.rotator = new OIRotationManager(this)\n    this.translator = new OITranslateManager(this)\n    this.converter = new OIConversionManager(this, options.fontStyle)\n    this.texter = new OITextManager(this)\n    this.selector = new OISelectionManager(this)\n    this.svgDebugger = new OIDebugSVGManager(this)\n    this.snaps = new OISnapManager(this, options.behaviors?.snap)\n    this.move = new OIMoveManager(this)\n    this.menu = new OIMenuManager(this, options.behaviors?.menu)\n\n    this.#intention = Intention.Write\n    this.#model = new OIModel(this.#configuration.rendering.minWidth, this.#configuration.rendering.minHeight, this.configuration.rendering.guides.gap)\n\n  }\n\n  //#region Properties\n  get internalEvent(): InternalEvent\n  {\n    return InternalEvent.getInstance()\n  }\n\n  get intention(): Intention\n  {\n    return this.#intention\n  }\n  set intention(i: Intention)\n  {\n    this.#intention = i\n    switch (this.#intention) {\n      case Intention.Erase:\n        this.renderer.parent?.classList.remove(\"draw\")\n        this.renderer.parent?.classList.add(\"erase\")\n        this.renderer.parent?.classList.remove(\"select\")\n        this.renderer.parent?.classList.remove(\"move\")\n        break\n      case Intention.Select:\n        this.renderer.parent?.classList.remove(\"draw\")\n        this.renderer.parent?.classList.remove(\"erase\")\n        this.renderer.parent?.classList.add(\"select\")\n        this.renderer.parent?.classList.remove(\"move\")\n        break\n      case Intention.Move:\n        this.renderer.parent?.classList.remove(\"draw\")\n        this.renderer.parent?.classList.remove(\"erase\")\n        this.renderer.parent?.classList.remove(\"select\")\n        this.renderer.parent?.classList.add(\"move\")\n        break\n      default:\n        this.renderer.parent?.classList.add(\"draw\")\n        this.renderer.parent?.classList.remove(\"erase\")\n        this.renderer.parent?.classList.remove(\"select\")\n        this.renderer.parent?.classList.remove(\"move\")\n        break\n    }\n    this.unselectAll()\n  }\n\n  get model(): OIModel\n  {\n    return this.#model\n  }\n\n  get configuration(): TConfiguration\n  {\n    return this.#configuration\n  }\n  set renderingConfiguration(renderingConfiguration: TRenderingConfiguration)\n  {\n    this.configuration.rendering = mergeDeep(this.configuration.rendering, renderingConfiguration)\n    const height = Math.max(this.renderer.parent.clientHeight, this.configuration.rendering.minHeight)\n    const width = Math.max(this.renderer.parent.clientWidth, this.configuration.rendering.minWidth)\n    this.renderer.resize(height, width)\n    this.model.rowHeight = this.configuration.rendering.guides.gap\n    this.history.stack.forEach(i => i.model.rowHeight = this.model.rowHeight)\n  }\n  //#endregion\n\n  //#region Style\n  get currentPenStyle(): TStyle\n  {\n    return this.styler.currentPenStyle\n  }\n\n  get penStyle(): TStyle\n  {\n    return this.styler.penStyle\n  }\n  async setPenStyle(penStyle?: TStyle | undefined): Promise<void>\n  {\n    this.#logger.info(\"setPenStyle\", { penStyle })\n    this.styler.setPenStyle(Object.assign({}, this.currentPenStyle, penStyle))\n    return Promise.resolve()\n  }\n\n  get penStyleClasses(): string\n  {\n    return this.styler.penStyleClasses\n  }\n  async setPenStyleClasses(penStyleClasses?: string | undefined): Promise<void>\n  {\n    this.#logger.info(\"setPenStyleClasses\", { penStyleClasses })\n    this.styler.setPenStyleClasses(penStyleClasses)\n    return Promise.resolve()\n  }\n\n  get theme(): TTheme\n  {\n    return this.styler.theme\n  }\n  async setTheme(theme?: TTheme): Promise<void>\n  {\n    this.#logger.info(\"setTheme\", { theme })\n    this.styler.setTheme(theme)\n    return Promise.resolve()\n  }\n  //#endregion\n\n\n  updateLayerInfos(): void\n  {\n    clearTimeout(this.#layerInfosTimer)\n    this.#layerInfosTimer = setTimeout(() =>\n    {\n      this.menu.update()\n      this.svgDebugger.apply()\n      this.recognizer.waitForIdle()\n    }, 1500)\n  }\n\n  protected onPointerDown(evt: PointerEvent, pointer: TPointer): void\n  {\n    this.#logger.debug(\"onPointerDown\", { evt, pointer })\n    this.internalEvent.emitIdle(false)\n    try {\n      this.unselectAll()\n      switch (this.#intention) {\n        case Intention.Erase:\n          this.eraser.start(pointer)\n          break\n        case Intention.Select:\n          this.selector.start(pointer)\n          break\n        case Intention.Move:\n          this.move.start(evt)\n          break\n        default:\n          this.writer.start(this.currentPenStyle, pointer, evt.pointerType)\n          break\n      }\n    }\n    catch (error) {\n      this.#logger.error(\"onPointerDown\", error)\n      this.grabber.stopPointerEvent()\n      this.internalEvent.emitError(error as Error)\n    }\n    finally {\n      this.svgDebugger.apply()\n    }\n  }\n\n  protected onPointerMove(evt: PointerEvent, pointer: TPointer): void\n  {\n    this.#logger.debug(\"onPointerMove\", { pointer })\n    try {\n      switch (this.#intention) {\n        case Intention.Erase:\n          this.eraser.continue(pointer)\n          break\n        case Intention.Select:\n          this.selector.continue(pointer)\n          break\n        case Intention.Move:\n          this.move.continue(evt)\n          break\n        default:\n          this.writer.continue(pointer)\n          break\n      }\n    }\n    catch (error) {\n      this.#logger.error(\"onPointerMove\", error)\n      this.internalEvent.emitError(error as Error)\n    }\n    finally {\n      this.svgDebugger.apply()\n    }\n  }\n\n  protected async onPointerUp(evt: PointerEvent, pointer: TPointer): Promise<void>\n  {\n    this.#logger.debug(\"onPointerUp\", { pointer })\n    try {\n      switch (this.#intention) {\n        case Intention.Erase:\n          this.eraser.end(pointer)\n          break\n        case Intention.Select:\n          this.selector.end(pointer)\n          break\n        case Intention.Move:\n          this.move.end(evt)\n          break\n        default:\n          this.writer.end(pointer)\n          break\n      }\n    }\n    catch (error) {\n      this.undo()\n      this.#logger.error(\"onPointerUp\", error)\n      this.internalEvent.emitError(error as Error)\n    }\n    finally {\n      this.updateLayerInfos()\n    }\n  }\n\n  protected async onContextMenu(el: HTMLElement, point: TPoint): Promise<void>\n  {\n    if (this.intention === Intention.Select) {\n      let found = false\n      let currentEl: HTMLElement | null = el\n      const symbolTypesAllowed = [SymbolType.Edge.toString(), SymbolType.Shape.toString(), SymbolType.Stroke.toString(), SymbolType.Text.toString()]\n      while (currentEl && currentEl.tagName !== \"svg\" && !found) {\n        if (symbolTypesAllowed.includes(currentEl.getAttribute(\"type\") as string)) {\n          found = true\n        }\n        else {\n          currentEl = currentEl.parentElement\n        }\n      }\n      this.unselectAll()\n      if (currentEl?.id) {\n        this.model.selectSymbol(currentEl.id)\n        this.renderer.drawSymbol(this.model.symbolsSelected[0])\n        this.selector.drawSelectedGroup(this.model.symbolsSelected)\n      }\n      else {\n        this.menu.context.position.x = point.x + this.renderer.parent.clientLeft\n        this.menu.context.position.y = point.y + this.renderer.parent.clientTop\n        this.menu.context.show()\n      }\n    }\n  }\n\n  async init(domElement: HTMLElement): Promise<void>\n  {\n    this.#logger.info(\"init\", { domElement })\n\n    this.renderer.init(domElement)\n    this.menu.render(this.layerInfos)\n\n    this.grabber.attach(this.renderer.layer as unknown as HTMLElement)\n    this.grabber.onPointerDown = this.onPointerDown.bind(this)\n    this.grabber.onPointerMove = this.onPointerMove.bind(this)\n    this.grabber.onPointerUp = this.onPointerUp.bind(this)\n    this.grabber.onContextMenu = this.onContextMenu.bind(this)\n\n    this.model.width = Math.max(domElement.clientWidth, this.#configuration.rendering.minWidth)\n    this.model.height = Math.max(domElement.clientHeight, this.#configuration.rendering.minHeight)\n    this.model.rowHeight = this.configuration.rendering.guides.gap\n    this.history.init(this.model)\n\n    await this.recognizer.init()\n    await this.setPenStyle(this.penStyle)\n    await this.setTheme(this.theme)\n    await this.setPenStyleClasses(this.penStyleClasses)\n  }\n\n  async changeLanguage(code: string): Promise<void>\n  {\n    try {\n      this.#logger.info(\"changeLanguage\", { code })\n      this.internalEvent.emitIdle(false)\n      this.configuration.recognition.lang = code\n      await this.recognizer.destroy()\n      this.recognizer = new OIRecognizer(this.#configuration.server, this.#configuration.recognition)\n      await this.recognizer.init()\n      await this.recognizer.addStrokes(this.model.symbols.filter(s => s.type === SymbolType.Stroke) as OIStroke[], false)\n    }\n    catch (error) {\n      this.#logger.error(\"changeLanguage\", error)\n      this.internalEvent.emitError(error as Error)\n      throw error\n    }\n    finally {\n      this.updateLayerInfos()\n    }\n  }\n\n  protected createShape(partialShape: PartialDeep<TOIShape>): TOIShape\n  {\n    switch (partialShape.kind) {\n      case ShapeKind.Circle:\n        return OIShapeCircle.create(partialShape as PartialDeep<OIShapeCircle>)\n      case ShapeKind.Ellipse:\n        return OIShapeEllipse.create(partialShape as PartialDeep<OIShapeEllipse>)\n      case ShapeKind.Polygon:\n        return OIShapePolygon.create(partialShape as PartialDeep<OIShapePolygon>)\n      default:\n        throw new Error(`Unable to create shape, kind: \"${ partialShape.kind }\" is unknown`)\n    }\n  }\n\n  protected createEdge(partialEdge: PartialDeep<TOIEdge>): TOIEdge\n  {\n    switch (partialEdge.kind) {\n      case EdgeKind.Arc:\n        return OIEdgeArc.create(partialEdge as PartialDeep<OIEdgeArc>)\n      case EdgeKind.Line:\n        return OIEdgeLine.create(partialEdge as PartialDeep<OIEdgeLine>)\n      case EdgeKind.PolyEdge:\n        return OIEdgePolyLine.create(partialEdge as PartialDeep<OIEdgePolyLine>)\n      default:\n        throw new Error(`Unable to create edge, kind: \"${ partialEdge.kind }\" is unknown`)\n    }\n  }\n\n  protected createGroup(partialGroup: PartialDeep<OISymbolGroup>): OISymbolGroup\n  {\n    if (!partialGroup.children?.length) {\n      throw new Error(`Unable to create group, no children`)\n    }\n\n    const children = partialGroup.children.map(partialSymbol =>\n    {\n      switch (partialSymbol?.type) {\n        case SymbolType.Stroke:\n          return OIStroke.create(partialSymbol as PartialDeep<OIStroke>)\n        case SymbolType.Shape:\n          return this.createShape(partialSymbol as PartialDeep<TOIShape>)\n        case SymbolType.Edge:\n          return this.createEdge(partialSymbol as PartialDeep<TOIEdge>)\n        case SymbolType.Text:\n          return OIText.create(partialSymbol as PartialDeep<OIText>)\n        case SymbolType.Group:\n          return this.createGroup(partialSymbol as PartialDeep<OISymbolGroup>)\n        default:\n          throw new Error(`Unable to create group, symbol type '${ JSON.stringify(partialSymbol) } is unknow`)\n      }\n    })\n    const group = new OISymbolGroup(children, partialGroup.style)\n    if (partialGroup.id) {\n      group.id = partialGroup.id\n    }\n    if (partialGroup.decorators) {\n      group.decorators = partialGroup.decorators.map(d => new OIDecorator(d!.kind!, d!.style!))\n    }\n    return group\n  }\n\n  protected createStroke(partialSymbol: PartialDeep<OIStroke>): OIStroke\n  {\n    return OIStroke.create(partialSymbol as PartialDeep<OIStroke>)\n  }\n\n  protected createText(partialSymbol: PartialDeep<OIText>): OIText\n  {\n    return OIText.create(partialSymbol as PartialDeep<OIText>)\n  }\n\n  async createSymbol(partialSymbol: PartialDeep<TOISymbol>): Promise<TOISymbol>\n  {\n    try {\n      switch (partialSymbol.type) {\n        case SymbolType.Stroke:\n          return await this.addSymbol(this.createStroke(partialSymbol))\n        case SymbolType.Shape:\n          return await this.addSymbol(this.createShape(partialSymbol))\n        case SymbolType.Edge:\n          return await this.addSymbol(this.createEdge(partialSymbol))\n        case SymbolType.Text:\n          return await this.addSymbol(this.createText(partialSymbol))\n        case SymbolType.Group:\n          return await this.addSymbol(this.createGroup(partialSymbol))\n        default:\n          throw new Error(`Unable to create symbol, type: \"${ partialSymbol.type }\" is unknown`)\n      }\n    }\n    catch (error) {\n      this.#logger.error(\"createSymbol\", error)\n      this.updateLayerInfos()\n      this.internalEvent.emitError(error as Error)\n      throw error\n    }\n  }\n\n  async createSymbols(partialSymbols: PartialDeep<TOISymbol>[]): Promise<TOISymbol[]>\n  {\n    try {\n      const errors: string[] = []\n      const symbols: TOISymbol[] = []\n      partialSymbols.forEach(partialSymbol =>\n      {\n        try {\n          switch (partialSymbol.type) {\n            case SymbolType.Stroke:\n              symbols.push(this.createStroke(partialSymbol))\n              break\n            case SymbolType.Shape:\n              symbols.push(this.createShape(partialSymbol))\n              break\n            case SymbolType.Edge:\n              symbols.push(this.createEdge(partialSymbol))\n              break\n            case SymbolType.Text:\n              symbols.push(this.createText(partialSymbol))\n              break\n            case SymbolType.Group:\n              symbols.push(this.createGroup(partialSymbol))\n              break\n            default:\n              errors.push(`Unable to create symbol, type: \"${ partialSymbol.type }\" is unknown`)\n          }\n        } catch (error) {\n          errors.push(((error as Error).message || error) as string)\n        }\n      })\n      if (errors.length) {\n        throw new Error(errors.join(\"\\n\"))\n      }\n      return await this.addSymbols(symbols)\n    } catch (error) {\n      this.#logger.error(\"importPointEvents\", error)\n      this.internalEvent.emitError(error as Error)\n      throw error\n    }\n  }\n\n  async addSymbol(sym: TOISymbol, addToHistory = true): Promise<TOISymbol>\n  {\n    this.#logger.info(\"addSymbol\", { sym })\n    this.internalEvent.emitIdle(false)\n    if (sym.type === SymbolType.Text) {\n      this.texter.updateBounds(sym)\n    }\n    else if (sym.type === SymbolType.Group) {\n      sym.extractSymbols().forEach(t =>\n      {\n        if (t.type === SymbolType.Text) {\n          this.texter.updateBounds(t)\n        }\n      })\n    }\n    this.model.addSymbol(sym)\n    this.renderer.drawSymbol(sym)\n\n    const strokes = this.extractStrokesFromSymbols([sym])\n    this.recognizer.addStrokes(strokes, false)\n\n    if (addToHistory) {\n      this.history.push(this.model, { added: [sym] })\n    }\n    this.updateLayerInfos()\n    return sym\n  }\n\n  async addSymbols(symList: TOISymbol[], addToHistory = true): Promise<TOISymbol[]>\n  {\n    this.#logger.info(\"addSymbol\", { symList })\n    this.internalEvent.emitIdle(false)\n    symList.forEach(s =>\n    {\n      if (s.type === SymbolType.Text) {\n        this.texter.updateBounds(s)\n      }\n      else if (s.type === SymbolType.Group) {\n        s.extractSymbols().forEach(t =>\n        {\n          if (t.type === SymbolType.Text) {\n            this.texter.updateBounds(t)\n          }\n        })\n      }\n      this.model.addSymbol(s)\n      this.renderer.drawSymbol(s)\n    })\n    const strokes = this.extractStrokesFromSymbols(symList)\n    this.recognizer.addStrokes(strokes, false)\n    if (addToHistory) {\n      this.history.push(this.model, { added: symList })\n    }\n    this.updateLayerInfos()\n    return symList\n  }\n\n  async updateSymbol(sym: TOISymbol, addToHistory = true): Promise<TOISymbol>\n  {\n    this.#logger.info(\"updateSymbol\", { sym })\n    this.internalEvent.emitIdle(false)\n    if (sym.type === SymbolType.Text) {\n      this.texter.updateBounds(sym)\n    }\n    else if (sym.type === SymbolType.Group) {\n      sym.extractSymbols().forEach(t =>\n      {\n        if (t.type === SymbolType.Text) {\n          this.texter.updateBounds(t)\n        }\n      })\n    }\n    this.model.updateSymbol(sym)\n    this.renderer.drawSymbol(sym)\n    const strokes = this.extractStrokesFromSymbols([sym])\n    this.recognizer.replaceStrokes(strokes.map(s => s.id), strokes)\n    if (addToHistory) {\n      this.history.push(this.model, { updated: [sym] })\n    }\n    this.updateLayerInfos()\n    return sym\n  }\n\n  async updateSymbols(symList: TOISymbol[], addToHistory = true): Promise<TOISymbol[]>\n  {\n    this.#logger.info(\"updateSymbol\", { symList })\n    this.internalEvent.emitIdle(false)\n    symList.forEach(s =>\n    {\n      if (s.type === SymbolType.Text) {\n        this.texter.updateBounds(s)\n      }\n      else if (s.type === SymbolType.Group) {\n        s.extractSymbols().forEach(t =>\n        {\n          if (t.type === SymbolType.Text) {\n            this.texter.updateBounds(t)\n          }\n        })\n      }\n      this.model.updateSymbol(s)\n      this.renderer.drawSymbol(s)\n    })\n    const strokes = this.extractStrokesFromSymbols(symList)\n    this.recognizer.replaceStrokes(strokes.map(s => s.id), strokes)\n    if (addToHistory) {\n      this.history.push(this.model, { updated: symList })\n    }\n    this.updateLayerInfos()\n    return symList\n  }\n\n  updateSymbolsStyle(symbolIds: string[], style: TStyle, addToHistory = true): void\n  {\n    this.#logger.info(\"updateSymbolsStyle\", { symbolIds, style })\n    const symbols: TOISymbol[] = []\n    this.model.symbols.forEach(s =>\n    {\n      if (symbolIds.includes(s.id)) {\n        s.style = Object.assign({}, s.style, style)\n        if (s.type === SymbolType.Text) {\n          s.chars.forEach(c =>\n          {\n            if (style.color) {\n              c.color = style.color\n            }\n          })\n        }\n        else if (s.type === SymbolType.Group) {\n          s.updateChildrenStyle()\n        }\n        this.renderer.drawSymbol(s)\n        this.model.updateSymbol(s)\n        s.modificationDate = Date.now()\n        symbols.push(s)\n      }\n    })\n    if (symbols.length) {\n      symbols.forEach(s =>\n      {\n        if (s.type === SymbolType.Text) {\n          const lastWidth = s.bounds.width\n          this.texter.updateBounds(s)\n          const tx = s.bounds.width - lastWidth\n          if (tx !== 0) {\n            this.texter.moveTextAfter(s, tx)\n          }\n        }\n      })\n    }\n    if (addToHistory && symbols.length) {\n      this.history.push(this.model, { style: { symbols, style } })\n    }\n  }\n\n  updateTextFontStyle(textIds: string[], { fontSize, fontWeight }: { fontSize?: number, fontWeight?: \"normal\" | \"bold\" }): void\n  {\n    this.#logger.info(\"updateTextFontStyle\", { textIds, fontSize, fontWeight })\n    const symbols: (OIText | OISymbolGroup)[] = []\n    const translate: { symbols: TOISymbol[], tx: number, ty: number }[] = []\n    this.model.symbols.forEach(s =>\n    {\n      if (textIds.includes(s.id)) {\n        if (s.type === SymbolType.Text) {\n          s.chars.forEach(tc =>\n          {\n            if (fontSize) {\n              tc.fontSize = fontSize\n            }\n            if (fontWeight) {\n              tc.fontWeight = fontWeight\n            }\n          })\n          const lastWidth = s.bounds.width\n          this.texter.updateBounds(s)\n          this.renderer.drawSymbol(s)\n          const tx = s.bounds.width - lastWidth\n          if (tx !== 0) {\n            const symbolsTranslated = this.texter.moveTextAfter(s, tx)\n            if (symbolsTranslated?.length) {\n              translate.push({\n                symbols: symbolsTranslated,\n                tx,\n                ty: 0\n              })\n            }\n          }\n          s.modificationDate = Date.now()\n          symbols.push(s)\n        }\n        else if ((s.type === SymbolType.Group && s.extractSymbols().some(c => c.type === SymbolType.Text))) {\n          s.extractSymbols().forEach(c =>\n          {\n            if (c.type === SymbolType.Text) {\n              c.chars.forEach(tc =>\n              {\n                if (fontSize) {\n                  tc.fontSize = fontSize\n                }\n                if (fontWeight) {\n                  tc.fontWeight = fontWeight\n                }\n              })\n              const lastWidth = s.bounds.width\n              this.texter.updateBounds(c)\n              const tx = s.bounds.width - lastWidth\n              const symbolsTranslated = this.texter.moveTextAfter(c, tx)\n              if (symbolsTranslated?.length) {\n                translate.push({\n                  symbols: symbolsTranslated,\n                  tx,\n                  ty: 0\n                })\n              }\n              c.modificationDate = Date.now()\n            }\n          })\n          s.modificationDate = Date.now()\n          this.renderer.drawSymbol(s)\n          symbols.push(s)\n\n        }\n      }\n    })\n    if (symbols.length) {\n      this.history.push(this.model, { style: { symbols, fontSize }, translate })\n    }\n  }\n\n  async replaceSymbols(oldSymbols: TOISymbol[], newSymbols: TOISymbol[], addToHistory = true): Promise<void>\n  {\n    this.#logger.info(\"replaceSymbol\", { oldSymbols, newSymbols })\n    this.internalEvent.emitIdle(false)\n\n    const oldStrokes = this.extractStrokesFromSymbols(oldSymbols)\n    const newStrokes = this.extractStrokesFromSymbols(newSymbols)\n\n    const firstSym = oldSymbols[0]\n\n    if (firstSym) {\n      this.model.replaceSymbol(firstSym.id, newSymbols)\n      this.renderer.replaceSymbol(firstSym.id, newSymbols)\n\n      oldSymbols.slice(1).forEach(s =>\n      {\n        this.renderer.removeSymbol(s.id)\n        this.model.removeSymbol(s.id)\n      })\n\n      if (oldStrokes.length && newStrokes.length) {\n        this.recognizer.replaceStrokes(oldStrokes.map(s => s.id), newStrokes)\n      }\n      else if (oldStrokes.length) {\n        this.recognizer.eraseStrokes(oldStrokes.map(s => s.id))\n      }\n      else {\n        this.recognizer.addStrokes(newStrokes, false)\n      }\n\n      if (addToHistory) {\n        this.history.push(this.model, { replaced: { oldSymbols, newSymbols } })\n      }\n      this.updateLayerInfos()\n    }\n  }\n\n  changeOrderSymbol(symbol: TOISymbol, position: \"first\" | \"last\" | \"forward\" | \"backward\"): void\n  {\n    this.model.changeOrderSymbol(symbol.id, position)\n    this.renderer.changeOrderSymbol(symbol, position)\n    this.history.push(this.model, { order: { symbols: [symbol], position } })\n  }\n\n  changeOrderSymbols(symbols: TOISymbol[], position: \"first\" | \"last\" | \"forward\" | \"backward\")\n  {\n    symbols.forEach(s =>\n    {\n      this.model.changeOrderSymbol(s.id, position)\n      this.renderer.changeOrderSymbol(s, position)\n    })\n    this.history.push(this.model, { order: { symbols, position } })\n  }\n\n  groupSymbols(symbols: TOISymbol[]): OISymbolGroup\n  {\n    const group = this.createGroup({ children: symbols })\n    symbols.forEach(s =>\n    {\n      this.model.removeSymbol(s.id)\n      this.renderer.removeSymbol(s.id)\n    })\n    this.model.addSymbol(group)\n    this.history.push(this.model, { group: { symbols } })\n    return group\n  }\n\n  ungroupSymbol(group: OISymbolGroup): TOISymbol[]\n  {\n    group.children.forEach(s => this.renderer.drawSymbol(s))\n    this.renderer.removeSymbol(group.id)\n    this.model.replaceSymbol(group.id, group.children)\n    this.history.push(this.model, { ungroup: { group } })\n    return group.children\n  }\n\n  async groupStrokesByJIIXElement(): Promise<void>\n  {\n    await this.export([\"application/vnd.myscript.jiix\"])\n    const strokes = this.model.symbols.filter(s => s.type === SymbolType.Stroke)\n    const jiix = this.model.exports?.[\"application/vnd.myscript.jiix\"]\n    jiix?.elements?.forEach(el =>\n    {\n      if (el.type === \"Text\") {\n        const jiixText = el as TJIIXTextElement\n        jiixText.words?.forEach(w =>\n        {\n          const wordStrokes = strokes.filter(s => w.items?.map(s => s[\"full-id\"]).includes(s.id))\n          if (wordStrokes.length) {\n            const orginDeco: OIDecorator[] = []\n            let orginStyle: TStyle = wordStrokes[0].style\n            if (w.items?.length !== wordStrokes.length) {\n              w.items?.forEach(i =>\n              {\n                const sym = this.model.getRootSymbol(i[\"full-id\"] as string)\n                if (sym?.type === SymbolType.Group) {\n                  orginDeco.push(...sym.decorators)\n                  orginStyle = Object.assign({}, orginStyle, sym.style)\n                  wordStrokes.push(...sym.extractStrokes())\n                  this.model.removeSymbol(sym.id)\n                  this.renderer.removeSymbol(sym.id)\n                }\n              })\n            }\n            const wordSymb = this.createGroup({ children: wordStrokes, style: orginStyle })\n            orginDeco.forEach(d =>\n            {\n              if (!wordSymb.decorators.some(wd => wd.kind === d.kind)) {\n                wordSymb.decorators.push(d)\n              }\n            })\n            wordStrokes.map(s =>\n            {\n              this.model.removeSymbol(s.id)\n              this.renderer.removeSymbol(s.id)\n            })\n            this.model.addSymbol(wordSymb)\n            this.renderer.drawSymbol(wordSymb)\n          }\n        })\n      }\n      else {\n        const strokesAssociated = strokes.filter(s => el.items?.map(s => s[\"full-id\"]).includes(s.id))\n        if (strokesAssociated.length) {\n          const group = this.createGroup({ children: strokesAssociated })\n          strokesAssociated.map(s =>\n          {\n            this.model.removeSymbol(s.id)\n            this.renderer.removeSymbol(s.id)\n          })\n          this.model.addSymbol(group)\n          this.renderer.drawSymbol(group)\n        }\n      }\n    })\n  }\n\n  async removeSymbol(id: string, addToHistory = true): Promise<void>\n  {\n    this.#logger.info(\"removeSymbol\", { id })\n    const symbol = this.model.getRootSymbol(id)\n    if (symbol) {\n      this.internalEvent.emitIdle(false)\n      if (symbol.type === SymbolType.Group) {\n        const groupStrokeIds = symbol.extractStrokes().map(s => s.id)\n        symbol.removeChilds([id])\n        if (symbol.children.length) {\n          this.model.updateSymbol(symbol)\n          this.renderer.drawSymbol(symbol)\n          if (groupStrokeIds.includes(id)) {\n            this.recognizer.eraseStrokes([id])\n          }\n        }\n        else {\n          this.recognizer.eraseStrokes(groupStrokeIds)\n          this.model.removeSymbol(symbol.id)\n          this.renderer.removeSymbol(symbol.id)\n        }\n      }\n      else {\n        this.recognizer.eraseStrokes([id])\n        this.model.removeSymbol(symbol.id)\n        this.renderer.removeSymbol(symbol.id)\n      }\n      if (addToHistory) {\n        this.history.push(this.model, { erased: [symbol] })\n      }\n      this.updateLayerInfos()\n    }\n    else {\n      this.renderer.removeSymbol(id)\n      this.recognizer.eraseStrokes([id])\n    }\n  }\n\n  async removeSymbols(ids: string[], addToHistory = true): Promise<TOISymbol[]>\n  {\n    this.#logger.info(\"removeSymbol\", { ids })\n    const symbolsToRemove: TOISymbol[] = []\n    const symbolsToUpdate: TOISymbol[] = []\n    const strokesIds: string[] = []\n    ids.forEach(id =>\n    {\n      const sym = this.model.getRootSymbol(id)\n      if (sym) {\n        if (sym.id === id) {\n          symbolsToRemove.push(sym)\n          switch (sym.type) {\n            case SymbolType.Stroke:\n              strokesIds.push(sym.id)\n              break\n            case SymbolType.Group:\n              strokesIds.push(...sym.extractStrokes().map(s => s.id))\n              break\n          }\n        }\n        else {\n          /** we want to remove element in group */\n          const gr = sym.clone() as OISymbolGroup\n          strokesIds.push(...gr.extractStrokes().map(s => s.id).filter(id => ids.includes(id)))\n          gr.removeChilds(ids)\n          if (gr.children.length) {\n            symbolsToUpdate.push(gr)\n          }\n          else {\n            symbolsToRemove.push(gr)\n          }\n        }\n      }\n    })\n    this.recognizer.eraseStrokes(strokesIds)\n    symbolsToRemove.forEach(s =>\n    {\n      this.model.removeSymbol(s.id)\n      this.renderer.removeSymbol(s.id)\n    })\n\n    symbolsToUpdate.forEach(s =>\n    {\n      this.model.updateSymbol(s)\n      this.renderer.drawSymbol(s)\n    })\n\n\n    if (addToHistory) {\n      const changes: TOIHistoryChanges = {}\n      if (symbolsToRemove.length || symbolsToUpdate.length) {\n        if (symbolsToRemove.length) {\n          changes.erased = symbolsToRemove\n        }\n        if (symbolsToUpdate.length) {\n          changes.updated = symbolsToUpdate\n        }\n        this.history.push(this.model, changes)\n        this.updateLayerInfos()\n      }\n    }\n    this.internalEvent.emitIdle(false)\n    return symbolsToRemove\n  }\n\n  select(ids: string[]): void\n  {\n    this.selector.removeSelectedGroup()\n    this.model.symbols.forEach(s =>\n    {\n      s.selected = ids.includes(s.id)\n      this.renderer.drawSymbol(s)\n    })\n    this.selector.drawSelectedGroup(this.model.symbolsSelected)\n    this.internalEvent.emitSelected(this.model.symbolsSelected)\n  }\n\n  selectAll(): void\n  {\n    this.selector.removeSelectedGroup()\n    this.model.symbols.forEach(s =>\n    {\n      s.selected = true\n      this.renderer.drawSymbol(s)\n    })\n    this.selector.drawSelectedGroup(this.model.symbolsSelected)\n    this.internalEvent.emitSelected(this.model.symbolsSelected)\n  }\n\n  unselectAll(): void\n  {\n    this.menu.context.hide()\n    this.menu.update()\n    if (this.model.symbolsSelected.length) {\n      this.model.symbolsSelected.forEach(s =>\n      {\n        s.selected = false\n        this.renderer.drawSymbol(s)\n      })\n      this.selector.removeSelectedGroup()\n      this.internalEvent.emitSelected(this.model.symbolsSelected)\n    }\n  }\n\n  async importPointEvents(partialStrokes: PartialDeep<OIStroke>[]): Promise<OIModel>\n  {\n    this.#logger.info(\"importPointEvents\", { partialStrokes })\n    this.internalEvent.emitIdle(false)\n    const strokes = convertPartialStrokesToOIStrokes(partialStrokes)\n    strokes.forEach(s =>\n    {\n      this.model.addSymbol(s)\n      this.renderer.drawSymbol(s)\n    })\n    this.recognizer.addStrokes(strokes, false)\n    this.history.push(this.model, { added: strokes })\n    this.#logger.debug(\"importPointEvents\", this.model)\n    this.updateLayerInfos()\n    return this.model\n  }\n\n  protected triggerDownload(fileName: string, urlData: string): void\n  {\n    const downloadAnchorNode = document.createElement(\"a\")\n    downloadAnchorNode.setAttribute(\"href\", urlData)\n    downloadAnchorNode.setAttribute(\"download\", fileName)\n    document.body.appendChild(downloadAnchorNode)\n    downloadAnchorNode.click()\n    downloadAnchorNode.remove()\n  }\n\n  getSymbolsBounds(symbols: TOISymbol[], margin = SELECTION_MARGIN): Box\n  {\n    const box = Box.createFromBoxes(symbols.map(s => s.bounds))\n    box.x -= margin\n    box.y -= margin\n    box.width += margin * 2\n    box.height += margin * 2\n    return box\n  }\n\n  protected buildBlobFromSymbols(symbols: TOISymbol[], box: Box): Blob\n  {\n    const svgNode = SVGBuilder.createLayer(box)\n    symbols.forEach(s =>\n    {\n      const el = this.renderer.getElementById(s.id)?.cloneNode(true)\n      if (el) {\n        svgNode.appendChild(el)\n      }\n    })\n\n    const svgString = (new XMLSerializer()).serializeToString(svgNode)\n\n    return new Blob([svgString], {\n      type: \"image/svg+xml;charset=utf-8\"\n    })\n  }\n\n  protected getExportName(extension: string): string\n  {\n    const options: Intl.DateTimeFormatOptions = { year: \"numeric\", month: \"numeric\", day: \"numeric\", hour: \"2-digit\", minute: \"2-digit\", second: \"2-digit\" }\n    try {\n      return `iink-ts-${ new Date().toLocaleDateString(navigator.language, options) }.${ extension }`\n    }\n    catch {\n      return `iink-ts-${ new Date().toLocaleDateString(\"en-US\", options) }.${ extension }`\n    }\n  }\n\n  downloadAsSVG(selection = false)\n  {\n    const symbols = selection ? this.model.symbolsSelected : this.model.symbols\n    const box = this.getSymbolsBounds(symbols)\n    const svgBlob = this.buildBlobFromSymbols(symbols, box)\n    const url = URL.createObjectURL(svgBlob)\n    this.triggerDownload(this.getExportName(\"svg\"), url)\n  }\n\n  downloadAsPNG(selection = false)\n  {\n    const symbols = selection ? this.model.symbolsSelected : this.model.symbols\n    const box = this.getSymbolsBounds(symbols)\n    const svgBlob = this.buildBlobFromSymbols(symbols, box)\n\n    const url = URL.createObjectURL(svgBlob)\n    const image = new Image()\n    image.width = box.width\n    image.height = box.height\n    image.src = url\n    image.onload = () =>\n    {\n      const canvas = document.createElement(\"canvas\")\n      canvas.width = image.width\n      canvas.height = image.height\n\n      const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D\n      ctx.drawImage(image, 0, 0)\n      URL.revokeObjectURL(url)\n\n      const imgURI = canvas\n        .toDataURL(\"image/png\")\n        .replace(\"image/png\", \"image/octet-stream\")\n\n      this.triggerDownload(this.getExportName(\"png\"), imgURI)\n    }\n  }\n\n  downloadAsJson(selection = false)\n  {\n    const symbolsToExport = selection ? this.model.symbolsSelected : this.model.symbols\n    const dataStr = \"data:text/json;charset=utf-8,\" + encodeURIComponent(JSON.stringify(symbolsToExport, null, 2))\n    this.triggerDownload(this.getExportName(\"json\"), dataStr)\n  }\n\n  extractStrokesFromSymbols(symbols: TOISymbol[] | undefined): OIStroke[]\n  {\n    if (!symbols?.length) return []\n    const strokes: OIStroke[] = []\n    symbols.forEach(s =>\n    {\n      switch (s.type) {\n        case SymbolType.Stroke:\n          strokes.push(s)\n          break\n        case SymbolType.Group:\n          strokes.push(...s.extractStrokes())\n          break\n      }\n    })\n    return strokes\n  }\n\n  protected extractBackendChanges(changes: TOIHistoryChanges): TOIHistoryBackendChanges\n  {\n    const backendChanges: TOIHistoryBackendChanges = {}\n    backendChanges.added = this.extractStrokesFromSymbols(changes.added)\n    backendChanges.erased = this.extractStrokesFromSymbols(changes.erased)\n\n    const updated = this.extractStrokesFromSymbols(changes.updated)\n\n    const oldStrokes = updated.concat(this.extractStrokesFromSymbols(changes.replaced?.oldSymbols))\n    const newStrokes = updated.concat(this.extractStrokesFromSymbols(changes.replaced?.newSymbols))\n    if (oldStrokes.length && newStrokes.length) {\n      backendChanges.replaced = {\n        oldStrokes,\n        newStrokes\n      }\n    }\n    else {\n      backendChanges.added.push(...newStrokes)\n      backendChanges.erased.push(...oldStrokes)\n    }\n\n    if (changes.matrix) {\n      backendChanges.matrix = {\n        strokes: this.extractStrokesFromSymbols(changes.matrix.symbols),\n        matrix: changes.matrix.matrix,\n      }\n    }\n\n    if (changes.translate?.length) {\n      backendChanges.translate = []\n      changes.translate.forEach(tr =>\n      {\n        const strokes = this.extractStrokesFromSymbols(tr.symbols)\n        if (strokes.length) {\n          backendChanges.translate!.push({\n            strokes,\n            tx: tr.tx,\n            ty: tr.ty\n          })\n        }\n      })\n    }\n    if (changes.scale?.length) {\n      backendChanges.scale = []\n      changes.scale.forEach(tr =>\n      {\n        const strokes = this.extractStrokesFromSymbols(tr.symbols)\n        if (strokes.length) {\n          backendChanges.scale!.push({\n            strokes,\n            origin: tr.origin,\n            scaleX: tr.scaleX,\n            scaleY: tr.scaleY\n          })\n        }\n      })\n    }\n    if (changes.rotate?.length) {\n      backendChanges.rotate = []\n      changes.rotate.forEach(tr =>\n      {\n        const strokes = this.extractStrokesFromSymbols(tr.symbols)\n        if (strokes.length) {\n          backendChanges.rotate!.push({\n            strokes,\n            center: tr.center,\n            angle: tr.angle\n          })\n        }\n      })\n    }\n    return backendChanges\n  }\n\n  async undo(): Promise<OIModel>\n  {\n    this.#logger.info(\"undo\")\n    if (this.history.context.canUndo) {\n      this.internalEvent.emitIdle(false)\n      this.unselectAll()\n      const previousStackItem = this.history.undo()\n      const modifications = previousStackItem.model.extractDifferenceSymbols(this.model)\n      this.#model = previousStackItem.model.clone()\n      this.#logger.debug(\"undo\", { previousStackItem })\n      const actionsToBackend = this.extractBackendChanges(previousStackItem.changes)\n      modifications.removed.forEach(s => this.renderer.removeSymbol(s.id))\n      modifications.added.forEach(s => this.renderer.drawSymbol(s))\n      if (\n        actionsToBackend.added?.length ||\n        actionsToBackend.erased?.length ||\n        actionsToBackend.replaced ||\n        actionsToBackend.matrix ||\n        actionsToBackend.translate?.length ||\n        actionsToBackend.scale?.length ||\n        actionsToBackend.rotate?.length\n      ) {\n        await this.recognizer.undo(actionsToBackend)\n      }\n      this.updateLayerInfos()\n    }\n    return this.model\n  }\n\n  async redo(): Promise<OIModel>\n  {\n    this.#logger.info(\"redo\")\n\n    if (this.history.context.canRedo) {\n      this.internalEvent.emitIdle(false)\n      this.unselectAll()\n      const nextStackItem = this.history.redo()\n      const modifications = nextStackItem.model.extractDifferenceSymbols(this.model)\n      this.#model = nextStackItem.model.clone()\n      this.#logger.debug(\"redo\", { modifications })\n      const actionsToBackend = this.extractBackendChanges(nextStackItem.changes)\n      modifications.removed.forEach(s => this.renderer.removeSymbol(s.id))\n      modifications.added.forEach(s => this.renderer.drawSymbol(s))\n      if (\n        actionsToBackend.added?.length ||\n        actionsToBackend.erased?.length ||\n        actionsToBackend.replaced ||\n        actionsToBackend.matrix ||\n        actionsToBackend.translate?.length ||\n        actionsToBackend.scale?.length ||\n        actionsToBackend.rotate?.length\n      ) {\n        await this.recognizer.redo(actionsToBackend)\n      }\n\n      this.updateLayerInfos()\n    }\n    return this.model\n  }\n\n  async export(mimeTypes?: string[]): Promise<OIModel>\n  {\n    try {\n      this.#logger.info(\"export\", { mimeTypes })\n      const exports = await this.recognizer.export(mimeTypes)\n      this.model.mergeExport(exports as TExport)\n    }\n    catch (error) {\n      this.#logger.error(\"export\", { error })\n      this.internalEvent.emitError(error as Error)\n      throw error\n    }\n    return this.model\n  }\n\n  async convert(): Promise<OIModel>\n  {\n    try {\n      this.internalEvent.emitIdle(false)\n      await this.converter.apply()\n    }\n    catch (error) {\n      this.#logger.error(\"convert\", error)\n      this.internalEvent.emitError(error as Error)\n      throw error\n    }\n    finally {\n      this.updateLayerInfos()\n    }\n    return this.model\n  }\n\n  async resize(height: number, width: number): Promise<OIModel>\n  {\n    this.internalEvent.emitIdle(false)\n    this.#logger.info(\"resize\", { height, width })\n    this.model.height = height\n    this.model.width = width\n    this.renderer.resize(height, width)\n    this.menu.update()\n    this.internalEvent.emitIdle(true)\n    return this.model\n  }\n\n  async clear(): Promise<OIModel>\n  {\n    this.#logger.info(\"clear\")\n    this.internalEvent.emitIdle(false)\n    if (this.model.symbols.length) {\n      this.selector.removeSelectedGroup()\n      const erased = this.model.symbols\n      this.renderer.clear()\n      this.model.clear()\n      this.history.push(this.model, { erased })\n      this.recognizer.clear()\n      this.internalEvent.emitSelected(this.model.symbolsSelected)\n    }\n    this.updateLayerInfos()\n    return this.model\n  }\n\n  async destroy(): Promise<void>\n  {\n    this.#logger.info(\"destroy\")\n    this.grabber.detach()\n    this.renderer.destroy()\n    this.menu.destroy()\n    this.recognizer.destroy()\n    this.model.clear()\n    this.history.clear()\n    return Promise.resolve()\n  }\n}\n","import { Intention } from \"../Constants\"\nimport { Configuration, TConfiguration, TConverstionState } from \"../configuration\"\nimport { InternalEvent } from \"../event\"\nimport { PointerEventGrabber } from \"../grabber\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { IModel, Model, TExport } from \"../model\"\nimport { Stroke, TStroke, TPointer } from \"../primitive\"\nimport { RestRecognizer } from \"../recognizer\"\nimport { CanvasRenderer } from \"../renderer\"\nimport { DefaultPenStyle, StyleManager, TPenStyle, TTheme } from \"../style\"\nimport { HistoryManager } from \"../history\"\nimport { DeferredPromise, PartialDeep } from \"../utils\"\nimport { IBehaviors } from \"./IBehaviors\"\nimport { TBehaviorOptions } from \"./TBehaviorOptions\"\n\n/**\n * @group Behavior\n */\nexport class RestBehaviors implements IBehaviors\n{\n  name = \"RestBehaviors\"\n  #logger = LoggerManager.getLogger(LoggerClass.BEHAVIORS)\n  #configuration: TConfiguration\n  #model: Model\n  #resizeTimer?: ReturnType<typeof setTimeout>\n  #exportTimer?: ReturnType<typeof setTimeout>\n\n  grabber: PointerEventGrabber\n  renderer: CanvasRenderer\n  recognizer: RestRecognizer\n  history: HistoryManager\n  styleManager: StyleManager\n  intention: Intention\n\n  constructor(options: PartialDeep<TBehaviorOptions>)\n  {\n    this.#logger.info(\"constructor\", { options })\n    this.#configuration = new Configuration(options?.configuration)\n    this.styleManager = new StyleManager(options?.penStyle, options?.theme)\n\n    if (options.behaviors?.grabber) {\n      const CustomGrabber = options.behaviors?.grabber as unknown as typeof PointerEventGrabber\n      this.grabber = new CustomGrabber(this.#configuration.grabber)\n    }\n    else {\n      this.grabber = new PointerEventGrabber(this.#configuration.grabber)\n    }\n    if (options.behaviors?.recognizer) {\n      const CustomRecognizer = options.behaviors?.recognizer as unknown as typeof RestRecognizer\n      this.recognizer = new CustomRecognizer(this.#configuration.server, this.#configuration.recognition)\n    }\n    else {\n      this.recognizer = new RestRecognizer(this.#configuration.server, this.#configuration.recognition)\n    }\n    this.renderer = new CanvasRenderer(this.#configuration.rendering)\n\n    this.intention = Intention.Write\n    this.#model = new Model()\n    this.history = new HistoryManager(this.#configuration[\"undo-redo\"])\n  }\n\n  protected onPointerDown(evt: PointerEvent, point: TPointer): void\n  {\n    this.#logger.info(\"onPointerDown\", { intention: this.intention, evt, point })\n    const { pointerType } = evt\n    const style: TPenStyle = Object.assign({}, this.theme?.ink, this.currentPenStyle)\n    switch (this.intention) {\n      case Intention.Erase: {\n        if (this.model.removeStrokesFromPoint(point).length > 0) {\n          this.renderer.drawModel(this.model)\n        }\n        break\n      }\n      case Intention.Write:\n        this.model.initCurrentStroke(point, pointerType, style)\n        this.drawCurrentStroke()\n        break\n      default:\n        this.#logger.warn(\"#onPointerDown\", `onPointerDown intention unknow: \"${ this.intention }\"`)\n        break\n    }\n  }\n\n  protected onPointerMove(_evt: PointerEvent, point: TPointer): void\n  {\n    this.#logger.info(\"onPointerMove\", { intention: this.intention, point })\n    switch (this.intention) {\n      case Intention.Erase: {\n        if (this.model.removeStrokesFromPoint(point).length > 0) {\n          this.renderer.drawModel(this.model)\n        }\n        break\n      }\n      case Intention.Write:\n        this.model.appendToCurrentStroke(point)\n        this.drawCurrentStroke()\n        break\n      default:\n        this.#logger.warn(\"#onPointerMove\", `onPointerMove intention unknow: \"${ this.intention }\"`)\n        break\n    }\n  }\n\n  protected async onPointerUp(_evt: PointerEvent, point: TPointer): Promise<void>\n  {\n    this.#logger.info(\"onPointerUp\", { intention: this.intention, point })\n    switch (this.intention) {\n      case Intention.Erase:\n        this.model.removeStrokesFromPoint(point)\n        if (this.history.stack.at(-1)?.modificationDate !== this.model.modificationDate) {\n          await this.updateModelRendering()\n        }\n        break\n      case Intention.Write:\n        this.model.endCurrentStroke(point)\n        await this.updateModelRendering()\n        break\n      default:\n        this.#logger.warn(\"#onPointerUp\", `onPointerUp intention unknow: \"${ this.intention }\"`)\n        break\n    }\n  }\n\n  get internalEvent(): InternalEvent\n  {\n    return InternalEvent.getInstance()\n  }\n\n  get model(): Model\n  {\n    return this.#model\n  }\n\n  get currentPenStyle(): TPenStyle\n  {\n    return this.styleManager.currentPenStyle\n  }\n\n  get penStyle(): TPenStyle\n  {\n    return this.styleManager.penStyle\n  }\n  async setPenStyle(penStyle?: TPenStyle | undefined): Promise<void>\n  {\n    this.#logger.info(\"setPenStyle\", { penStyle })\n    this.styleManager.setPenStyle(penStyle)\n    return Promise.resolve()\n  }\n\n  get penStyleClasses(): string\n  {\n    return this.styleManager.penStyleClasses\n  }\n  async setPenStyleClasses(penStyleClasses?: string | undefined): Promise<void>\n  {\n    this.#logger.info(\"setPenStyleClasses\", { penStyleClasses })\n    this.styleManager.setPenStyleClasses(penStyleClasses)\n    return Promise.resolve()\n  }\n\n  get theme(): TTheme\n  {\n    return this.styleManager.theme\n  }\n  async setTheme(theme?: PartialDeep<TTheme>): Promise<void>\n  {\n    this.#logger.info(\"setTheme\", { theme })\n    this.styleManager.setTheme(theme)\n    return Promise.resolve()\n  }\n\n  get configuration(): TConfiguration\n  {\n    return this.#configuration\n  }\n\n  async init(domElement: HTMLElement): Promise<void>\n  {\n    this.#logger.info(\"init\", { domElement })\n    this.model.width = Math.max(domElement.clientWidth, this.#configuration.rendering.minWidth)\n    this.model.height = Math.max(domElement.clientHeight, this.#configuration.rendering.minHeight)\n\n    this.history.push(this.model)\n\n    this.renderer.init(domElement)\n\n    this.grabber.attach(domElement)\n    this.grabber.onPointerDown = this.onPointerDown.bind(this)\n    this.grabber.onPointerMove = this.onPointerMove.bind(this)\n    this.grabber.onPointerUp = this.onPointerUp.bind(this)\n    return Promise.resolve()\n  }\n\n  drawCurrentStroke(): void\n  {\n    this.#logger.debug(\"drawCurrentStroke\", { stroke: this.model.currentSymbol })\n    this.renderer.drawPendingStroke(this.model.currentSymbol)\n  }\n\n  async updateModelRendering(): Promise<IModel>\n  {\n    this.#logger.info(\"updateModelRendering\")\n    this.renderer.drawModel(this.model)\n    const deferred = new DeferredPromise<Model>()\n    this.history.push(this.model)\n    if (this.#configuration.triggers.exportContent !== \"DEMAND\") {\n      clearTimeout(this.#exportTimer)\n      let currentModel = this.model.clone()\n      this.#exportTimer = setTimeout(async () =>\n      {\n        try {\n          currentModel = await this.recognizer.export(currentModel)\n          this.history.updateStack(currentModel)\n          if (this.model.modificationDate === currentModel.modificationDate) {\n            this.model.exports = currentModel.exports\n          }\n          deferred.resolve(this.model)\n        } catch (error) {\n          this.#logger.error(\"updateModelRendering\", { error })\n          this.internalEvent.emitError(error as Error)\n          deferred.reject(error as Error)\n        }\n      }, this.#configuration.triggers.exportContent === \"QUIET_PERIOD\" ? this.#configuration.triggers.exportContentDelay : 0)\n    } else {\n      deferred.resolve(this.model)\n    }\n    await deferred.promise\n    this.internalEvent.emitExported(this.model.exports as TExport)\n    this.#logger.debug(\"updateModelRendering\", this.model.exports)\n    return deferred.promise\n  }\n\n  async export(mimeTypes?: string[]): Promise<IModel>\n  {\n    this.#logger.info(\"export\", { mimeTypes })\n    const newModel = await this.recognizer.export(this.model.clone(), mimeTypes)\n    if (this.model.modificationDate === newModel.modificationDate) {\n      this.model.mergeExport(newModel.exports as TExport)\n    }\n    this.history.updateStack(newModel)\n    this.#logger.debug(\"export\", this.model)\n    return this.model\n  }\n\n  async convert(conversionState?: TConverstionState, requestedMimeTypes?: string[]): Promise<IModel>\n  {\n    this.#logger.info(\"convert\", { conversionState, requestedMimeTypes })\n    const newModel = await this.recognizer.convert(this.model, conversionState, requestedMimeTypes)\n    Object.assign(this.#model, newModel)\n    this.#logger.debug(\"convert\", this.model)\n    return this.model\n  }\n\n  async importPointEvents(strokes: PartialDeep<TStroke>[]): Promise<IModel>\n  {\n    const errors: string[] = []\n    strokes.forEach((s, strokeIndex) =>\n    {\n      let flag = true\n      const stroke = new Stroke(s.style || DefaultPenStyle, s.pointerType)\n      if (s.id) stroke.id = s.id\n      if (!s.pointers?.length) {\n        errors.push(`stroke ${strokeIndex + 1} has not pointers`)\n        flag = false\n        return\n      }\n      s.pointers?.forEach((pp, pIndex) => {\n        if (!pp) {\n          errors.push(`stroke ${strokeIndex + 1} has no pointer at ${pIndex}`)\n          flag = false\n          return\n        }\n        const pointer: TPointer = {\n          p: pp.p || 1,\n          t: pp.t || pIndex,\n          x: 0,\n          y: 0\n        }\n        if (pp?.x == undefined || pp?.x == null) {\n          errors.push(`stroke ${strokeIndex + 1} has no x at pointer at ${pIndex}`)\n          flag = false\n          return\n        }\n        else {\n          pointer.x = pp.x\n        }\n        if (pp?.y == undefined || pp?.y == null) {\n          errors.push(`stroke ${strokeIndex + 1} has no y at pointer at ${pIndex}`)\n          flag = false\n          return\n        }\n        else {\n          pointer.y = pp.y\n        }\n        if (flag) {\n          stroke.pointers.push(pointer)\n        }\n      })\n      if (flag) {\n        this.model.addStroke(stroke)\n      }\n    })\n\n    if (errors.length) {\n      this.internalEvent.emitError( new Error(errors.join(\"\\n\")))\n    }\n    try {\n      const newModel = await this.updateModelRendering()\n      Object.assign(this.#model, newModel)\n      return this.model\n    } catch (error) {\n      this.internalEvent.emitError(error as Error)\n      throw error as Error\n    }\n  }\n\n  async resize(height: number, width: number): Promise<IModel>\n  {\n    this.#logger.info(\"resize\", { height, width })\n    const deferredResize = new DeferredPromise<Model>()\n    this.model.height = height\n    this.model.width = width\n    this.renderer.resize(this.model)\n    if (this.model.symbols.length) {\n      clearTimeout(this.#resizeTimer)\n      this.#resizeTimer = setTimeout(async () =>\n      {\n        const resizeModel = await this.recognizer.resize(this.model)\n        deferredResize.resolve(resizeModel)\n      }, this.#configuration.triggers.resizeTriggerDelay)\n    } else {\n      deferredResize.resolve(this.model)\n    }\n    this.#model = await deferredResize.promise\n    this.#logger.debug(\"resize\", { model: this.model })\n    this.internalEvent.emitExported(this.model.exports as TExport)\n    return this.model\n  }\n\n  async undo(): Promise<IModel>\n  {\n    this.#logger.info(\"undo\")\n    this.#model = this.history.undo() as Model\n    this.renderer.drawModel(this.#model)\n    this.#model = await this.recognizer.export(this.#model)\n    this.history.updateStack(this.#model)\n    this.internalEvent.emitExported(this.#model.exports as TExport)\n    this.#logger.debug(\"undo\", this.#model)\n    return this.#model\n  }\n\n  async redo(): Promise<IModel>\n  {\n    this.#logger.info(\"redo\")\n    this.#model = this.history.redo() as Model\n    this.renderer.drawModel(this.#model)\n    this.#model = await this.recognizer.export(this.#model)\n    this.history.updateStack(this.#model)\n    this.internalEvent.emitExported(this.#model.exports as TExport)\n    this.#logger.debug(\"redo\", this.#model)\n    return this.#model\n  }\n\n  async clear(): Promise<IModel>\n  {\n    this.#logger.info(\"clear\")\n    this.model.clear()\n    this.history.push(this.model)\n    this.renderer.drawModel(this.model)\n    this.internalEvent.emitExported(this.model.exports as TExport)\n    this.#logger.debug(\"clear\", this.model)\n    return this.model\n  }\n\n  async destroy(): Promise<void>\n  {\n    this.#logger.info(\"destroy\")\n    this.grabber.detach()\n    this.renderer.destroy()\n    return Promise.resolve()\n  }\n}\n","import { Intention } from \"../Constants\"\nimport { Configuration, TConfiguration, TConverstionState } from \"../configuration\"\nimport { InternalEvent } from \"../event\"\nimport { PointerEventGrabber } from \"../grabber\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { IModel, Model, TExport } from \"../model\"\nimport { TWSMessageEventSVGPatch, WSRecognizer } from \"../recognizer\"\nimport { WSSVGRenderer } from \"../renderer\"\nimport { DefaultPenStyle, StyleManager, TPenStyle, TTheme } from \"../style\"\nimport { HistoryManager } from \"../history\"\nimport { DeferredPromise, PartialDeep } from \"../utils\"\nimport { Stroke, TStroke, TPointer } from \"../primitive\"\nimport { IBehaviors } from \"./IBehaviors\"\nimport { TBehaviorOptions } from \"./TBehaviorOptions\"\n\n/**\n * @group Behavior\n */\nexport class WSBehaviors implements IBehaviors\n{\n  name = \"WSBehaviors\"\n  #logger = LoggerManager.getLogger(LoggerClass.BEHAVIORS)\n  #configuration: TConfiguration\n  #model: Model\n  #resizeTimer?: ReturnType<typeof setTimeout>\n\n  grabber: PointerEventGrabber\n  renderer: WSSVGRenderer\n  recognizer: WSRecognizer\n  history: HistoryManager\n  styleManager: StyleManager\n  intention: Intention\n\n\n  constructor(options: PartialDeep<TBehaviorOptions>)\n  {\n    this.#logger.info(\"constructor\", { options })\n    this.#configuration = new Configuration(options?.configuration)\n    this.styleManager = new StyleManager(options?.penStyle, options?.theme)\n\n    if (options.behaviors?.grabber) {\n      const CustomGrabber = options.behaviors?.grabber as unknown as typeof PointerEventGrabber\n      this.grabber = new CustomGrabber(this.#configuration.grabber)\n    }\n    else {\n      this.grabber = new PointerEventGrabber(this.#configuration.grabber)\n    }\n    if (options.behaviors?.recognizer) {\n      const CustomRecognizer = options.behaviors?.recognizer as unknown as typeof WSRecognizer\n      this.recognizer = new CustomRecognizer(this.#configuration.server, this.#configuration.recognition)\n    }\n    else {\n      this.recognizer = new WSRecognizer(this.#configuration.server, this.#configuration.recognition)\n    }\n    this.renderer = new WSSVGRenderer(this.#configuration.rendering)\n\n    this.intention = Intention.Write\n    this.#model = new Model()\n    this.history = new HistoryManager(this.#configuration[\"undo-redo\"])\n  }\n\n  get internalEvent(): InternalEvent\n  {\n    return InternalEvent.getInstance()\n  }\n\n  get model(): Model\n  {\n    return this.#model\n  }\n\n  get configuration(): TConfiguration\n  {\n    return this.#configuration\n  }\n\n  get currentPenStyle(): TPenStyle\n  {\n    return this.styleManager.currentPenStyle\n  }\n\n  get penStyle(): TPenStyle\n  {\n    return this.styleManager.penStyle\n  }\n  setPenStyle(penStyle?: PartialDeep<TPenStyle>): Promise<void>\n  {\n    this.#logger.info(\"setPenStyle\", { penStyle })\n    this.styleManager.setPenStyle(penStyle)\n    this.#logger.debug(\"setPenStyle\", this.styleManager.penStyle)\n    return this.recognizer.setPenStyle(this.styleManager.penStyle)\n  }\n\n  get penStyleClasses(): string\n  {\n    return this.styleManager.penStyleClasses\n  }\n  setPenStyleClasses(penClass?: string): Promise<void>\n  {\n    this.#logger.info(\"setPenStyleClasses\", { penClass })\n    this.styleManager.setPenStyleClasses(penClass)\n    this.#logger.debug(\"setPenStyleClasses\", this.styleManager.penStyleClasses)\n    return this.recognizer.setPenStyleClasses(this.styleManager.penStyleClasses)\n  }\n\n  get theme(): TTheme\n  {\n    return this.styleManager.theme\n  }\n  setTheme(theme?: PartialDeep<TTheme>): Promise<void>\n  {\n    this.#logger.info(\"setTheme\", { theme })\n    this.styleManager.setTheme(theme)\n    this.#logger.debug(\"setTheme\", this.styleManager.theme)\n    return this.recognizer.setTheme(this.styleManager.theme)\n  }\n\n  protected onExport(exports: TExport): void\n  {\n    this.#logger.debug(\"onExport\", { exports })\n    this.model.mergeExport(exports)\n  }\n\n  protected onPointerDown(evt: PointerEvent, point: TPointer): void\n  {\n    this.#logger.info(\"onPointerDown\", { intention: this.intention, evt, point })\n    let { pointerType } = evt\n    const style: TPenStyle = Object.assign({}, this.theme?.ink, this.currentPenStyle)\n    if (this.intention === Intention.Erase) {\n      pointerType = \"eraser\"\n    }\n    this.model.initCurrentStroke(point, pointerType, style)\n    this.drawCurrentStroke()\n  }\n\n  protected onPointerMove(_evt: PointerEvent, point: TPointer): void\n  {\n    this.#logger.info(\"onPointerMove\", { intention: this.intention, point })\n    this.model.appendToCurrentStroke(point)\n    this.drawCurrentStroke()\n  }\n\n  protected async onPointerUp(_evt: PointerEvent, point: TPointer): Promise<void>\n  {\n    try {\n      this.#logger.info(\"onPointerUp\", { intention: this.intention, point })\n      this.model.endCurrentStroke(point)\n      await this.synchronizeModelWithBackend()\n    } catch (error) {\n      this.internalEvent.emitError(error as Error)\n    }\n  }\n\n  protected onSVGPatch(evt: TWSMessageEventSVGPatch): void\n  {\n    this.#logger.info(\"onSVGPatch\", { evt })\n    this.renderer.updatesLayer(evt.layer, evt.updates)\n  }\n\n  async init(domElement: HTMLElement): Promise<void>\n  {\n    this.#logger.info(\"init\", { domElement })\n    const compStyles = window.getComputedStyle(domElement);\n    this.model.width = Math.max(parseInt(compStyles.width.replace(\"px\",\"\")), this.#configuration.rendering.minWidth)\n    this.model.height = Math.max(parseInt(compStyles.height.replace(\"px\",\"\")), this.#configuration.rendering.minHeight)\n    this.history.push(this.model)\n\n    this.renderer.init(domElement)\n\n    this.grabber.attach(domElement)\n    this.grabber.onPointerDown = this.onPointerDown.bind(this)\n    this.grabber.onPointerMove = this.onPointerMove.bind(this)\n    this.grabber.onPointerUp = this.onPointerUp.bind(this)\n\n    this.internalEvent.addExportedListener(this.onExport.bind(this))\n    this.internalEvent.addSVGPatchListener(this.onSVGPatch.bind(this))\n\n    await this.recognizer.init(this.model.height, this.model.width)\n    await this.setPenStyle(this.penStyle)\n    await this.setTheme(this.theme as PartialDeep<TTheme>)\n    await this.setPenStyleClasses(this.penStyleClasses)\n  }\n\n  drawCurrentStroke(): void\n  {\n    this.#logger.debug(\"drawCurrentStroke\", { stroke: this.model.currentSymbol })\n    const currentSymbol = this.model.currentSymbol as Stroke\n    if (currentSymbol) {\n      this.renderer.drawPendingStroke(currentSymbol)\n    }\n  }\n\n  async synchronizeModelWithBackend(): Promise<IModel>\n  {\n    this.#logger.info(\"synchronizeModelWithBackend\")\n    if (this.#configuration.triggers.exportContent !== \"DEMAND\") {\n      const unsentStrokes = this.model.extractUnsentStrokes()\n      this.model.updatePositionSent()\n      this.history.push(this.model)\n      this.renderer.clearErasingStrokes()\n      const exports = await this.recognizer.addStrokes(unsentStrokes)\n      this.model.mergeExport(exports)\n      this.history.updateStack(this.model)\n    }\n    this.#logger.debug(\"synchronizeModelWithBackend\", this.model)\n    return this.model\n  }\n\n  async waitForIdle(): Promise<void>\n  {\n    return this.recognizer.waitForIdle()\n  }\n\n  async export(mimeTypes?: string[]): Promise<IModel>\n  {\n    this.#logger.info(\"export\", { mimeTypes })\n    try {\n      if (this.#configuration.triggers.exportContent === \"DEMAND\") {\n        const unsentStrokes = this.model.extractUnsentStrokes()\n        this.model.updatePositionSent()\n        const exports = await this.recognizer.addStrokes(unsentStrokes)\n        this.model.updatePositionReceived()\n        this.model.mergeExport(exports)\n        this.#logger.debug(\"export\", this.model)\n        return this.model\n      } else {\n        return this.recognizer.export(this.model, mimeTypes)\n      }\n    } catch (error) {\n      this.#logger.error(\"export\", { error } )\n      this.internalEvent.emitError(error as Error)\n      return Promise.reject(error)\n    }\n  }\n\n  async convert(conversionState?: TConverstionState): Promise<IModel>\n  {\n    this.#logger.info(\"convert\", { conversionState })\n    this.history.push(this.model)\n    this.history.stack.push(this.model.clone())\n    this.#model = await this.recognizer.convert(this.model, conversionState)\n    this.#logger.debug(\"convert\", this.model)\n    this.history.push(this.model)\n    return this.model\n  }\n\n  async import(data: Blob, mimeType?: string): Promise<IModel>\n  {\n    this.#logger.info(\"import\", { data, mimeType })\n    this.history.stack.push(this.model.clone())\n    const m = await this.recognizer.import(this.model, data, mimeType)\n    this.history.push(m)\n    return m\n  }\n\n  async importPointEvents(strokes: PartialDeep<TStroke>[]): Promise<IModel>\n  {\n    this.#logger.info(\"importPointEvents\", { strokes })\n    const errors: string[] = []\n    const strokesToImport = strokes.map((s, strokeIndex) => {\n      const str = new Stroke(s.style || DefaultPenStyle, s.pointerType)\n      if (s.id) str.id = s.id\n      if (s.pointerType) str.pointerType = s.pointerType\n      if (!s.pointers?.length) {\n        errors.push(`stroke ${strokeIndex + 1} has not pointers`)\n      }\n      let flag = true\n      s.pointers?.forEach((pp, pIndex) => {\n        flag = true\n        if (!pp) {\n          errors.push(`stroke ${strokeIndex + 1} has no pointer at ${pIndex}`)\n          return\n        }\n        const pointer: TPointer = {\n          p: pp.p || 1,\n          t: pp.t || pIndex,\n          x: 0,\n          y: 0\n        }\n        if (pp?.x == undefined || pp?.x == null) {\n          errors.push(`stroke ${strokeIndex + 1} has no x at pointer at ${pIndex}`)\n          flag = false\n        }\n        else {\n          pointer.x = pp.x\n        }\n        if (pp?.y == undefined || pp?.y == null) {\n          errors.push(`stroke ${strokeIndex + 1} has no y at pointer at ${pIndex}`)\n          flag = false\n        }\n        else {\n          pointer.y = pp.y\n        }\n        if (flag) {\n          str.pointers.push(pointer)\n        }\n      })\n      return str\n    })\n    if (errors.length) {\n      this.internalEvent.emitError( new Error(errors.join(\"\\n\")))\n    }\n    strokesToImport.map(s => this.model.addStroke(s))\n    const exportPoints = await this.recognizer.importPointEvents(strokesToImport)\n    this.model.mergeExport(exportPoints)\n    this.#logger.debug(\"importPointEvents\", this.model)\n    return this.model\n  }\n\n  async resize(height: number, width: number): Promise<IModel>\n  {\n    this.#logger.info(\"resize\", { height, width })\n    const deferredResize = new DeferredPromise<Model>()\n    this.model.height = height\n    this.model.width = width\n    const clonedModel = this.model.clone()\n    this.renderer.resize(clonedModel)\n    clearTimeout(this.#resizeTimer)\n    this.#resizeTimer = setTimeout(async () =>\n    {\n      try {\n        const resizeModel = await this.recognizer.resize(clonedModel)\n        deferredResize.resolve(resizeModel)\n      } catch (error) {\n        this.#logger.error(\"resize\", { height, width, error } )\n        deferredResize.reject(error as Error)\n      }\n    }, this.#configuration.triggers.resizeTriggerDelay)\n\n    this.#model = await deferredResize.promise\n    this.internalEvent.emitExported(this.model.exports as TExport)\n    this.#logger.debug(\"resize\", this.model)\n    return this.model\n  }\n\n  async undo(): Promise<IModel>\n  {\n    this.#logger.info(\"undo\")\n    if (this.history.context.canUndo) {\n      this.#model = this.history.undo() as Model\n      return this.recognizer.undo(this.model)\n    }\n    else {\n      throw new Error(\"Undo not allowed\")\n    }\n  }\n\n  async redo(): Promise<IModel>\n  {\n    this.#logger.info(\"redo\")\n    if (this.history.context.canRedo) {\n      this.#model = this.history.redo() as Model\n      this.#logger.debug(\"undo\", this.#model)\n      return this.recognizer.redo(this.model)\n    }\n    else {\n      throw new Error(\"Redo not allowed\")\n    }\n  }\n\n  async clear(): Promise<IModel>\n  {\n    this.#logger.info(\"clear\")\n    this.model.clear()\n    this.history.push(this.model)\n    return this.recognizer.clear(this.model)\n  }\n\n  async destroy(): Promise<void>\n  {\n    this.#logger.info(\"destroy\")\n    this.grabber.detach()\n    this.renderer.destroy()\n    this.recognizer.destroy()\n    return Promise.resolve()\n  }\n}\n","import { TMarginConfiguration, TRenderingConfiguration } from \"../configuration\"\nimport { InternalEvent } from \"../event\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { TJIIXExport, TJIIXWord } from \"../model\"\nimport { convertMillimeterToPixel, createUUID } from \"../utils\"\n\n/**\n * @group SmartGuide\n */\nexport class SmartGuide\n{\n  uuid: string\n  #smartGuideElement!: HTMLDivElement\n  #wrapperElement!: HTMLDivElement\n  #prompterContainerElement!: HTMLDivElement\n  #prompterTextElement!: HTMLDivElement\n  #ellipsisElement!: HTMLDivElement\n  #tagElement!: HTMLDivElement\n  #candidatesElement!: HTMLDivElement\n  #menuElement!: HTMLDivElement\n  #convertElement!: HTMLButtonElement\n  #copyElement!: HTMLButtonElement\n  #deleteElement!: HTMLButtonElement\n  #isMenuOpen!: boolean\n  margin: TMarginConfiguration\n  renderingConfiguration!: TRenderingConfiguration\n  jiix?: TJIIXExport\n  lastWord?: TJIIXWord\n  wordToChange?: TJIIXWord\n  #logger = LoggerManager.getLogger(LoggerClass.SMARTGUIDE)\n\n  constructor()\n  {\n    this.#logger.info(\"constructor\")\n    this.uuid = createUUID()\n    this.margin = {\n      bottom: 0,\n      left: 0,\n      right: 0,\n      top: 0\n    }\n    this.#createRootElement()\n    this.#createWrapperElement()\n    this.#createPrompterContainerElement()\n    this.#createPrompterTextElement()\n    this.#createEllipsisElement()\n    this.#createTagElement()\n    this.#createCandidatesElement()\n    this.#createMoreMenuElement()\n    this.#createConvertElement()\n    this.#createCopyElement()\n    this.#createDeleteElement()\n  }\n\n  get internalEvent(): InternalEvent\n  {\n    return InternalEvent.getInstance()\n  }\n\n  #createRootElement(): void\n  {\n    this.#smartGuideElement = document.createElement(\"div\")\n    this.#smartGuideElement.id = `smartguide-${ this.uuid }`\n    this.#smartGuideElement.classList.add(\"smartguide\")\n    this.#smartGuideElement.addEventListener(\"pointerdown\", e => {\n      e.preventDefault()\n      e.stopPropagation()\n    })\n  }\n\n  #createWrapperElement(): void\n  {\n    this.#wrapperElement = document.createElement(\"div\")\n    this.#wrapperElement.id = `smartguide-wrapper-${ this.uuid }`\n    this.#wrapperElement.classList.add(\"smartguide-wrapper\")\n  }\n\n  #createPrompterContainerElement(): void\n  {\n    this.#prompterContainerElement = document.createElement(\"div\")\n    this.#prompterContainerElement.id = `prompter-container-${ this.uuid }`\n    this.#prompterContainerElement.classList.add(\"prompter-container\")\n  }\n\n  #createPrompterTextElement(): void\n  {\n    this.#prompterTextElement = document.createElement(\"div\")\n    this.#prompterTextElement.id = `prompter-text-${ this.uuid }`\n    this.#prompterTextElement.classList.add(\"prompter-text\")\n    this.#prompterTextElement.setAttribute(\"touch-action\", \"none\")\n  }\n\n  #createEllipsisElement(): void\n  {\n    this.#ellipsisElement = document.createElement(\"div\")\n    this.#ellipsisElement.id = `ellipsis-${ this.uuid }`\n    this.#ellipsisElement.classList.add(\"ellipsis\")\n    this.#ellipsisElement.innerHTML = \"...\"\n  }\n\n  #createTagElement(): void\n  {\n    this.#tagElement = document.createElement(\"div\")\n    this.#tagElement.id = `tag-icon-${ this.uuid }`\n    this.#tagElement.classList.add(\"tag-icon\")\n    this.#tagElement.innerHTML = \"&#182;\"\n  }\n\n  #createCandidatesElement(): void\n  {\n    this.#candidatesElement = document.createElement(\"div\")\n    this.#candidatesElement.id = `candidates-${ this.uuid }`\n    this.#candidatesElement.classList.add(\"candidates\")\n  }\n\n  #createMoreMenuElement(): void\n  {\n    this.#menuElement = document.createElement(\"div\")\n    this.#menuElement.id = `more-menu-${ this.uuid }`\n    this.#menuElement.classList.add(\"more-menu\")\n  }\n\n  #createConvertElement(): void\n  {\n    this.#convertElement = document.createElement(\"button\")\n    this.#convertElement.id = `convert-${ this.uuid }`\n    this.#convertElement.classList.add(\"options-label-button\")\n    this.#convertElement.innerHTML = \"Convert\"\n  }\n\n  #createCopyElement(): void\n  {\n    this.#copyElement = document.createElement(\"button\")\n    this.#copyElement.id = `copy-${ this.uuid }`\n    this.#copyElement.classList.add(\"options-label-button\")\n    this.#copyElement.innerHTML = \"Copy\"\n  }\n\n  #createDeleteElement(): void\n  {\n    this.#deleteElement = document.createElement(\"button\")\n    this.#deleteElement.id = `delete-${ this.uuid }`\n    this.#deleteElement.classList.add(\"options-label-button\")\n    this.#deleteElement.innerHTML = \"Delete\"\n  }\n\n  init(domElement: HTMLElement, margin: TMarginConfiguration, renderingConfiguration: TRenderingConfiguration): void\n  {\n    this.#logger.info(\"init\", { domElement, margin, renderingConfiguration })\n    domElement.appendChild(this.#smartGuideElement)\n    this.#smartGuideElement.appendChild(this.#wrapperElement)\n\n    this.#wrapperElement.appendChild(this.#tagElement)\n\n    this.#prompterContainerElement.appendChild(this.#prompterTextElement)\n    this.#wrapperElement.appendChild(this.#prompterContainerElement)\n\n    this.#wrapperElement.appendChild(this.#ellipsisElement)\n\n    this.#menuElement.appendChild(this.#convertElement)\n    this.#menuElement.appendChild(this.#copyElement)\n    this.#menuElement.appendChild(this.#deleteElement)\n    this.#menuElement.classList.add(\"close\")\n    this.#wrapperElement.appendChild(this.#menuElement)\n    this.#isMenuOpen = false\n\n    this.#candidatesElement.style.display = \"none\"\n    this.#wrapperElement.appendChild(this.#candidatesElement)\n    this.margin = margin\n    this.renderingConfiguration = renderingConfiguration\n    this.#addListeners()\n\n    this.resize()\n  }\n\n  #showCandidates = (target: HTMLElement) =>\n  {\n    this.#logger.info(\"showCandidates\", { target })\n    const wordId = parseInt(target.id.replace(\"word-\", \"\").replace(this.uuid, \"\"))\n    const words = this.jiix?.words as TJIIXWord[]\n    this.wordToChange = words[wordId]\n    if (this.wordToChange) {\n      this.wordToChange.id = wordId.toString()\n      this.#candidatesElement.innerHTML = \"\"\n      if (this.wordToChange?.candidates) {\n        this.#candidatesElement.style.display = \"flex\"\n        this.wordToChange.candidates.forEach((word, index) =>\n        {\n          if (this.wordToChange?.label === word) {\n            this.#candidatesElement.innerHTML += `<span id=\"cdt-${ index }${ this.uuid }\" class=\"selected-word\">${ word }</span>`\n          } else {\n            this.#candidatesElement.innerHTML += `<span id=\"cdt-${ index }${ this.uuid }\">${ word }</span>`\n          }\n        })\n\n        target.appendChild(this.#candidatesElement)\n      }\n    }\n  }\n  #hideCandidates(): void\n  {\n    this.#candidatesElement.style.display = \"none\"\n  }\n\n  #openMenu(): void\n  {\n    this.#menuElement.classList.add(\"open\")\n    this.#menuElement.classList.remove(\"close\")\n    this.#isMenuOpen = true\n  }\n  #closeMenu(): void\n  {\n    this.#menuElement.classList.add(\"close\")\n    this.#menuElement.classList.remove(\"open\")\n    this.#isMenuOpen = false\n  }\n\n  #onClickEllipsis = (evt: Event) =>\n  {\n    this.#logger.info(\"onClickEllipsis\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    this.#isMenuOpen ? this.#closeMenu() : this.#openMenu()\n    this.#hideCandidates()\n  }\n\n  #onClickConvert = (evt: Event) =>\n  {\n    this.#logger.info(\"onClickConvert\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    this.internalEvent.emitConvert()\n    this.#closeMenu()\n  }\n\n  #createTextAreaElement(value: string): HTMLTextAreaElement\n  {\n    const isRTL = document.documentElement.getAttribute(\"dir\") === \"rtl\"\n    const textArea = document.createElement(\"textarea\")\n    textArea.style.fontSize = \"12pt\"\n    textArea.style.display = \"absolute\"\n    textArea.style[isRTL ? \"right\" : \"left\"] = \"-9999px\"\n    const yPosition = window.pageYOffset || document.documentElement.scrollTop\n    textArea.style.top = `${ yPosition }px`\n    textArea.setAttribute(\"readonly\", \"\")\n    textArea.value = value\n    return textArea\n  }\n\n  #selectText(textArea: HTMLTextAreaElement)\n  {\n    if (navigator.userAgent.match(/ipad|iphone/i)) {\n      const range = document.createRange()\n      range.selectNodeContents(textArea)\n      const selection = window.getSelection()\n      if (selection) {\n        selection.removeAllRanges()\n        selection.addRange(range)\n        textArea.setSelectionRange(0, 999999)\n      }\n    } else {\n      textArea.select()\n    }\n  }\n\n  #onClickCopy = async (evt: Event): Promise<void> =>\n  {\n    this.#logger.info(\"onClickCopy\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    try {\n      this.#closeMenu()\n      let message = \"Nothing to copy\"\n      if (this.#prompterTextElement.innerText) {\n        message = `\"${ this.#prompterTextElement.innerText }\" copied to clipboard`\n        const fakeEl = this.#createTextAreaElement(this.#prompterTextElement.innerText)\n        this.#prompterContainerElement.appendChild(fakeEl)\n        this.#selectText(fakeEl)\n        document.execCommand(\"copy\")\n        fakeEl.remove()\n      }\n      this.internalEvent.emitNotif({ message, timeout: 1500 })\n    } catch (error) {\n      this.#logger.error(\"onClickCopy\", error)\n      this.internalEvent.emitError(error as Error)\n    }\n  }\n\n  #onClickDelete = (evt: Event) =>\n  {\n    this.#logger.info(\"onClickDelete\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    this.internalEvent.emitClear()\n    this.#closeMenu()\n  }\n\n  #onClickCandidate = (evt: Event) =>\n  {\n    this.#logger.info(\"onClickCandidate\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    const target = evt.target as HTMLElement\n    const candidate = target.innerText\n    if (this.jiix?.words && candidate !== this.wordToChange?.label && this.wordToChange?.candidates?.includes(candidate)) {\n      this.jiix.words[parseInt(this.wordToChange?.id as string)].label = candidate\n      this.internalEvent.emitImportJIIX(this.jiix)\n    }\n    this.#candidatesElement.style.display = \"none\"\n  }\n\n  #onClickPrompter = (evt: Event): void =>\n  {\n    this.#logger.info(\"onClickPrompter\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    this.#closeMenu()\n    const target = evt.target as HTMLElement\n    if (target.id !== this.#prompterTextElement.id) {\n      this.#showCandidates(target)\n    } else {\n      this.#hideCandidates()\n    }\n  }\n\n  #stopPropagation = (evt: Event) =>\n  {\n    evt.preventDefault()\n    evt.stopPropagation()\n  }\n\n  #onClickOutSide = () =>\n  {\n    this.#hideCandidates()\n    this.#closeMenu()\n  }\n\n  #addListeners(): void\n  {\n    this.#smartGuideElement.addEventListener(\"pointerdown\", this.#stopPropagation.bind(this))\n    this.#ellipsisElement.addEventListener(\"pointerdown\", this.#onClickEllipsis.bind(this))\n    this.#convertElement.addEventListener(\"pointerdown\", this.#onClickConvert.bind(this))\n    this.#copyElement.addEventListener(\"pointerdown\", this.#onClickCopy.bind(this))\n    this.#deleteElement.addEventListener(\"pointerdown\", this.#onClickDelete.bind(this))\n    this.#prompterTextElement.addEventListener(\"pointerdown\", this.#onClickPrompter.bind(this))\n    this.#candidatesElement.addEventListener(\"pointerdown\", this.#onClickCandidate.bind(this))\n    document.addEventListener(\"pointerdown\", this.#onClickOutSide.bind(this))\n  }\n\n  #removeListeners(): void\n  {\n    this.#smartGuideElement.addEventListener(\"pointerdown\", this.#stopPropagation)\n    this.#ellipsisElement.removeEventListener(\"pointerdown\", this.#onClickEllipsis)\n    this.#convertElement.removeEventListener(\"pointerdown\", this.#onClickConvert)\n    this.#copyElement.removeEventListener(\"pointerdown\", this.#onClickCopy)\n    this.#deleteElement.removeEventListener(\"pointerdown\", this.#onClickDelete)\n    this.#prompterTextElement.removeEventListener(\"pointerdown\", this.#onClickPrompter)\n    this.#candidatesElement.removeEventListener(\"pointerdown\", this.#onClickCandidate)\n    document.removeEventListener(\"pointerdown\", this.#onClickOutSide)\n  }\n\n  resize(): void\n  {\n    this.#logger.info(\"resize\")\n    const marginLeft = convertMillimeterToPixel(this.margin.left)\n    const marginRight = convertMillimeterToPixel(this.margin.right)\n    this.#wrapperElement.style.marginLeft = `${ marginLeft }px`\n    this.#wrapperElement.style.marginRight = `${ marginRight }px`\n  }\n\n  update(exports: TJIIXExport): void\n  {\n    this.#logger.info(\"update\", { exports })\n    this.jiix = exports\n    const createWordSpan = (index: number, word?: TJIIXWord) =>\n    {\n      const span = document.createElement(\"span\")\n      span.id = `word-${ index }${ this.uuid }`\n      if (word) {\n        span.textContent = word.label\n      } else {\n        span.innerHTML = \"&nbsp;\"\n      }\n      this.#logger.debug(\"update\", { span })\n      return span\n    }\n\n    const populatePrompter = () =>\n    {\n      this.#logger.info(\"populatePrompter\")\n      this.#prompterTextElement.innerHTML = \"\"\n      if (this.jiix?.words) {\n        const words = this.jiix.words as TJIIXWord[]\n        const myFragment = document.createDocumentFragment()\n        words.forEach((word, index) =>\n        {\n          if (word.label === \" \" || word.label.includes(\"\\n\")) {\n            myFragment.appendChild(createWordSpan(index))\n          } else if (index !== words.length - 1) {\n            myFragment.appendChild(createWordSpan(index, word))\n          } else {\n            this.#prompterTextElement.appendChild(myFragment)\n            if (this.lastWord) {\n              this.lastWord = word\n            }\n            const span = createWordSpan(index, word)\n            // This is used to scroll to last word if last word is modified\n\n            if ((this.lastWord?.candidates !== word.candidates) && (this.lastWord?.label !== word.label)) {\n              this.lastWord = word\n            }\n            if (this.wordToChange?.id === index.toString()) {\n              span.classList.add(\"modified-word\")\n              this.wordToChange = undefined\n            }\n            else {\n              span.classList.add(\"added-word\")\n            }\n            this.#prompterTextElement.appendChild(span)\n            this.#prompterContainerElement.scrollLeft = span.offsetLeft\n            this.#logger.debug(\"update => populatePrompter\", { span, lastWord: this.lastWord })\n          }\n        })\n      }\n    }\n    populatePrompter()\n    if (this.jiix?.words?.length) {\n      this.#ellipsisElement.style.setProperty(\"pointer-events\", \"auto\")\n    }\n    else {\n      this.#ellipsisElement.style.setProperty(\"pointer-events\", \"none\")\n    }\n  }\n\n  clear(): void\n  {\n    this.#logger.info(\"clear\")\n    this.#prompterTextElement.innerHTML = \"\"\n    this.#candidatesElement.innerHTML = \"\"\n  }\n\n  destroy(): void\n  {\n    this.#logger.info(\"destroy\")\n    this.#removeListeners()\n    this.#smartGuideElement.remove()\n  }\n}\n","\nimport style from \"./iink.css\"\nimport { IBehaviors, OIBehaviors, RestBehaviors, TBehaviorOptions, WSBehaviors } from \"./behaviors\"\nimport { SmartGuide } from \"./smartguide\"\nimport { DeferredPromise, PartialDeep, mergeDeep } from \"./utils\"\nimport { LoggerClass, LoggerManager } from \"./logger\"\nimport { Intention } from \"./Constants\"\nimport { DefaultLoggerConfiguration, TConfiguration, TConverstionState, TLoggerConfiguration, TMarginConfiguration } from \"./configuration\"\nimport { ExportType, IModel, TExport, TJIIXExport } from \"./model\"\nimport { TSymbol, TStroke } from \"./primitive\"\nimport { InternalEvent, PublicEvent } from \"./event\"\nimport { TUndoRedoContext } from \"./history\"\nimport { IGrabber } from \"./grabber\"\nimport { TPenStyle, TTheme } from \"./style\"\n\n/**\n * @group Editor\n */\nexport type HTMLEditorElement = HTMLElement &\n{\n  editor: Editor\n}\n\n/**\n * @group Editor\n */\nexport class Editor\n{\n  logger = LoggerManager.getLogger(LoggerClass.EDITOR)\n  wrapperHTML: HTMLEditorElement\n  #layerInfos!: HTMLDivElement\n  #loaderHTML!: HTMLDivElement\n\n  #messageContainer!: HTMLDivElement\n  #messageModal!: HTMLDivElement\n  #messageOverlay!: HTMLDivElement\n  #messageText!: HTMLParagraphElement\n\n  #stateHTML!: HTMLDivElement\n  #busyHTML!: HTMLDivElement\n  #idleHTML!: HTMLDivElement\n  #behaviors!: IBehaviors\n  #smartGuide?: SmartGuide\n  #initializationDeferred: DeferredPromise<void>\n\n  #loggerConfiguration!: TLoggerConfiguration\n\n  constructor(wrapperHTML: HTMLElement, options: PartialDeep<TBehaviorOptions>, globalClassCss = \"ms-editor\")\n  {\n    this.#initializationDeferred = new DeferredPromise<void>()\n    this.loggerConfiguration = mergeDeep({}, options.logger, DefaultLoggerConfiguration)\n    this.logger.info(\"constructor\", { wrapperHTML, options, globalClassCss })\n\n    this.wrapperHTML = wrapperHTML as HTMLEditorElement\n    this.wrapperHTML.classList.add(globalClassCss)\n    this.wrapperHTML.classList.add(\"draw\")\n    this.events.setElement(this.wrapperHTML)\n\n    const styleElement = document.createElement(\"style\")\n    styleElement.appendChild(document.createTextNode(style as string))\n    this.wrapperHTML.appendChild(styleElement)\n\n    this.wrapperHTML.appendChild(this.#createLayerInfos())\n\n    this.#instantiateBehaviors(options)\n  }\n\n  get loggerConfiguration(): TLoggerConfiguration\n  {\n    return this.#loggerConfiguration\n  }\n\n  set loggerConfiguration(loggerConfig: TLoggerConfiguration)\n  {\n    this.#loggerConfiguration = Object.assign({}, DefaultLoggerConfiguration, loggerConfig)\n    LoggerManager.setLoggerLevel(this.#loggerConfiguration)\n  }\n\n  get initializationPromise(): Promise<void>\n  {\n    return this.#initializationDeferred.promise\n  }\n\n  get model(): IModel\n  {\n    return this.behaviors.model\n  }\n\n  get behaviors(): IBehaviors\n  {\n    return this.#behaviors\n  }\n\n  get configuration(): TConfiguration\n  {\n    return this.behaviors.configuration\n  }\n  set configuration(configuration: TConfiguration)\n  {\n    this.logger.info(\"set configuration\", { configuration })\n    this.#instantiateBehaviors({ configuration })\n    this.initialize()\n  }\n\n  get intention(): Intention\n  {\n    return this.behaviors.intention\n  }\n  set intention(i: Intention)\n  {\n    this.logger.info(\"set intention\", i)\n    this.behaviors.intention = i\n    this.#setCursorIntention()\n  }\n\n  get events(): PublicEvent\n  {\n    return PublicEvent.getInstance()\n  }\n\n  get internalEvents(): InternalEvent\n  {\n    return InternalEvent.getInstance()\n  }\n\n  get context(): TUndoRedoContext\n  {\n    return this.behaviors.history.context\n  }\n\n  get grabber(): IGrabber\n  {\n    return this.behaviors.grabber\n  }\n\n  get currentPenStyle(): TPenStyle\n  {\n    return this.behaviors.currentPenStyle\n  }\n\n  get penStyle(): TPenStyle\n  {\n    return this.behaviors.penStyle\n  }\n  set penStyle(ps: PartialDeep<TPenStyle>)\n  {\n    this.logger.info(\"set penStyle\", { ps })\n    this.behaviors.setPenStyle(ps)\n  }\n\n  get theme(): TTheme\n  {\n    return this.behaviors.theme\n  }\n  set theme(theme: PartialDeep<TTheme>)\n  {\n    this.logger.info(\"set theme\", { t: theme })\n    this.behaviors.setTheme(theme)\n  }\n\n  get penStyleClasses(): string\n  {\n    return this.behaviors.penStyleClasses\n  }\n  set penStyleClasses(styleClasses: string)\n  {\n    this.logger.info(\"set penStyleClasses\", { psc: styleClasses })\n    this.behaviors.setPenStyleClasses(styleClasses)\n  }\n\n  #setCursorIntention(): void\n  {\n    switch (this.behaviors.intention) {\n      case Intention.Erase:\n        this.wrapperHTML.classList.remove(\"draw\")\n        this.wrapperHTML.classList.add(\"erase\")\n        this.wrapperHTML.classList.remove(\"select\")\n        break\n      case Intention.Select:\n        this.wrapperHTML.classList.remove(\"draw\")\n        this.wrapperHTML.classList.remove(\"erase\")\n        this.wrapperHTML.classList.add(\"select\")\n        break\n      default:\n        this.wrapperHTML.classList.add(\"draw\")\n        this.wrapperHTML.classList.remove(\"erase\")\n        this.wrapperHTML.classList.remove(\"select\")\n        break\n    }\n  }\n\n  #createLoader(): HTMLDivElement\n  {\n    this.#loaderHTML = document.createElement(\"div\")\n    this.#loaderHTML.classList.add(\"loader\")\n    this.#loaderHTML.style.display = \"none\"\n    return this.#loaderHTML\n  }\n\n  #createMessage(): HTMLDivElement\n  {\n    this.#messageContainer = document.createElement(\"div\")\n    this.#messageContainer.classList.add(\"message-container\")\n    this.#messageContainer.style.display = \"none\"\n\n    this.#messageOverlay = document.createElement(\"div\")\n    this.#messageOverlay.classList.add(\"message-overlay\")\n    this.#messageContainer.appendChild(this.#messageOverlay)\n\n    this.#messageModal = document.createElement(\"div\")\n    this.#messageModal.classList.add(\"message-modal\")\n\n    const closeBtn = document.createElement(\"button\")\n    closeBtn.classList.add(\"ms-button\", \"close\")\n    closeBtn.addEventListener(\"pointerup\", () => this.closeMessageModal())\n    this.#messageModal.appendChild(closeBtn)\n\n    this.#messageText = document.createElement(\"p\")\n    this.#messageModal.appendChild(this.#messageText)\n    this.#messageContainer.appendChild(this.#messageModal)\n    return this.#messageContainer\n  }\n\n  #createEditorState(): HTMLDivElement\n  {\n    this.#stateHTML = document.createElement(\"div\")\n    this.#stateHTML.classList.add(\"state\")\n    this.#idleHTML = document.createElement(\"div\")\n    this.#idleHTML.textContent = \"idle\"\n    this.#idleHTML.style.display = \"block\"\n    this.#stateHTML.appendChild(this.#idleHTML)\n    this.#busyHTML = document.createElement(\"div\")\n    this.#busyHTML.classList.add(\"busy\")\n    this.#busyHTML.style.display = \"none\"\n    this.#stateHTML.appendChild(this.#busyHTML)\n    this.#stateHTML.style.display = \"none\"\n    return this.#stateHTML\n  }\n\n  #updateEditorState(idle: boolean): void\n  {\n    if (this.configuration.offscreen) {\n      this.#stateHTML.style.display = \"block\"\n      if (idle) {\n        this.#idleHTML.style.display = \"block\"\n        this.#busyHTML.style.display = \"none\"\n      }\n      else {\n        this.#idleHTML.style.display = \"none\"\n        this.#busyHTML.style.display = \"block\"\n      }\n    }\n    else {\n      this.#stateHTML.style.display = \"none\"\n    }\n  }\n\n  #createLayerInfos(): HTMLDivElement\n  {\n    this.#layerInfos = document.createElement(\"div\")\n    this.#layerInfos.classList.add(\"ms-layer-infos\")\n    this.#layerInfos.appendChild(this.#createLoader())\n    this.#layerInfos.appendChild(this.#createMessage())\n    this.#layerInfos.appendChild(this.#createEditorState())\n    return this.#layerInfos\n  }\n\n  #instantiateBehaviors(options: PartialDeep<TBehaviorOptions>)\n  {\n    this.logger.info(\"instantiateBehaviors\", { options })\n    if (!options?.configuration) {\n      throw new Error(\"Configuration required\")\n    }\n    this.internalEvents.removeAllListeners()\n    if (this.#behaviors) {\n      this.#behaviors.destroy()\n    }\n    if (options.configuration.offscreen) {\n      this.#behaviors = new OIBehaviors(options, this.#layerInfos)\n    }\n    else if (options.configuration.server?.protocol === \"REST\") {\n      this.#behaviors = new RestBehaviors(options)\n    } else {\n      this.#behaviors = new WSBehaviors(options)\n    }\n    this.logger.debug(\"instantiateBehaviors\", this.#behaviors)\n  }\n\n  async #initializeBehaviors(): Promise<void>\n  {\n    this.logger.info(\"initializeBehaviors\", \"start\")\n    this.#initializationDeferred = new DeferredPromise<void>()\n    this.#loaderHTML.style.display = \"initial\"\n    this.closeMessageModal()\n    return this.behaviors.init(this.wrapperHTML)\n      .then(async () =>\n      {\n        this.logger.info(\"initializeBehaviors\", \"then\")\n        this.wrapperHTML.editor = this\n        this.#initializationDeferred.resolve()\n        this.events.emitLoaded()\n      })\n      .catch((error: Error) =>\n      {\n        this.logger.error(\"initializeBehaviors\", error)\n        this.#initializationDeferred.reject(error)\n        this.showError(error)\n      })\n      .finally(() =>\n      {\n        this.logger.debug(\"initializeBehaviors\", \"finally\")\n        this.#loaderHTML.style.display = \"none\"\n        this.#updateEditorState(true)\n        return this.#initializationDeferred.promise\n      })\n  }\n\n  #initializeSmartGuide(): void\n  {\n    this.#smartGuide?.destroy()\n    this.logger.info(\"initializeSmartGuide\", { smartGuide: this.configuration.rendering.smartGuide })\n    if (this.configuration.rendering.smartGuide.enable) {\n      this.#smartGuide = new SmartGuide()\n      let margin: TMarginConfiguration\n      switch (this.configuration.recognition.type) {\n        case \"TEXT\":\n          margin = this.configuration.recognition.text.margin\n          break\n        case \"MATH\":\n          margin = this.configuration.recognition.math.margin\n          break\n        default:\n          margin = {\n            top: 20,\n            left: 10,\n            right: 10,\n            bottom: 10\n          }\n          break\n      }\n      this.#smartGuide.init(this.#layerInfos, margin, this.configuration.rendering)\n    }\n  }\n\n  async closeMessageModal(): Promise<void>\n  {\n    this.#messageContainer.style.display = \"none\"\n    this.#messageText.innerText = \"\"\n    if (this.#messageModal.classList.contains(\"error-msg\")) {\n      this.#messageModal.classList.remove(\"error-msg\")\n      await this.behaviors.destroy()\n      this.initialize()\n    }\n  }\n\n  showError(err: Error | string)\n  {\n    this.#messageModal.classList.add(\"error-msg\")\n    this.#messageModal.classList.remove(\"info-msg\")\n    this.#messageContainer.style.display = \"block\"\n    this.#messageText.innerText = typeof err === \"string\" ? err : err.message\n  }\n\n  showNotif(notif: { message: string, timeout?: number })\n  {\n    this.#messageModal.classList.add(\"info-msg\")\n    this.#messageModal.classList.remove(\"error-msg\")\n    this.#messageContainer.style.display = \"block\"\n    this.#messageText.innerText = notif.message\n    setTimeout(() =>\n    {\n      this.closeMessageModal()\n    }, notif.timeout || 2500)\n  }\n\n  #addInternalListeners(): void\n  {\n    this.internalEvents.removeAllListeners()\n    this.internalEvents.addConvertListener(this.convert.bind(this))\n    this.internalEvents.addClearListener(this.clear.bind(this))\n    this.internalEvents.addErrorListener(this.showError.bind(this))\n    this.internalEvents.addNotifListener(this.showNotif.bind(this))\n    this.internalEvents.addClearMessageListener(this.closeMessageModal.bind(this))\n    this.internalEvents.addImportJIIXListener(this.#onImportJIIX.bind(this))\n    this.internalEvents.addExportedListener(this.#onExport.bind(this))\n    this.internalEvents.addContextChangeListener(this.#onContextChange.bind(this))\n    this.internalEvents.addIdleListener(this.#onIdleChange.bind(this))\n    this.internalEvents.addSelectedListener(this.#onSelectionChange.bind(this))\n    this.internalEvents.addIntentionListener(this.#onIntentionChange.bind(this))\n  }\n\n  #onSelectionChange = (symbols: TSymbol[]) =>\n  {\n    this.events.emitSelected(symbols)\n  }\n\n  #onIntentionChange = (intention: Intention) =>\n  {\n    this.intention = intention\n    this.events.emitIntention(intention)\n  }\n\n  #onContextChange = (context: TUndoRedoContext) =>\n  {\n    this.events.emitChanged(context)\n  }\n\n  #onIdleChange = (idle: boolean) =>\n  {\n    this.#updateEditorState(idle)\n    this.events.emitIdle(idle)\n  }\n\n  #onExport(exports: TExport): void\n  {\n    this.logger.info(\"onExport\", { exports })\n    if (this.configuration.rendering.smartGuide.enable) {\n      if (exports && exports[\"application/vnd.myscript.jiix\"]) {\n        const jjix = exports[\"application/vnd.myscript.jiix\"] as TJIIXExport\n        this.#smartGuide?.update(jjix)\n      }\n    }\n    this.events.emitExported(exports)\n  }\n\n  #onImportJIIX(jiix: TJIIXExport): void\n  {\n    this.logger.info(\"onImportJIIX\", { jiix })\n    this.import(new Blob([JSON.stringify(jiix)], { type: ExportType.JIIX }), ExportType.JIIX)\n  }\n\n  async initialize(): Promise<void>\n  {\n    this.logger.info(\"initialize\")\n    this.#addInternalListeners()\n    await this.#initializeBehaviors()\n    this.#initializeSmartGuide()\n  }\n\n  async waitForIdle(): Promise<void>\n  {\n    if (this.behaviors.waitForIdle) {\n      return this.behaviors.waitForIdle()\n    }\n    return\n  }\n\n  async undo(): Promise<IModel>\n  {\n    this.logger.info(\"undo\")\n    await this.#initializationDeferred.promise\n    await this.behaviors.undo()\n    this.logger.debug(\"undo\", this.model)\n    return this.model\n  }\n\n  async redo(): Promise<IModel>\n  {\n    this.logger.info(\"redo\")\n    await this.#initializationDeferred.promise\n    await this.behaviors.redo()\n    this.logger.debug(\"redo\", this.model)\n    return this.model\n  }\n\n  async clear(): Promise<IModel>\n  {\n    this.logger.info(\"clear\")\n    await this.#initializationDeferred.promise\n    await this.behaviors.clear()\n    this.events.emitCleared(this.model)\n    this.logger.debug(\"clear\", this.model)\n    return this.model\n  }\n\n  async resize(): Promise<IModel>\n  {\n    this.logger.info(\"resize\")\n    await this.#initializationDeferred.promise\n    if (this.configuration.rendering.smartGuide.enable) {\n      this.#smartGuide?.resize()\n    }\n    const compStyles = window.getComputedStyle(this.wrapperHTML)\n    const height = Math.max(parseInt(compStyles.height.replace(\"px\", \"\")), this.configuration.rendering.minHeight)\n    const width = Math.max(parseInt(compStyles.width.replace(\"px\", \"\")), this.configuration.rendering.minWidth)\n    await this.behaviors.resize(height, width)\n    this.logger.debug(\"resize\", this.model)\n    return this.model\n  }\n\n  async export(mimeTypes?: string[]): Promise<IModel>\n  {\n    this.logger.info(\"export\", { mimeTypes })\n    await this.#initializationDeferred.promise\n    await this.behaviors.export(mimeTypes)\n    this.logger.debug(\"export\", this.model)\n    return this.model\n  }\n\n  async convert(params?: { conversionState?: TConverstionState, mimeTypes?: string[] }): Promise<IModel | never>\n  {\n    this.logger.info(\"export\", { params })\n    await this.#initializationDeferred.promise\n    await this.behaviors.convert(params?.conversionState, params?.mimeTypes)\n    this.events.emitConverted(this.model.converts as TExport)\n    this.logger.debug(\"convert\", this.model)\n    return this.model\n  }\n\n  async import(data: Blob | string | TJIIXExport, mimeType?: string): Promise<IModel | never>\n  {\n    this.logger.info(\"import\", { data, mimeType })\n    await this.#initializationDeferred.promise\n    if (this.behaviors.import) {\n      let blobToImport: Blob\n      if (data instanceof Blob) {\n        blobToImport = data\n      }\n      else if (typeof data === \"string\") {\n        blobToImport = new Blob([data])\n      }\n      else {\n        blobToImport = new Blob([JSON.stringify(data)])\n      }\n      await this.behaviors.import(blobToImport, mimeType)\n      this.events.emitImported(this.model.exports as TExport)\n      this.logger.debug(\"import\", this.model)\n      return this.model\n    }\n    return Promise.reject(\"Import impossible, behaviors has no import function\")\n  }\n\n  async importPointEvents(strokes: PartialDeep<TStroke>[]): Promise<IModel>\n  {\n    this.logger.info(\"importPointEvents\", { strokes })\n    await this.#initializationDeferred.promise\n    await this.behaviors.importPointEvents(strokes)\n    this.events.emitImported(this.model.exports as TExport)\n    this.logger.debug(\"importPointEvents\", this.model)\n    return this.model\n    return Promise.reject(\"Import impossible, behaviors has no importPointEvents function\")\n  }\n}\n"],"names":["Intention","WriteTool","SvgElementRole","ResizeDirection","SELECTION_MARGIN","LoggerLevel","LoggerClass","Logger","constructor","instanceName","level","this","debug","functionName","data","DEBUG","dataLog","from","message","console","info","INFO","warn","WARN","error","LoggerManager","getLogger","name","__classPrivateFieldGet","_a","_LoggerManager_loggerMap","has","set","ERROR","get","setLoggerLevel","config","Object","keys","forEach","lc","value","Map","DeferredPromise","isFullFilled","isPending","promise","Promise","resolve","reject","v","__awaiter","isValidNumber","x","isNaN","parseFloat","toString","isFinite","isBetween","val","min","max","computeAverage","arr","reduce","p","c","length","computeDistance","p1","p2","distance","Math","hypot","y","computeAngleAxeRadian","begin","end","atan2","createPointsOnSegment","spaceBetweenPoint","points","globalDistance","spaceWithP1","push","scalaire","v1","v2","computeNearestPointOnSegment","seg","vectP1P","vectP1P2","scalaireP1P_P1P2","scalaireP1P2_P1P2","t","isPointInsideBox","point","box","width","height","convertRadianToDegree","radian","PI","toFixed","convertDegreeToRadian","degree","computeRotatedPoint","center","dx","dy","cos","sin","computePointOnEllipse","radiusX","radiusY","phi","theta","cosPhi","sinPhi","M","abs","N","computeDistanceBetweenPointAndSegment","findIntersectionBetween2Segment","seg1","seg2","S1dx","S1dy","S2dx","S2dy","S1S2dx","S1S2dy","ua_t","ub_t","u_b","ua","ub","findIntersectBetweenSegmentAndCircle","r","result","a","pow","b","cc","deter","e","sqrt","u1","u2","computeAngleRadian","p1c","p2c","p1p2","acos","getClosestPoints","points1","points2","minDistance","Number","MAX_SAFE_INTEGER","_p1","_p2","d","getClosestPoint","closest","index","i","isPointInsidePolygon","inside","j","isVersionSuperiorOrEqual","source","target","sourceParts","split","targetParts","computeHmac","applicationKey","hmacKey","enc","TextEncoder","messageEncoded","encode","keyEncoded","key","crypto","subtle","importKey","hash","signature","sign","buffer","Uint8Array","Array","prototype","map","call","padStart","join","convertMillimeterToPixel","mm","convertPixelToMillimeter","px","convertBoundingBoxMillimeterToPixel","createUUID","dt","Date","now","replace","random","floor","mergeDeep","sources","isObject","item","isArray","shift","assign","concat","getAvailableFontList","configuration","server","scheme","_b","host","_c","recognition","lang","serverConfig","response","fetch","json","sort","getAvailableLanguageList","computeLinksPointers","angle","radius","computeMiddlePointer","point1","point2","DefaultListenerConfiguration","capture","passive","DefaultGrabberConfiguration","listenerOptions","xyFloatPrecision","timestampFloatPrecision","delayLongTouch","DefaultMenuConfiguration","enable","style","intention","action","context","DefaultEraserConfiguration","DefaultDiagramConvertConfiguration","types","DefaultDiagramConfiguration","convert","eraser","mimeTypes","DefaultJiixConfiguration","strokes","ids","text","chars","words","DefaultExportConfiguration","jiix","DefaultMarginConfiguration","top","left","right","bottom","DefaultSolverConfiguration","DefaultMathUndoRedoConfiguration","mode","DefaultMathConfiguration","solver","margin","DefaultRawContentConfiguration","gestures","DefaultDebugConfiguration","DefaultRecognitionRendererConfiguration","DefaultTextGuidesConfiguration","DefaultTextConfiguration","guides","DefaultConvertionConfiguration","force","DefaultRecognitionConfiguration","diagram","export","math","renderer","type","alwaysConnected","gesture","ignoreGestureStrokes","DefaultGuidesConfiguration","gap","DefaultSmartGuidesConfiguration","DefaultRenderingConfiguration","smartGuide","minHeight","minWidth","DefaultServerConfiguration","protocol","version","useWindowLocation","websocket","pingEnabled","pingDelay","maxPingLostCount","autoReconnect","maxRetryCount","fileChunkSize","DefaultTriggerConfiguration","exportContent","exportContentDelay","resizeTriggerDelay","DefaultUndoRedoConfiguration","maxStackSize","DefaultConfiguration","offscreen","grabber","rendering","triggers","menu","Configuration","_Configuration_logger","CONFIGURATION","structuredClone","overrideDefaultConfiguration","defaultConf","Boolean","_d","_f","_e","_h","_g","_j","_l","_k","_o","_m","_p","_q","window","location","indexOf","includes","DefaultLoggerConfiguration","EDITOR","BEHAVIORS","RECOGNIZER","GRABBER","RENDERER","PUBLIC_EVENT","INTERNAL_EVENT","MODEL","SYMBOL","SMARTGUIDE","GESTURE","STYLE","HISTORY","TRANSFORMER","CONVERTER","WRITE","SELECTION","SVGDEBUG","MENU","InternalEventType","EventType","ExportType","JIIXELementType","JIIXNodeKind","JIIXEdgeKind","DecoratorKind","InternalEvent","EventTarget","super","_InternalEvent_abortController","_InternalEvent_logger","__classPrivateFieldSet","AbortController","getInstance","_InternalEvent_instance","removeAllListeners","abort","emitSVGPatch","patchChange","_InternalEvent_instances","_InternalEvent_emit","SVG_PATCH","addSVGPatchListener","callback","addEventListener","evt","detail","signal","emitExported","exports","EXPORTED","addExportedListener","emitClearMessage","CLEAR_MESSAGE","addClearMessageListener","emitError","err","addErrorListener","emitNotif","notif","NOTIF","addNotifListener","emitImportJIIX","IMPORT_JIIX","addImportJIIXListener","emitConvert","conversionState","CONVERT","addConvertListener","emitClear","CLEAR","addClearListener","emitContextChange","CONTEXT_CHANGE","addContextChangeListener","emitIdle","idle","IDLE","addIdleListener","emitSelected","symbols","SELECTED","addSelectedListener","emitIntention","INTENTION","addIntentionListener","WeakMap","WeakSet","dispatchEvent","CustomEvent","bubbles","composed","undefined","PublicEvent","_PublicEvent_element","_PublicEvent_logger","_PublicEvent_instance","setElement","el","emitLoaded","LOADED","_PublicEvent_instances","_PublicEvent_emit","emitChanged","undoRedoContext","CHANGED","canClear","empty","emitCleared","model","CLEARED","emitConverted","CONVERTED","emitImported","IMPORTED","OIPointerEventGrabber","_OIPointerEventGrabber_logger","prevent","preventDefault","pointerDownHandler","button","buttons","activePointerId","pointerId","onPointerDown","extractPoint","pointerMoveHandler","onPointerMove","pointerUpHandler","stopPropagation","onPointerUp","pointerOutHandler","domElement","contains","contextMenuHandler","onContextMenu","roundFloat","oneFloat","requestedFloatPrecision","floatPrecision","round","event","clientX","clientY","changedTouches","rect","getBoundingClientRect","pointer","clientLeft","scrollLeft","clientTop","scrollTop","pressure","stopPointerEvent","attach","detach","removeEventListener","PointerEventGrabber","_PointerEventGrabber_logger","classList","document","documentElement","Box","boundindBox","Error","createFromBoxes","boxes","createFromPoints","getCorners","getCenter","getSides","vertices","isContained","wrapper","containsPoint","child","overlaps","box1","box2","xMin","xMid","xMax","yMin","yMid","yMax","corners","snapPoints","boundaries","OIDecorator","kind","id","clone","DefaultStyle","color","opacity","fill","DefaultPenStyle","DefaultTheme","ink","module","o","n","l","m","defineProperty","configurable","enumerable","__esModule","default","hasOwnProperty","s","TypeError","Symbol","iterator","toJSON","u","trim","substring","_trimSemiColon","toCSS","slice","parser","JsonCSS","StyleHelper","themeToCSS","themeToJSON","theme","penStyleToCSS","penStyle","css","penStyleToJSON","penStyleString","stringToJSON","JSONToString","entries","k","SymbolType","EdgeKind","EdgeDecoration","ShapeKind","StyleManager","_StyleManager_penStyle","_StyleManager_theme","_StyleManager_penStyleClasses","_StyleManager_currentPenStyle","_StyleManager_logger","setTheme","setPenStyleClasses","setPenStyle","currentPenStyle","penStyleClasses","penStyleClass","MatrixTransform","xx","yx","xy","yy","tx","ty","identity","applyToPoint","mat","rotation","hypotAc","hypotBd","toCssString","matrix","invert","denom","multiply","translate","rotate","cosAngle","sinAngle","scale","OISymbolBase","creationTime","modificationDate","selected","deleting","transform","edges","isClosed","isIntersected","some","edge","OIEdgeBase","startDecoration","endDecoration","Edge","bounds","bb","e1","e2","isValidPoint","OIEdgeArc","startAngle","sweepAngle","Arc","_vertices","verticesId","computedVertices","nbVertices","angleStep","endAngle","at","create","partial","arc","OIEdgeLine","start","Line","line","OIEdgePolyLine","PolyEdge","polyline","OIShapeBase","Shape","OIShapeEllipse","orientation","Ellipse","perimeter","nbPoint","createBetweenPoints","origin","updateBetweenPoints","ellipse","OIShapeCircle","Circle","_bounds","computedBondingBox","firstPoint","rad","boundingBox","circle","OIShapePolygon","Polygon","polygon","createTriangleBetweenPoints","updateTriangleBetweenPoints","poly","createParallelogramBetweenPoints","updateParallelogramBetweenPoints","createRectangleBetweenPoints","updateRectangleBetweenPoints","createRhombusBetweenPoints","updateRhombusBetweenPoints","OIStroke","pointerType","Stroke","pointers","decorators","strokeToSplit","before","after","substract","stroke","partStroke","lastPointBeforeStroke","closestLastPointBeforeStroke","newStrokes","strokeAfter","firstPointAfterStroke","closestFirstPointStrokeAfter","computePressure","ratio","filterPointByAcquisitionDelta","lastPointer","delta","addPointer","formatToSend","errors","flag","pp","pIndex","convertPartialStrokesToOIStrokes","OISymbolGroup","children","Group","flatMap","updateChildrenStyle","Text","containsSymbol","strokeId","containsOnlyStroke","extractSymbols","extractStrokes","removeChilds","symbolIds","group","every","filter","symbolId","symbol","s1","JSON","parse","stringify","OIText","label","offsetY","getCharCorners","char","boxBox","getCharsOverlaps","charCorners","OIEraser","Eraser","convertPartialStrokesToStrokes","ji","RecognizerError","TOIMessageType","Model","rowHeight","creationDate","_Model_logger","positions","lastSentPosition","lastReceivedPosition","getStrokeFromPoint","_strokeList","strokePointer","addPoint","addStroke","converts","updateStroke","updatedStroke","strokeIndex","findIndex","splice","removeStroke","removeStrokesFromPoint","strokeToRemove","extractUnsentStrokes","initCurrentStroke","dpi","pxWidth","currentSymbol","appendToCurrentStroke","endCurrentStroke","updatePositionSent","position","updatePositionReceived","mergeExport","mergeConvert","clonedModel","clear","OIModel","_OIModel_logger","symbolsSelected","symbolsToDelete","selectSymbol","find","unselectSymbol","resetSelection","getRootSymbol","getSymbolRowIndex","getSymbolsByRowOrdered","rows","rowIndex","row","s2","r1","r2","roundToLineGuide","isSymbolAbove","isSymbolInRow","isSymbolBelow","getFirstSymbol","previous","current","getLastSymbol","addSymbol","updateSymbol","updatedSymbol","sIndex","replaceSymbol","changeOrderSymbol","fromIndex","toIndex","sym","removeSymbol","symbolIndex","extractDifferenceSymbols","added","removed","OIRecognizer","recognitionConfig","_OIRecognizer_logger","pingCount","reconnectionCount","serverConfiguration","recognitionConfiguration","url","exportDeferredMap","contextlessGestureDeferred","connected","initialized","rejectDeferredPending","addStrokeDeferred","transformStrokeDeferred","eraseStrokeDeferred","replaceStrokeDeferred","undoDeferred","redoDeferred","clearDeferred","values","waitForIdleDeferred","resetAllDeferred","closeDeferred","clearSocketListener","socket","openCallback","bind","closeCallback","messageCallback","reason","currentErrorCode","code","GOING_AWAY","PROTOCOL_ERROR","UNSUPPORTED_DATA","ABNORMAL_CLOSURE","INVALID_FRAME_PAYLOAD","POLICY_VIOLATION","MESSAGE_TOO_BIG","INTERNAL_ERROR","SERVICE_RESTART","TRY_AGAIN","BAD_GATEWAY","TLS_HANDSHAKE","CANT_ESTABLISH","pingWorker","terminate","_OIRecognizer_instances","_OIRecognizer_send","manageHMACChallenge","hmacChallengeMessage","hmac","hmacChallenge","initPing","PingWorker","postMessage","onmessage","close","manageAuthenticated","pixelTomm","sessionId","iinkSessionId","scaleX","scaleY","manageSessionDescriptionMessage","sessionDescriptionMessage","currentPartId","contentType","manageNewPartMessage","newPartMessage","managePartChangeMessage","partChangeMessage","partId","manageContentChangedMessage","contentChangeMessage","canRedo","canUndo","manageExportMessage","exportMessage","manageWaitForIdle","manageErrorMessage","errorMessage","UNKNOW","NO_ACTIVITY","timeout","Infinity","WRONG_CREDENTIALS","TOO_OLD","NO_SESSION_FOUND","manageGestureDetected","gestureMessage","manageContextlessGesture","websocketMessage","Pong","HMAC_Challenge","Authenticated","SessionDescription","NewPart","PartChanged","ContentChanged","Exported","GestureDetected","ContextlessGesture","Idle","init","WebSocket","send","readyState","CONNECTING","OPEN","CLOSING","CLOSED","waitForIdle","buildAddStrokesMessage","processGestures","addStrokes","buildReplaceStrokesMessage","oldStrokeIds","replaceStrokes","buildTransformTranslateMessage","strokeIds","transformationType","transformTranslate","buildTransformRotateMessage","x0","y0","transformRotate","buildTransformScaleMessage","transformScale","buildTransformMatrixMessage","transformMatrix","buildEraseStrokesMessage","eraseStrokes","recognizeGesture","buildUndoRedoChanges","changes","changesMessages","erased","replaced","oldStrokes","tr","undo","actions","redo","requestedMimeTypes","all","mt","destroy","RestRecognizer","_RestRecognizer_logger","postConfig","buildData","strokeGroupByPenStyle","groupIndex","sg","isPenStyleEqual","ps1","ps2","strokeGroupsToSend","newGroup","charAt","toUpperCase","toLowerCase","xDPI","yDPI","strokeGroups","post","mimeType","headers","Headers","append","reqInit","method","body","request","Request","ok","blob","catch","tryFetch","then","res","getMimeTypes","myModel","dataToConcert","promises","String","mimeTypesRequiringExport","resize","WSRecognizer","_WSRecognizer_logger","toLocaleLowerCase","internalEvent","infinitePing","setTimeout","params","xDpi","yDpi","viewSizeHeight","viewSizeWidth","exportDeferred","convertDeferred","importDeferred","resizeDeferred","_r","_s","_t","_u","_v","manageAckMessage","ackDeferred","manageContentPackageDescriptionMessage","importPointEventsDeferred","manageContentChangeMessage","stackIndex","undoStackIndex","possibleUndoCount","manageSVGPatchMessage","svgPatchMessage","styleClasses","localModel","import","chunkSize","importFileId","readBlob","fileReader","FileReader","onloadend","ev","onerror","readAsText","importFileMessage","size","blobPart","fileChuckMessage","lastChunk","importPointEvents","events","exportPoints","myExportConverted","undoExports","redoExports","clearExports","CanvasRendererShape","_CanvasRendererShape_logger","table","returnedAngle","drawEllipseArc","context2D","shapeEllipse","centerPoint","maxRadius","minRadius","z1","z2","z3","z4","boundariesPoints","save","beginPath","alpha","cosAlpha","sinAlpha","moveTo","lineTo","restore","drawLine","drawArrowHead","headPoint","beta","fillStyle","strokeStyle","drawShapeEllipse","beginDecoration","beginTangentAngle","endTangentAngle","drawShapeLine","shapeLine","lastPoint","draw","lineWidth","lines","CanvasRendererStroke","_CanvasRendererStroke_logger","renderArc","context2d","renderLine","linkPoints1","linkPoints2","renderFinal","linkPoints","newAngle","renderQuadratic","ctrl","linkPoints3","quadraticCurveTo","NUMBER_POINTS","NUMBER_QUADRATICS","secondPoint","beginLine","endLine","beginFinal","endFinal","closePath","CanvasRendererText","_CanvasRendererText_logger","string","textLine","drawUnderline","textUnderline","underline","topLeftPoint","firstCharacter","lastCharacter","drawText","font","textHeight","textAlign","justificationType","textBaseline","fillText","drawTextLine","underlineList","CanvasRenderer","_CanvasRenderer_logger","strokeRenderer","shapeRenderer","textRenderer","createCanvas","canvas","createElement","add","resizeContent","pixelRatio","devicePixelRatio","renderingCanvas","capturingCanvas","parentNode","clientWidth","clientHeight","getContext","drawSymbol","element","appendChild","parent","renderingCanvasContext","capturingCanvasContext","drawModel","clearRect","drawPendingStroke","innerHTML","OISVGRendererConst","arrowHeadStartMarker","arrowHeadEndMaker","selectionFilterId","removalFilterId","crossMarker","noSelection","XMLNS","SVGBuilder","createLayer","attrs","svgEl","createElementNS","setAttribute","createFilter","createDefs","createMarker","marker","createComponentTransfert","createDropShadow","deviation","shadow","createTransfertFunctionTable","feFunc","createGroup","groupEl","createLine","lineEl","createCircle","circleEl","createPath","pathEl","createPolygon","polygonEl","createRect","rectEl","createTSpan","tSpanEl","textContent","createForeignObject","node","objEl","createText","textEl","OISVGRendererEdgeUtil","getLinePath","getPolyLinePath","getArcPath","getSVGPath","getSVGElement","pathAttrs","Arrow","OISVGRendererEraserUtil","strokeWith","middlePoints","acc","shadowBlur","OISVGRendererDecoratorUtil","decorator","Highlight","Surround","Strikethrough","Underline","OISVGRendererShapeUtil","getPolygonePath","getCirclePath","getEllipsePath","shape","OISVGRendererStrokeUtil","getFinalPath","parts","getQuadraticPath","central","STROKE_LENGTH","STROKE_WIDTH","NB_QUADRATICS","beforeLastPoint","strokeGroup","strokeAttrs","deco","prepend","OISVGRendererTextUtil","textGroup","textElement","fontSize","fontWeight","OISVGRendererGroupUtil","getChildElement","symbolGroup","SurroundAction","StrikeThroughAction","InsertAction","OISVGRenderer","_OISVGRenderer_logger","groupGuidesId","verticalGuides","horizontalGuides","initLayer","layer","setProperty","createSVGTools","defs","REFX","SIZE","REFY","arrowHeadMarkerAttrs","markerWidth","markerHeight","refX","refY","arrowHeadStart","orient","arrowHeadEnd","crossMarkerAttrs","viewBox","cross","createFilters","filtersGroup","removalFilter","filterUnits","bfeComponentTransfer","bfeFuncA","selectionFilter","drawGuides","getAttribute","offSet","subOffSet","role","Guide","guidesGroup","svgLine","subY","subX","svgPoint","Set","definitionGroup","removeGuides","querySelector","remove","oncontextmenu","buildElementFromSymbol","prependElement","symbolToMove","moveEl","insertAdjacentElement","nextElementSibling","previousElementSibling","appendElement","removeElement","oldStroke","oldNode","replaceWith","elements","drawCircle","drawRect","drawConnectionBetweenBox","attrsLine","getElementById","getElements","tagName","query","querySelectorAll","clearElements","firstChild","SVGStroker","buildSVGPath","drawStroke","svgElement","svgPathElement","svgPath","WSSVGRenderer","_WSSVGRenderer_logger","stroker","replaceAll","layerName","update","oldLayer","insertAdjacentHTML","svg","pendingStrokesGroup","replaceElement","elementToRemove","parentSelector","parentId","removeChild","insertBefore","refId","selector","removeAttribute","updateLayer","updatesLayer","updates","clearPendingStroke","pendingStrokeGroup","clearErasingStrokes","erasingStroke","svgList","OIConversionManager","behaviors","fontStyle","_OIConversionManager_logger","weight","computeFontSize","buildChar","grid","buildWord","word","charSymbols","charStrokes","items","g","hightlight","strikethrough","surround","convertText","onlyText","jiixWords","jiixChars","textBounds","isNewLine","currentY","currentX","texter","getSpaceWidth","wordStrokes","textSymbol","nbRow","setBounds","buildCircle","cx","cy","buildEllipse","rx","ry","buildRectangle","rectangle","buildPolygon","buildRhombus","buildTriangle","buildParallelogram","convertNode","associatedStroke","uniqStrokes","Rectangle","Triangle","Parallelogram","Rhombus","buildLine","x1","y1","x2","y2","p1Decoration","p2Decoration","buildPolyEdge","unshift","buildArc","convertEdge","apply","removeSelectedGroup","strokesToConvert","extractStrokesFromSymbols","conversionResults","conversion","addSymbols","cs","removeSymbols","history","OIGestureManager","gestureAction","_OIGestureManager_logger","insertAction","LineBreak","surroundAction","Select","strikeThroughAction","Draw","strikeThrough","insert","recognizer","translator","currentStyle","styler","strokeSpaceWidth","applySurroundGesture","gestureStroke","select","symWithDec","highlight","computeScratchOnStrokes","partPointersToRemove","subStrokes","ss","fullStrokeId","strokePartToErase","computeScratchOnText","charsToRemove","cIndex","c1","updateBounds","computeScratchOnSymbol","strokesScratchedResult","childrenNotTouch","results","symbolsGroup","textScratchedResult","applyScratch","symbolsToUpdate","symbolsToErase","symbolsToReplace","oldSymbols","newSymbols","updateSymbols","updated","replaceSymbols","applyJoinGesture","symbolsAbove","symbolsRow","symbolsBeforeGestureInRow","symbolsOnGestureInRow","symbolsAfterGestureInRow","symbolsBelow","symbolToJoin","childBefore","childAfter","applyToSymbol","symbolsAfterNextRow","lastSymbBefore","firstSymbolAfter","translateX","lastSymbBeforeClone","firstSymbolAfterClone","symbolsToGroup","texts","d1","rest","lastSymbolBeforeGesture","firstSymbolAfterGesture","symbolInNextRow","lastSymbolAbove","createStrokesFromGestureSubStroke","strokeOrigin","subStroke","computeSplitStroke","computeSplitStrokeInGroup","newGroups","groupSymbols","symbolsBefore","symbolsAfter","strokeIdToSplit","gs","computeChangesOnSplitStroke","symbolToSplit","computeChangesOnSplitGroup","groupToSplit","groupSymbolsBefore","groupsSymbolsAfter","groupBefore","grouAfter","computeChangesOnSplitText","textToSplit","charsBefore","charsAfter","newTexts","textBefore","pointAfter","textAfter","applyInsertGesture","Insert","applyUnderlineGesture","applyStrikeThroughGesture","Erase","updateSymbolsStyle","groupStrokesByJIIXElement","gestureType","svgDebugger","getGestureFromContextLess","gestureStrokeId","strokeAfterIds","strokeBeforeIds","symbolsToUnderline","symbolsToStrikeThrough","OIResizeManager","_OIResizeManager_logger","keepRatio","applyToStroke","applyToShape","applyToEdge","applyOnText","applyOnGroup","setTransformOrigin","originX","originY","scaleElement","sx","sy","interactElementsGroup","InteractElementsGroup","direction","transformOrigin","hideInteractElements","localPoint","horizontalResize","verticalResize","snaps","snapResize","deltaX","deltaY","continue","clearSnapToElementLines","strokesFromSymbols","resetSelectedGroup","showInteractElements","OIRotationManager","_OIRotationManager_logger","angleRad","rotateElement","angleDegree","snapRotation","OISelectionManager","_OISelectionManager_logger","_OISelectionManager_selectingId","rotator","resizer","selectionBox","startSelectionPoint","endSelectionPoint","drawSelectingRect","clearSelectingRect","getPoint","createTranslateRect","Translate","boxWithMarge","translateEl","handler","endHandler","createRotateGroup","Rotate","attrs1","attrs2","attrs3","createResizeGroup","Resize","P_NW","P_NE","P_SE","P_SW","bindEl","def","lineResize","cornerResize","createInteractElementsGroup","symbolElementMap","surroundGroup","SURROUND_ATTRS","drawSelectedGroup","selectedGroup","groupBox","getBBox","show","hide","updatedSymbols","OISnapManager","options","_OISnapManager_logger","snapToElement","snapToGrid","snapAngle","selectionSnapPoints","otherSnapPoints","selectSymbolIds","snapThreshold","getNearestVerticalGuide","prev","curr","getNearestHorizontalGuide","getGuidePointToSnap","drawSnapToElementLines","getSnapLinesInfos","sourcePoints","targetPoints","infos","nudge","verticales","horizontales","horizontal","vertical","snapLines","snapLinesInfos","snapTranslate","selectionSymbolPoints","lastDeltaX","lastDeltaY","gridPoint","OITextManager","_OITextManager_logger","drawSymbolHidden","setCharsBounds","textGroupEl","getNumberOfChars","ext","getExtentOfChar","getElementBoundingBox","markers","clipped","getBoundingBox","charSymbol","moveTextAfter","textsAfter","OITranslateManager","_OITranslateManager_logger","addToHistory","translateElement","OIWriteManager","_OIWriteManager_logger","_OIWriteManager_tool","Pencil","detectGesture","tool","wt","unselectAll","gestureManager","needContextLessGesture","strokeBoundsWithMargin","subS","createCurrentSymbol","DoubleArrow","updateCurrentSymbol","updateCurrentSymbolShape","currentSymbolOrigin","updateCurrentSymbolEdge","localPointer","interactWithBackend","localStroke","gestureFromContextLess","pop","localSymbol","OIEraseManager","_OIEraseManager_logger","currentEraser","lastSeg","OIDebugSVGManager","_OIDebugSVGManager_logger","_OIDebugSVGManager_snapPointsVisibility","_OIDebugSVGManager_verticesVisibility","_OIDebugSVGManager_boundingBoxVisibility","_OIDebugSVGManager_recognitionBoxVisibility","_OIDebugSVGManager_recognitionItemBoxVisibility","snapPointsVisibility","debugSnapPoints","verticesVisibility","debugVertices","boundingBoxVisibility","showBoundingBox","hideBoundingBox","recognitionBoxVisibility","debugRecognitionBox","recognitionItemBoxVisibility","debugRecognitionItemBox","showSnapPoints","hideSnapPoints","showVertices","hideVertices","drawBoundingBox","symbolAttrs","charAttrs","symEl","ca","sa","debugBoundingBox","drawRecognitionBox","COLOR","recognitionGroup","infosGroup","infoX","infoY","TEXT_HEIGHT","w","infosGroupBox","rectBox","rectTranslate","newRectBox","showRecognitionBox","hideProperties","candidates","inf","clearRecognitionBox","drawRecognitionItemBox","recognitionItemGroup","charX","charY","charsGroup","charsGroupBox","showRecognitionItemBox","clearRecognitionItemBox","OIMenu","thicknessList","fontSizeList","fontWeightList","colors","createToolTip","tooltipContent","createWrapCollapsible","title","head","btn","ArrowDown","content","toggle","createSeparatorHorizontal","separator","createSeparatorVertical","createMenuItemBoolean","labelEl","checkbox","disabled","initValue","indeterminate","checked","createMenuItemSelect","opt","Option","createMenuItemButton","icon","tooltip","createMenuItemButtonList","createMenuItemColorList","createColorList","list","colorEl","createMenuItem","OIMenuSub","param","trigger","menuTitle","menuTitleElement","subMenu","open","unwrap","display","wrap","OIMenuAction","_OIMenuAction_logger","guideGaps","isMobile","createMenuClear","menuClear","createMenuLanguage","triggerBtn","languages","changeLanguage","menuLanguage","createMenuUndo","menuUndo","createMenuRedo","menuRedo","createMenuConvert","menuConvert","createMenuGesture","subMenuWrapper","surroundActionValues","strikeThroughActionValues","splitActionValues","writer","Write","createMenuGuide","renderingConfiguration","createMenuSnap","createMenuDebug","menuItems","createMenuExport","downloadAsJson","downloadAsSVG","downloadAsPNG","readFileAsText","file","reader","onload","createMenuImport","importInput","accept","multiple","importBtn","files","innerText","fileString","createSymbols","closeAllSubMenu","render","menuTrigger","visibility","lastChild","OIMenuIntention","_OIMenuIntention_logger","createMenuWrite","writeBtn","createMenuMove","menuMove","Move","createMenuSelect","menuSelect","createMenuErase","menuErase","createShapeSubMenu","subMenuShape","menuShape","subMenuContent","nextSibling","createMenuShape","rectangleIcon","triangle","rhombus","createEdgeSubMenu","square","subMenuEdge","menuEdge","createMenuEdge","lineIcon","arrow","doubleArrow","_w","_x","_z","_y","_0","OIMenuStyle","_OIMenuStyle_logger","writeShape","createMenuStroke","symbolsStyles","hasUniqColor","st","menuColorStrokeDef","menuColor","menuColorStroke","createMenuColorFill","menuColorFill","createMenuThickness","hasUniqWidth","menuThickness","createMenuFontSize","converter","textSymbols","updateTextFontStyle","menuFontSize","createMenuFontWeight","menuFontWeight","createMenuOpacity","hasUniqOpacity","currentOpacity","input","output","menuStrokeOpacity","shapeSelected","OIMenuContext","_OIMenuContext_logger","haveSymbolsSelected","symbolsDecorable","showDecorator","createMenuEdit","editInput","editSaveBtn","firstChar","editMenu","createMenuDuplicate","duplicateBtn","duplicatedSymbols","createMenuGroup","groupBtn","ungroupSymbol","convertBtn","updateLayerInfos","createMenuRemove","removeBtn","createMenuReorder","changeOrderSymbols","reverse","reorderMenu","createDecoratorSubMenu","labelEL","decoIndex","decoratorMenu","createMenuDecorator","menuExport","createMenuSelectAll","selectAll","updateDecoratorSubMenu","removeProperty","decos","btnToActivate","updateGroupMenu","parentElement","OIMenuManager","custom","_OIMenuManager_logger","CustomMenuStyle","CustomMenuIntention","CustomMenuAction","OIMoveManager","getInitialUndoRedoContext","HistoryManager","_HistoryManager_logger","stack","updateContext","updateStack","previousModel","nextModel","OIHistoryManager","_OIHistoryManager_logger","isChangesEmpty","order","ungroup","reverseChanges","reversedChanges","currentStackItem","previousStackItem","nextStackItem","OIBehaviors","layerInfos","_OIBehaviors_logger","_OIBehaviors_configuration","_OIBehaviors_model","_OIBehaviors_intention","_OIBehaviors_layerInfosTimer","snap","move","clearTimeout","found","currentEl","symbolTypesAllowed","createShape","partialShape","createEdge","partialEdge","partialGroup","partialSymbol","createStroke","createSymbol","partialSymbols","symList","lastWidth","textIds","tc","symbolsTranslated","firstSym","orginDeco","orginStyle","wordSymb","wd","strokesAssociated","groupStrokeIds","symbolsToRemove","strokesIds","gr","partialStrokes","triggerDownload","fileName","urlData","downloadAnchorNode","click","getSymbolsBounds","buildBlobFromSymbols","svgNode","cloneNode","svgString","XMLSerializer","serializeToString","Blob","getExportName","extension","year","month","day","hour","minute","second","toLocaleDateString","navigator","language","selection","svgBlob","URL","createObjectURL","image","Image","src","drawImage","revokeObjectURL","imgURI","toDataURL","symbolsToExport","dataStr","encodeURIComponent","extractBackendChanges","backendChanges","modifications","actionsToBackend","RestBehaviors","_RestBehaviors_logger","_RestBehaviors_configuration","_RestBehaviors_model","_RestBehaviors_resizeTimer","_RestBehaviors_exportTimer","styleManager","CustomGrabber","CustomRecognizer","drawCurrentStroke","_evt","updateModelRendering","deferred","currentModel","newModel","deferredResize","resizeModel","WSBehaviors","_WSBehaviors_logger","_WSBehaviors_configuration","_WSBehaviors_model","_WSBehaviors_resizeTimer","penClass","onExport","synchronizeModelWithBackend","onSVGPatch","compStyles","getComputedStyle","parseInt","unsentStrokes","strokesToImport","str","SmartGuide","_SmartGuide_smartGuideElement","_SmartGuide_wrapperElement","_SmartGuide_prompterContainerElement","_SmartGuide_prompterTextElement","_SmartGuide_ellipsisElement","_SmartGuide_tagElement","_SmartGuide_candidatesElement","_SmartGuide_menuElement","_SmartGuide_convertElement","_SmartGuide_copyElement","_SmartGuide_deleteElement","_SmartGuide_isMenuOpen","_SmartGuide_logger","_SmartGuide_showCandidates","wordId","uuid","wordToChange","_SmartGuide_onClickEllipsis","_SmartGuide_instances","_SmartGuide_hideCandidates","_SmartGuide_onClickConvert","_SmartGuide_closeMenu","_SmartGuide_onClickCopy","fakeEl","_SmartGuide_selectText","execCommand","_SmartGuide_onClickDelete","_SmartGuide_onClickCandidate","candidate","_SmartGuide_onClickPrompter","_SmartGuide_stopPropagation","_SmartGuide_onClickOutSide","_SmartGuide_createRootElement","_SmartGuide_createWrapperElement","_SmartGuide_createPrompterContainerElement","_SmartGuide_createPrompterTextElement","_SmartGuide_createEllipsisElement","_SmartGuide_createTagElement","_SmartGuide_createCandidatesElement","_SmartGuide_createMoreMenuElement","_SmartGuide_createConvertElement","_SmartGuide_createCopyElement","_SmartGuide_createDeleteElement","_SmartGuide_addListeners","marginLeft","marginRight","createWordSpan","span","myFragment","createDocumentFragment","lastWord","offsetLeft","populatePrompter","_SmartGuide_removeListeners","_SmartGuide_openMenu","isRTL","textArea","yPosition","pageYOffset","userAgent","match","range","createRange","selectNodeContents","getSelection","removeAllRanges","addRange","setSelectionRange","Editor","wrapperHTML","globalClassCss","logger","_Editor_layerInfos","_Editor_loaderHTML","_Editor_messageContainer","_Editor_messageModal","_Editor_messageOverlay","_Editor_messageText","_Editor_stateHTML","_Editor_busyHTML","_Editor_idleHTML","_Editor_behaviors","_Editor_smartGuide","_Editor_initializationDeferred","_Editor_loggerConfiguration","_Editor_onSelectionChange","_Editor_onIntentionChange","_Editor_onContextChange","_Editor_onIdleChange","_Editor_instances","_Editor_updateEditorState","loggerConfiguration","styleElement","createTextNode","_Editor_createLayerInfos","_Editor_instantiateBehaviors","loggerConfig","initializationPromise","initialize","_Editor_setCursorIntention","internalEvents","ps","psc","closeMessageModal","showError","showNotif","_Editor_addInternalListeners","_Editor_initializeBehaviors","_Editor_initializeSmartGuide","blobToImport","_Editor_createLoader","_Editor_createMessage","closeBtn","_Editor_createEditorState","editor","finally","_Editor_onImportJIIX","_Editor_onExport","jjix","JIIX"],"mappings":"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","x_google_ignoreList":[42]}