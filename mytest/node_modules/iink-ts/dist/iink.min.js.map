{"version":3,"file":"iink.min.js","sources":["../src/Constants.ts","../src/logger/logger.ts","../src/logger/LoggerManager.ts","../src/utils/DeferredPromise.ts","../src/utils/math.ts","../src/utils/geometry.ts","../src/utils/version.ts","../src/utils/crypto.ts","../src/utils/units.ts","../src/utils/uuid.ts","../src/utils/merge.ts","../src/utils/language.ts","../src/utils/quadratics.ts","../src/configuration/GrabberConfiguration.ts","../src/configuration/MenuConfiguration.ts","../src/configuration/recognition/EraserConfiguration.ts","../src/configuration/recognition/DiagramConfiguration.ts","../src/configuration/recognition/ExportConfiguration.ts","../src/configuration/recognition/MarginConfiguration.ts","../src/configuration/recognition/MathConfiguration.ts","../src/configuration/recognition/RawContentConfiguration.ts","../src/configuration/recognition/RecognitionRendererConfiguration.ts","../src/configuration/recognition/TextConfiguration.ts","../src/configuration/recognition/ConvertionConfiguration.ts","../src/configuration/RecognitionConfiguration.ts","../src/configuration/RenderingConfiguration.ts","../src/configuration/ServerConfiguration.ts","../src/configuration/TriggerConfiguration.ts","../src/configuration/UndoRedoConfiguration.ts","../src/configuration/Configuration.ts","../src/configuration/LoggerConfiguration.ts","../src/event/InternalEvent.ts","../src/event/PublicEvent.ts","../src/model/Export.ts","../src/primitive/OIDecorator.ts","../src/grabber/OIPointerEventGrabber.ts","../src/grabber/PointerEventGrabber.ts","../src/primitive/Box.ts","../src/style/Style.ts","../src/style/PenStyle.ts","../src/style/Theme.ts","../node_modules/json-css/lib/jsoncss.min.js","../src/style/StyleHelper.ts","../src/primitive/Symbol.ts","../src/primitive/OIEdge.ts","../src/primitive/OIShape.ts","../src/style/StyleManager.ts","../src/transform/Matrix.ts","../src/primitive/OISymbolBase.ts","../src/primitive/Point.ts","../src/primitive/OIEdgeArc.ts","../src/primitive/OIEdgeLine.ts","../src/primitive/OIEdgePolyLine.ts","../src/primitive/OIShapeEllipse.ts","../src/primitive/OIShapeCircle.ts","../src/primitive/OIShapePolygon.ts","../src/primitive/OIStroke.ts","../src/primitive/OISymbolGroup.ts","../src/primitive/OIText.ts","../src/primitive/OIEraser.ts","../src/primitive/Stroke.ts","../src/recognizer/RecognizerError.ts","../src/recognizer/OIRecognizerMessage.ts","../src/model/Model.ts","../src/model/OIModel.ts","../src/recognizer/OIRecognizer.ts","../src/recognizer/RestRecognizer.ts","../src/recognizer/WSRecognizer.ts","../src/renderer/canvas/CanvasRendererShape.ts","../src/renderer/canvas/CanvasRendererStroke.ts","../src/renderer/canvas/CanvasRendererText.ts","../src/renderer/canvas/CanvasRenderer.ts","../src/renderer/svg/OISVGRendererConst.ts","../src/renderer/svg/SVGBuilder.ts","../src/renderer/svg/OISVGRendererEdgeUtil.ts","../src/renderer/svg/OISVGRendererEraserUtil.ts","../src/renderer/svg/OISVGRendererDecoratorUtil.ts","../src/renderer/svg/OISVGRendererShapeUtil.ts","../src/renderer/svg/OISVGRendererStrokeUtil.ts","../src/renderer/svg/OISVGRendererTextUtil.ts","../src/renderer/svg/OISVGRendererGroupUtil.ts","../src/gesture/Gesture.ts","../src/renderer/svg/OISVGRenderer.ts","../src/renderer/svg/SVGStroker.ts","../src/renderer/svg/WSSVGRenderer.ts","../src/manager/OIConversionManager.ts","../src/manager/OIGestureManager.ts","../src/manager/OIResizeManager.ts","../src/manager/OIRotationManager.ts","../src/manager/OISelectionManager.ts","../src/manager/OISnapManager.ts","../src/manager/OITextManager.ts","../src/manager/OITranslateManager.ts","../src/manager/OIWriteManager.ts","../src/manager/OIEraseManager.ts","../src/manager/OIDebugSVGManager.ts","../src/menu/OIMenu.ts","../src/menu/OIMenuSub.ts","../src/menu/OIMenuAction.ts","../src/menu/OIMenuIntention.ts","../src/menu/OIMenuStyle.ts","../src/menu/OIMenuContext.ts","../src/manager/OIMenuManager.ts","../src/manager/OIMoveManager.ts","../src/history/UndoRedoContext.ts","../src/history/HistoryManager.ts","../src/history/OIHistoryManager.ts","../src/behaviors/OIBehaviors.ts","../src/behaviors/RestBehaviors.ts","../src/behaviors/WSBehaviors.ts","../src/smartguide/SmartGuide.ts","../src/Editor.ts","../src/utils/font.ts"],"sourcesContent":["/**\n * @group Editor\n * @description List the possibilities of interactions\n */\nexport enum Intention\n{\n  Write = \"write\",\n  Erase = \"erase\",\n  /**\n   * @remarks only usable in the case of offscreen\n   */\n  Select = \"select\",\n  /**\n   * @remarks only usable in the case of offscreen\n   */\n  Move = \"move\"\n}\n\n/**\n * @group Editor\n * @description List all the shapes that can be drawn\n * @remarks only usable in the case of offscreen\n */\nexport enum WriteTool\n{\n  Pencil = \"pencil\",\n  Rectangle = \"rectangle\",\n  Rhombus = \"rhombus\",\n  Circle = \"circle\",\n  Ellipse = \"ellipse\",\n  Triangle = \"triangle\",\n  Parallelogram = \"parallelogram\",\n  Line = \"line\",\n  Arrow = \"arrow\",\n  DoubleArrow = \"double-arrow\",\n}\n\n/**\n * @group Renderer\n * @description List all svg elements roles\n * @remarks only usable in the case of offscreen\n */\nexport enum SvgElementRole\n{\n  Guide = \"guide\",\n  InteractElementsGroup = \"interact-elements-group\",\n  Translate = \"translate\",\n  Resize = \"resize\",\n  Rotate = \"rotate\",\n}\n\n/**\n * @group Renderer\n * @description List all svg elements resize direction\n * @remarks only usable in the case of offscreen\n */\nexport const enum ResizeDirection\n{\n  North = \"n-resize\",\n  East = \"e-resize\",\n  South = \"s-resize\",\n  West = \"w-resize\",\n  NorthEast = \"ne-resize\",\n  NorthWest = \"nw-resize\",\n  SouthEast = \"se-resize\",\n  SouthWest = \"sw-resize\"\n}\n\n/**\n * @group Renderer\n */\nexport const SELECTION_MARGIN = 10 as const\n","/**\n * @group Logger\n */\nexport enum LoggerLevel\n{\n  DEBUG = \"1\",\n  INFO = \"2\",\n  WARN = \"3\",\n  ERROR = \"4\"\n}\n\n/**\n * @group Logger\n */\nexport enum LoggerClass\n{\n  EDITOR = \"EDITOR\",\n  RECOGNIZER = \"RECOGNIZER\",\n  GRABBER = \"GRABBER\",\n  BEHAVIORS = \"BEHAVIORS\",\n  GESTURE = \"GESTURE\",\n  CONFIGURATION = \"CONFIGURATION\",\n  PUBLIC_EVENT = \"PUBLIC_EVENT\",\n  MODEL = \"MODEL\",\n  RENDERER = \"RENDERER\",\n  SMARTGUIDE = \"SMARTGUIDE\",\n  STYLE = \"STYLE\",\n  HISTORY = \"HISTORY\",\n  SYMBOL = \"SYMBOL\",\n  INTERNAL_EVENT = \"INTERNAL_EVENT\",\n  WRITE = \"WRITE\",\n  TRANSFORMER = \"TRANSFORMER\",\n  CONVERTER = \"CONVERTER\",\n  SELECTION = \"SELECTION\",\n  SVGDEBUG = \"SVGDEBUG\",\n  MENU = \"MENU\"\n}\n\n/**\n * @group Logger\n */\nexport class Logger\n{\n  instanceName: LoggerClass\n  level: LoggerLevel\n\n  constructor(instanceName: LoggerClass, level: LoggerLevel)\n  {\n    this.instanceName = instanceName\n    this.level = level\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  debug(functionName: string, ...data: any)\n  {\n    if (LoggerLevel.DEBUG >= this.level) {\n      const dataLog = {\n        from: `${this.instanceName}.${functionName}`,\n        message: data,\n      }\n      console.debug(dataLog)\n    }\n  }\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  info(functionName: string, ...data: any)\n  {\n    if (LoggerLevel.INFO >= this.level) {\n      const dataLog = {\n        from: `${this.instanceName}.${functionName}`,\n        message: data,\n      }\n      console.info(dataLog)\n    }\n  }\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  warn(functionName: string, ...data: any)\n  {\n    if (LoggerLevel.WARN >= this.level) {\n      const dataLog = {\n        from: `${this.instanceName}.${functionName}`,\n        message: data,\n      }\n      console.warn(dataLog)\n    }\n  }\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  error(functionName: string, ...error: any)\n  {\n    const dataLog = {\n      from: `${this.instanceName}.${functionName}`,\n      error,\n    }\n    console.error(dataLog)\n  }\n}\n","import { TLoggerConfiguration } from \"../configuration\"\nimport { Logger, LoggerClass, LoggerLevel } from \"./logger\"\n\n/**\n * @group Logger\n */\nexport class LoggerManager\n{\n  static #loggerMap: Map<LoggerClass, Logger> = new Map()\n\n  static getLogger(name: LoggerClass): Logger\n  {\n    if (!this.#loggerMap.has(name)) {\n      this.#loggerMap.set(name, new Logger(name, LoggerLevel.ERROR))\n    }\n    return this.#loggerMap.get(name) as Logger\n  }\n\n  static setLoggerLevel(config: TLoggerConfiguration)\n  {\n    Object.keys(config).forEach((lc) =>\n    {\n      LoggerManager.getLogger(lc as LoggerClass).level = config[lc as LoggerClass]\n    })\n  }\n}\n","\n/**\n * @group Utils\n */\nexport class DeferredPromise<T> {\n  promise: Promise<T>\n  resolve!: (value: T) => void\n  reject!: (value: Error | string) => void\n\n  isFullFilled: boolean\n  isPending: boolean\n\n\n  constructor()\n  {\n    this.isFullFilled = false\n    this.isPending = true\n\n    this.promise = new Promise((resolve, reject) =>\n    {\n      this.reject = async (v: unknown) =>\n      {\n        this.isFullFilled = true\n        this.isPending = false\n        return reject(v)\n      }\n      this.resolve = async (v: unknown) =>\n      {\n        this.isFullFilled = true\n        this.isPending = false\n        return resolve(v as T)\n      }\n    })\n  }\n}\n","/**\n * @group Utils\n */\nexport function isValidNumber(x: unknown): boolean\n{\n  if (x === undefined || x === null) return false\n  return !isNaN(parseFloat(x.toString())) && isFinite(+x)\n}\n/**\n * @group Utils\n */\nexport function isBetween(val: number, min: number, max: number): boolean\n{\n  return val >= min && val <= max\n}\n\n/**\n * @group Utils\n */\nexport function computeAverage(arr: number[]): number\n{\n  return arr.reduce((p, c) => p + c, 0) / (arr.length || 1)\n}\n","import { TBoundingBox, TPoint, TSegment } from \"../primitive\"\nimport { isBetween } from \"./math\"\n\n/**\n * @group Utils\n */\nexport function computeDistance(p1: TPoint, p2: TPoint): number\n{\n  const distance = Math.hypot(p2.y - p1.y, p2.x - p1.x)\n  return isNaN(distance) ? 0 : distance\n}\n\n/**\n * @group Utils\n */\nexport function computeAngleAxeRadian(begin: TPoint, end: TPoint): number\n{\n  return Math.atan2(end.y - begin.y, end.x - begin.x)\n}\n\n/**\n * @group Utils\n */\nexport function createPointsOnSegment(p1: TPoint, p2: TPoint, spaceBetweenPoint = 1): TPoint[]\n{\n  const points: TPoint[] = []\n  const globalDistance = computeDistance(p1, p2)\n  let spaceWithP1 = spaceBetweenPoint\n  while (spaceWithP1 < globalDistance) {\n    const p = {\n      x: p1.x + (spaceWithP1 * (p2.x - p1.x)) / globalDistance,\n      y: p1.y + (spaceWithP1 * (p2.y - p1.y)) / globalDistance\n    }\n    points.push(p)\n    spaceWithP1 += spaceBetweenPoint\n  }\n  return points\n}\n\n/**\n * @group Utils\n */\nexport function scalaire(v1: TPoint, v2: TPoint): number\n{\n  return v1.x * v2.x + v1.y * v2.y\n}\n\n/**\n * @group Utils\n */\nexport function computeNearestPointOnSegment(p: TPoint, seg: TSegment): TPoint\n{\n  const vectP1P = { x: p.x - seg.p1.x, y: p.y - seg.p1.y }\n  const vectP1P2 = { x: seg.p2.x - seg.p1.x, y: seg.p2.y - seg.p1.y }\n  if (vectP1P2.x === 0 && vectP1P2.y === 0) {\n    return seg.p1\n  }\n  const scalaireP1P_P1P2 = scalaire(vectP1P, vectP1P2)\n  const scalaireP1P2_P1P2 = scalaire(vectP1P2, vectP1P2)\n\n  const t = Math.min(1, Math.max(0, scalaireP1P_P1P2 / scalaireP1P2_P1P2))\n  return { x: seg.p1.x + (vectP1P2.x * t), y: seg.p1.y + (vectP1P2.y * t) }\n}\n\n/**\n * @group Utils\n */\nexport function isPointInsideBox(point: TPoint, box: TBoundingBox): boolean\n{\n  return isBetween(point.x, box.x, box.x + box.width) && isBetween(point.y, box.y, box.y + box.height)\n}\n\n/**\n * @group Utils\n */\nexport function convertRadianToDegree(radian: number): number\n{\n  return +((radian % (2 * Math.PI)) / Math.PI * 180).toFixed(4)\n}\n\n/**\n * @group Utils\n */\nexport function convertDegreeToRadian(degree: number): number\n{\n  return +((degree % 360) / 180 * Math.PI).toFixed(4)\n}\n\n/**\n * @group Utils\n */\nexport function computeRotatedPoint(point: TPoint, center: TPoint, radian: number): TPoint\n{\n  const dx = point.x - center.x\n  const dy = point.y - center.y\n  const cos = Math.cos(radian)\n  const sin = Math.sin(radian)\n  return {\n    x: +(center.x + cos * dx - sin * dy).toFixed(3),\n    y: +(center.y + sin * dx + cos * dy).toFixed(3)\n  }\n}\n\n/**\n * @group Utils\n */\nexport function computePointOnEllipse(center: TPoint, radiusX: number, radiusY: number, phi: number, theta: number): TPoint\n{\n  const cosPhi = Math.cos(phi)\n  const sinPhi = Math.sin(phi)\n\n  const M = Math.abs(radiusX) * Math.cos(theta)\n  const N = Math.abs(radiusY) * Math.sin(theta)\n\n  return {\n    x: +(center.x + cosPhi * M - sinPhi * N).toFixed(3),\n    y: +(center.y + sinPhi * M + cosPhi * N).toFixed(3)\n  }\n}\n\n/**\n * @group Utils\n */\nexport function computeDistanceBetweenPointAndSegment(p: TPoint, seg: TSegment): number\n{\n  return computeDistance(p, computeNearestPointOnSegment(p, seg))\n}\n\n/**\n * @group Utils\n */\nexport function findIntersectionBetween2Segment(seg1: TSegment, seg2: TSegment): TPoint | undefined\n{\n\n  if (seg1.p1.x === seg2.p1.x && seg1.p1.y === seg2.p1.y) return seg1.p1\n  if (seg1.p1.x === seg2.p2.x && seg1.p1.y === seg2.p2.y) return seg1.p1\n\n  if (seg1.p2.x === seg2.p1.x && seg1.p2.y === seg2.p1.y) return seg1.p2\n  if (seg1.p2.x === seg2.p2.x && seg1.p2.y === seg2.p2.y) return seg1.p2\n\n  const S1dx = seg1.p2.x - seg1.p1.x\n  const S1dy = seg1.p2.y - seg1.p1.y\n\n  const S2dx = seg2.p2.x - seg2.p1.x\n  const S2dy = seg2.p2.y - seg2.p1.y\n\n  const S1S2dx = seg1.p1.x - seg2.p1.x\n  const S1S2dy = seg1.p1.y - seg2.p1.y\n\n  const ua_t = S2dx * S1S2dy - S2dy * S1S2dx\n  const ub_t = S1dx * S1S2dy - S1dy * S1S2dx\n  const u_b = S2dy * S1dx - S2dx * S1dy\n\n  if (ua_t === 0 || ub_t === 0 || u_b === 0) return\n\n  const ua = ua_t / u_b\n  const ub = ub_t / u_b\n  if (isBetween(ua, 0, 1) && isBetween(ub, 0, 1)) {\n    return {\n      x: seg1.p1.x + ua * S1dx,\n      y: seg1.p1.y + ua * S1dy\n    }\n  }\n  return\n}\n\n/**\n * @group Utils\n */\nexport function findIntersectBetweenSegmentAndCircle(seg: TSegment, c: TPoint, r: number): TPoint[]\n{\n  const result: TPoint[] = []\n\n  const a = Math.pow(seg.p2.x - seg.p1.x, 2) + Math.pow(seg.p2.y - seg.p1.y, 2)\n  const b = 2 * ((seg.p2.x - seg.p1.x) * (seg.p1.x - c.x) + (seg.p2.y - seg.p1.y) * (seg.p1.y - c.y))\n  const cc = Math.pow(c.x, 2) + Math.pow(c.y, 2) + Math.pow(seg.p1.x, 2) + Math.pow(seg.p1.y, 2) - 2 * (c.x * seg.p1.x + c.y * seg.p1.y) - Math.pow(r, 2)\n  const deter = Math.pow(b, 2) - 4 * a * cc\n\n  if (deter <= 0) return []\n\n  const e = Math.sqrt(deter)\n  const u1 = (-b + e) / (2 * a)\n  const u2 = (-b - e) / (2 * a)\n\n  if ((u1 < 0 || u1 > 1) && (u2 < 0 || u2 > 1)) {\n    return result\n  }\n\n  if (isBetween(u1, 0, 1)) {\n    result.push({\n      x: (seg.p2.x - seg.p1.x) * u1 + seg.p1.x,\n      y: (seg.p2.y - seg.p1.y) * u1 + seg.p1.y\n    })\n  }\n\n  if (isBetween(u2, 0, 1)) {\n    result.push({\n      x: (seg.p2.x - seg.p1.x) * u2 + seg.p1.x,\n      y: (seg.p2.y - seg.p1.y) * u2 + seg.p1.y\n    })\n  }\n\n  return result\n}\n\n/**\n * @group Utils\n */\nexport function computeAngleRadian(p1: TPoint, center: TPoint, p2: TPoint): number\n{\n  const p1c = Math.sqrt(Math.pow(center.x - p1.x, 2) + Math.pow(center.y - p1.y, 2))\n  const p2c = Math.sqrt(Math.pow(center.x - p2.x, 2) + Math.pow(center.y - p2.y, 2))\n  const p1p2 = Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2))\n  return Math.acos((p2c * p2c + p1c * p1c - p1p2 * p1p2) / (2 * p2c * p1c))\n}\n\n/**\n * @group Utils\n */\nexport function getClosestPoints(points1: TPoint[], points2: TPoint[]): { p1: TPoint, p2: TPoint }\n{\n  let p1 = points1[0]\n  let p2 = points2[0]\n  let minDistance = Number.MAX_SAFE_INTEGER\n  points1.forEach(_p1 =>\n  {\n    points2.forEach(_p2 =>\n    {\n      const d = computeDistance(_p1, _p2)\n      if (minDistance > d) {\n        minDistance = d\n        p1 = _p1\n        p2 = _p2\n      }\n    })\n  })\n  return { p1, p2 }\n}\n\n/**\n * @group Utils\n */\nexport function getClosestPoint(points: TPoint[], point: TPoint): { point?: TPoint, index: number }\n{\n  let minDistance = Number.MAX_SAFE_INTEGER\n  let closest: TPoint | undefined\n  let index = -1\n  points.forEach((p, i) =>\n  {\n    const d = computeDistance(p, point)\n    if (minDistance > d) {\n      minDistance = d\n      closest = p\n      index = i\n    }\n  })\n  return {\n    point: closest,\n    index\n  }\n}\n\n/**\n * @group Utils\n */\nexport function isPointInsidePolygon(point: TPoint, points: TPoint[])\n{\n  let inside = false\n  for (let i = 0, j = points.length - 1; i < points.length; j = i++) {\n    const p1 = points[i]\n    const p2 = points[j]\n    const intersect = ((p1.y > point.y) != (p2.y > point.y))\n      && (point.x < (p2.x - p1.x) * (point.y - p1.y) / (p2.y - p1.y) + p1.x)\n    if (intersect) inside = !inside\n  }\n\n  return inside\n}\n","\n/**\n * @group Utils\n */\nexport const isVersionSuperiorOrEqual = (source: string, target: string): boolean =>\n{\n  const sourceParts = source.split(\".\")\n  const targetParts = target.split(\".\")\n\n  for (let i = 0; i < targetParts.length; i++) {\n    const a = Number(targetParts[i])\n    const b = Number(sourceParts[i])\n    if (a > b) return false\n    if (a < b) return true\n  }\n  return true\n}\n","/**\n * @group Utils\n */\nexport async function computeHmac(message: string, applicationKey: string, hmacKey: string): Promise<string>\n{\n  const enc = new TextEncoder()\n  const messageEncoded = enc.encode(message)\n  const keyEncoded = enc.encode(applicationKey + hmacKey)\n\n  const key = await crypto.subtle.importKey(\n    \"raw\",\n    keyEncoded,\n    {\n      name: \"HMAC\",\n      hash: { name: \"SHA-512\" }\n    },\n    false,\n    [\"sign\"]\n  )\n\n  const signature = await crypto.subtle.sign(\n    \"HMAC\",\n    key,\n    messageEncoded\n  )\n\n  const buffer = new Uint8Array(signature)\n  return Array.prototype.map.call(buffer, x => x.toString(16).padStart(2, \"0\")).join(\"\")\n}\n","import { TBoundingBox } from \"../primitive\"\n\n/**\n * @group Utils\n */\nexport function convertMillimeterToPixel(mm: number): number\n{\n  return +(mm * 96 / 25.4).toFixed(3)\n}\n\n/**\n * @group Utils\n */\nexport function convertPixelToMillimeter(px: number): number\n{\n  return +(px / 96 * 25.4).toFixed(3)\n}\n\n/**\n * @group Utils\n */\nexport function convertBoundingBoxMillimeterToPixel(box?: TBoundingBox): TBoundingBox\n{\n  if (!box) {\n    return { height: 0, width: 0, x: 0, y: 0}\n  }\n  return {\n    x: convertMillimeterToPixel(box.x),\n    y: convertMillimeterToPixel(box.y),\n    width: convertMillimeterToPixel(box.width),\n    height: convertMillimeterToPixel(box.height),\n  }\n}\n","\n/**\n * @group Utils\n */\nexport function createUUID(): string\n{\n  let dt = Date.now()\n  const uuid = \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function (c)\n  {\n    const r = (dt + Math.random() * 16) % 16 | 0\n    dt = Math.floor(dt / 16)\n    return (c == \"x\" ? r : (r & 0x3 | 0x8)).toString(16)\n  })\n  return uuid\n}\n","\n/**\n * @group Utils\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const mergeDeep = (target: any, ...sources: any[]): any =>\n{\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const isObject = (item: any) =>\n  {\n    return (item && typeof item === \"object\" && !Array.isArray(item))\n  }\n  if (!sources.length) return target\n  const source = sources.shift()\n\n  if (isObject(target) && isObject(source)) {\n    for (const key in source) {\n      if (isObject(source[key])) {\n        if (!target[key]) {\n          Object.assign(target, { [key]: {} })\n        }\n        mergeDeep(target[key], source[key])\n      }\n      else if (Array.isArray(target[key]) && Array.isArray(source[key])) {\n        target[key].concat(source[key])\n      }\n      else {\n        Object.assign(target, { [key]: source[key] })\n      }\n    }\n  }\n  else if (Array.isArray(target) && Array.isArray(source)) {\n    target = target.concat(source)\n  }\n  else if (source) {\n    target = source\n  }\n\n  return mergeDeep(target, ...sources)\n}\n","import { TConfiguration } from \"../configuration\"\nimport { PartialDeep } from \"./types\"\n\n/**\n * @group Utils\n */\nexport async function getAvailableLanguageList(configuration: PartialDeep<TConfiguration>): Promise<{ result: { [key: string]: string } }>\n{\n  if (configuration?.server?.scheme && configuration?.server?.host) {\n    const serverConfig = configuration.server\n    const response = await fetch(`${ serverConfig.scheme }://${ serverConfig.host }/api/v4.0/iink/availableLanguageList`)\n    return response.json()\n  } else {\n    return Promise.reject(\"Failed to get languages: configuration.server.scheme & configuration.server.host are required!\")\n  }\n}\n","import { TPoint, TPointer } from \"../primitive\"\n\n/**\n * @group Utils\n */\nexport function computeLinksPointers(point: TPointer, angle: number, width: number): TPoint[]\n{\n  const radius = point.p * width\n  return [\n    {\n      x: +(point.x - (Math.sin(angle) * radius)).toFixed(3),\n      y: +(point.y + (Math.cos(angle) * radius)).toFixed(3)\n    },\n    {\n      x: +(point.x + (Math.sin(angle) * radius)).toFixed(3),\n      y: +(point.y - (Math.cos(angle) * radius)).toFixed(3),\n    }\n  ]\n}\n\n/**\n * @group Utils\n */\nexport function computeMiddlePointer(point1: TPointer, point2: TPointer): TPointer\n{\n  return {\n    x: +((point2.x + point1.x) / 2).toFixed(3),\n    y: +((point2.y + point1.y) / 2).toFixed(3),\n    p: +((point2.p + point1.p) / 2).toFixed(3),\n    t: +((point2.t + point1.t) / 2).toFixed(3),\n  }\n}\n","\n/**\n * @group Configuration\n */\nexport type TListenerConfiguration = {\n  capture: boolean\n  passive: boolean\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultListenerConfiguration: TListenerConfiguration = {\n  capture: false,\n  passive: true\n}\n\n\n/**\n * @group Configuration\n */\nexport type TGrabberConfiguration = {\n  listenerOptions: TListenerConfiguration\n  xyFloatPrecision: number\n  timestampFloatPrecision: number\n  delayLongTouch: number\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultGrabberConfiguration: TGrabberConfiguration = {\n  listenerOptions: DefaultListenerConfiguration,\n  xyFloatPrecision: 0,\n  timestampFloatPrecision: 0,\n  delayLongTouch: 500\n}\n","\n/**\n * @group Configuration\n * @remarks only usable in the case of offscreen\n */\nexport type TMenuConfiguration = {\n  enable: boolean,\n  style: {\n    enable: boolean,\n  }\n  intention: {\n    enable: boolean,\n  }\n  action: {\n    enable: boolean,\n  }\n  context: {\n    enable: boolean,\n  }\n}\n\n/**\n * @group Configuration\n * @remarks only usable in the case of offscreen\n */\nexport const DefaultMenuConfiguration: TMenuConfiguration = {\n  enable: true,\n  style: {\n    enable: true\n  },\n  intention: {\n    enable: true\n  },\n  action: {\n    enable: true\n  },\n  context: {\n    enable: true\n  },\n}\n","\n/**\n * @group Configuration\n */\nexport type TEraserConfiguration = {\n  \"erase-precisely\": boolean\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultEraserConfiguration: TEraserConfiguration = {\n  \"erase-precisely\": false\n}\n","\nimport { DefaultEraserConfiguration, TEraserConfiguration } from \"./EraserConfiguration\"\nimport { TTextConfConfiguration } from \"./TextConfiguration\"\n\n/**\n * @group Configuration\n */\nexport type TDiagramConvertConfiguration = {\n  types?: (\"text\" | \"shape\")[]\n  \"match-text-size\"?: boolean\n}\n\n/**\n * @group Configuration\n */\nexport type TDiagramConfiguration = {\n  mimeTypes: (\"application/vnd.myscript.jiix\" | \"application/vnd.openxmlformats-officedocument.presentationml.presentation\" | \"image/svg+xml\")[]\n  \"enable-sub-blocks\"?: boolean\n  text?: TTextConfConfiguration\n  convert?: TDiagramConvertConfiguration\n  \"session-time\"?: number\n  eraser?: TEraserConfiguration\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultDiagramConvertConfiguration: TDiagramConvertConfiguration = {\n  types: [\"text\", \"shape\"],\n  \"match-text-size\": true\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultDiagramConfiguration: TDiagramConfiguration = {\n  convert: DefaultDiagramConvertConfiguration,\n  eraser: DefaultEraserConfiguration,\n  mimeTypes: [\"application/vnd.myscript.jiix\"],\n}\n","\n/**\n * @group Configuration\n */\nexport type TImageViewportConfiguration = {\n  x: number\n  y: number\n  width: number\n  height: number\n}\n\n/**\n * @group Configuration\n */\nexport type TImageConfiguration = {\n  guides: boolean\n  viewport: TImageViewportConfiguration\n}\n\n/**\n * @group Configuration\n */\nexport type TJiixConfiguration = {\n  \"bounding-box\": boolean\n  strokes: boolean\n  ids: boolean\n  \"full-stroke-ids\": boolean\n  text: {\n    chars: boolean\n    words: boolean\n  }\n  style?: boolean\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultJiixConfiguration: TJiixConfiguration = {\n  \"bounding-box\": false,\n  strokes: false,\n  ids: false,\n  \"full-stroke-ids\": false,\n  text: {\n    chars: false,\n    words: true\n  },\n}\n\n/**\n * @group Configuration\n */\nexport type TMathMLFlavor = {\n  name: string\n}\n\n/**\n * @group Configuration\n */\nexport type TMathMLExport = {\n  flavor: TMathMLFlavor\n}\n\n/**\n * @group Configuration\n */\nexport type TExportConfiguration = {\n  \"image-resolution\"?: number\n  image?: TImageConfiguration\n  jiix: TJiixConfiguration\n  mathml?: TMathMLExport\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultExportConfiguration: TExportConfiguration = {\n  \"image-resolution\": 300,\n  jiix: DefaultJiixConfiguration\n}\n","\n/**\n * @group Configuration\n */\nexport type TMarginConfiguration = {\n  bottom: number\n  left: number\n  right: number\n  top: number\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultMarginConfiguration: TMarginConfiguration = {\n  top: 20,\n  left: 10,\n  right: 10,\n  bottom: 10\n}\n","import { DefaultMarginConfiguration, TMarginConfiguration } from \"./MarginConfiguration\"\nimport { DefaultEraserConfiguration, TEraserConfiguration } from \"./EraserConfiguration\"\n\n/**\n * @group Configuration\n */\nexport type TRoundingMode = \"half up\" | \"truncate\"\n\n/**\n * @group Configuration\n */\nexport type TAngleUnit = \"deg\" | \"rad\"\n\n/**\n * @group Configuration\n */\nexport type TSolverOptions = \"algebraic\" | \"numeric\"\n\n/**\n * @group Configuration\n */\nexport type TSolverConfiguration = {\n  enable?: boolean\n  \"fractional-part-digits\"?: number\n  \"decimal-separator\"?: string\n  \"rounding-mode\"?: TRoundingMode\n  \"angle-unit\"?: TAngleUnit\n  options?: TSolverOptions\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultSolverConfiguration: TSolverConfiguration = {\n  enable: true,\n  \"fractional-part-digits\": 3,\n  \"decimal-separator\": \".\",\n  \"rounding-mode\": \"half up\",\n  \"angle-unit\": \"deg\"\n}\n\n/**\n * @group Configuration\n */\nexport type TUndoRedoMode = \"stroke\" | \"session\"\n\n/**\n * @group Configuration\n */\nexport type TMathUndoRedoConfiguration = {\n  mode: TUndoRedoMode\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultMathUndoRedoConfiguration: TMathUndoRedoConfiguration = {\n  mode: \"stroke\"\n}\n\n/**\n * @group Configuration\n */\nexport type TMathConfiguration = {\n  mimeTypes: (\"application/x-latex\" | \"application/mathml+xml\" | \"application/vnd.myscript.jiix\")[]\n  solver?: TSolverConfiguration\n  margin: TMarginConfiguration\n  \"undo-redo\"?: TMathUndoRedoConfiguration\n  customGrammar?: string\n  customGrammarId?: string\n  customGrammarContent?: string\n  eraser?: TEraserConfiguration\n  \"session-time\"?: number\n  \"recognition-timeout\"?: number\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultMathConfiguration: TMathConfiguration = {\n  solver: DefaultSolverConfiguration,\n  margin: DefaultMarginConfiguration,\n  eraser: DefaultEraserConfiguration,\n  \"undo-redo\": DefaultMathUndoRedoConfiguration,\n  mimeTypes: [\"application/vnd.myscript.jiix\"],\n}\n","\nimport { DefaultEraserConfiguration, TEraserConfiguration } from \"./EraserConfiguration\"\nimport { TTextConfConfiguration } from \"./TextConfiguration\"\n\n/**\n * @group Configuration\n */\nexport type TRawContentConfiguration = {\n  text?: TTextConfConfiguration\n  \"session-time\"?: number\n  recognition?: {\n    types: (\"text\" | \"shape\")[]\n  }\n  eraser?: TEraserConfiguration\n  /**\n   * @description allows you to define the detected gestures\n   * @remarks only usable in the case of offscreen\n   */\n  gestures? : (\"underline\" | \"scratch-out\" | \"join\" | \"insert\" | \"strike-through\" | \"surround\")[]\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultRawContentConfiguration: TRawContentConfiguration = {\n  recognition: {\n    types: [\"text\", \"shape\"]\n  },\n  eraser: DefaultEraserConfiguration,\n  /**\n   * @remarks only usable in the case of offscreen\n   */\n  gestures : [\"underline\", \"scratch-out\", \"join\", \"insert\", \"strike-through\", \"surround\"]\n}\n","\n/**\n * @group Configuration\n */\nexport type TRecognitionRendererDebugConfiguration = {\n  \"draw-text-boxes\": boolean\n  \"draw-image-boxes\": boolean\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultDebugConfiguration: TRecognitionRendererDebugConfiguration = {\n  \"draw-text-boxes\": false,\n  \"draw-image-boxes\": false\n}\n\n/**\n * @group Configuration\n */\nexport type TRecognitionRendererConfiguration = {\n  debug: TRecognitionRendererDebugConfiguration\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultRecognitionRendererConfiguration: TRecognitionRendererConfiguration = {\n  debug: DefaultDebugConfiguration\n}\n","import { DefaultMarginConfiguration, TMarginConfiguration } from \"./MarginConfiguration\"\nimport { DefaultEraserConfiguration, TEraserConfiguration } from \"./EraserConfiguration\"\n\n/**\n * @group Configuration\n */\nexport type TTextGuidesConfiguration = {\n  enable: boolean\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultTextGuidesConfiguration: TTextGuidesConfiguration = {\n  enable: true\n}\n\n/**\n * @group Configuration\n */\nexport type TTextConfConfiguration = {\n  customResources?: string[]\n  customLexicon?: string[]\n  addLKText?: boolean\n}\n\n/**\n * @group Configuration\n */\nexport type TTextConfiguration = {\n  text?: boolean\n  mimeTypes: (\"text/plain\" | \"application/vnd.myscript.jiix\")[]\n  margin: TMarginConfiguration\n  guides?: TTextGuidesConfiguration\n  configuration?: TTextConfConfiguration\n  eraser?: TEraserConfiguration\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultTextConfiguration: TTextConfiguration = {\n  guides: DefaultTextGuidesConfiguration,\n  eraser: DefaultEraserConfiguration,\n  margin: DefaultMarginConfiguration,\n  mimeTypes: [\"application/vnd.myscript.jiix\"],\n}\n","\n/**\n * @group Configuration\n */\nexport type TConvertionConfiguration = {\n    force?: {\n        \"on-stylesheet-change\": boolean\n    }\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultConvertionConfiguration: TConvertionConfiguration = {\n    force: {\n        \"on-stylesheet-change\": false\n    }\n}\n","import {\n  TDiagramConfiguration,\n  TExportConfiguration,\n  TMathConfiguration,\n  TRawContentConfiguration,\n  TRecognitionRendererConfiguration,\n  TTextConfiguration,\n  TConvertionConfiguration,\n  DefaultDiagramConfiguration,\n  DefaultExportConfiguration,\n  DefaultRecognitionRendererConfiguration,\n  DefaultRawContentConfiguration,\n  DefaultMathConfiguration,\n  DefaultTextConfiguration,\n  DefaultConvertionConfiguration,\n} from \"./recognition\"\n\n/**\n * @group Configuration\n */\nexport type TRecognitionType = \"TEXT\" | \"MATH\" | \"DIAGRAM\" | \"Raw Content\"\n\n/**\n * @group Configuration\n */\nexport type TConverstionState = \"DIGITAL_EDIT\" | \"HANDWRITING\"\n\n/**\n * @group Configuration\n */\nexport type TRecognitionConfiguration = {\n  type: TRecognitionType\n  alwaysConnected: boolean\n  lang: string\n  math: TMathConfiguration\n  text: TTextConfiguration\n  diagram: TDiagramConfiguration\n  renderer: TRecognitionRendererConfiguration\n  export: TExportConfiguration\n  \"raw-content\": TRawContentConfiguration\n  gesture: {\n    enable: boolean,\n    ignoreGestureStrokes: boolean\n  }\n  convert: TConvertionConfiguration\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultRecognitionConfiguration: TRecognitionConfiguration = {\n  diagram: DefaultDiagramConfiguration,\n  export: DefaultExportConfiguration,\n  math: DefaultMathConfiguration,\n  \"raw-content\": DefaultRawContentConfiguration,\n  renderer: DefaultRecognitionRendererConfiguration,\n  text: DefaultTextConfiguration,\n  type: \"TEXT\",\n  alwaysConnected: true,\n  lang: \"en_US\",\n  gesture: {\n    enable: true,\n    ignoreGestureStrokes: false,\n  },\n  convert: DefaultConvertionConfiguration,\n}\n","\n/**\n * @group Configuration\n */\nexport type TGuidesConfiguration = {\n  enable: boolean,\n  gap: number\n  /**\n   * @remarks only usable in the case of offscreen\n   */\n  type: \"line\" | \"grid\" | \"point\"\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultGuidesConfiguration: TGuidesConfiguration = {\n  enable: true,\n  gap: 50,\n  /**\n   * @remarks only usable in the case of offscreen\n   */\n  type: \"point\"\n}\n\n/**\n * @group Configuration\n */\nexport type TSmartGuidesConfiguration = {\n  enable: boolean\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultSmartGuidesConfiguration: TSmartGuidesConfiguration = {\n  enable: true,\n}\n\n/**\n * @group Configuration\n */\nexport type TRenderingConfiguration = {\n  minHeight: number\n  minWidth: number\n  smartGuide: TSmartGuidesConfiguration\n  guides: TGuidesConfiguration\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultRenderingConfiguration: TRenderingConfiguration = {\n  guides: DefaultGuidesConfiguration,\n  smartGuide: DefaultSmartGuidesConfiguration,\n  minHeight: 100,\n  minWidth: 100,\n}\n","\n/**\n * @group Configuration\n */\nexport type TProtocol = \"WEBSOCKET\" | \"REST\"\n\n/**\n * @group Configuration\n */\nexport type TSchene = \"https\" | \"http\"\n\n/**\n * @group Configuration\n */\nexport type TServerConfiguration = {\n  protocol: TProtocol,\n  scheme: TSchene,\n  host: string\n  applicationKey: string\n  hmacKey: string\n  version: string\n  useWindowLocation?: boolean\n  websocket: {\n    pingEnabled: boolean\n    pingDelay: number\n    maxPingLostCount: number\n    autoReconnect: boolean\n    maxRetryCount: number\n    fileChunkSize: number\n  }\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultServerConfiguration: TServerConfiguration = {\n  protocol: \"WEBSOCKET\",\n  scheme: \"https\",\n  host: \"cloud.myscript.com\",\n  applicationKey: \"\",\n  hmacKey: \"\",\n  version: \"2.3.0\",\n  useWindowLocation: false,\n  websocket: {\n    pingEnabled: true,\n    pingDelay: 15000,\n    maxPingLostCount: 20,\n    autoReconnect: true,\n    maxRetryCount: 2,\n    fileChunkSize: 300000\n  }\n}\n","/**\n * @group Configuration\n * @remarks\n * Configure when the action is triggered.\n *\n * POINTER_UP :   Action is triggered on every PenUP.\n *                This is the recommended mode for CDK V3 WebSocket recognitions.\n *\n * QUIET_PERIOD : Action is triggered after a quiet period in milli-seconds on every pointer up.\n *                The value is set to 1000 for example recognition will be triggered when the user stops writing for 1 seconds.\n *                This is the recommended mode for all REST discoveries.\n *\n * DEMAND :       Action is triggered on external demande\n */\n export type TTriggerConfiguration = {\n  exportContent: \"QUIET_PERIOD\" | \"POINTER_UP\" | \"DEMAND\"\n  exportContentDelay: number\n  resizeTriggerDelay: number\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultTriggerConfiguration: TTriggerConfiguration = {\n  exportContent: \"POINTER_UP\",\n  exportContentDelay: 1000,\n  resizeTriggerDelay: 100\n}\n","\n/**\n * @group Configuration\n */\nexport type TUndoRedoConfiguration = {\n  maxStackSize: number\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultUndoRedoConfiguration: TUndoRedoConfiguration = {\n  maxStackSize: 100\n}\n","\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { PartialDeep, mergeDeep } from \"../utils\"\nimport { DefaultGrabberConfiguration, TGrabberConfiguration } from \"./GrabberConfiguration\"\nimport { DefaultMenuConfiguration, TMenuConfiguration } from \"./MenuConfiguration\"\nimport { DefaultRecognitionConfiguration, TRecognitionConfiguration } from \"./RecognitionConfiguration\"\nimport { DefaultRenderingConfiguration, TRenderingConfiguration } from \"./RenderingConfiguration\"\nimport { DefaultServerConfiguration, TServerConfiguration } from \"./ServerConfiguration\"\nimport { DefaultTriggerConfiguration, TTriggerConfiguration } from \"./TriggerConfiguration\"\nimport { DefaultUndoRedoConfiguration, TUndoRedoConfiguration } from \"./UndoRedoConfiguration\"\n\n/**\n * @group Configuration\n */\nexport type TConfiguration = {\n  offscreen: boolean\n  server: TServerConfiguration\n  recognition: TRecognitionConfiguration\n  grabber: TGrabberConfiguration\n  rendering: TRenderingConfiguration\n  triggers: TTriggerConfiguration\n  \"undo-redo\": TUndoRedoConfiguration,\n  menu: TMenuConfiguration\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultConfiguration: TConfiguration = {\n  offscreen: false,\n  server: DefaultServerConfiguration,\n  recognition: DefaultRecognitionConfiguration,\n  grabber: DefaultGrabberConfiguration,\n  rendering: DefaultRenderingConfiguration,\n  triggers: DefaultTriggerConfiguration,\n  \"undo-redo\": DefaultUndoRedoConfiguration,\n  menu: DefaultMenuConfiguration\n}\n\n/**\n * @group Configuration\n */\nexport class Configuration implements TConfiguration\n{\n  #logger = LoggerManager.getLogger(LoggerClass.CONFIGURATION)\n\n  offscreen: boolean\n  grabber: TGrabberConfiguration\n  recognition: TRecognitionConfiguration\n  rendering: TRenderingConfiguration\n  server: TServerConfiguration\n  triggers: TTriggerConfiguration\n  \"undo-redo\": TUndoRedoConfiguration\n  menu: TMenuConfiguration\n\n  constructor(configuration?: PartialDeep<TConfiguration>)\n  {\n    this.#logger.info(\"constructor\", { configuration })\n    this.offscreen = DefaultConfiguration.offscreen\n    this.grabber = structuredClone(DefaultConfiguration.grabber)\n    this.recognition = structuredClone(DefaultConfiguration.recognition)\n    this.rendering = structuredClone(DefaultConfiguration.rendering)\n    this.server = structuredClone(DefaultConfiguration.server)\n    this[\"undo-redo\"] = structuredClone(DefaultConfiguration[\"undo-redo\"])\n    this.triggers = structuredClone(DefaultConfiguration.triggers)\n    this.menu = structuredClone(DefaultConfiguration.menu)\n\n    this.overrideDefaultConfiguration(configuration)\n  }\n\n  overrideDefaultConfiguration(configuration?: PartialDeep<TConfiguration>): void\n  {\n    this.#logger.info(\"overrideDefaultConfiguration\", { configuration })\n    const defaultConf = structuredClone(DefaultConfiguration) as TConfiguration\n    this.offscreen = Boolean(configuration?.offscreen)\n    this.grabber = mergeDeep({}, defaultConf.grabber, configuration?.grabber)\n    this.recognition = mergeDeep({}, defaultConf.recognition, configuration?.recognition)\n    this.rendering = mergeDeep({}, defaultConf.rendering, configuration?.rendering)\n    this.server = mergeDeep({}, defaultConf.server, configuration?.server)\n    this.triggers = mergeDeep({}, defaultConf.triggers, configuration?.triggers)\n    this[\"undo-redo\"] = mergeDeep({}, defaultConf[\"undo-redo\"], configuration?.[\"undo-redo\"])\n    this.menu = mergeDeep({}, defaultConf.menu, configuration?.menu)\n\n    if (configuration?.recognition?.text?.mimeTypes) {\n      this.recognition.text.mimeTypes = configuration.recognition.text.mimeTypes as (\"text/plain\" | \"application/vnd.myscript.jiix\")[]\n    }\n    if (configuration?.recognition?.math?.mimeTypes) {\n      this.recognition.math.mimeTypes = configuration.recognition.math.mimeTypes as (\"application/vnd.myscript.jiix\" | \"application/x-latex\" | \"application/mathml+xml\")[]\n    }\n    if (configuration?.recognition?.diagram?.mimeTypes) {\n      this.recognition.diagram.mimeTypes = configuration.recognition.diagram.mimeTypes as (\"application/vnd.myscript.jiix\" | \"application/vnd.openxmlformats-officedocument.presentationml.presentation\" | \"image/svg+xml\")[]\n    }\n    if (configuration?.recognition?.diagram?.convert?.types) {\n      this.recognition.diagram.convert!.types = configuration.recognition.diagram.convert.types as (\"text\" | \"shape\")[]\n    }\n    if (configuration?.recognition?.[\"raw-content\"]?.gestures) {\n      this.recognition[\"raw-content\"].gestures = configuration.recognition[\"raw-content\"].gestures as (\"underline\" | \"scratch-out\" | \"join\" | \"insert\" | \"strike-through\" | \"surround\")[]\n    }\n    if (configuration?.recognition?.[\"raw-content\"]?.recognition?.types) {\n      this.recognition[\"raw-content\"].recognition!.types = configuration.recognition[\"raw-content\"].recognition.types as (\"text\" | \"shape\")[]\n    }\n\n    if (this.server?.useWindowLocation) {\n      this.server.scheme = window.location.protocol.indexOf(\"s\") > -1 ? \"https\" : \"http\"\n      this.server.host = window.location.host\n    }\n\n    if (this.offscreen) {\n      this.recognition.type = \"Raw Content\"\n      this.rendering.smartGuide.enable = false\n      this.server.protocol = \"WEBSOCKET\"\n      this.recognition.export.jiix[\"full-stroke-ids\"] = true\n      this.recognition.export.jiix.ids = true\n      this.recognition.export.jiix.text.words = true\n      this.recognition.export.jiix.text.chars = true\n      this.recognition.export.jiix[\"bounding-box\"]= true\n    }\n    else {\n      if (\n        this.server.protocol === \"REST\" &&\n        this.triggers.exportContent === \"POINTER_UP\"\n      ) {\n        this.triggers.exportContent = \"QUIET_PERIOD\"\n        this.triggers.exportContentDelay = Math.max(this.triggers.exportContentDelay, 50)\n      }\n\n      if (\n        this.server.protocol === \"WEBSOCKET\" &&\n        this.recognition.type === \"TEXT\"\n      ) {\n        if (\n          this.rendering.smartGuide.enable &&\n          !this.recognition.text.mimeTypes.includes(\"application/vnd.myscript.jiix\")\n        ) {\n          // mimeType required for smartGuide\n          this.recognition.text.mimeTypes.push(\"application/vnd.myscript.jiix\")\n        }\n      } else {\n        // smartGuide enable only on websocket text\n        this.rendering.smartGuide.enable = false\n      }\n      // raw-content.gestures Unrecognized when not offscreen\n      delete this.recognition[\"raw-content\"].gestures\n      this.menu.style.enable = false\n    }\n    this.#logger.debug(\"overrideDefaultConfiguration\", { configuration: this })\n  }\n}\n","import { LoggerClass, LoggerLevel } from \"../logger\"\n\n/**\n * @group Configuration\n */\nexport type TLoggerConfiguration = {\n  [key in keyof typeof LoggerClass]: LoggerLevel\n}\n\n/**\n * @group Configuration\n */\nexport const DefaultLoggerConfiguration: TLoggerConfiguration = {\n  [LoggerClass.EDITOR]: LoggerLevel.ERROR,\n  [LoggerClass.BEHAVIORS]: LoggerLevel.ERROR,\n  [LoggerClass.RECOGNIZER]: LoggerLevel.ERROR,\n  [LoggerClass.GRABBER]: LoggerLevel.ERROR,\n  [LoggerClass.RENDERER]: LoggerLevel.ERROR,\n  [LoggerClass.CONFIGURATION]: LoggerLevel.ERROR,\n  [LoggerClass.PUBLIC_EVENT]: LoggerLevel.ERROR,\n  [LoggerClass.INTERNAL_EVENT]: LoggerLevel.ERROR,\n  [LoggerClass.MODEL]: LoggerLevel.ERROR,\n  [LoggerClass.SYMBOL]: LoggerLevel.ERROR,\n  [LoggerClass.SMARTGUIDE]: LoggerLevel.ERROR,\n  [LoggerClass.GESTURE]: LoggerLevel.ERROR,\n  [LoggerClass.STYLE]: LoggerLevel.ERROR,\n  [LoggerClass.HISTORY]: LoggerLevel.ERROR,\n  [LoggerClass.TRANSFORMER]: LoggerLevel.ERROR,\n  [LoggerClass.CONVERTER]: LoggerLevel.ERROR,\n  [LoggerClass.WRITE]: LoggerLevel.ERROR,\n  [LoggerClass.SELECTION]: LoggerLevel.ERROR,\n  [LoggerClass.SVGDEBUG]: LoggerLevel.ERROR,\n  [LoggerClass.MENU]: LoggerLevel.ERROR,\n}\n","import { Intention } from \"../Constants\"\nimport { TConverstionState } from \"../configuration\"\nimport { LoggerManager, LoggerClass } from \"../logger\"\nimport { TExport, TJIIXExport } from \"../model\"\nimport { TOISymbol } from \"../primitive\"\nimport { TWSMessageEventSVGPatch } from \"../recognizer\"\nimport { TUndoRedoContext } from \"../history\"\n\n\n/**\n * @group Event\n * @description Lists all internal library events\n * @example\n * You can run code on \"EventType\" raised by using\n * ```ts\n * editor.internalEvents.addEventListener(InternalEventType.SVG_PATCH, (evt) => console.log(evt.detail))\n * ```\n */\nexport enum InternalEventType\n{\n  SVG_PATCH = \"internal_svg_patch\",\n  EXPORTED = \"internal_exported\",\n  CLEAR_MESSAGE = \"internal_clear_message\",\n  ERROR = \"internal_error\",\n  NOTIF = \"internal_notif\",\n  IMPORT_JIIX = \"internal_import_jiix\",\n  CONVERT = \"internal_convert\",\n  CLEAR = \"internal_clear\",\n  CONTEXT_CHANGE = \"internal_context_change\",\n  IDLE = \"internal_idle\",\n  SELECTED = \"internal_selected\",\n  INTENTION = \"internal_intention\",\n}\n\n/**\n * @group Event\n */\nexport class InternalEvent extends EventTarget\n{\n  static #instance: InternalEvent\n  #abortController: AbortController\n  #logger = LoggerManager.getLogger(LoggerClass.INTERNAL_EVENT)\n\n  private constructor()\n  {\n    super()\n    this.#logger.info(\"constructor\")\n    this.#abortController = new AbortController()\n  }\n\n  public static getInstance(): InternalEvent\n  {\n    if (!InternalEvent.#instance) {\n      InternalEvent.#instance = new InternalEvent()\n    }\n\n    return InternalEvent.#instance\n  }\n\n  removeAllListeners(): void\n  {\n    this.#logger.info(\"removeAllListeners\")\n    this.#abortController.abort()\n    this.#abortController = new AbortController()\n  }\n\n  #emit(type: string, data?: unknown): void\n  {\n    this.dispatchEvent(new CustomEvent(type, Object.assign({ bubbles: true, composed: true }, data ? { detail: data } : undefined)))\n  }\n\n  emitSVGPatch(patchChange: TWSMessageEventSVGPatch): void\n  {\n    this.#logger.info(\"emitSVGPatch\", { patchChange })\n    this.#emit(InternalEventType.SVG_PATCH, patchChange)\n  }\n  addSVGPatchListener(callback: (contentChange: TWSMessageEventSVGPatch) => void): void\n  {\n    this.#logger.info(\"addSVGPatchListener\", { callback })\n    this.addEventListener(InternalEventType.SVG_PATCH, (evt: unknown) => callback(((evt as CustomEvent).detail as TWSMessageEventSVGPatch)), { signal: this.#abortController.signal })\n  }\n\n  emitExported(exports: TExport): void\n  {\n    this.#logger.info(\"emitExported\", { exports })\n    this.#emit(InternalEventType.EXPORTED, exports)\n  }\n  addExportedListener(callback: (exports: TExport) => void): void\n  {\n    this.#logger.info(\"addExportedListener\", { callback })\n    this.addEventListener(InternalEventType.EXPORTED, (evt: unknown) => callback(((evt as CustomEvent).detail as TExport)), { signal: this.#abortController.signal })\n  }\n\n  emitClearMessage(): void\n  {\n    this.#logger.info(\"emitClearMessage\")\n    this.#emit(InternalEventType.CLEAR_MESSAGE)\n  }\n  addClearMessageListener(callback: () => void): void\n  {\n    this.#logger.info(\"addClearMessageListener\", { callback })\n    this.addEventListener(InternalEventType.CLEAR_MESSAGE, () => callback(), { signal: this.#abortController.signal })\n  }\n\n  emitError(err: Error): void\n  {\n    this.#logger.info(\"emitError\", { err })\n    this.#emit(InternalEventType.ERROR, err)\n  }\n  addErrorListener(callback: (err: Error) => void): void\n  {\n    this.#logger.info(\"addErrorListener\", { callback })\n    this.addEventListener(InternalEventType.ERROR, (evt: unknown) => callback(((evt as CustomEvent).detail as Error)), { signal: this.#abortController.signal })\n  }\n\n  emitNotif(notif: { message: string, timeout?: number }): void\n  {\n    this.#logger.info(\"emitWNotif\", { notif })\n    this.#emit(InternalEventType.NOTIF, notif)\n  }\n  addNotifListener(callback: (notif: { message: string, timeout?: number }) => void): void\n  {\n    this.#logger.info(\"addNotifListener\", { callback })\n    this.addEventListener(InternalEventType.NOTIF, (evt: unknown) => callback(((evt as CustomEvent).detail as { message: string, timeout?: number })), { signal: this.#abortController.signal })\n  }\n\n  emitImportJIIX(jiix: TJIIXExport): void\n  {\n    this.#logger.info(\"emitImportJIIX\", { jiix })\n    this.#emit(InternalEventType.IMPORT_JIIX, jiix)\n  }\n  addImportJIIXListener(callback: (jiix: TJIIXExport) => void): void\n  {\n    this.#logger.info(\"addImportJIIXListener\", { callback })\n    this.addEventListener(InternalEventType.IMPORT_JIIX, (evt: unknown) => callback(((evt as CustomEvent).detail as TJIIXExport)), { signal: this.#abortController.signal })\n  }\n\n  emitConvert(conversionState: TConverstionState = \"DIGITAL_EDIT\"): void\n  {\n    this.#logger.info(\"emitConvert\", { conversionState })\n    this.#emit(InternalEventType.CONVERT, conversionState)\n  }\n  addConvertListener(callback: (params?: { conversionState?: TConverstionState, mimeTypes?: string[] }) => void): void\n  {\n    this.#logger.info(\"addConvertListener\", { callback })\n    this.addEventListener(InternalEventType.CONVERT, (evt: unknown) => callback(((evt as CustomEvent).detail as { conversionState?: TConverstionState, mimeTypes?: string[] })), { signal: this.#abortController.signal })\n  }\n\n  emitClear(): void\n  {\n    this.#logger.info(\"emitClear\")\n    this.#emit(InternalEventType.CLEAR)\n  }\n  addClearListener(callback: () => void): void\n  {\n    this.#logger.info(\"addClearListener\", { callback })\n    this.addEventListener(InternalEventType.CLEAR, () => callback(), { signal: this.#abortController.signal })\n  }\n\n  emitContextChange(context: TUndoRedoContext): void\n  {\n    this.#logger.info(\"emitContextChange\", { context })\n    this.#emit(InternalEventType.CONTEXT_CHANGE, context)\n  }\n  addContextChangeListener(callback: (context: TUndoRedoContext) => void): void\n  {\n    this.#logger.info(\"addContextChangeListener\", { callback })\n    this.addEventListener(InternalEventType.CONTEXT_CHANGE, (evt: unknown) => callback(((evt as CustomEvent).detail as TUndoRedoContext)), { signal: this.#abortController.signal })\n  }\n\n  emitIdle(idle: boolean): void\n  {\n    this.#logger.info(\"emitIdle\", { idle })\n    this.#emit(InternalEventType.IDLE, idle)\n  }\n  addIdleListener(callback: (idle: boolean) => void): void\n  {\n    this.#logger.info(\"addIdleListener\", { callback })\n    this.addEventListener(InternalEventType.IDLE, (evt: unknown) => callback(((evt as CustomEvent).detail as boolean)), { signal: this.#abortController.signal })\n  }\n\n  emitSelected(symbols: TOISymbol[]): void\n  {\n    this.#emit(InternalEventType.SELECTED, symbols)\n  }\n  addSelectedListener(callback: (symbols: TOISymbol[]) => void): void\n  {\n    this.#logger.info(\"addSelectedListener\", { callback })\n    this.addEventListener(InternalEventType.SELECTED, (evt: unknown) => callback(((evt as CustomEvent).detail as TOISymbol[])), { signal: this.#abortController.signal })\n  }\n\n  emitIntention(intention: Intention): void\n  {\n    this.#emit(InternalEventType.INTENTION, intention)\n  }\n  addIntentionListener(callback: (intention: Intention) => void): void\n  {\n    this.#logger.info(\"addSelectedListener\", { callback })\n    this.addEventListener(InternalEventType.INTENTION, (evt: unknown) => callback(((evt as CustomEvent).detail as Intention)), { signal: this.#abortController.signal })\n  }\n}\n","import { Intention } from \"../Constants\"\nimport { LoggerManager, LoggerClass } from \"../logger\"\nimport { IModel, TExport } from \"../model\"\nimport { TSymbol } from \"../primitive\"\nimport { TUndoRedoContext } from \"../history\"\n\n/**\n * @group Event\n * @description Lists all events that can be listened to on the editor or DOM element\n * @example\n * You can run code on \"EventType\" raised by using\n * ```ts\n * editor.events.addEventListener(EventType.CHANGED, (evt) => console.log(evt.detail))\n * ```\n */\nexport enum EventType {\n  /**\n   * @description event emitted when history has changed i.e. the context of undo-redo\n   */\n  CHANGED = \"changed\",\n  /**\n   * @description event emitted when clearing is complete\n   */\n  CLEARED = \"cleared\",\n  /**\n   * @description event emitted after the conversion is complete\n   */\n  CONVERTED = \"converted\",\n  /**\n   * @description event emitted when the editor encounters an error\n   */\n  ERROR = \"error\",\n  /**\n   * @description event emitted on click on pointer events\n   */\n  POINTEREVENTS = \"pointer_events\",\n  /**\n   * @description event emitted after the end of the export\n   */\n  EXPORTED = \"exported\",\n  /**\n   * @description event emitted after the end of the import\n   */\n  IMPORTED = \"imported\",\n  /**\n   * @description event emitted when the server is idle after a job\n   */\n  IDLE = \"idle\",\n  /**\n   * @description event emitted after full editor initialization\n   */\n  LOADED = \"loaded\",\n  /**\n  * @description event emitted after\n  */\n  SELECTED = \"selected\",\n  /**\n  * @description event emitted after\n  */\n  INTENTION = \"intention\",\n}\n\n/**\n * @group Event\n */\nexport class PublicEvent extends EventTarget\n{\n  static #instance: PublicEvent\n  #element?: HTMLElement\n  #logger = LoggerManager.getLogger(LoggerClass.PUBLIC_EVENT)\n\n  private constructor()\n  {\n    super()\n  }\n\n  public static getInstance(): PublicEvent\n  {\n    if (!PublicEvent.#instance) {\n      PublicEvent.#instance = new PublicEvent()\n    }\n\n    return PublicEvent.#instance\n  }\n\n  setElement(el: HTMLElement)\n  {\n    this.#logger.info(\"setElement\", { el })\n    this.#element = el\n  }\n\n  #emit(type: string, data?: unknown): void\n  {\n    const evt = new CustomEvent(type, Object.assign({ bubbles: true, composed: true }, data ? { detail: data } : undefined))\n    this.dispatchEvent(evt)\n    this.#element?.dispatchEvent(evt)\n  }\n\n  emitLoaded(): void\n  {\n    this.#logger.info(\"emitLoaded\")\n    this.#emit(EventType.LOADED)\n  }\n\n  emitExported(exports: TExport): void\n  {\n    this.#logger.info(\"emitExported\", { exports })\n    this.#emit(EventType.EXPORTED, exports)\n  }\n\n  emitChanged(undoRedoContext: TUndoRedoContext): void\n  {\n    this.#logger.info(\"emitChanged\", { undoRedoContext })\n    this.#emit(EventType.CHANGED, {\n      ...undoRedoContext,\n      canClear: !undoRedoContext.empty\n    })\n  }\n\n  emitIdle(idle: boolean): void\n  {\n    this.#logger.info(\"emitIdle\", { idle })\n    this.#emit(EventType.IDLE, idle)\n  }\n\n  emitCleared(model?: IModel): void\n  {\n    this.#logger.info(\"emitCleared\", { model })\n    this.#emit(EventType.CLEARED, model)\n  }\n\n  emitConverted(exports: TExport): void\n  {\n    this.#logger.info(\"emitConverted\", { exports })\n    this.#emit(EventType.CONVERTED, exports)\n  }\n\n  emitImported(exports: TExport): void\n  {\n    this.#logger.info(\"emitImported\", { exports })\n    this.#emit(EventType.IMPORTED, exports)\n  }\n\n  emitSelected(symbols: TSymbol[]): void\n  {\n    this.#emit(EventType.SELECTED, symbols)\n  }\n\n  emitIntention(intention: Intention): void\n  {\n    this.#emit(EventType.INTENTION, intention)\n  }\n}\n","import { EdgeDecoration, TBoundingBox, TPoint } from \"../primitive\"\n\n/**\n * @group Exports\n * @description List all supported MIME types for export. Please note, the MIME types supported depend on the recognition type configured\n */\nexport enum ExportType\n{\n  JIIX = \"application/vnd.myscript.jiix\",\n  TEXT = \"text/plain\",\n  LATEX = \"application/x-latex\",\n  MATHML = \"application/mathml+xml\",\n  SVG = \"image/svg+xml\",\n  OFFICE_DOCUMENT = \"application/vnd.openxmlformats-officedocument.presentationml.presentation\"\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.preprod.myscript.com/docs/interactive-ink/latest/reference/jiix  Element type}\n */\nexport enum JIIXELementType\n{\n  Text = \"Text\",\n  Node = \"Node\",\n  Edge = \"Edge\",\n  RawContent = \"Raw Content\",\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.preprod.myscript.com/docs/interactive-ink/latest/reference/jiix/#diagram-item-blocks | Element node kind}\n */\nexport enum JIIXNodeKind\n{\n  Circle = \"circle\",\n  Ellipse = \"ellipse\",\n  Rectangle = \"rectangle\",\n  Triangle = \"triangle\",\n  Parallelogram = \"parallelogram\",\n  Polygon = \"polygon\",\n  Rhombus = \"rhombus\",\n}\n\n/**\n * @group Exports\n */\nexport enum JIIXEdgeKind\n{\n  Line = \"line\",\n  PolyEdge = \"polyedge\",\n  Arc = \"arc\",\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.preprod.myscript.com/docs/interactive-ink/latest/reference/jiix/#stroke-item | Stroke item}\n */\nexport type TJIIXStrokeItem = {\n  type: \"stroke\"\n  id: string\n  \"full-id\"?: string\n  timestamp?: string\n  X?: number[]\n  Y?: number[]\n  F?: number[]\n  T?: number[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXBase = {\n  \"bounding-box\"?: TBoundingBox\n  items?: TJIIXStrokeItem[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXElementBase<T = string> = TJIIXBase & {\n  id: string\n  type: T\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.preprod.myscript.com/docs/interactive-ink/latest/reference/jiix/#word-object | Word object}\n */\nexport type TJIIXWord = TJIIXBase & {\n  id?: string\n  label: string\n  candidates?: string[]\n  \"first-char\"?: number\n  \"last-char\"?: number\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.preprod.myscript.com/docs/interactive-ink/latest/reference/jiix/#character-object | Character object}\n */\nexport type TJIIXChar = TJIIXBase & {\n  label: string\n  candidates?: string[]\n  word: number\n  grid: TPoint[]\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.preprod.myscript.com/docs/interactive-ink/latest/reference/jiix/#text-interpretation | Text Element }\n */\nexport type TJIIXTextElement = TJIIXElementBase<JIIXELementType.Text> & {\n  id: string\n  \"bounding-box\"?: TBoundingBox\n  label: string\n  words?: TJIIXWord[]\n  chars?: TJIIXChar[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeElementBase<K = string> = TJIIXElementBase<JIIXELementType.Node> & {\n  id: string\n  kind: K\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeCircle = TJIIXNodeElementBase<JIIXNodeKind.Circle> & {\n  id: string\n  cx: number\n  cy: number\n  r: number\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeEllipse = TJIIXNodeElementBase<JIIXNodeKind.Ellipse> & {\n  id: string\n  cx: number\n  cy: number\n  rx: number\n  ry: number\n  orientation: number\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeRectangle = TJIIXNodeElementBase<JIIXNodeKind.Rectangle> & {\n  id: string\n  height: number\n  width: number\n  x: number\n  y: number\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeTriangle = TJIIXNodeElementBase<JIIXNodeKind.Triangle> & {\n  id: string\n  points: number[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeParrallelogram = TJIIXNodeElementBase<JIIXNodeKind.Parallelogram> & {\n  id: string\n  points: number[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodePolygon = TJIIXNodeElementBase<JIIXNodeKind.Polygon> & {\n  id: string\n  points: number[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeRhombus = TJIIXNodeElementBase<JIIXNodeKind.Rhombus> & {\n  id: string\n  points: number[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeElement =\n  TJIIXNodeCircle |\n  TJIIXNodeEllipse |\n  TJIIXNodeRectangle |\n  TJIIXNodeTriangle |\n  TJIIXNodeParrallelogram |\n  TJIIXNodePolygon |\n  TJIIXNodeRhombus\n\n/**\n * @group Exports\n */\nexport type TJIIXEdgeElementBase<K = string> = TJIIXElementBase<JIIXELementType.Edge> & {\n  kind: K\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.preprod.myscript.com/docs/interactive-ink/latest/reference/jiix/#line-item | Element line}\n */\nexport type TJIIXEdgeLine = TJIIXEdgeElementBase<JIIXEdgeKind.Line> & {\n  x1: number\n  x2: number\n  y1: number\n  y2: number\n  p1Decoration?: EdgeDecoration\n  p2Decoration?: EdgeDecoration\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXEdgePolyEdge = TJIIXEdgeElementBase<JIIXEdgeKind.PolyEdge> & {\n  edges: TJIIXEdgeLine[]\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.preprod.myscript.com/docs/interactive-ink/latest/reference/jiix/#arc-item | Element arc}\n */\nexport type TJIIXEdgeArc = TJIIXEdgeElementBase<JIIXEdgeKind.Arc> & {\n  cx: number,\n  cy: number,\n  rx: number,\n  ry: number,\n  phi: number,\n  startAngle: number,\n  sweepAngle: number\n  startDecoration?: EdgeDecoration\n  endDecoration?: EdgeDecoration\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXEdgeElement =\n  TJIIXEdgeLine |\n  TJIIXEdgePolyEdge |\n  TJIIXEdgeArc\n\n/**\n * @group Exports\n * @remarks {@link https://developer.preprod.myscript.com/docs/interactive-ink/latest/reference/web/jiix | Exports}\n */\nexport type TJIIXElement =\n  TJIIXTextElement |\n  TJIIXNodeElement |\n  TJIIXEdgeElement\n\n/**\n * @group Exports\n */\nexport type TJIIXExport = {\n  type: string\n  id: string\n  \"bounding-box\"?: TBoundingBox\n  version: string\n  elements?: TJIIXElement[]\n  label?: string\n  words?: TJIIXWord[]\n  chars?: TJIIXChar[]\n}\n\n/**\n * @group Exports\n * @remarks\n * List all supported MIME types for export.\n *\n * Attention the MIME types supported depend on the {@link TRecognitionType | type of recognition}\n *\n * {@link https://developer.preprod.myscript.com/docs/interactive-ink/latest/reference/jiix | Documentation}\n */\nexport type TExport = {\n  /** @hidden */\n  [key: string]: unknown\n  /**\n   * @remarks vnd.myscript.jiix is used for text and raw-content exports\n   */\n  \"application/vnd.myscript.jiix\"?: TJIIXExport\n  /**\n   * @remarks text/plain is only use for text export\n   */\n  \"text/plain\"?: string\n  /**\n   * @remarks x-latex is only use for math export\n   * @see {@link https://katex.org/docs/browser.html | katex} to render\n   */\n  \"application/x-latex\"?: string\n  /**\n   * @remarks mathml+xml is only use for math export\n   * @see {@link https://www.w3.org/Math/whatIsMathML.html | Mathematical Markup Language}\n   */\n  \"application/mathml+xml\"?: string\n  /**\n   * @remarks svg+xml is only use for diagram export\n   */\n  \"image/svg+xml\"?: string\n  /**\n   * @remarks vnd.openxmlformats-officedocument.presentationml.presentation is only use for diagram export\n   * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/Blob | Blob}\n   */\n  \"application/vnd.openxmlformats-officedocument.presentationml.presentation\"?: Blob\n}\n","import { createUUID } from \"../utils\"\nimport { TStyle } from \"../style\"\n\n/**\n * @group Primitive\n */\nexport enum DecoratorKind\n{\n  Highlight = \"highlight\",\n  Surround = \"surround\",\n  Underline = \"underline\",\n  Strikethrough = \"strikethrough\",\n}\n\n/**\n * @group Primitive\n */\nexport class OIDecorator\n{\n  id: string\n  kind: DecoratorKind\n  style: TStyle\n\n  constructor(kind: DecoratorKind, style: TStyle)\n  {\n    this.id = `${ kind }-${ createUUID() }`\n    this.style = structuredClone(style)\n    this.kind = kind\n  }\n\n  clone(): OIDecorator\n  {\n    const clone = new OIDecorator(this.kind, structuredClone(this.style))\n    clone.id = this.id\n    return clone\n  }\n\n}\n","import { TGrabberConfiguration } from \"../configuration\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { TPointer } from \"../primitive\"\nimport { IGrabber } from \"./IGrabber\"\n\n/**\n * @group Grabber\n */\nexport class OIPointerEventGrabber implements IGrabber\n{\n  #logger = LoggerManager.getLogger(LoggerClass.GRABBER)\n\n  protected configuration: TGrabberConfiguration\n  protected domElement!: HTMLElement\n  protected activePointerId?: number\n  protected prevent = (e: Event) => e.preventDefault()\n\n  onPointerDown!: (evt: PointerEvent, point: TPointer) => void\n  onPointerMove!: (evt: PointerEvent, point: TPointer) => void\n  onPointerUp!: (evt: PointerEvent, point: TPointer) => void\n  onContextMenu!: (el: HTMLElement, point: TPointer) => void\n\n  constructor(configuration: TGrabberConfiguration)\n  {\n    this.#logger.info(\"constructor\", { configuration })\n    this.configuration = configuration\n  }\n\n  protected roundFloat(oneFloat: number, requestedFloatPrecision: number): number\n  {\n    if (requestedFloatPrecision >= 0) {\n      const floatPrecision: number = Math.pow(10, requestedFloatPrecision)\n      return Math.round(oneFloat / floatPrecision) * floatPrecision\n    }\n    this.#logger.debug(\"roundFloat\", { oneFloat, requestedFloatPrecision })\n    return oneFloat\n  }\n\n  protected extractPoint(event: MouseEvent | TouchEvent): TPointer\n  {\n    let clientX: number, clientY: number\n    if (\"changedTouches\" in event) {\n      ({ clientX, clientY } = event.changedTouches[0])\n    } else {\n      ({ clientX, clientY } = event)\n    }\n    const rect: DOMRect = this.domElement.getBoundingClientRect()\n    const pointer = {\n      x: this.roundFloat(clientX - rect.left - this.domElement.clientLeft + this.domElement.scrollLeft, this.configuration.xyFloatPrecision),\n      y: this.roundFloat(clientY - rect.top - this.domElement.clientTop + this.domElement.scrollTop, this.configuration.xyFloatPrecision),\n      t: this.roundFloat(Date.now(), this.configuration.timestampFloatPrecision),\n      p: (event as PointerEvent).pressure,\n    }\n    this.#logger.debug(\"extractPoint\", { event, pointer })\n    return pointer\n  }\n\n  protected pointerDownHandler = (evt: PointerEvent) =>\n  {\n    this.#logger.info(\"pointerDown\", { evt })\n\n    // exit if not a left click or multi-touch\n    if (evt.button !== 0 || evt.buttons !== 1) {\n      return\n    }\n\n    this.activePointerId = evt.pointerId\n\n    if (this.onPointerDown) {\n      const point = this.extractPoint(evt)\n      this.onPointerDown(evt, point)\n    }\n  }\n\n  protected pointerMoveHandler = (evt: PointerEvent) =>\n  {\n    this.#logger.info(\"pointerMove\", { evt })\n    if (this.activePointerId != undefined && this.activePointerId === evt.pointerId) {\n      if (this.onPointerMove) {\n        const point = this.extractPoint(evt)\n        this.onPointerMove(evt, point)\n      }\n    }\n  }\n\n  protected pointerUpHandler = (evt: PointerEvent) =>\n  {\n    this.#logger.info(\"pointerUp\", { evt })\n    if (this.activePointerId != undefined && this.activePointerId === evt.pointerId) {\n      this.activePointerId = undefined\n      evt.stopPropagation()\n      if (this.onPointerUp) {\n        const point = this.extractPoint(evt)\n        this.onPointerUp(evt, point)\n      }\n    }\n  }\n\n  protected pointerOutHandler = (evt: PointerEvent) =>\n  {\n    if (\n      this.activePointerId != undefined && this.activePointerId === evt.pointerId &&\n      !this.domElement.contains(evt.target as HTMLElement)\n    ) {\n      evt.stopPropagation()\n      this.activePointerId = undefined\n      if (this.onPointerUp) {\n        const point = this.extractPoint(evt)\n        this.onPointerUp(evt, point)\n      }\n    }\n  }\n\n  protected contextMenuHandler = (evt: MouseEvent) =>\n  {\n    const point = this.extractPoint(evt)\n    this.onContextMenu(evt.target as HTMLElement, point)\n  }\n\n  stopPointerEvent(): void\n  {\n    this.activePointerId = undefined\n  }\n\n  attach(domElement: HTMLElement)\n  {\n    this.#logger.info(\"attach\", { domElement })\n    if (this.domElement) {\n      this.detach()\n    }\n    this.domElement = domElement\n    this.domElement.addEventListener(\"pointerdown\", this.pointerDownHandler, this.configuration.listenerOptions)\n    this.domElement.addEventListener(\"pointermove\", this.pointerMoveHandler, this.configuration.listenerOptions)\n    this.domElement.addEventListener(\"pointerup\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.domElement.addEventListener(\"pointerleave\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.domElement.addEventListener(\"pointercancel\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.domElement.addEventListener(\"pointerout\", this.pointerOutHandler, this.configuration.listenerOptions)\n    this.domElement.addEventListener(\"contextmenu\", this.contextMenuHandler)\n  }\n\n  detach()\n  {\n    this.#logger.info(\"detach\")\n    this.domElement?.removeEventListener(\"pointerdown\", this.pointerDownHandler, this.configuration.listenerOptions)\n    this.domElement?.removeEventListener(\"pointermove\", this.pointerMoveHandler, this.configuration.listenerOptions)\n    this.domElement?.removeEventListener(\"pointerup\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.domElement?.removeEventListener(\"pointerleave\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.domElement?.removeEventListener(\"pointercancel\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.domElement?.removeEventListener(\"pointerout\", this.pointerOutHandler, this.configuration.listenerOptions)\n    this.domElement?.removeEventListener(\"contextmenu\", this.contextMenuHandler)\n  }\n}\n","import { TGrabberConfiguration } from \"../configuration\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { TPointer } from \"../primitive\"\nimport { IGrabber } from \"./IGrabber\"\n\n/**\n * @group Grabber\n */\nexport class PointerEventGrabber implements IGrabber\n{\n  protected configuration: TGrabberConfiguration\n\n  protected domElement!: HTMLElement\n\n  protected activePointerId?: number\n\n  protected prevent = (e: Event) => e.preventDefault()\n  #logger = LoggerManager.getLogger(LoggerClass.GRABBER)\n\n  onPointerDown!: (evt: PointerEvent, point: TPointer) => void\n  onPointerMove!: (evt: PointerEvent, point: TPointer) => void\n  onPointerUp!: (evt: PointerEvent, point: TPointer) => void\n\n  constructor(configuration: TGrabberConfiguration)\n  {\n    this.#logger.info(\"constructor\", { configuration })\n    this.configuration = configuration\n  }\n\n  protected roundFloat(oneFloat: number, requestedFloatPrecision: number): number\n  {\n    if (requestedFloatPrecision >= 0) {\n      const floatPrecision: number = Math.pow(10, requestedFloatPrecision)\n      return Math.round(oneFloat / floatPrecision) * floatPrecision\n    }\n    this.#logger.debug(\"roundFloat\", { oneFloat, requestedFloatPrecision })\n    return oneFloat\n  }\n\n  protected extractPoint(event: MouseEvent | TouchEvent): TPointer\n  {\n    let clientX: number, clientY: number\n    if (\"changedTouches\" in event) {\n      ({ clientX, clientY } = event.changedTouches[0])\n    } else {\n      ({ clientX, clientY } = event)\n    }\n    const rect: DOMRect = this.domElement.getBoundingClientRect()\n    const pointer = {\n      x: this.roundFloat(clientX - rect.left - this.domElement.clientLeft + this.domElement.scrollLeft, this.configuration.xyFloatPrecision),\n      y: this.roundFloat(clientY - rect.top - this.domElement.clientTop + this.domElement.scrollTop, this.configuration.xyFloatPrecision),\n      t: this.roundFloat(Date.now(), this.configuration.timestampFloatPrecision),\n      p: (event as PointerEvent).pressure || 1,\n    }\n    this.#logger.debug(\"extractPoint\", { event, pointer })\n    return pointer\n  }\n\n  protected pointerDownHandler = (evt: PointerEvent) =>\n  {\n    this.#logger.info(\"pointerDown\", { evt })\n\n    // exit if not a left click or multi-touch\n    if (evt.button !== 0 || evt.buttons !== 1) {\n      return\n    }\n\n    this.activePointerId = evt.pointerId\n\n    if (this.onPointerDown) {\n      const point = this.extractPoint(evt)\n      this.onPointerDown(evt, point)\n    }\n  }\n\n  protected pointerMoveHandler = (evt: PointerEvent) =>\n  {\n    this.#logger.info(\"pointerMove\", { evt })\n    if (this.activePointerId != undefined && this.activePointerId === evt.pointerId) {\n      if ((evt.target as HTMLElement).classList.contains(\"smartguide\")) {\n        this.pointerUpHandler(evt)\n        return\n      }\n      if (this.onPointerMove) {\n        const point = this.extractPoint(evt)\n        this.onPointerMove(evt, point)\n      }\n    }\n  }\n\n  protected pointerUpHandler = (evt: PointerEvent) =>\n  {\n    this.#logger.info(\"pointerUp\", { evt })\n    if (this.activePointerId != undefined && this.activePointerId === evt.pointerId) {\n      this.activePointerId = undefined\n      evt.stopPropagation()\n      if (this.onPointerUp) {\n        const point = this.extractPoint(evt)\n        this.onPointerUp(evt, point)\n      }\n    }\n  }\n\n  protected pointerOutHandler = (evt: PointerEvent) =>\n  {\n    if (\n      this.activePointerId != undefined && this.activePointerId === evt.pointerId &&\n      !this.domElement.contains(evt.target as HTMLElement)\n    ) {\n      evt.stopPropagation()\n      this.activePointerId = undefined\n      if (this.onPointerUp) {\n        const point = this.extractPoint(evt)\n        this.onPointerUp(evt, point)\n      }\n    }\n  }\n\n  attach(domElement: HTMLElement)\n  {\n    this.#logger.info(\"attach\", { domElement })\n    if (this.domElement) {\n      this.detach()\n    }\n    this.domElement = domElement\n    this.domElement.addEventListener(\"pointerdown\", this.pointerDownHandler, this.configuration.listenerOptions)\n    this.domElement.addEventListener(\"pointermove\", this.pointerMoveHandler, this.configuration.listenerOptions)\n    this.domElement.addEventListener(\"pointerup\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.domElement.addEventListener(\"pointerleave\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.domElement.addEventListener(\"pointercancel\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.domElement.addEventListener(\"pointerout\", this.pointerOutHandler, this.configuration.listenerOptions)\n\n    this.domElement.addEventListener(\"touchmove\", this.prevent)\n\n    // FIXME investigate why this is needed for iOS devices\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\n    document.documentElement.addEventListener(\"pointerdown\", () => { })\n  }\n\n  detach()\n  {\n    this.#logger.info(\"detach\")\n    this.domElement?.removeEventListener(\"pointerdown\", this.pointerDownHandler, this.configuration.listenerOptions)\n    this.domElement?.removeEventListener(\"pointermove\", this.pointerMoveHandler, this.configuration.listenerOptions)\n    this.domElement?.removeEventListener(\"pointerup\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.domElement?.removeEventListener(\"pointerleave\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.domElement?.removeEventListener(\"pointercancel\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.domElement?.removeEventListener(\"pointerout\", this.pointerOutHandler, this.configuration.listenerOptions)\n    this.domElement?.removeEventListener(\"touchmove\", this.prevent)\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\n    document.documentElement.removeEventListener(\"pointerdown\", () => { })\n  }\n}\n","import { isBetween } from \"../utils\"\nimport { TPoint, TSegment } from \"./Point\"\n\n/**\n * @group Primitive\n */\nexport type TBoundingBox = {\n  x: number,\n  y: number,\n  width: number,\n  height: number\n}\n\n/**\n * @group Primitive\n */\nexport type TBox = {\n  x: number\n  y: number\n  width: number\n  height: number\n  xMin: number\n  xMid: number\n  xMax: number\n  yMin: number\n  yMid: number\n  yMax: number\n}\n\n/**\n * @group Primitive\n */\nexport class Box implements TBox\n{\n  x: number\n  y: number\n  width: number\n  height: number\n\n  constructor(boundindBox: TBoundingBox)\n  {\n    if (boundindBox.width < 0) throw new Error(\"width must be positive\")\n    if (boundindBox.height < 0) throw new Error(\"height must be positive\")\n    this.height = boundindBox.height\n    this.width = boundindBox.width\n    this.x = boundindBox.x\n    this.y = boundindBox.y\n  }\n\n  static createFromBoxes(boxes: TBoundingBox[]): Box\n  {\n    if (!boxes?.length) {\n      return new Box({ height: 0, width: 0, x: 0, y: 0 })\n    }\n    const x = Math.min(...boxes.map(b => b.x))\n    const width = Math.max(...boxes.map(b => b.x + b.width)) - x\n    const y = Math.min(...boxes.map(b => b.y))\n    const height = Math.max(...boxes.map(b => b.y + b.height)) - y\n    return new Box({ x, y, width, height })\n  }\n\n  static createFromPoints(points: TPoint[]): Box\n  {\n    if (!points?.length) {\n      return new Box({ height: 0, width: 0, x: 0, y: 0 })\n    }\n    const x = Math.min(...points.map(p => p.x))\n    const width = Math.max(...points.map(p => p.x)) - x\n    const y = Math.min(...points.map(p => p.y))\n    const height = Math.max(...points.map(p => p.y)) - y\n    return new Box({ x, y, width, height })\n  }\n\n  static getCorners(box: TBoundingBox): TPoint[]\n  {\n    return [\n      { x: box.x, y: box.y },\n      { x: box.x + box.width, y: box.y },\n      { x: box.x + box.width, y: box.y + box.height },\n      { x: box.x, y: box.y + box.height }\n    ]\n  }\n\n  static getCenter(box: TBoundingBox): TPoint\n  {\n    return { x: box.x + box.width / 2, y: box.y + box.height / 2 }\n  }\n\n  static getSides(box: TBoundingBox): TSegment[]\n  {\n    const vertices = Box.getCorners(box)\n    return vertices.map((p, i) =>\n    {\n      if (i === 3) {\n        return { p1: vertices[0], p2: p }\n      }\n      else {\n        return { p1: p, p2: vertices[i + 1] }\n      }\n    })\n  }\n\n  static isContained(box: TBoundingBox, wrapper: TBoundingBox): boolean\n  {\n    return isBetween(box.x, wrapper.x, wrapper.x + wrapper.width) &&\n      isBetween(box.x + box.width, wrapper.x, wrapper.x + wrapper.width) &&\n      isBetween(box.y, wrapper.y, wrapper.y + wrapper.height) &&\n      isBetween(box.y + box.height, wrapper.y, wrapper.y + wrapper.height)\n  }\n\n  static containsPoint(box: TBoundingBox, point: TPoint): boolean\n  {\n    return isBetween(point.x, box.x, box.x + box.width) &&\n      isBetween(point.y, box.y, box.y + box.height)\n  }\n\n  static contains(box: TBoundingBox, child: TBoundingBox): boolean\n  {\n    return isBetween(child.x, box.x, box.x + box.width) &&\n      isBetween(child.x + child.width, box.x, box.x + box.width) &&\n      isBetween(child.y, box.y, box.y + box.height) &&\n      isBetween(child.y + child.height, box.y, box.y + box.height)\n  }\n\n  static overlaps(box1: TBoundingBox, box2: TBoundingBox): boolean\n  {\n    if (box1.x > box2.x + box2.width) return false\n    if (box1.x + box1.width < box2.x) return false\n    if (box1.y > box2.y + box2.height) return false\n    if (box1.y + box1.height < box2.y) return false\n\n    return true\n  }\n\n  get xMin(): number\n  {\n    return this.x\n  }\n\n  get xMid(): number\n  {\n    return this.x + this.width / 2\n  }\n\n  get xMax(): number\n  {\n    return this.x + this.width\n  }\n\n  get yMin(): number\n  {\n    return this.y\n  }\n\n  get yMid(): number\n  {\n    return this.y + this.height / 2\n  }\n\n  get yMax(): number\n  {\n    return this.y + this.height\n  }\n\n  get corners(): TPoint[]\n  {\n    return Box.getCorners(this)\n  }\n\n  get center(): TPoint\n  {\n    return Box.getCenter(this)\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return [\n      ...this.corners,\n      this.center\n    ]\n  }\n\n  isContained(wrapper: TBoundingBox): boolean\n  {\n    return Box.isContained(this, wrapper)\n  }\n\n  contains(child: TBoundingBox): boolean\n  {\n    return Box.contains(this, child)\n  }\n\n  containsPoint(point: TPoint): boolean\n  {\n    return Box.containsPoint(this, point)\n  }\n\n  overlaps(boundaries: TBoundingBox): boolean\n  {\n    return Box.overlaps(this, boundaries)\n  }\n}\n","/**\n * @group Style\n * @property {String} color=#000000 Color (supported formats rgb() rgba() hsl() hsla() #rgb #rgba #rrggbb #rrggbbaa)\n * @property {String} width in px\n\n */\nexport type TStyle = {\n  width?: number\n  color?: string\n  opacity?: number\n  fill?: string\n}\n\n/**\n * @group Style\n */\nexport const DefaultStyle: TStyle = {\n  width: 2,\n  color: \"#000000\",\n  opacity: 1,\n  fill: \"transparent\",\n} as const\n","import { TStyle } from \"./Style\"\n\n/**\n * @group Style\n * @property {String} -myscript-pen-width=1 Width of strokes and primitives in mm (no other unit is supported yet)\n * @property {String} -myscript-pen-fill-style=none\n * @property {String} -myscript-pen-fill-color=#FFFFFF00 Color filled inside the area delimited by strokes and primitives\n */\nexport type TPenStyle = TStyle & {\n  \"-myscript-pen-width\"?: number\n  \"-myscript-pen-fill-style\"?: string\n  \"-myscript-pen-fill-color\"?: string\n}\n\n/**\n * @group Style\n */\nexport const DefaultPenStyle: TPenStyle = {\n\n}\n","import { TPenStyle } from \"./PenStyle\"\n\n/**\n * @group Style\n */\nexport type TThemeMath = {\n  \"font-family\": string\n}\n\n/**\n * @group Style\n */\nexport type TThemeMathSolved = {\n  \"font-family\": string\n  color: string\n}\n\n/**\n * @group Style\n */\nexport type TThemeText = {\n  \"font-family\": string,\n  \"font-size\": number\n}\n\n/**\n * @group Style\n */\nexport type TTheme = {\n  ink: TPenStyle\n  \".math\": TThemeMath\n  \".math-solved\": TThemeMathSolved\n  \".text\": TThemeText\n  [key: string]: unknown\n}\n\n/**\n * @group Style\n */\nexport const DefaultTheme: TTheme = {\n  ink: {\n    color: \"#000000\",\n    width: 1,\n    \"-myscript-pen-width\": 1,\n    \"-myscript-pen-fill-style\": \"none\",\n    \"-myscript-pen-fill-color\": \"#FFFFFF00\"\n  },\n  \".math\": {\n    \"font-family\": \"STIXGeneral\"\n  },\n  \".math-solved\": {\n    \"font-family\": \"STIXGeneral\",\n    color: \"#A8A8A8FF\"\n  },\n  \".text\": {\n    \"font-family\": \"MyScriptInter\",\n    \"font-size\": 10\n  }\n}\n","!function(t,e){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=e():\"function\"==typeof define&&define.amd?define([],e):\"object\"==typeof exports?exports.JsonCSS=e():t.JsonCSS=e()}(this,function(){return function(t){function e(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,\"a\",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p=\"\",e(e.s=1)}([function(t,e,n){\"use strict\";function o(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}Object.defineProperty(e,\"__esModule\",{value:!0});var r=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&\"function\"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?\"symbol\":typeof t},i=function t(e){var n=this;o(this,t),this.toJSON=function(t){if(\"string\"!=typeof t)return console.error(\"Need a CSS string but given \",void 0===t?\"undefined\":r(t),t),\"Not a valid CSS..!\";var e={},o=void 0,i=void 0,u=void 0;try{t.split(\"{\").forEach(function(t){if(i=t.trim())if(-1===i.indexOf(\"}\"))e[i]={},o=i;else{i.substring(0,i.indexOf(\"}\")).split(\";\").forEach(function(t){(u=t.split(\":\"))&&2===u.length&&(e[o][u[0].trim().replace(/^\\\"|\\\"$/g,\"\")]=n._trimSemiColon(u[1].trim().replace(/^\\\"|\\\"$/g,\"\")))});try{o=i.split(\"}\")[1].trim(),o&&(e[o]={})}catch(t){}}})}catch(t){return\"Not a valid CSS..!\"}return e},this.toCSS=function(t){if(\"object\"!==(void 0===t?\"undefined\":r(t)))return console.error(\"Need a JSON object but given \",void 0===t?\"undefined\":r(t),t),\"Not a valid JSON..!\";var e=\"\";try{for(var n in t)if(t.hasOwnProperty(n)){e+=n+\" {\\n\";for(var o in t[n])t[n].hasOwnProperty(o)&&(e+=o+\": \"+t[n][o]+\";\\n\");e+=\"}\\n\"}}catch(t){return\"Not a valid JSON..!\"}return e},this._trimSemiColon=function(t){return\";\"===t.slice(-1)?t.slice(0,n.length-1):t}};e.default=i},function(t,e,n){\"use strict\";t.exports=n(0).default}])});","import JsonCSS from \"json-css\"\nimport { TTheme } from \"./Theme\"\nimport { TPenStyle } from \"./PenStyle\"\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst parser: any = new JsonCSS()\n\n/**\n * @group Style\n */\nexport const StyleHelper = {\n  themeToCSS(json: TTheme): string\n  {\n    return parser.toCSS(json) as string\n    // css = css.replace( /[\\r\\n]+/gm, \"\" )\n    // return css\n  },\n  themeToJSON(style: string): TTheme\n  {\n    const theme = parser.toJSON(style) as TTheme\n    theme[\".text\"][\"font-size\"] = Number(theme[\".text\"][\"font-size\"])\n    theme.ink[\"-myscript-pen-width\"] = Number(theme.ink[\"-myscript-pen-width\"])\n    theme.ink.width = Number(theme.ink.width)\n    return theme\n  },\n  penStyleToCSS (penStyle: TPenStyle): string {\n    let css = parser.toCSS({ css: penStyle }) as string\n    css = css.substring(6, css.length - 3)\n    return css\n  },\n  penStyleToJSON (penStyleString: string): TPenStyle {\n    const penStyle = parser.toJSON(`css {${penStyleString}}`).css as TPenStyle\n    if (penStyle.width) {\n      penStyle.width = Number(penStyle.width)\n    } else {\n      delete penStyle.width\n    }\n    if (penStyle[\"-myscript-pen-width\"]) {\n      penStyle[\"-myscript-pen-width\"] = Number(penStyle[\"-myscript-pen-width\"])\n    } else {\n      delete penStyle[\"-myscript-pen-width\"]\n    }\n    return penStyle\n  },\n\n  stringToJSON(style: string): {[key: string]: string}\n  {\n    return parser.toJSON(`css {${style}}`).css\n  },\n  JSONToString(style: {[key: string]: string}): string\n  {\n    return Object.entries(style).map(([k, v]) => `${k}:${v}`).join(\";\")\n  }\n}\n","import { TStyle } from \"../style\"\n\n/**\n * @group Primitive\n */\nexport enum SymbolType\n{\n  Stroke = \"stroke\",\n  Group = \"group\",\n  Shape = \"shape\",\n  Edge = \"edge\",\n  Text = \"text\",\n  Eraser = \"eraser\",\n}\n\n/**\n * @group Primitive\n */\nexport interface TSymbol {\n  id: string\n  creationTime: number\n  modificationDate: number\n  type: string\n  style: TStyle\n}\n","import { SELECTION_MARGIN } from \"../Constants\"\nimport { TStyle } from \"../style\"\nimport { findIntersectionBetween2Segment, PartialDeep } from \"../utils\"\nimport { Box, TBoundingBox } from \"./Box\"\nimport { OISymbolBase } from \"./OISymbolBase\"\nimport { TPoint } from \"./Point\"\nimport { SymbolType } from \"./Symbol\"\n\n/**\n * @group Primitive\n */\nexport enum EdgeKind\n{\n  Line = \"line\",\n  PolyEdge = \"polyedge\",\n  Arc = \"arc\",\n}\n\n/**\n * @group Primitive\n */\nexport enum EdgeDecoration\n{\n  Arrow = \"arrow-head\"\n}\n\n/**\n * @group Primitive\n */\nexport abstract class OIEdgeBase<K = EdgeKind> extends OISymbolBase<SymbolType.Edge>\n{\n  readonly kind: K\n  readonly isClosed = false\n\n  startDecoration?: EdgeDecoration\n  endDecoration?: EdgeDecoration\n\n  constructor(\n    kind: K,\n    startDecoration?: EdgeDecoration,\n    endDecoration?: EdgeDecoration,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(SymbolType.Edge, style)\n    this.kind = kind\n\n    this.startDecoration = startDecoration\n    this.endDecoration = endDecoration\n  }\n\n  abstract get vertices(): TPoint[]\n\n  get bounds(): Box\n  {\n    const bb = Box.createFromPoints(this.vertices)\n    bb.x -= SELECTION_MARGIN / 2\n    bb.y -= SELECTION_MARGIN / 2\n    bb.height += SELECTION_MARGIN\n    bb.width += SELECTION_MARGIN\n    if (this.startDecoration || this.endDecoration) {\n      bb.x -= ((this.style.width || 1) * 2.5)\n      bb.y -= ((this.style.width || 1) * 2.5)\n      bb.height += ((this.style.width || 1) * 5)\n      bb.width += ((this.style.width || 1) * 5)\n    }\n    return bb\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return this.vertices\n  }\n\n  overlaps(box: TBoundingBox): boolean\n  {\n    return this.bounds.isContained(box) ||\n      this.edges.some(e1 => Box.getSides(box).some(e2 => !!findIntersectionBetween2Segment(e1, e2)))\n  }\n\n  abstract clone(): OIEdgeBase\n}\n","import { TStyle } from \"../style\"\nimport { findIntersectionBetween2Segment, PartialDeep } from \"../utils\"\nimport { Box, TBoundingBox } from \"./Box\"\nimport { OISymbolBase } from \"./OISymbolBase\"\nimport { TPoint } from \"./Point\"\nimport { SymbolType } from \"./Symbol\"\n\n/**\n * @group Primitive\n */\nexport enum ShapeKind\n{\n  Circle = \"circle\",\n  Ellipse = \"ellipse\",\n  Polygon = \"polygon\",\n  Table = \"table\"\n}\n\n/**\n * @group Primitive\n */\nexport abstract class OIShapeBase<K = ShapeKind> extends OISymbolBase<SymbolType.Shape>\n{\n  readonly kind: K\n  readonly isClosed = true\n\n  constructor(kind: K, style?: PartialDeep<TStyle>)\n  {\n    super(SymbolType.Shape, style)\n    this.kind = kind\n  }\n\n  get bounds(): Box\n  {\n    return Box.createFromPoints(this.vertices)\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return this.bounds.snapPoints\n  }\n\n  overlaps(box: TBoundingBox): boolean\n  {\n    return this.bounds.isContained(box) ||\n      this.edges.some(e1 => Box.getSides(box).some(e2 => !!findIntersectionBetween2Segment(e1, e2)))\n  }\n}\n","import { LoggerClass, LoggerManager } from \"../logger\"\nimport { PartialDeep, mergeDeep } from \"../utils\"\nimport { DefaultPenStyle, TPenStyle } from \"./PenStyle\"\nimport { DefaultTheme, TTheme } from \"./Theme\"\n\n/**\n * @group Style\n */\nexport class StyleManager\n{\n  #penStyle!: TPenStyle\n  #theme!: TTheme\n  #penStyleClasses!: string\n  #currentPenStyle!: TPenStyle\n  #logger =  LoggerManager.getLogger(LoggerClass.STYLE)\n\n  constructor(penStyle?: PartialDeep<TPenStyle>, theme?: PartialDeep<TTheme>)\n  {\n    this.#logger.info(\"constructor\", { penStyle, theme })\n    this.setTheme(theme)\n    this.setPenStyleClasses()\n    this.setPenStyle(penStyle)\n  }\n\n  get currentPenStyle(): TPenStyle\n  {\n    return this.#currentPenStyle || this.#penStyle\n  }\n\n  get penStyle(): TPenStyle\n  {\n    return this.#penStyle\n  }\n  setPenStyle(style?: PartialDeep<TPenStyle>)\n  {\n    this.#logger.info(\"setPenStyle\", { style })\n    this.#penStyle = mergeDeep(structuredClone(DefaultPenStyle), style || {}) as TPenStyle\n    this.#currentPenStyle = style || (this.theme[`.${ this.#penStyleClasses }`]) as TPenStyle\n    this.#logger.debug(\"setPenStyle\", this.#currentPenStyle)\n  }\n\n  get theme(): TTheme\n  {\n    return this.#theme\n  }\n  setTheme(theme?: PartialDeep<TTheme>)\n  {\n    this.#logger.info(\"setTheme\", { theme })\n    this.#theme = mergeDeep(structuredClone(DefaultTheme), theme || {}) as TTheme\n    this.#logger.debug(\"setTheme\", this.#theme)\n  }\n\n  get penStyleClasses(): string\n  {\n    return this.#penStyleClasses\n  }\n  setPenStyleClasses(penStyleClass = \"\")\n  {\n    this.#logger.info(\"setPenStyleClasses\", { penStyleClass })\n    this.#penStyleClasses = penStyleClass\n    this.#currentPenStyle = (this.theme[`.${ this.#penStyleClasses }`]) as TPenStyle\n    this.#logger.debug(\"setPenStyleClasses\", this.#currentPenStyle)\n  }\n\n}\n","import { TPoint } from \"../primitive\"\n\n/**\n * @group Transform\n * @remarks Represents a 2D affine transform, defined as a 3x3 matrix with an implicit third raw of <code>[ 0 0 1 ]</code>\n */\nexport type TMatrixTransform = {\n  /**\n   * @remarks scaling x\n   */\n  xx: number,\n  /**\n   * @remarks shearing x\n   */\n  yx: number,\n  /**\n   * @remarks translation x\n   */\n  tx: number,\n  /**\n   * @remarks shearing y\n   */\n  xy: number,\n  /**\n   * @remarks scaling y\n   */\n  yy: number,\n  /**\n   * @remarks translation y\n   */\n  ty: number,\n}\n\n/**\n * @group Transform\n * @remarks Represents a 2D affine transform, defined as a 3x3 matrix with an implicit third raw of <code>[ 0 0 1 ]</code>\n */\nexport class MatrixTransform implements TMatrixTransform\n{\n  xx: number\n  yx: number\n  xy: number\n  yy: number\n  tx: number\n  ty: number\n\n  constructor(xx: number, yx: number, xy: number, yy: number, tx: number, ty: number)\n  {\n    this.xx = xx\n    this.yx = yx\n    this.xy = xy\n    this.yy = yy\n    this.tx = tx\n    this.ty = ty\n  }\n\n  static identity(): MatrixTransform\n  {\n    return new MatrixTransform(1, 0, 0, 1, 0, 0)\n  }\n\n  static applyToPoint(mat: TMatrixTransform, point: TPoint): TPoint\n  {\n    return {\n      x: mat.xx * point.x + mat.xy * point.y + mat.tx,\n      y: mat.yx * point.x + mat.yy * point.y + mat.ty,\n    }\n  }\n\n  static rotation(mat: TMatrixTransform): number\n  {\n    let rotation\n\n    if (mat.xx !== 0 || mat.xy !== 0) {\n      const hypotAc = Math.hypot(mat.xx, mat.xy)\n      rotation = Math.acos(mat.xx / hypotAc) * (mat.xy > 0 ? -1 : 1)\n    } else if (mat.yx !== 0 || mat.yy !== 0) {\n      const hypotBd = Math.hypot(mat.yx, mat.yy)\n      rotation = Math.PI / 2 + Math.acos(mat.yx / hypotBd) * (mat.yy > 0 ? -1 : 1)\n    } else {\n      rotation = 0\n    }\n\n    return rotation\n  }\n\n  static toCssString(matrix: TMatrixTransform): string\n  {\n    return `matrix(${ matrix.xx }, ${ matrix.yx }, ${ matrix.xy }, ${ matrix.yy }, ${ matrix.tx }, ${ matrix.ty })`\n  }\n\n\tinvert() {\n\t\tconst { xx, yx, xy, yy, tx, ty } = this\n\t\tconst denom = xx * yy - yx * xy\n\t\tthis.xx = yy / denom\n\t\tthis.yx = yx / -denom\n\t\tthis.xy = xy / -denom\n\t\tthis.yy = xx / denom\n\t\tthis.tx = (yy * tx - xy * ty) / -denom\n\t\tthis.ty = (yx * tx - xx * ty) / denom\n\t\treturn this\n\t}\n\n  multiply(m: TMatrixTransform): MatrixTransform\n  {\n    const { xx, yx, xy, yy, tx, ty } = this\n    this.xx = xx * m.xx + xy * m.yx\n    this.yx = yx * m.xx + yy * m.yx\n    this.xy = xx * m.xy + xy * m.yy\n    this.yy = yx * m.xy + yy * m.yy\n    this.tx = xx * m.tx + xy * m.ty + tx\n    this.ty = yx * m.tx + yy * m.ty + ty\n    return this\n  }\n\n  translate(tx: number, ty: number): MatrixTransform\n  {\n    return this.multiply({ xx: 1, yx: 0, xy: 0, yy: 1, tx, ty })\n  }\n\n  rotate(radian: number, center?: TPoint): MatrixTransform\n  {\n    if (center) {\n      this.translate(center.x, center.y)\n    }\n    const cosAngle = Math.round(Math.cos(radian) * 1000) / 1000\n    const sinAngle = Math.round(Math.sin(radian) * 1000) / 1000\n    this.multiply({\n      xx: cosAngle,\n      yx: sinAngle,\n      xy: -sinAngle,\n      yy: cosAngle,\n      tx: 0,\n      ty: 0\n    })\n    if (center) {\n      this.translate(-center.x, -center.y)\n    }\n    return this\n  }\n\n  scale(x: number, y: number, center?: TPoint): MatrixTransform\n  {\n    if (center) {\n      this.translate(center.x, center.y)\n    }\n    this.multiply({\n      xx: x,\n      yx: 0,\n      xy: 0,\n      yy: y,\n      tx: 0,\n      ty: 0\n    })\n    if (center) {\n      this.translate(-center.x, -center.y)\n    }\n    return this\n  }\n\n  applyToPoint(point: TPoint): TPoint\n  {\n    return MatrixTransform.applyToPoint(this, point)\n  }\n\n  clone(): MatrixTransform\n  {\n    return new MatrixTransform(this.xx, this.yx, this.xy, this.yy, this.tx, this.ty)\n  }\n\n  toCssString(): string\n  {\n    return MatrixTransform.toCssString(this)\n  }\n\n}\n","import { PartialDeep, createUUID, findIntersectionBetween2Segment } from \"../utils\"\nimport { TBoundingBox } from \"./Box\"\nimport { TPoint, TSegment } from \"./Point\"\nimport { SymbolType, TSymbol } from \"./Symbol\"\nimport { DefaultStyle, TStyle } from \"../style\"\nimport { MatrixTransform } from \"../transform\"\n\n/**\n * @group Primitive\n */\nexport abstract class OISymbolBase<T extends string = SymbolType> implements TSymbol\n{\n  readonly type: T\n  abstract readonly isClosed: boolean\n  style: TStyle\n\n  id: string\n  creationTime: number\n  modificationDate: number\n  selected: boolean\n  deleting: boolean\n  transform: MatrixTransform\n\n  constructor(type: T, style?: PartialDeep<TStyle>)\n  {\n    this.type = type\n    this.id = `${ this.type }-${ createUUID() }`\n\n    this.creationTime = Date.now()\n    this.modificationDate = this.creationTime\n    this.selected = false\n    this.deleting = false\n\n    this.transform = MatrixTransform.identity()\n\n    this.style = Object.assign({}, DefaultStyle, style)\n    this.style.opacity = +this.style.opacity!\n    this.style.width = +this.style.width!\n  }\n\n  abstract get vertices(): TPoint[]\n\n  abstract get snapPoints(): TPoint[]\n\n  get edges(): TSegment[]\n  {\n    if (this.isClosed) {\n      return this.vertices.map((p, i) =>\n        {\n          if (i === this.vertices.length - 1) {\n            return { p1: p, p2: this.vertices[0] }\n          }\n          else {\n            return { p1: p, p2: this.vertices[i + 1] }\n          }\n        })\n    }\n    else {\n      return this.vertices.slice(0, -1).map((p, i) =>\n      {\n        return { p1: p, p2: this.vertices[i + 1] }\n      })\n    }\n  }\n\n  abstract overlaps(box: TBoundingBox): boolean\n\n  abstract clone(): OISymbolBase\n\n  abstract toJSON(): PartialDeep<OISymbolBase>\n\n  isIntersected(seg: TSegment): boolean\n  {\n    return this.edges.some(edge =>\n    {\n      return findIntersectionBetween2Segment(edge, seg)\n    })\n  }\n}\n","import { PartialDeep, isValidNumber } from \"../utils\"\n\n/**\n * @group Primitive\n */\nexport type TPoint = {\n  x: number\n  y: number\n}\n\n/**\n * @group Primitive\n */\nexport type TPointer = TPoint & {\n  t: number\n  p: number\n}\n\n/**\n * @group Primitive\n */\nexport type TSegment = {\n  p1: TPoint\n  p2: TPoint\n}\n\n/**\n * @group Primitive\n */\nexport function isValidPoint(p?: PartialDeep<TPoint>): boolean\n{\n  if (!p) return false\n  if (!isValidNumber(p.x)) return false\n  if (!isValidNumber(p.y)) return false\n  return true\n}\n","import { SELECTION_MARGIN } from \"../Constants\"\nimport { TStyle } from \"../style\"\nimport { PartialDeep, computePointOnEllipse, isValidNumber } from \"../utils\"\nimport { EdgeDecoration, EdgeKind, OIEdgeBase } from \"./OIEdge\"\nimport { TPoint, isValidPoint } from \"./Point\"\n\n/**\n * @group Primitive\n */\nexport class OIEdgeArc extends OIEdgeBase<EdgeKind.Arc>\n{\n  center: TPoint\n  startAngle: number\n  sweepAngle: number\n  radiusX: number\n  radiusY: number\n  phi: number\n  protected _vertices: Map<string, TPoint[]>\n\n  constructor(\n    center: TPoint,\n    startAngle: number,\n    sweepAngle: number,\n    radiusX: number,\n    radiusY: number,\n    phi: number,\n    startDecoration?: EdgeDecoration,\n    endDecoration?: EdgeDecoration,\n    style?: PartialDeep<TStyle>,\n  )\n  {\n    super(EdgeKind.Arc, startDecoration, endDecoration, style)\n    this.center = center\n    this.startAngle = startAngle\n    this.sweepAngle = sweepAngle\n    this.radiusX = radiusX\n    this.radiusY = radiusY\n    this.phi = phi\n    this._vertices = new Map<string, TPoint[]>()\n    this._vertices.set(this.verticesId, this.computedVertices())\n  }\n\n  protected get verticesId(): string\n  {\n    return `${ this.center.x }-${ this.center.y }-${ this.startAngle }-${ this.sweepAngle }-${ this.radiusX }-${ this.radiusY }-${ this.phi }`\n  }\n\n  protected computedVertices(): TPoint[]\n  {\n    const length = Math.abs(this.sweepAngle) * Math.sqrt((Math.pow(this.radiusX, 2) + Math.pow(this.radiusY, 2)) / 2)\n    const nbVertices = Math.max(8, Math.round(length / SELECTION_MARGIN))\n    const angleStep = this.sweepAngle / nbVertices\n    const v: TPoint[] = []\n    const endAngle = this.startAngle + this.sweepAngle\n    if (this.sweepAngle > 0) {\n      for (let angle = this.startAngle; angle < endAngle; angle += angleStep) {\n        v.push(computePointOnEllipse(this.center, this.radiusX, this.radiusY, this.phi, angle))\n      }\n    } else {\n      for (let angle = this.startAngle; angle > endAngle; angle += angleStep) {\n        v.push(computePointOnEllipse(this.center, this.radiusX, this.radiusY, this.phi, angle))\n      }\n    }\n    v.push(computePointOnEllipse(this.center, this.radiusX, this.radiusY, this.phi, endAngle))\n    return v\n  }\n\n  get vertices(): TPoint[]\n  {\n    if (!this._vertices.has(this.verticesId)) {\n      this._vertices.set(this.verticesId, this.computedVertices())\n    }\n    return this._vertices.get(this.verticesId)!\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return [\n      this.vertices[0],\n      this.vertices.at(-1)!\n    ]\n  }\n\n  clone(): OIEdgeArc\n  {\n    const clone = new OIEdgeArc(\n      structuredClone(this.center),\n      this.startAngle,\n      this.sweepAngle,\n      this.radiusX,\n      this.radiusY,\n      this.phi,\n      this.startDecoration,\n      this.endDecoration,\n      structuredClone(this.style)\n    )\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<OIEdgeArc>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      center: this.center,\n      startAngle: this.startAngle,\n      sweepAngle: this.sweepAngle,\n      radiusX: this.radiusX,\n      radiusY: this.radiusY,\n      phi: this.phi,\n      startDecoration: this.startDecoration,\n      style: this.style,\n      endDecoration: this.endDecoration,\n    }\n  }\n\n  static create(partial: PartialDeep<OIEdgeArc>): OIEdgeArc\n  {\n    if (!isValidPoint(partial?.center)) throw new Error(`Unable to create a arc, center point is invalid`)\n    if (!isValidNumber(partial?.startAngle)) throw new Error(`Unable to create a arc, startAngle is invalid`)\n    if (!isValidNumber(partial?.sweepAngle)) throw new Error(`Unable to create a arc, sweepAngle is invalid`)\n    if (!isValidNumber(partial?.radiusX)) throw new Error(`Unable to create a arc, radiusX is invalid`)\n    if (!isValidNumber(partial?.radiusY)) throw new Error(`Unable to create a arc, radiusY is invalid`)\n    const arc = new OIEdgeArc(\n      partial?.center as TPoint,\n      partial.startAngle!,\n      partial.sweepAngle!,\n      partial.radiusX!,\n      partial.radiusY!,\n      partial.phi || 0,\n      partial.startDecoration,\n      partial.endDecoration,\n      partial.style\n    )\n    if (partial.id) {\n      arc.id = partial.id\n    }\n    return arc\n  }\n}\n","import { TStyle } from \"../style\"\nimport { PartialDeep } from \"../utils\"\nimport { EdgeDecoration, EdgeKind, OIEdgeBase } from \"./OIEdge\"\nimport { TPoint, isValidPoint } from \"./Point\"\n\n/**\n * @group Primitive\n */\nexport class OIEdgeLine extends OIEdgeBase<EdgeKind.Line>\n{\n  start: TPoint\n  end: TPoint\n\n  constructor(\n    start: TPoint,\n    end: TPoint,\n    startDecoration?: EdgeDecoration,\n    endDecoration?: EdgeDecoration,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(EdgeKind.Line, startDecoration, endDecoration, style)\n    this.start = start\n    this.end = end\n  }\n\n  get vertices(): TPoint[]\n  {\n    return [\n      this.start,\n      this.end\n    ]\n  }\n\n  clone(): OIEdgeLine\n  {\n    const clone = new OIEdgeLine(structuredClone(this.start), structuredClone(this.end), this.startDecoration, this.endDecoration, structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<OIEdgeLine>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      start: this.start,\n      end: this.end,\n      style: this.style,\n      startDecoration: this.startDecoration,\n      endDecoration: this.endDecoration,\n    }\n  }\n\n  static create(partial: PartialDeep<OIEdgeLine>): OIEdgeLine\n  {\n    if (!isValidPoint(partial?.start)) throw new Error(`Unable to create a arc, start point is invalid`)\n    if (!isValidPoint(partial?.end)) throw new Error(`Unable to create a arc, end point is invalid`)\n    const line = new OIEdgeLine(partial?.start as TPoint, partial?.end as TPoint, partial.startDecoration, partial.endDecoration, partial.style)\n    if (partial.id) {\n      line.id = partial.id\n    }\n    return line\n  }\n}\n","import { TStyle } from \"../style\"\nimport { PartialDeep } from \"../utils\"\nimport { EdgeDecoration, EdgeKind, OIEdgeBase } from \"./OIEdge\"\nimport { TPoint, isValidPoint } from \"./Point\"\n\n/**\n * @group Primitive\n */\nexport class OIEdgePolyLine extends OIEdgeBase<EdgeKind.PolyEdge>\n{\n  points: TPoint[]\n\n  constructor(\n    points: TPoint[],\n    startDecoration?: EdgeDecoration,\n    endDecoration?: EdgeDecoration,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(EdgeKind.PolyEdge, startDecoration, endDecoration, style)\n    this.points = points\n  }\n\n  get vertices(): TPoint[]\n  {\n    return this.points\n  }\n\n  clone(): OIEdgePolyLine\n  {\n    const clone = new OIEdgePolyLine(structuredClone(this.points),this.startDecoration, this.endDecoration, structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<OIEdgePolyLine>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      points: this.points,\n      style: this.style,\n      startDecoration: this.startDecoration,\n      endDecoration: this.endDecoration,\n    }\n  }\n\n  static create(partial: PartialDeep<OIEdgePolyLine>): OIEdgePolyLine\n  {\n    if (!partial?.points?.map(p => isValidPoint(p))) throw new Error(`Unable to create a PolyLine, points are invalid`)\n    const polyline = new OIEdgePolyLine(partial?.points as TPoint[], partial.startDecoration, partial.endDecoration, partial.style)\n    if (partial.id) {\n      polyline.id = partial.id\n    }\n    return polyline\n  }\n}\n","import { SELECTION_MARGIN } from \"../Constants\"\nimport { TStyle } from \"../style\"\nimport { PartialDeep, computePointOnEllipse, findIntersectionBetween2Segment, isValidNumber, } from \"../utils\"\nimport { TPoint, isValidPoint } from \"./Point\"\nimport { OIShapeBase, ShapeKind } from \"./OIShape\"\nimport { Box, TBoundingBox } from \"./Box\"\n\n/**\n * @group Primitive\n */\nexport class OIShapeEllipse extends OIShapeBase<ShapeKind.Ellipse>\n{\n  center: TPoint\n  radiusX: number\n  radiusY: number\n  orientation: number\n  protected _vertices: Map<string, TPoint[]>\n\n  constructor(\n    center: TPoint,\n    radiusX: number,\n    radiusY: number,\n    orientation: number,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(ShapeKind.Ellipse, style)\n    this.center = center\n    this.radiusX = radiusX\n    this.radiusY = radiusY\n    this.orientation = orientation\n    this._vertices = new Map<string, TPoint[]>()\n  }\n\n  protected get verticesId(): string\n  {\n    return `${ this.center.x }-${ this.center.y }-${ this.radiusX }-${ this.radiusY }-${ this.orientation }`\n  }\n\n  protected computedVertices(): TPoint[]\n  {\n    const points: TPoint[] = []\n    const perimeter = 2 * Math.PI * Math.sqrt((Math.pow(this.radiusX, 2) + Math.pow(this.radiusY, 2)) / 2)\n    const nbPoint = Math.max(8, Math.round(perimeter / SELECTION_MARGIN))\n    for (let i = 0; i < nbPoint; i++) {\n      const theta = 2 * Math.PI * (i / nbPoint)\n      points.push(computePointOnEllipse(this.center, this.radiusX, this.radiusY, this.orientation, theta))\n    }\n\n    return points\n  }\n\n  get vertices(): TPoint[]\n  {\n    if (!this._vertices.has(this.verticesId)) {\n      this._vertices.set(this.verticesId, this.computedVertices())\n    }\n    return this._vertices.get(this.verticesId)!\n  }\n\n  overlaps(box: TBoundingBox): boolean\n  {\n\n    return this.bounds.isContained(box) ||\n      this.edges.some(e1 => Box.getSides(box).some(e2 => !!findIntersectionBetween2Segment(e1, e2)))\n  }\n\n  clone(): OIShapeEllipse\n  {\n    const clone = new OIShapeEllipse(structuredClone(this.center), this.radiusX, this.radiusY, this.orientation, structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<OIShapeEllipse>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      center: this.center,\n      orientation: this.orientation,\n      radiusX: this.radiusX,\n      radiusY: this.radiusY,\n      style: this.style,\n    }\n  }\n\n  static createBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): OIShapeEllipse\n  {\n    const center = {\n      x: (origin.x + target.x) / 2,\n      y: (origin.y + target.y) / 2\n    }\n    const radiusX = Math.abs(origin.x - target.x) / 2\n    const radiusY = Math.abs(origin.y - target.y) / 2\n    return new OIShapeEllipse(center, radiusX, radiusY, 0, style)\n  }\n\n  static updateBetweenPoints(ellipse: OIShapeEllipse, origin: TPoint, target: TPoint): OIShapeEllipse\n  {\n    ellipse.center = {\n      x: (origin.x + target.x) / 2,\n      y: (origin.y + target.y) / 2\n    }\n    ellipse.radiusX = Math.abs(origin.x - target.x) / 2\n    ellipse.radiusY = Math.abs(origin.y - target.y) / 2\n    return ellipse\n  }\n\n  static create(partial: PartialDeep<OIShapeEllipse>): OIShapeEllipse\n  {\n    if (!isValidPoint(partial.center)) throw new Error(`Unable to create ellipse, center is undefined`)\n    if (!isValidNumber(partial.radiusX)) throw new Error(`Unable to create ellipse, radiusX is undefined`)\n    if (!isValidNumber(partial.radiusY)) throw new Error(`Unable to create ellipse, radiusY is undefined`)\n    const ellipse = new OIShapeEllipse(partial.center as TPoint, partial.radiusX!, partial.radiusY!, partial.orientation || 0, partial.style)\n    if (partial.id) {\n      ellipse.id = partial.id\n    }\n    return ellipse\n  }\n}\n","import { SELECTION_MARGIN } from \"../Constants\"\nimport { TStyle } from \"../style\"\nimport { PartialDeep, findIntersectBetweenSegmentAndCircle, isValidNumber, computeRotatedPoint } from \"../utils\"\nimport { TPoint, isValidPoint } from \"./Point\"\nimport { OIShapeBase, ShapeKind } from \"./OIShape\"\nimport { Box, TBoundingBox } from \"./Box\"\n\n/**\n * @group Primitive\n */\nexport class OIShapeCircle extends OIShapeBase<ShapeKind.Circle>\n{\n  center: TPoint\n  radius: number\n  protected _vertices: Map<string, TPoint[]>\n  protected _bounds: Map<string, Box>\n\n  constructor(\n    center: TPoint,\n    radius: number,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(ShapeKind.Circle, style)\n    this.center = center\n    this.radius = radius\n    this._vertices = new Map<string, TPoint[]>()\n    this._vertices.set(this.verticesId, this.computedVertices())\n    this._bounds = new Map<string, Box>()\n    this._bounds.set(this.verticesId, this.computedBondingBox())\n  }\n\n  protected get verticesId(): string\n  {\n    return `${ this.center.x }-${ this.center.y }-${ this.radius }`\n  }\n\n  protected computedVertices(): TPoint[]\n  {\n    const firstPoint: TPoint = {\n      x: this.center.x,\n      y: this.radius + this.center.y\n    }\n    const perimeter = 2 * Math.PI * this.radius\n    const nbPoint = Math.max(8, Math.round(perimeter / SELECTION_MARGIN))\n    const points: TPoint[] = []\n    for (let i = 0; i < nbPoint; i++) {\n      const rad = 2 * Math.PI * (i / nbPoint)\n      points.push(computeRotatedPoint(firstPoint, this.center, rad))\n    }\n    return points\n  }\n\n  protected computedBondingBox(): Box\n  {\n    const boundingBox: TBoundingBox = {\n      x: this.center.x - this.radius,\n      y: this.center.y - this.radius,\n      height: this.radius * 2,\n      width: this.radius * 2\n    }\n    this._bounds\n    return new Box(boundingBox)\n  }\n\n  get bounds(): Box\n  {\n    if (!this._bounds.has(this.verticesId)) {\n      this._bounds.set(this.verticesId, this.computedBondingBox())\n    }\n    return this._bounds.get(this.verticesId)!\n  }\n\n  get vertices(): TPoint[]\n  {\n    if (!this._vertices.has(this.verticesId)) {\n      this._vertices.set(this.verticesId, this.computedVertices())\n    }\n    return this._vertices.get(this.verticesId)!\n  }\n\n\n  overlaps(box: TBoundingBox): boolean\n  {\n    return this.bounds.isContained(box) ||\n      Box.getSides(box).some(seg => findIntersectBetweenSegmentAndCircle(seg, this.center, this.radius).length)\n  }\n\n  clone(): OIShapeCircle\n  {\n    const clone = new OIShapeCircle(structuredClone(this.center), this.radius, structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<OIShapeCircle>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      center: this.center,\n      radius: this.radius,\n      style: this.style,\n    }\n  }\n\n  static createBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): OIShapeCircle\n  {\n    const center = {\n      x: (origin.x + target.x) / 2,\n      y: (origin.y + target.y) / 2\n    }\n\n    const width = Math.abs(origin.x - target.x)\n    const height = Math.abs(origin.y - target.y)\n    const radius = Math.min(width, height) / 2\n    return new OIShapeCircle(center, radius, style)\n  }\n  static updateBetweenPoints(circle: OIShapeCircle, origin: TPoint, target: TPoint): OIShapeCircle\n  {\n    circle.center = {\n      x: (origin.x + target.x) / 2,\n      y: (origin.y + target.y) / 2\n    }\n    const width = Math.abs(origin.x - target.x)\n    const height = Math.abs(origin.y - target.y)\n    circle.radius = Math.min(width, height) / 2\n    return circle\n  }\n\n  static create(partial: PartialDeep<OIShapeCircle>): OIShapeCircle\n  {\n    if (!isValidPoint(partial.center)) throw new Error(`Unable to create circle, center is invalid`)\n    if (!isValidNumber(partial.radius)) throw new Error(`Unable to create circle, radius is undefined`)\n    const circle = new OIShapeCircle(partial.center as TPoint, partial.radius!, partial.style)\n    if (partial.id) {\n      circle.id = partial.id\n    }\n    return circle\n  }\n}\n","import { TStyle } from \"../style\"\nimport { TPoint, isValidPoint } from \"./Point\"\nimport { OIShapeBase, ShapeKind } from \"./OIShape\"\nimport { Box } from \"./Box\"\nimport { PartialDeep } from \"../utils\"\n\n/**\n * @group Primitive\n */\nexport class OIShapePolygon extends OIShapeBase<ShapeKind.Polygon>\n{\n  points: TPoint[]\n\n  constructor(points: TPoint[], style?: PartialDeep<TStyle>)\n  {\n    super(ShapeKind.Polygon, style)\n    this.points = points\n  }\n\n  get vertices(): TPoint[]\n  {\n    return this.points\n  }\n\n  get bounds(): Box\n  {\n    return Box.createFromPoints(this.vertices)\n  }\n\n  clone(): OIShapePolygon\n  {\n    const clone = new OIShapePolygon(structuredClone(this.points), structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<OIShapePolygon>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      points: this.points,\n      style: this.style,\n    }\n  }\n\n  static create(partial: PartialDeep<OIShapePolygon>): OIShapePolygon\n  {\n    if (!partial?.points || partial?.points?.length < 3) throw new Error(`Unable to create polygon at least 3 points required`)\n    if (partial?.points?.some(p => !isValidPoint(p))) throw new Error(`Unable to create a polygon, one or more points are invalid`)\n    const polygon = new OIShapePolygon(partial.points as TPoint[], partial.style)\n    if (partial.id) {\n      polygon.id = partial.id\n    }\n    return polygon\n  }\n\n  static createTriangleBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): OIShapePolygon\n  {\n    const points: TPoint[] = [\n      { x: origin.x, y: origin.y },\n      { x: target.x, y: origin.y },\n      { x: (origin.x + target.x) / 2, y: target.y }\n    ]\n    return new OIShapePolygon(points, style)\n  }\n  static updateTriangleBetweenPoints(poly: OIShapePolygon, origin: TPoint, target: TPoint): OIShapePolygon\n  {\n    poly.points = [\n      { x: origin.x, y: origin.y },\n      { x: target.x, y: origin.y },\n      { x: (origin.x + target.x) / 2, y: target.y }\n    ]\n    poly.modificationDate = Date.now()\n    return poly\n  }\n\n  static createParallelogramBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): OIShapePolygon\n  {\n    const points: TPoint[] = [\n      { x: origin.x, y: origin.y },\n      { x: origin.x + (target.x - origin.x) * 0.75, y: origin.y },\n      { x: target.x, y: target.y },\n      { x: origin.x + (target.x - origin.x) * 0.25, y: target.y },\n    ]\n    return new OIShapePolygon(points, style)\n  }\n  static updateParallelogramBetweenPoints(poly: OIShapePolygon, origin: TPoint, target: TPoint): OIShapePolygon\n  {\n    const points: TPoint[] = [\n      { x: origin.x, y: origin.y },\n      { x: origin.x + (target.x - origin.x) * 0.75, y: origin.y },\n      { x: target.x, y: target.y },\n      { x: origin.x + (target.x - origin.x) * 0.25, y: target.y },\n    ]\n    poly.points = points\n    poly.modificationDate = Date.now()\n    return poly\n  }\n\n  static createRectangleBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): OIShapePolygon\n  {\n    const box = Box.createFromPoints([origin, target])\n    const points: TPoint[] = [\n      { x: box.xMin, y: box.yMin },\n      { x: box.xMax, y: box.yMin },\n      { x: box.xMax, y: box.yMax },\n      { x: box.xMin, y: box.yMax },\n    ]\n    return new OIShapePolygon(points, style)\n  }\n  static updateRectangleBetweenPoints(poly: OIShapePolygon, origin: TPoint, target: TPoint): OIShapePolygon\n  {\n    const box = Box.createFromPoints([origin, target])\n    const points: TPoint[] = [\n      { x: box.xMin, y: box.yMin },\n      { x: box.xMax, y: box.yMin },\n      { x: box.xMax, y: box.yMax },\n      { x: box.xMin, y: box.yMax },\n    ]\n    poly.points = points\n    poly.modificationDate = Date.now()\n    return poly\n  }\n\n  static createRhombusBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): OIShapePolygon\n  {\n    const box = Box.createFromPoints([origin, target])\n    const points: TPoint[] = [\n      { x: box.xMid, y: box.yMin },\n      { x: box.xMax, y: box.yMid },\n      { x: box.xMid, y: box.yMax },\n      { x: box.xMin, y: box.yMid },\n    ]\n    return new OIShapePolygon(points, style)\n  }\n\n  static updateRhombusBetweenPoints(poly: OIShapePolygon, origin: TPoint, target: TPoint): OIShapePolygon\n  {\n    const box = Box.createFromPoints([origin, target])\n    const points: TPoint[] = [\n      { x: box.xMid, y: box.yMin },\n      { x: box.xMax, y: box.yMid },\n      { x: box.xMid, y: box.yMax },\n      { x: box.xMin, y: box.yMid },\n    ]\n    poly.points = points\n    poly.modificationDate = Date.now()\n    return poly\n  }\n}\n","import { TStyle } from \"../style\"\nimport { PartialDeep, computeDistance, getClosestPoint } from \"../utils\"\nimport { TStroke, TStrokeToSend } from \"./Stroke\"\nimport { TPoint, TPointer } from \"./Point\"\nimport { Box, TBoundingBox } from \"./Box\"\nimport { SymbolType } from \"./Symbol\"\nimport { OIDecorator } from \"./OIDecorator\"\nimport { OISymbolBase } from \"./OISymbolBase\"\n\n/**\n * @group Primitive\n */\nexport class OIStroke extends OISymbolBase<SymbolType.Stroke>\n{\n  readonly isClosed = false\n\n  pointerType: string\n  length: number\n  decorators: OIDecorator[]\n  pointers: Array<TPointer>\n\n  constructor(style?: PartialDeep<TStyle>, pointerType = \"pen\")\n  {\n    super(SymbolType.Stroke, style)\n\n    this.pointerType = pointerType\n    this.pointers = []\n    this.decorators = []\n    this.length = 0\n  }\n\n  get bounds(): Box\n  {\n    return Box.createFromPoints(this.vertices)\n  }\n\n  static split(strokeToSplit: OIStroke, i: number): { before: OIStroke, after: OIStroke }\n  {\n    const before = new OIStroke(strokeToSplit.style, strokeToSplit.pointerType)\n    before.pointers = strokeToSplit.pointers.slice(0, i)\n\n    const after = new OIStroke(strokeToSplit.style, strokeToSplit.pointerType)\n    after.pointers = strokeToSplit.pointers.slice(i)\n\n    return { before, after }\n  }\n\n  static substract(stroke: OIStroke, partStroke: OIStroke): { before?: OIStroke, after?: OIStroke }\n  {\n    if (!partStroke.length) return { before: stroke }\n    const result: { before?: OIStroke, after?: OIStroke } = {}\n    const lastPointBeforeStroke = {\n      x: partStroke.pointers[0].x as number,\n      y: partStroke.pointers[0].y as number\n    }\n    const closestLastPointBeforeStroke = getClosestPoint(stroke.pointers, lastPointBeforeStroke)\n    if (closestLastPointBeforeStroke.index > -1) {\n      const newStrokes = OIStroke.split(stroke, closestLastPointBeforeStroke.index)\n      result.before = newStrokes.before\n      result.after = newStrokes.after\n    }\n    const strokeAfter = result.after || stroke\n    const firstPointAfterStroke = {\n      x: partStroke.pointers.at(-1)!.x as number,\n      y: partStroke.pointers.at(-1)!.y as number\n    }\n    const closestFirstPointStrokeAfter = getClosestPoint(strokeAfter.pointers, firstPointAfterStroke)\n    if (closestFirstPointStrokeAfter.index > -1) {\n      const newStrokes = OIStroke.split(strokeAfter, closestFirstPointStrokeAfter.index)\n      result.after = newStrokes.after\n    }\n    if (!result.before?.pointers.length) result.before = undefined\n    if (!result.after?.pointers.length) result.after = undefined\n    return result\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return this.bounds.snapPoints\n  }\n\n  get vertices(): TPoint[]\n  {\n    return this.pointers\n  }\n\n  protected computePressure(distance: number): number\n  {\n    let ratio = 1.0\n    if (distance === this.length) {\n      ratio = 1.0\n    } else if (distance < 10) {\n      ratio = 0.2 + Math.pow(0.1 * distance, 0.4)\n    } else if (distance > this.length - 10) {\n      ratio = 0.2 + Math.pow(0.1 * (this.length - distance), 0.4)\n    }\n    const pressure = ratio * Math.max(0.1, 1.0 - (0.1 * Math.sqrt(distance)))\n    return isNaN(pressure) ? 0.5 : Math.round(pressure * 100) / 100\n  }\n\n  protected filterPointByAcquisitionDelta(point: TPointer): boolean\n  {\n    const lastPointer = this.pointers.at(-1)\n    const delta: number = (2 + ((this.style.width || 1) / 4))\n    return !lastPointer ||\n      Math.abs(lastPointer.x - point.x) >= delta ||\n      Math.abs(lastPointer.y - point.y) >= delta\n  }\n\n  addPointer(pointer: TPointer): void\n  {\n    if (this.filterPointByAcquisitionDelta(pointer)) {\n      const lastPointer = this.pointers.at(-1)\n      const distance = lastPointer ? computeDistance(pointer, lastPointer) : 0\n      this.length += distance\n      pointer.p = this.computePressure(distance)\n      this.pointers.push(pointer)\n      this.modificationDate = Date.now()\n    }\n  }\n\n  overlaps(box: TBoundingBox): boolean\n  {\n    return this.pointers.some(p =>\n    {\n      return p.x >= box.x && p.x <= box.x + box.width\n        && p.y >= box.y && p.y <= box.y + box.height\n    })\n  }\n\n  clone(): OIStroke\n  {\n    const clone = new OIStroke(this.style, this.pointerType)\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    clone.pointers = structuredClone(this.pointers)\n    clone.decorators = this.decorators.map(d => d.clone())\n    clone.length = this.length\n    return clone\n  }\n\n  formatToSend(): TStrokeToSend\n  {\n    const json: TStrokeToSend = {\n      id: this.id,\n      pointerType: this.pointerType,\n      p: [],\n      t: [],\n      x: [],\n      y: []\n    }\n    this.pointers.forEach(p =>\n    {\n      json.p.push(p.p)\n      json.t.push(p.t)\n      json.x.push(p.x)\n      json.y.push(p.y)\n    })\n    return json\n  }\n\n  toJSON(): PartialDeep<OIStroke>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      pointers: this.pointers,\n      style: this.style,\n      decorators: this.decorators.length ? this.decorators : undefined\n    }\n  }\n\n  static create(partial: PartialDeep<OIStroke>): OIStroke\n  {\n    if (!partial.pointers?.length) {\n      throw new Error(`not pointers`)\n    }\n    const stroke = new OIStroke(partial.style, partial.pointerType)\n    if (partial.id) {\n      stroke.id = partial.id\n    }\n    const errors: string[] = []\n    let flag = true\n    partial.pointers?.forEach((pp, pIndex) =>\n    {\n      if (!pp) {\n        errors.push(`no pointer at ${ pIndex }`)\n        flag = false\n        return\n      }\n      const pointer: TPointer = {\n        p: pp.p || 1,\n        t: pp.t || pIndex,\n        x: 0,\n        y: 0\n      }\n      if (pp?.x == undefined || pp?.x == null) {\n        errors.push(`no x at pointer at ${ pIndex }`)\n        flag = false\n        return\n      }\n      else {\n        pointer.x = pp.x\n      }\n      if (pp?.y == undefined || pp?.y == null) {\n        errors.push(`no y at pointer at ${ pIndex }`)\n        flag = false\n        return\n      }\n      else {\n        pointer.y = pp.y\n      }\n      if (flag) {\n        stroke.addPointer(pointer)\n      }\n    })\n\n    if (errors.length) {\n      throw new Error(errors.join(\" and \"))\n    }\n    if (partial.decorators?.length) {\n      partial.decorators.forEach(d => {\n        if(d?.kind) {\n          stroke.decorators.push(new OIDecorator(d.kind, Object.assign({}, stroke.style, d.style)))\n        }\n      })\n    }\n    return stroke\n  }\n}\n\n/**\n * @group Primitive\n * @group Utils\n */\nexport function convertPartialStrokesToOIStrokes(json: PartialDeep<TStroke>[]): OIStroke[]\n{\n  const errors: string[] = []\n  const strokes: OIStroke[] = []\n  json.forEach((j, i) =>\n  {\n    try {\n      strokes.push(OIStroke.create(j as PartialDeep<OIStroke>))\n    } catch (e) {\n      errors.push(`stroke ${ i + 1 } has ${ (e as Error).message }`)\n    }\n  })\n\n  if (errors.length) {\n    throw new Error(errors.join(\"\\n\"))\n  }\n\n  return strokes\n}\n","import { TStyle } from \"../style\"\nimport { PartialDeep } from \"../utils\"\nimport { TPoint } from \"./Point\"\nimport { Box, TBoundingBox } from \"./Box\"\nimport { SymbolType } from \"./Symbol\"\nimport { OIDecorator } from \"./OIDecorator\"\nimport { OISymbolBase } from \"./OISymbolBase\"\nimport { OIStroke } from \"./OIStroke\"\nimport { TOISymbol } from \".\"\n\n/**\n * @group Primitive\n */\nexport class OISymbolGroup extends OISymbolBase<SymbolType.Group>\n{\n  readonly isClosed = false\n\n  children: TOISymbol[]\n  decorators: OIDecorator[]\n\n  constructor(\n    children: TOISymbol[],\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(SymbolType.Group, style)\n    this.children = children\n    this.decorators = []\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return this.bounds.snapPoints\n  }\n\n  get vertices(): TPoint[]\n  {\n    return this.children.flatMap(s => s.vertices)\n  }\n\n  get bounds(): Box\n  {\n    return Box.createFromBoxes(this.children.map(c => c.bounds))\n  }\n\n  updateChildrenStyle(): void\n  {\n    this.children.forEach(child => {\n      child.style = Object.assign({}, child.style, this.style)\n      if (child.type === SymbolType.Text) {\n        child.chars.forEach(c =>\n        {\n          if (child.style.color) {\n            c.color = child.style.color\n          }\n        })\n      }\n      else if (child.type === SymbolType.Group) {\n        child.updateChildrenStyle()\n      }\n    })\n  }\n\n  overlaps(box: TBoundingBox): boolean\n  {\n    return this.children.some(s => s.overlaps(box))\n  }\n\n  containsSymbol(strokeId: string): boolean\n  {\n    return OISymbolGroup.containsSymbol(this, strokeId)\n  }\n\n  containsOnlyStroke(): boolean\n  {\n    return OISymbolGroup.containsOnlyStroke(this)\n  }\n\n  extractSymbols(): TOISymbol[]\n  {\n    return OISymbolGroup.extractSymbols(this)\n  }\n\n  extractStrokes(): OIStroke[]\n  {\n    return OISymbolGroup.extractStrokes(this)\n  }\n\n  removeChilds(symbolIds: string[]): OISymbolGroup\n  {\n    return OISymbolGroup.removeChilds(this, symbolIds)\n  }\n\n  static containsOnlyStroke(group: OISymbolGroup): boolean\n  {\n    return group.children.every(s =>\n    {\n      if (s.type === SymbolType.Group) {\n        return OISymbolGroup.containsOnlyStroke(s as OISymbolGroup)\n      }\n      if (s.type === SymbolType.Stroke) {\n        return true\n      }\n      return false\n    })\n  }\n\n  static extractSymbols(group: OISymbolGroup): TOISymbol[]\n  {\n    return group.children.flatMap(s =>\n    {\n      if (s.type === SymbolType.Group) {\n        return OISymbolGroup.extractSymbols(s as OISymbolGroup).concat(s)\n      }\n      return s\n    })\n  }\n\n  static extractStrokes(group: OISymbolGroup): OIStroke[]\n  {\n    return group.children.flatMap(s =>\n    {\n      if (s.type === SymbolType.Stroke) {\n        return s as OIStroke\n      }\n      if (s.type === SymbolType.Group) {\n        return OISymbolGroup.extractStrokes(s as OISymbolGroup)\n      }\n      return\n    }).filter(s => !!s) as OIStroke[]\n  }\n\n  static containsSymbol(group: OISymbolGroup, symbolId: string): boolean\n  {\n    return group.children.some(symbol =>\n    {\n      if (symbol.type === SymbolType.Group) {\n        return OISymbolGroup.containsSymbol(symbol as OISymbolGroup, symbolId)\n      }\n      return symbol.id === symbolId\n    })\n  }\n\n  static removeChilds(group: OISymbolGroup, symbolIds: string[]): OISymbolGroup\n  {\n    group.children = group.children.filter(s => !symbolIds.includes(s.id))\n    const symbolsToRemove = group.children.slice()\n    symbolsToRemove.forEach(s =>\n    {\n      if (s.type === SymbolType.Group) {\n        if (!s.removeChilds(symbolIds).children.length) {\n          group.children = group.children.filter(s1 => s1.id !== s.id)\n        }\n      }\n    })\n    return group\n  }\n\n  clone(): OISymbolGroup\n  {\n    const clone = new OISymbolGroup(this.children.map(s => s.clone()), structuredClone({ ...this.style }))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    clone.decorators = this.decorators.map(d => d.clone())\n    return clone\n  }\n\n  toJSON(): PartialDeep<OISymbolGroup>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      children: JSON.parse(JSON.stringify(this.children)),\n      decorators: this.decorators.length ? JSON.parse(JSON.stringify(this.decorators)) : undefined\n    }\n  }\n}\n","import { TStyle } from \"../style\"\nimport { PartialDeep, convertDegreeToRadian, findIntersectionBetween2Segment, isPointInsidePolygon, computeRotatedPoint } from \"../utils\"\nimport { TPoint, isValidPoint } from \"./Point\"\nimport { SymbolType } from \"./Symbol\"\nimport { Box, TBoundingBox } from \"./Box\"\nimport { OIDecorator } from \"./OIDecorator\"\nimport { OISymbolBase } from \"./OISymbolBase\"\n\n/**\n * @group Primitive\n */\nexport type TOISymbolChar = {\n  id: string\n  label: string\n  fontSize: number\n  fontWeight: \"normal\" | \"bold\"\n  color: string\n  bounds: TBoundingBox\n}\n\n/**\n * @group Primitive\n */\nexport class OIText extends OISymbolBase<SymbolType.Text>\n{\n  readonly isClosed = true\n\n  point: TPoint\n  chars: TOISymbolChar[]\n  decorators: OIDecorator[]\n  bounds: Box\n  rotation?: {\n    degree: number,\n    center: TPoint\n  }\n\n  constructor(\n    chars: TOISymbolChar[],\n    point: TPoint,\n    bounds: TBoundingBox,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(SymbolType.Text, style)\n    this.point = point\n    this.bounds = new Box(bounds)\n    this.chars = chars\n    this.decorators = []\n  }\n\n  get label(): string\n  {\n    return this.chars.map(c => c.label).join(\"\")\n  }\n\n  get vertices(): TPoint[]\n  {\n    if (this.rotation) {\n      const center = this.rotation.center\n      const rad = convertDegreeToRadian(-this.rotation.degree)\n      return this.bounds.corners\n        .map(p =>\n        {\n          return computeRotatedPoint(p, center, rad)\n        })\n    }\n    else {\n      return this.bounds.corners\n    }\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    const offsetY = this.bounds.yMax - this.point.y\n    const points = [\n      { x: this.bounds.x, y: this.bounds.yMin + offsetY },\n      { x: this.bounds.xMax, y: this.bounds.yMin + offsetY },\n      { x: this.bounds.xMax, y: this.bounds.yMax - offsetY },\n      { x: this.bounds.x, y: this.bounds.yMax - offsetY },\n      this.bounds.center\n    ]\n    if (this.rotation) {\n      const center = this.rotation.center\n      const rad = convertDegreeToRadian(-this.rotation.degree)\n      return points\n        .map(p =>\n        {\n          return computeRotatedPoint(p, center, rad)\n        })\n    }\n    return points\n  }\n\n  protected getCharCorners(char: TOISymbolChar): TPoint[]\n  {\n    const boxBox = new Box(char.bounds)\n    if (this.rotation) {\n      const center = this.rotation.center\n      const rad = convertDegreeToRadian(-this.rotation.degree)\n      return boxBox.corners\n        .map(p =>\n        {\n          return computeRotatedPoint(p, center, rad)\n        })\n    }\n    return boxBox.corners\n  }\n\n  getCharsOverlaps(points: TPoint[]): TOISymbolChar[]\n  {\n    return this.chars.filter(c =>\n    {\n      const charCorners = this.getCharCorners(c)\n      return points.some(p => isPointInsidePolygon(p, charCorners))\n    })\n  }\n\n  overlaps(box: TBoundingBox): boolean\n  {\n    return this.vertices.some(p => Box.containsPoint(box, p)) ||\n      this.edges.some(e1 => Box.getSides(box).some(e2 => !!findIntersectionBetween2Segment(e1, e2)))\n  }\n\n  clone(): OIText\n  {\n    const clone = new OIText(structuredClone(this.chars), structuredClone(this.point), this.bounds, structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    clone.decorators = this.decorators.map(d => d.clone())\n    clone.rotation = this.rotation ? structuredClone(this.rotation) : undefined\n    return clone\n  }\n\n  toJSON(): PartialDeep<OIText>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      point: this.point,\n      chars: this.chars,\n      style: this.style,\n      rotation: this.rotation,\n      bounds: this.bounds,\n      decorators: this.decorators.length ? this.decorators : undefined\n    }\n  }\n\n  static create(partial: PartialDeep<OIText>): OIText\n  {\n    if (!isValidPoint(partial?.point)) throw new Error(`Unable to create a OIText, point are invalid`)\n    if (!partial.chars?.length) throw new Error(`Unable to create a OIText, no chars`)\n    if (!partial.bounds) throw new Error(`Unable to create a OIText, no boundingBox`)\n    const text = new OIText(partial.chars as TOISymbolChar[], partial.point as TPoint, partial.bounds as TBoundingBox, partial.style)\n    if (partial.id) text.id = partial.id\n    if (partial.decorators?.length) {\n      partial.decorators.forEach(d => {\n        if(d?.kind) {\n          text.decorators.push(new OIDecorator(d.kind, Object.assign({}, text.style, d.style)))\n        }\n      })\n    }\n    return text\n  }\n}\n","import { createUUID, PartialDeep } from \"../utils\"\nimport { TPoint, TPointer } from \"./Point\"\nimport { Box, TBoundingBox } from \"./Box\"\nimport { SymbolType } from \"./Symbol\"\nimport { OISymbolBase } from \"./OISymbolBase\"\nimport { TStyle } from \"../style\"\n\nconst style: TStyle = {\n  color: \"grey\",\n  fill: \"none\",\n  width: 12,\n  opacity: 0.2\n}\n\n/**\n * @group Primitive\n */\nexport class OIEraser extends OISymbolBase<SymbolType.Eraser>\n{\n  readonly isClosed = false\n  pointers: TPointer[]\n\n  constructor()\n  {\n    super(SymbolType.Eraser, style)\n    this.id = `${ this.type }-${ createUUID() }`\n    this.creationTime = Date.now()\n    this.modificationDate = this.creationTime\n    this.pointers = []\n  }\n\n  get bounds(): Box\n  {\n    return Box.createFromPoints(this.vertices)\n  }\n\n  get vertices(): TPoint[]\n  {\n    return this.pointers\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return []\n  }\n\n  clone(): OISymbolBase\n  {\n    const clone = new OIEraser()\n    clone.id = this.id\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    clone.pointers = structuredClone(this.pointers)\n    return clone\n  }\n\n  overlaps(box: TBoundingBox): boolean\n  {\n    return this.pointers.some(p =>\n    {\n      return p.x >= box.x && p.x <= box.x + box.width\n        && p.y >= box.y && p.y <= box.y + box.height\n    })\n  }\n\n  toJSON(): PartialDeep<OIEraser>\n  {\n    return {\n      id: this.id,\n      pointers: this.pointers,\n      style: this.style\n    }\n  }\n}\n","import { DefaultPenStyle, TPenStyle } from \"../style\"\nimport { PartialDeep, createUUID } from \"../utils\"\nimport { TPointer } from \"./Point\"\nimport { SymbolType, TSymbol } from \"./Symbol\"\n\n/**\n * @group Primitive\n */\nexport type TStrokeToSend = {\n  id: string\n  pointerType: string\n  x: number[]\n  y: number[]\n  t: number[]\n  p: number[]\n}\n\n/**\n * @group Primitive\n */\nexport type TStrokeGroupToSend = {\n  penStyle?: string\n  strokes: TStrokeToSend[]\n}\n\n/**\n * @group Primitive\n */\nexport type TStroke = TSymbol & {\n  pointerType: string\n  pointers: TPointer[]\n  length: number\n}\n\n/**\n * @group Primitive\n */\nexport type TStrokeGroup = {\n  penStyle: TPenStyle\n  strokes: Stroke[]\n}\n\n/**\n * @group Primitive\n */\nexport class Stroke implements TStroke\n{\n  type = SymbolType.Stroke\n  id: string\n  creationTime: number\n  modificationDate: number\n  style: TPenStyle\n  pointerType: string\n  pointers: TPointer[]\n  length: number\n\n  constructor(style: TPenStyle, pointerType = \"pen\")\n  {\n    this.id = `${this.type}-${createUUID()}`\n    this.creationTime = Date.now()\n    this.modificationDate = this.creationTime\n    this.style = style\n    this.pointerType = pointerType\n    this.pointers = []\n    this.length = 0\n  }\n\n  clone(): Stroke\n  {\n    const clone = new Stroke(this.style, this.pointerType)\n    clone.id = this.id\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    clone.pointers = structuredClone(this.pointers)\n    clone.length = this.length\n    return clone\n  }\n\n  formatToSend(): TStrokeToSend\n  {\n    const json: TStrokeToSend = {\n      id: this.id,\n      pointerType: this.pointerType,\n      p: [],\n      t: [],\n      x: [],\n      y: []\n    }\n    this.pointers.forEach(p => {\n      json.p.push(p.p)\n      json.t.push(p.t)\n      json.x.push(p.x)\n      json.y.push(p.y)\n    })\n    return json\n  }\n}\n\n/**\n * @group Primitive\n * @group Utils\n */\nexport function convertPartialStrokesToStrokes(json: PartialDeep<TStroke>[]): Stroke[]\n{\n  const errors: string[] = []\n  const strokes: Stroke[] = []\n  json.forEach((j, ji) => {\n    let flag = true\n    const stroke = new Stroke(j.style || DefaultPenStyle, j.pointerType)\n    if (j.id) stroke.id = j.id\n    if (!j.pointers?.length) {\n      errors.push(`stroke ${ji + 1} has not pointers`)\n      flag = false\n      return\n    }\n    j.pointers?.forEach((pp, pIndex) => {\n      if (!pp) {\n        errors.push(`stroke ${ji + 1} has no pointer at ${pIndex}`)\n        flag = false\n        return\n      }\n      const pointer: TPointer = {\n        p: pp.p || 1,\n        t: pp.t || pIndex,\n        x: 0,\n        y: 0\n      }\n      if (pp?.x == undefined || pp?.x == null) {\n        errors.push(`stroke ${ji + 1} has no x at pointer at ${pIndex}`)\n        flag = false\n        return\n      }\n      else {\n        pointer.x = pp.x\n      }\n      if (pp?.y == undefined || pp?.y == null) {\n        errors.push(`stroke ${ji + 1} has no y at pointer at ${pIndex}`)\n        flag = false\n        return\n      }\n      else {\n        pointer.y = pp.y\n      }\n      if (flag) {\n        stroke.pointers.push(pointer)\n      }\n    })\n    if (flag) {\n      strokes.push(stroke)\n    }\n  })\n\n  if (errors.length) {\n    throw new Error(errors.join(\"\\n\"))\n  }\n\n  return strokes\n}\n","/**\n * @group Recognizer\n * @remarks List all errors generated by the backend with their descriptions\n */\nexport enum RecognizerError {\n  NO_ACTIVITY = \"Session closed due to no activity. Without a connection on your part, it will be permanently lost after an hour.\",\n  WRONG_CREDENTIALS = \"Application credentials are invalid. Please check or regenerate your application key and hmackey.\",\n  TOO_OLD = \"Session is too old. Max Session Duration Reached.\",\n  NO_SESSION_FOUND = \"No sessions found. Without activation for 1 hour, sessions are deleted from the server. To avoid losing your work, use the json export, then import it this will create a new session.\",\n  UNKNOW = \"An unknown error has occurred.\",\n  ABNORMAL_CLOSURE = \"MyScript recognition server is not reachable.\",\n  CANT_ESTABLISH = \"Unable to establish a connection to MyScript recognition server. Check the host and your connectivity.\",\n  GOING_AWAY = \"MyScript recognition server is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection.\",\n  PROTOCOL_ERROR = \"MyScript recognition server terminated the connection due to a protocol error.\",\n  UNSUPPORTED_DATA = \"MyScript recognition server terminated the connection because the endpoint received data of a type it cannot accept. (For example, a text-only endpoint received binary data.)\",\n  INVALID_FRAME_PAYLOAD = \"MyScript recognition server terminated the connection because a message was received that contained inconsistent data (e.g., non-UTF-8 data within a text message).\",\n  POLICY_VIOLATION = \"MyScript recognition server terminated the connection because it received a message that violates its policy.\",\n  MESSAGE_TOO_BIG = \"MyScript recognition server terminated the connection because a data frame was received that is too large.\",\n  INTERNAL_ERROR = \"MyScript recognition server terminated the connection because it encountered an unexpected condition that prevented it from fulfilling the request.\",\n  SERVICE_RESTART = \"MyScript recognition server terminated the connection because it is restarting.\",\n  TRY_AGAIN = \"MyScript recognition server terminated the connection due to a temporary condition, e.g. it is overloaded and is casting off some of its clients.\",\n  BAD_GATEWAY = \"MyScript recognition server was acting as a gateway or proxy and received an invalid response from the upstream server.\",\n  TLS_HANDSHAKE = \"MyScript recognition server connection was closed due to a failure to perform a TLS handshake\",\n}\n","import { TGesture } from \"../gesture\"\nimport { TExport } from \"../model\"\n\n/**\n * @group Recognizer\n */\nexport enum TOIMessageType\n{\n  HMAC_Challenge = \"hmacChallenge\",\n  Authenticated = \"authenticated\",\n  SessionDescription = \"sessionDescription\",\n  NewPart = \"newPart\",\n  PartChanged = \"partChanged\",\n  ContentChanged = \"contentChanged\",\n  Idle = \"idle\",\n  Pong = \"pong\",\n  Exported = \"exported\",\n  GestureDetected = \"gestureDetected\",\n  ContextlessGesture = \"contextlessGesture\",\n  Error = \"error\",\n}\n\n/**\n * @group Recognizer\n * @description use to type message to send to backend\n */\nexport type TOIMessageEvent = {\n  type: string\n  [key: string]: unknown\n}\n\n/**\n * @group Recognizer\n */\nexport type TOIMessage<T = string> = {\n  type: T\n}\n\n/**\n * @group Recognizer\n */\nexport type TOIMessageEventAuthenticated = TOIMessage<TOIMessageType.Authenticated>\n\n/**\n * @group Recognizer\n */\nexport type TOIMessageEventHMACChallenge = TOIMessage<TOIMessageType.HMAC_Challenge> & {\n  hmacChallenge: string\n  iinkSessionId: string\n}\n\n/**\n * @group Recognizer\n */\nexport type TOISessionDescriptionMessage = TOIMessage<TOIMessageType.SessionDescription> & {\n  contentPartCount: number\n  iinkSessionId: string\n}\n\n/**\n * @group Recognizer\n */\nexport type TOIMessageEventNewPart = TOIMessage<TOIMessageType.NewPart> & {\n  id: string\n  idx: null\n}\n\n/**\n * @group Recognizer\n */\nexport type TOIMessageEventPartChange = TOIMessage<TOIMessageType.PartChanged> & {\n  partIdx: number\n  partId: string\n  partCount: number\n}\n\n/**\n * @group Recognizer\n */\nexport type TOIMessageEventContentChange = TOIMessage<TOIMessageType.ContentChanged> & {\n  partId: string\n  canUndo: boolean\n  canRedo: boolean\n  empty: boolean\n  undoStackIndex: number\n  possibleUndoCount: number\n}\n\n/**\n * @group Recognizer\n */\nexport type TOIMessageEventExport = TOIMessage<TOIMessageType.Exported> & {\n  partId: string\n  exports: TExport\n}\n\n/**\n * @group Recognizer\n */\nexport type TOIMessageEventGesture = TOIMessage<TOIMessageType.GestureDetected> & TGesture\n\n/**\n * @group Recognizer\n */\nexport type TOIMessageEventContextlessGesture = TOIMessage<TOIMessageType.ContextlessGesture> & {\n  gestureType: \"none\" | \"scratch\" | \"left-right\" | \"right-left\" | \"bottom-top\" | \"top-bottom\" | \"surround\",\n  strokeId: string\n}\n\n/**\n * @group Recognizer\n */\nexport type TOIMessageEventPong = TOIMessage<TOIMessageType.Pong>\n\n/**\n * @group Recognizer\n */\nexport type TOIMessageEventIdle = TOIMessage<TOIMessageType.Idle>\n\n/**\n * @group Recognizer\n */\nexport type TOIMessageEventError = TOIMessage<TOIMessageType.Error> & {\n  code?: number | string\n  message?: string\n  data?: {\n    code: number | string\n    message: string\n  }\n}\n\n/**\n * @group Recognizer\n */\nexport type TOIMessageReceived =\n  TOIMessageEventAuthenticated |\n  TOIMessageEventHMACChallenge |\n  TOISessionDescriptionMessage |\n  TOIMessageEventNewPart |\n  TOIMessageEventPartChange |\n  TOIMessageEventContentChange |\n  TOIMessageEventExport |\n  TOIMessageEventGesture |\n  TOIMessageEventContextlessGesture |\n  TOIMessageEventPong |\n  TOIMessageEventIdle |\n  TOIMessageEventError\n","import { LoggerClass, LoggerManager } from \"../logger\"\nimport { TPenStyle } from \"../style\"\nimport { computeDistance } from \"../utils\"\nimport { TExport } from \"./Export\"\nimport { IModel } from \"./IModel\"\nimport { Stroke, TPoint, TPointer } from \"../primitive\"\n\n/**\n * @group Model\n */\nexport type TRecognitionPositions = {\n  lastSentPosition: number\n  lastReceivedPosition: number\n}\n\n/**\n * @group Model\n */\nexport class Model implements IModel\n{\n  readonly creationTime: number\n  modificationDate: number\n  positions: TRecognitionPositions\n  currentSymbol?: Stroke\n  symbols: Stroke[]\n  exports?: TExport\n  converts?: TExport\n  width: number\n  height: number\n  rowHeight: number\n  idle: boolean\n  #logger = LoggerManager.getLogger(LoggerClass.MODEL)\n\n  constructor(width = 100, height = 100, rowHeight = 0, creationDate = Date.now())\n  {\n    this.#logger.info(\"constructor\", { width, height, creationDate })\n    this.creationTime = creationDate\n    this.modificationDate = creationDate\n    this.width = width\n    this.height = height\n    this.rowHeight = rowHeight\n    this.symbols = []\n    this.positions = {\n      lastSentPosition: 0,\n      lastReceivedPosition: 0\n    }\n    this.idle = true\n  }\n\n  protected computePressure(distance: number, globalDistance: number): number\n  {\n    let ratio = 1.0\n    if (distance === globalDistance) {\n      ratio = 1.0\n    } else if (distance < 10) {\n      ratio = 0.2 + Math.pow(0.1 * distance, 0.4)\n    } else if (distance > globalDistance - 10) {\n      ratio = 0.2 + Math.pow(0.1 * (globalDistance - distance), 0.4)\n    }\n    const pressure = ratio * Math.max(0.1, 1.0 - (0.1 * Math.sqrt(distance)))\n    return isNaN(pressure) ? 0.5 : Math.round(pressure * 100) / 100\n  }\n\n  protected filterPointByAcquisitionDelta(stroke: Stroke, point: TPointer, lastPointer?: TPointer): boolean\n  {\n    const delta: number = (2 + ((stroke.style[\"-myscript-pen-width\"] || 0) / 4))\n    return !lastPointer ||\n      stroke.pointers.length === 0 ||\n      Math.abs(lastPointer.x - point.x) >= delta ||\n      Math.abs(lastPointer.y - point.y) >= delta\n  }\n\n  getStrokeFromPoint(point: TPoint): Stroke[]\n  {\n    this.#logger.info(\"getStrokeFromPoint\", { point })\n    const isBetween = (val: number, min: number, max: number): boolean => (val >= min && val <= max)\n\n    const _strokeList: Stroke[] = []\n    this.symbols.forEach((stroke) =>\n    {\n      for (let i = 0; i < stroke.pointers.length; i++) {\n        const strokePointer = stroke.pointers[i]\n        if (\n          isBetween(strokePointer.x, point.x - 5, point.x + 5) &&\n          isBetween(strokePointer.y, point.y - 5, point.y + 5)\n        ) {\n          _strokeList.push(stroke)\n          break\n        }\n        else {\n          if (computeDistance(point, strokePointer) < 10) {\n            _strokeList.push(stroke)\n            break\n          }\n        }\n      }\n    })\n    this.#logger.debug(\"getStrokeFromPoint\", { strokes: _strokeList })\n    return _strokeList\n  }\n\n  addPoint(stroke: Stroke, pointer: TPointer): void\n  {\n    this.#logger.debug(\"addPoint\", { stroke, pointer })\n    const lastPointer = stroke.pointers.at(-1)\n    if (this.filterPointByAcquisitionDelta(stroke, pointer, lastPointer)) {\n      const distance = lastPointer ? computeDistance(pointer, lastPointer) : 0\n      stroke.length += distance\n      pointer.p = this.computePressure(distance, stroke.length)\n      stroke.pointers.push(pointer)\n      stroke.modificationDate = Date.now()\n    }\n  }\n\n  addStroke(stroke: Stroke): void\n  {\n    this.#logger.info(\"addStroke\", { stroke })\n    this.symbols.push(stroke)\n    this.modificationDate = Date.now()\n    this.converts = undefined\n    this.exports = undefined\n  }\n\n  updateStroke(updatedStroke: Stroke): void\n  {\n    this.#logger.info(\"updateStroke\", { updatedStroke })\n    const strokeIndex = this.symbols.findIndex((s: Stroke): boolean => s.id === updatedStroke.id)\n    if (strokeIndex !== -1) {\n      updatedStroke.modificationDate = Date.now()\n      this.symbols.splice(strokeIndex, 1, updatedStroke)\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n    this.#logger.debug(\"updateStroke\", this.symbols)\n  }\n\n  removeStroke(id: string): void\n  {\n    this.#logger.info(\"removeStroke\", { id })\n    const strokeIndex = this.symbols.findIndex(s => s.id === id)\n    if (strokeIndex !== -1) {\n      this.positions.lastSentPosition--\n      this.positions.lastReceivedPosition--\n      this.symbols.splice(strokeIndex, 1)\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n    this.#logger.debug(\"removeStroke\", this.symbols)\n  }\n\n  removeStrokesFromPoint(point: TPoint): string[]\n  {\n    this.#logger.info(\"removeStrokesFromPoint\", { point })\n    const strokes = this.getStrokeFromPoint(point)\n    strokes.forEach(strokeToRemove =>\n    {\n      this.removeStroke(strokeToRemove.id)\n    })\n    this.#logger.debug(\"removeStrokesFromPoint\", strokes.map(s => s.id))\n    return strokes.map(s => s.id)\n  }\n\n  extractUnsentStrokes(): Stroke[]\n  {\n    return this.symbols.slice(this.positions.lastSentPosition)\n  }\n\n  initCurrentStroke(point: TPointer, pointerType: string, style: TPenStyle, dpi = 96): void\n  {\n    this.#logger.info(\"initCurrentStroke\", { point, pointerType, style, dpi })\n    if (style[\"-myscript-pen-width\"]) {\n      const pxWidth = (style[\"-myscript-pen-width\"] * dpi) / 25.4\n      style.width = pxWidth / 2\n    }\n    this.modificationDate = Date.now()\n    this.exports = undefined\n    this.currentSymbol = new Stroke(style, pointerType)\n    this.#logger.debug(\"initCurrentStroke\", this.currentSymbol)\n    this.addPoint(this.currentSymbol, point)\n  }\n\n  appendToCurrentStroke(point: TPointer): void\n  {\n    this.#logger.info(\"appendToCurrentStroke\", { point })\n    if (this.currentSymbol) {\n      this.addPoint(this.currentSymbol, point)\n    }\n    this.#logger.debug(\"appendToCurrentStroke\", this.currentSymbol)\n  }\n\n  endCurrentStroke(point: TPointer): void\n  {\n    this.#logger.info(\"endCurrentStroke\", { point })\n    if (this.currentSymbol) {\n      this.addPoint(this.currentSymbol, point)\n      this.addStroke(this.currentSymbol)\n      this.currentSymbol = undefined\n    }\n    this.#logger.debug(\"endCurrentStroke\", this.currentSymbol)\n  }\n\n  updatePositionSent(position: number = this.symbols.length): void\n  {\n    this.#logger.info(\"updatePositionSent\", { position })\n    this.positions.lastSentPosition = position\n    this.#logger.debug(\"updatePositionSent\", this.positions.lastSentPosition)\n  }\n\n  updatePositionReceived(): void\n  {\n    this.#logger.info(\"updatePositionReceived\")\n    this.positions.lastReceivedPosition = this.positions.lastSentPosition\n    this.#logger.debug(\"updatePositionReceived\", this.positions.lastReceivedPosition)\n  }\n\n  mergeExport(exports: TExport)\n  {\n    this.#logger.info(\"mergeExport\", { exports })\n    if (this.exports) {\n      Object.assign(this.exports, exports)\n    } else {\n      this.exports = exports\n    }\n    this.#logger.debug(\"mergeExport\", this.exports)\n  }\n\n  mergeConvert(converts: TExport)\n  {\n    this.#logger.info(\"mergeConvert\", { converts })\n    if (this.converts) {\n      Object.assign(this.converts, converts)\n    } else {\n      this.converts = converts\n    }\n    this.#logger.debug(\"mergeConvert\", this.converts)\n  }\n\n  clone(): Model\n  {\n    this.#logger.info(\"clone\")\n    const clonedModel = new Model(this.width, this.height, this.rowHeight, this.creationTime)\n    clonedModel.modificationDate = JSON.parse(JSON.stringify(this.modificationDate))\n    clonedModel.currentSymbol = this.currentSymbol ? this.currentSymbol.clone() : undefined\n    clonedModel.symbols = this.symbols.map(s => s.clone())\n    clonedModel.positions = JSON.parse(JSON.stringify(this.positions))\n    clonedModel.exports = this.exports ? JSON.parse(JSON.stringify(this.exports)) : undefined\n    clonedModel.converts = this.converts ? JSON.parse(JSON.stringify(this.converts)) : undefined\n    clonedModel.idle = this.idle\n    this.#logger.debug(\"clone\", { clonedModel })\n    return clonedModel\n  }\n\n  clear(): void\n  {\n    this.#logger.info(\"clear\")\n    this.modificationDate = Date.now()\n    this.currentSymbol = undefined\n    this.symbols = []\n    this.positions.lastSentPosition = 0\n    this.positions.lastReceivedPosition = 0\n    this.exports = undefined\n    this.converts = undefined\n    this.idle = true\n  }\n}\n","import { LoggerClass, LoggerManager } from \"../logger\"\nimport\n{\n  SymbolType,\n  TOISymbol,\n} from \"../primitive\"\nimport { TExport } from \"./Export\"\nimport { IModel } from \"./IModel\"\n\n/**\n * @group Model\n */\nexport class OIModel implements IModel\n{\n  #logger = LoggerManager.getLogger(LoggerClass.MODEL)\n  readonly creationTime: number\n  modificationDate: number\n  currentSymbol?: TOISymbol\n  symbols: TOISymbol[]\n  exports?: TExport\n  converts?: TExport\n  width: number\n  height: number\n  rowHeight: number\n  idle: boolean\n\n  constructor(width = 100, height = 100, rowHeight = 0, creationDate = Date.now())\n  {\n    this.creationTime = creationDate\n    this.modificationDate = creationDate\n    this.width = width\n    this.height = height\n    this.rowHeight = rowHeight\n    this.symbols = []\n    this.exports = undefined\n    this.converts = undefined\n    this.idle = true\n  }\n\n  get symbolsSelected(): TOISymbol[]\n  {\n    return this.symbols.filter(s => s.selected)\n  }\n\n  get symbolsToDelete(): TOISymbol[]\n  {\n    return this.symbols.filter(s => s.deleting)\n  }\n\n  selectSymbol(id: string): void\n  {\n    const symbol = this.symbols.find(s => s.id === id || (s.type === SymbolType.Group && s.containsSymbol(id)))\n    if (symbol) {\n      symbol.selected = true\n    }\n  }\n\n  unselectSymbol(id: string): void\n  {\n    const symbol = this.symbols.find(s => s.id === id)\n    if (symbol) {\n      symbol.selected = false\n    }\n  }\n\n  resetSelection(): void\n  {\n    this.symbols.forEach(s => s.selected = false)\n  }\n\n  getRootSymbol(id: string): TOISymbol | undefined\n  {\n    return this.symbols.find(s =>\n    {\n      if (s.id === id) return s\n      if (s.type === SymbolType.Group && s.containsSymbol(id)) {\n        return s\n      }\n      return\n    })\n  }\n\n  getSymbolRowIndex(symbol: TOISymbol): number\n  {\n    return Math.round(symbol.bounds.yMid / this.rowHeight)\n  }\n\n  getSymbolsByRowOrdered(): { rowIndex: number, symbols: TOISymbol[] }[]\n  {\n    const rows: { rowIndex: number, symbols: TOISymbol[] }[] = []\n    this.symbols.forEach(s =>\n    {\n      const rowIndex = this.getSymbolRowIndex(s)\n      const row = rows.find(r => r.rowIndex === rowIndex)\n      if (row) {\n        row.symbols.push(s)\n      }\n      else {\n        rows.push({ rowIndex, symbols: [s] })\n      }\n    })\n    rows.forEach(r =>\n    {\n      r.symbols.sort((s1, s2) => s1.bounds.xMid - s2.bounds.xMid)\n    })\n    return rows.sort((r1, r2) => r1.rowIndex - r2.rowIndex)\n  }\n\n  roundToLineGuide(y: number): number\n  {\n    return Math.round(y / this.rowHeight) * this.rowHeight\n  }\n\n  isSymbolAbove(source: TOISymbol, target: TOISymbol): boolean\n  {\n    return source.bounds.yMid - this.rowHeight / 2 > target.bounds.yMid\n  }\n\n  isSymbolInRow(source: TOISymbol, target: TOISymbol): boolean\n  {\n    return Math.abs(source.bounds.yMid - target.bounds.yMid) <= this.rowHeight / 2\n  }\n\n  isSymbolBelow(source: TOISymbol, target: TOISymbol): boolean\n  {\n    return source.bounds.yMid + this.rowHeight / 2 < target.bounds.yMid\n  }\n\n  getFirstSymbol(symbols: TOISymbol[]): TOISymbol | undefined\n  {\n    if (!symbols.length) return\n    return symbols.reduce((previous, current) =>\n    {\n      if (previous) {\n        if (Math.round(previous.bounds.yMid / this.rowHeight) < Math.round(current.bounds.yMid / this.rowHeight)) {\n          return previous\n        }\n        else if (Math.round(previous.bounds.yMid / this.rowHeight) == Math.round(current.bounds.yMid / this.rowHeight) && previous.bounds.xMid < current.bounds.xMid) {\n          return previous\n        }\n      }\n      return current\n    })\n  }\n\n  getLastSymbol(symbols: TOISymbol[]): TOISymbol | undefined\n  {\n    if (!symbols.length) return\n    return symbols.reduce((previous, current) =>\n    {\n      if (previous) {\n        if (previous.bounds.yMid - current.bounds.yMid > this.rowHeight / 2) {\n          return previous\n        }\n        if (previous.bounds.yMid - current.bounds.yMid < this.rowHeight / 2) {\n          return current\n        }\n        else if (previous.bounds.xMid > current.bounds.xMid) {\n          return previous\n        }\n      }\n      return current\n    })\n  }\n\n  addSymbol(symbol: TOISymbol): void\n  {\n    this.#logger.info(\"addSymbol\", { symbol })\n    const sIndex = this.symbols.findIndex(s => s.id === symbol.id)\n    if (sIndex > -1) {\n      throw new Error(`Symbol id already exist: ${ symbol.id }`)\n    }\n    this.symbols.push(symbol)\n    this.modificationDate = Date.now()\n    this.converts = undefined\n    this.exports = undefined\n    this.#logger.debug(\"addSymbol\", this.symbols)\n  }\n\n  updateSymbol(updatedSymbol: TOISymbol): void\n  {\n    this.#logger.info(\"updateSymbol\", { updatedSymbol })\n    const sIndex = this.symbols.findIndex(s => s.id === updatedSymbol.id)\n    if (sIndex !== -1) {\n      updatedSymbol.modificationDate = Date.now()\n      this.symbols.splice(sIndex, 1, updatedSymbol)\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n    this.#logger.debug(\"updateSymbol\", this.symbols)\n  }\n\n  replaceSymbol(id: string, symbols: TOISymbol[]): void\n  {\n    const sIndex = this.symbols.findIndex(s => s.id === id)\n    if (sIndex !== -1) {\n      this.symbols.splice(sIndex, 1, ...symbols)\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n  }\n\n  changeOrderSymbol(id: string, position: \"first\" | \"last\" | \"forward\" | \"backward\")\n  {\n    const fromIndex = this.symbols.findIndex(s => s.id === id)\n    if (fromIndex > -1) {\n      let toIndex = fromIndex\n      switch (position) {\n        case \"first\":\n          toIndex = 0\n          break\n        case \"last\":\n          toIndex = this.symbols.length - 1\n          break\n        case \"forward\":\n          toIndex = Math.min(toIndex + 1, this.symbols.length - 1)\n          break\n        case \"backward\":\n          toIndex = Math.max(toIndex - 1, 0)\n          break\n      }\n      const sym = this.symbols.splice(fromIndex, 1)[0]\n      this.symbols.splice(toIndex, 0, sym)\n    }\n  }\n\n  removeSymbol(id: string): void\n  {\n    this.#logger.info(\"removeSymbol\", { id })\n    const symbolIndex = this.symbols.findIndex(s => s.id === id)\n    if (symbolIndex !== -1) {\n      this.symbols.splice(symbolIndex, 1)\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n    this.#logger.debug(\"removeSymbol\", this.symbols)\n  }\n\n  extractDifferenceSymbols(model: OIModel): { added: TOISymbol[], removed: TOISymbol[] }\n  {\n    return {\n      added: this.symbols.filter(s1 => model.symbols.findIndex(s2 => s1.id === s2.id && s1.modificationDate === s2.modificationDate) === -1),\n      removed: model.symbols.filter(s1 => this.symbols.findIndex(s2 => s1.id === s2.id && s1.modificationDate === s2.modificationDate) === -1)\n    }\n  }\n\n  mergeExport(exports: TExport)\n  {\n    this.#logger.info(\"mergeExport\", { exports })\n    if (this.exports) {\n      Object.assign(this.exports, exports)\n    } else {\n      this.exports = exports\n    }\n    this.#logger.debug(\"mergeExport\", this.exports)\n  }\n\n  clone(): OIModel\n  {\n    this.#logger.info(\"clone\")\n    const clonedModel = new OIModel(this.width, this.height, this.rowHeight, this.creationTime)\n    clonedModel.modificationDate = this.modificationDate\n    clonedModel.symbols = this.symbols.map(s =>\n    {\n      const c = s.clone()\n      c.selected = false\n      return c\n    })\n    clonedModel.exports = structuredClone(this.exports)\n    clonedModel.idle = this.idle\n    this.#logger.debug(\"clone\", { clonedModel })\n    return clonedModel\n  }\n\n  clear(): void\n  {\n    this.#logger.info(\"clear\")\n    this.modificationDate = Date.now()\n    this.symbols = []\n    this.currentSymbol = undefined\n    this.exports = undefined\n    this.converts = undefined\n    this.idle = true\n\n  }\n}\n","import { TRecognitionConfiguration, TServerConfiguration } from \"../configuration\"\nimport { InternalEvent } from \"../event\"\nimport { TOIHistoryBackendChanges, TUndoRedoContext } from \"../history\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { TExport, TJIIXExport } from \"../model\"\nimport { OIStroke } from \"../primitive\"\nimport { TMatrixTransform } from \"../transform\"\nimport { computeHmac, DeferredPromise } from \"../utils\"\nimport\n{\n  TOIMessageEvent,\n  TOIMessageEventContentChange,\n  TOIMessageEventContextlessGesture,\n  TOIMessageEventError,\n  TOIMessageEventExport,\n  TOIMessageEventGesture,\n  TOIMessageEventHMACChallenge,\n  TOIMessageEventNewPart,\n  TOIMessageEventPartChange,\n  TOIMessageReceived,\n  TOIMessageType,\n  TOISessionDescriptionMessage\n} from \"./OIRecognizerMessage\"\nimport { RecognizerError } from \"./RecognizerError\"\nimport PingWorker from \"web-worker:../worker/ping.worker.ts\"\n\n/**\n * A websocket dialog have this sequence :\n * --------------- Client --------------------------------------------------------------- Server ---------------\n * { type: \"authenticate\" }                           ==================>\n *                                                    <==================       { type: \"hmacChallenge\" }\n * { type: \"hmac\" }                                   ==================>\n *                                                    <==================       { type: \"authenticated\" }\n * { type: \"initSession\" | \"restoreSession\" }         ==================>\n *                                                    <==================       { type: \"sessionDescription\" }\n * { type: \"newContentPart\" | \"openContentPart\" }     ==================>\n *                                                    <==================       { type: \"partChanged\" }\n * { type: \"addStrokes\" }                             ==================>\n *                                                    <==================       { type: \"contentChanged\" }\n * { type: \"transform\" }                              ==================>\n *                                                    <==================       { type: \"contentChanged\" }\n * { type: \"eraseStrokes\" }                           ==================>\n *                                                    <==================       { type: \"contentChanged\" }\n */\n\n/**\n * @group Recognizer\n */\nexport class OIRecognizer\n{\n  #logger = LoggerManager.getLogger(LoggerClass.RECOGNIZER)\n  protected serverConfiguration: TServerConfiguration\n  protected recognitionConfiguration: TRecognitionConfiguration\n\n  protected socket!: WebSocket\n  protected pingWorker?: Worker\n  protected pingCount = 0\n  protected reconnectionCount = 0\n  protected sessionId?: string\n  protected currentPartId?: string\n  protected currentErrorCode?: string | number\n\n  protected connected: DeferredPromise<void>\n  protected initialized: DeferredPromise<void>\n\n  protected addStrokeDeferred?: DeferredPromise<TOIMessageEventGesture | undefined>\n  protected contextlessGestureDeferred: Map<string, DeferredPromise<TOIMessageEventContextlessGesture>>\n  protected transformStrokeDeferred?: DeferredPromise<void>\n  protected eraseStrokeDeferred?: DeferredPromise<void>\n  protected replaceStrokeDeferred?: DeferredPromise<void>\n  protected exportDeferredMap: Map<string, DeferredPromise<TExport>>\n  protected closeDeferred?: DeferredPromise<void>\n  protected waitForIdleDeferred?: DeferredPromise<void>\n  protected undoDeferred?: DeferredPromise<void>\n  protected redoDeferred?: DeferredPromise<void>\n  protected clearDeferred?: DeferredPromise<void>\n\n  url: string\n\n  constructor(serverConfig: TServerConfiguration, recognitionConfig: TRecognitionConfiguration)\n  {\n    this.#logger.info(\"constructor\", { serverConfig, recognitionConfig })\n    this.serverConfiguration = serverConfig\n    this.recognitionConfiguration = recognitionConfig\n    const scheme = (this.serverConfiguration.scheme === \"https\") ? \"wss\" : \"ws\"\n    this.url = `${ scheme }://${ this.serverConfiguration.host }/api/v4.0/iink/offscreen?applicationKey=${ this.serverConfiguration.applicationKey }`\n\n    this.exportDeferredMap = new Map()\n    this.contextlessGestureDeferred = new Map()\n\n    this.connected = new DeferredPromise<void>()\n    this.initialized = new DeferredPromise<void>()\n  }\n\n  get mimeTypes(): string[]\n  {\n    return [\"application/vnd.myscript.jiix\"]\n  }\n\n  get event(): InternalEvent\n  {\n    return InternalEvent.getInstance()\n  }\n\n  #send(message: TOIMessageEvent): void\n  {\n    if (!this.socket) {\n      throw new Error(\"Recognizer must be initilized\")\n    }\n    if (this.socket.readyState === this.socket.OPEN) {\n      this.socket.send(JSON.stringify(message))\n    }\n    else {\n      throw new Error(`Connection not ready, state: ${ this.socket.readyState }}`)\n    }\n  }\n\n  protected rejectDeferredPending(error: Error | string): void\n  {\n    this.initialized.reject(error)\n    this.addStrokeDeferred?.reject(error)\n    this.transformStrokeDeferred?.reject(error)\n    this.eraseStrokeDeferred?.reject(error)\n    this.replaceStrokeDeferred?.reject(error)\n    this.undoDeferred?.reject(error)\n    this.redoDeferred?.reject(error)\n    this.clearDeferred?.reject(error)\n    Array.from(this.contextlessGestureDeferred.values())\n      .forEach(v =>\n      {\n        v.reject(error)\n      })\n    Array.from(this.exportDeferredMap.values())\n      .forEach(v =>\n      {\n        v.reject(error)\n      })\n    this.waitForIdleDeferred?.reject(error)\n  }\n\n  protected resetAllDeferred(): void\n  {\n    this.connected = new DeferredPromise<void>()\n    this.initialized = new DeferredPromise<void>()\n    this.addStrokeDeferred = undefined\n    this.contextlessGestureDeferred.clear()\n    this.transformStrokeDeferred = undefined\n    this.eraseStrokeDeferred = undefined\n    this.replaceStrokeDeferred = undefined\n    this.exportDeferredMap.clear()\n    this.waitForIdleDeferred = undefined\n    this.closeDeferred = undefined\n  }\n\n  protected clearSocketListener(): void\n  {\n    this.socket.removeEventListener(\"open\", this.openCallback.bind(this))\n    this.socket.removeEventListener(\"close\", this.closeCallback.bind(this))\n    this.socket.removeEventListener(\"message\", this.messageCallback.bind(this))\n  }\n\n  protected closeCallback(evt: CloseEvent): void\n  {\n    this.#logger.info(\"closeCallback\", { evt })\n    let message = evt.reason\n    if (!this.currentErrorCode) {\n      switch (evt.code) {\n        case 1000:\n          // Normal Closure\n          break\n        case 1001:\n          message = RecognizerError.GOING_AWAY\n          break\n        case 1002:\n          message = RecognizerError.PROTOCOL_ERROR\n          break\n        case 1003:\n          message = RecognizerError.UNSUPPORTED_DATA\n          break\n        case 1006:\n          message = RecognizerError.ABNORMAL_CLOSURE\n          break\n        case 1007:\n          message = RecognizerError.INVALID_FRAME_PAYLOAD\n          break\n        case 1008:\n          message = RecognizerError.POLICY_VIOLATION\n          break\n        case 1009:\n          message = RecognizerError.MESSAGE_TOO_BIG\n          break\n        case 1011:\n          message = RecognizerError.INTERNAL_ERROR\n          break\n        case 1012:\n          message = RecognizerError.SERVICE_RESTART\n          break\n        case 1013:\n          message = RecognizerError.TRY_AGAIN\n          break\n        case 1014:\n          message = RecognizerError.BAD_GATEWAY\n          break\n        case 1015:\n          message = RecognizerError.TLS_HANDSHAKE\n          break\n        default:\n          message = RecognizerError.CANT_ESTABLISH\n          break\n      }\n    }\n\n    this.clearSocketListener()\n    this.closeDeferred?.resolve()\n    if (!this.currentErrorCode && evt.code !== 1000) {\n      const error = new Error(message)\n      this.event.emitError(error)\n      this.rejectDeferredPending(message)\n    }\n    this.pingWorker?.terminate()\n    this.resetAllDeferred()\n  }\n\n  protected openCallback(): void\n  {\n    this.connected.resolve()\n    this.reconnectionCount = 0\n    this.#send({\n      type: \"authenticate\",\n      \"myscript-client-name\": \"iink-ts\",\n      \"myscript-client-version\": \"2.0.1\",\n    })\n  }\n\n  protected async manageHMACChallenge(hmacChallengeMessage: TOIMessageEventHMACChallenge): Promise<void>\n  {\n    this.#send({\n      type: \"hmac\",\n      hmac: await computeHmac(hmacChallengeMessage.hmacChallenge, this.serverConfiguration.applicationKey, this.serverConfiguration.hmacKey)\n    })\n  }\n\n  protected initPing(): void\n  {\n    this.pingWorker = new PingWorker()\n    this.pingWorker.postMessage({\n      pingDelay: this.serverConfiguration.websocket.pingDelay,\n    })\n    this.pingWorker.onmessage = () =>\n    {\n      if (this.pingCount < this.serverConfiguration.websocket.maxPingLostCount) {\n        this.#send({ type: \"ping\" })\n      }\n      else {\n        this.close(1000, \"MAXIMUM_PING_REACHED\")\n        this.pingWorker?.terminate()\n      }\n      this.pingCount++\n    }\n  }\n\n  protected manageAuthenticated(): void\n  {\n    const pixelTomm = 25.4 / 96\n    this.#send({\n      type: this.sessionId ? \"restoreSession\" : \"initSession\",\n      iinkSessionId: this.sessionId,\n      scaleX: pixelTomm,\n      scaleY: pixelTomm,\n      configuration: this.recognitionConfiguration\n    })\n  }\n\n  protected manageSessionDescriptionMessage(sessionDescriptionMessage: TOISessionDescriptionMessage): void\n  {\n    if (sessionDescriptionMessage.iinkSessionId) {\n      this.sessionId = sessionDescriptionMessage.iinkSessionId\n    }\n    if (this.currentPartId) {\n      this.#send({ type: \"openContentPart\", id: this.currentPartId })\n    }\n    else {\n      this.#send({ type: \"newContentPart\", contentType: this.recognitionConfiguration.type, mimeTypes: this.mimeTypes })\n    }\n  }\n\n  protected manageNewPartMessage(newPartMessage: TOIMessageEventNewPart): void\n  {\n    this.initialized.resolve()\n    this.currentPartId = newPartMessage.id\n  }\n\n  protected managePartChangeMessage(partChangeMessage: TOIMessageEventPartChange): void\n  {\n    this.initialized?.resolve()\n    this.currentPartId = partChangeMessage.partId\n  }\n\n  protected manageContentChangedMessage(contentChangeMessage: TOIMessageEventContentChange): void\n  {\n    this.initialized?.resolve()\n    this.replaceStrokeDeferred?.resolve()\n    this.transformStrokeDeferred?.resolve()\n    this.eraseStrokeDeferred?.resolve()\n    this.undoDeferred?.resolve()\n    this.redoDeferred?.resolve()\n    this.clearDeferred?.resolve()\n    this.event.emitContextChange({\n      canRedo: contentChangeMessage.canRedo,\n      canUndo: contentChangeMessage.canRedo,\n    } as TUndoRedoContext)\n  }\n\n  protected manageExportMessage(exportMessage: TOIMessageEventExport): void\n  {\n    if (exportMessage.exports[\"application/vnd.myscript.jiix\"]) {\n      exportMessage.exports[\"application/vnd.myscript.jiix\"] = JSON.parse(exportMessage.exports[\"application/vnd.myscript.jiix\"].toString()) as TJIIXExport\n    }\n\n    Object.keys(exportMessage.exports)\n      .forEach(key =>\n      {\n        if (this.exportDeferredMap.has(key)) {\n          this.exportDeferredMap.get(key)!.resolve(exportMessage.exports)\n        }\n      })\n    this.event.emitExported(exportMessage.exports)\n  }\n\n  protected manageWaitForIdle(): void\n  {\n    this.waitForIdleDeferred?.resolve()\n    this.event.emitIdle(true)\n  }\n\n  protected manageErrorMessage(errorMessage: TOIMessageEventError): void\n  {\n    this.currentErrorCode = errorMessage.data?.code || errorMessage.code\n    let message = errorMessage.data?.message || errorMessage.message || RecognizerError.UNKNOW\n\n    if (this.currentErrorCode === \"no.activity\") {\n      this.rejectDeferredPending(message)\n      this.event.emitNotif({ message: RecognizerError.NO_ACTIVITY, timeout: Infinity })\n    }\n    else {\n      switch (this.currentErrorCode) {\n        case \"access.not.granted\":\n          message = RecognizerError.WRONG_CREDENTIALS\n          break\n        case \"session.too.old\":\n          message = RecognizerError.TOO_OLD\n          break\n        case \"restore.session.not.found\":\n          message = RecognizerError.NO_SESSION_FOUND\n          break\n      }\n      this.rejectDeferredPending(message)\n      this.event.emitError(new Error(message))\n    }\n  }\n\n  protected manageGestureDetected(gestureMessage: TOIMessageEventGesture): void\n  {\n    this.addStrokeDeferred?.resolve(gestureMessage)\n  }\n\n  protected manageContextlessGesture(gestureMessage: TOIMessageEventContextlessGesture): void\n  {\n    this.contextlessGestureDeferred.get(gestureMessage.strokeId)?.resolve(gestureMessage)\n  }\n\n  protected messageCallback(message: MessageEvent<string>): void\n  {\n    this.currentErrorCode = undefined\n    try {\n      const websocketMessage: TOIMessageReceived = JSON.parse(message.data)\n      if (websocketMessage.type === TOIMessageType.Pong) {\n        return\n      }\n      this.pingCount = 0\n      switch (websocketMessage.type) {\n        case TOIMessageType.HMAC_Challenge:\n          this.manageHMACChallenge(websocketMessage)\n          break\n        case TOIMessageType.Authenticated:\n          this.manageAuthenticated()\n          break\n        case TOIMessageType.SessionDescription:\n          this.manageSessionDescriptionMessage(websocketMessage)\n          break\n        case TOIMessageType.NewPart:\n          this.manageNewPartMessage(websocketMessage)\n          break\n        case TOIMessageType.PartChanged:\n          this.managePartChangeMessage(websocketMessage)\n          break\n        case TOIMessageType.ContentChanged:\n          this.manageContentChangedMessage(websocketMessage)\n          break\n        case TOIMessageType.Exported:\n          this.manageExportMessage(websocketMessage)\n          break\n        case TOIMessageType.GestureDetected:\n          this.manageGestureDetected(websocketMessage)\n          break\n        case TOIMessageType.ContextlessGesture:\n          this.manageContextlessGesture(websocketMessage)\n          break\n        case TOIMessageType.Error:\n          this.manageErrorMessage(websocketMessage)\n          break\n        case TOIMessageType.Idle:\n          this.manageWaitForIdle()\n          break\n        default:\n          this.#logger.warn(\"messageCallback\", `Message type unknow: \"${ websocketMessage }\".`)\n          break\n      }\n    }\n    catch (error) {\n      this.event.emitError(new Error(message.data))\n    }\n  }\n\n  async init(): Promise<void>\n  {\n    if (this.currentErrorCode === \"restore.session.not.found\") {\n      this.currentErrorCode === undefined\n      this.sessionId = undefined\n      this.currentPartId = undefined\n    }\n    this.socket = new WebSocket(this.url)\n    this.clearSocketListener()\n    this.socket.addEventListener(\"open\", this.openCallback.bind(this))\n    this.socket.addEventListener(\"close\", this.closeCallback.bind(this))\n    this.socket.addEventListener(\"message\", this.messageCallback.bind(this))\n    await this.initialized.promise\n    if (this.serverConfiguration.websocket.pingEnabled) {\n      this.pingCount = 0\n      this.initPing()\n    }\n  }\n\n  async send(message: TOIMessageEvent): Promise<void>\n  {\n    if (!this.socket) {\n      return Promise.reject(new Error(\"Recognizer must be initilized\"))\n    }\n\n    switch (this.socket.readyState) {\n      case this.socket.CONNECTING:\n      case this.socket.OPEN:\n        await this.initialized.promise\n        this.#send(message)\n        return Promise.resolve()\n      case this.socket.CLOSING:\n      case this.socket.CLOSED:\n        if (this.serverConfiguration.websocket.autoReconnect) {\n          this.reconnectionCount++\n          if (this.serverConfiguration.websocket.maxRetryCount > this.reconnectionCount) {\n            this.event.emitClearMessage()\n            await this.init()\n            await this.waitForIdle()\n            return this.send(message)\n          }\n          else {\n            return Promise.reject(new Error(\"Unable to send message. The maximum number of connection attempts has been reached.\"))\n          }\n        }\n        else {\n          return Promise.reject(new Error(\"Unable to send message. Connection closed and automatic reconnection disabled\"))\n        }\n        break\n    }\n  }\n\n  protected buildAddStrokesMessage(strokes: OIStroke[], processGestures = true): TOIMessageEvent\n  {\n    return {\n      type: \"addStrokes\",\n      processGestures,\n      strokes: strokes.map(s => s.formatToSend())\n    }\n  }\n  async addStrokes(strokes: OIStroke[], processGestures = true): Promise<TOIMessageEventGesture | undefined>\n  {\n    this.addStrokeDeferred = new DeferredPromise<TOIMessageEventGesture | undefined>()\n    if (strokes.length === 0) {\n      this.addStrokeDeferred.resolve(undefined)\n      return this.addStrokeDeferred?.promise\n    }\n    await this.send(this.buildAddStrokesMessage(strokes, processGestures))\n    return this.addStrokeDeferred?.promise\n  }\n\n  protected buildReplaceStrokesMessage(oldStrokeIds: string[], newStrokes: OIStroke[]): TOIMessageEvent\n  {\n    return {\n      type: \"replaceStrokes\",\n      oldStrokeIds,\n      newStrokes: newStrokes.map(s => s.formatToSend())\n    }\n  }\n  async replaceStrokes(oldStrokeIds: string[], newStrokes: OIStroke[]): Promise<void>\n  {\n    this.replaceStrokeDeferred = new DeferredPromise<void>()\n    if (oldStrokeIds.length === 0) {\n      this.replaceStrokeDeferred.resolve()\n      return this.replaceStrokeDeferred?.promise\n    }\n    await this.send(this.buildReplaceStrokesMessage(oldStrokeIds, newStrokes))\n    return this.replaceStrokeDeferred?.promise\n  }\n\n  protected buildTransformTranslateMessage(strokeIds: string[], tx: number, ty: number): TOIMessageEvent\n  {\n    return {\n      type: \"transform\",\n      transformationType: \"TRANSLATE\",\n      strokeIds,\n      tx,\n      ty\n    }\n  }\n  async transformTranslate(strokeIds: string[], tx: number, ty: number): Promise<void>\n  {\n    this.transformStrokeDeferred = new DeferredPromise<void>()\n    if (strokeIds.length === 0) {\n      this.transformStrokeDeferred.resolve()\n      return this.transformStrokeDeferred?.promise\n    }\n    await this.send(this.buildTransformTranslateMessage(strokeIds, tx, ty))\n    return this.transformStrokeDeferred?.promise\n  }\n\n  protected buildTransformRotateMessage(strokeIds: string[], angle: number, x0: number = 0, y0: number = 0): TOIMessageEvent\n  {\n    return {\n      type: \"transform\",\n      transformationType: \"ROTATE\",\n      strokeIds,\n      angle,\n      x0,\n      y0\n    }\n  }\n  async transformRotate(strokeIds: string[], angle: number, x0: number = 0, y0: number = 0): Promise<void>\n  {\n    this.transformStrokeDeferred = new DeferredPromise<void>()\n    if (strokeIds.length === 0) {\n      this.transformStrokeDeferred.resolve()\n      return this.transformStrokeDeferred?.promise\n    }\n    await this.send(this.buildTransformRotateMessage(strokeIds, angle, x0, y0))\n    return this.transformStrokeDeferred?.promise\n  }\n\n  protected buildTransformScaleMessage(strokeIds: string[], scaleX: number, scaleY: number, x0: number = 0, y0: number = 0): TOIMessageEvent\n  {\n    return {\n      type: \"transform\",\n      transformationType: \"SCALE\",\n      strokeIds,\n      scaleX,\n      scaleY,\n      x0,\n      y0\n    }\n  }\n  async transformScale(strokeIds: string[], scaleX: number, scaleY: number, x0: number = 0, y0: number = 0): Promise<void>\n  {\n    this.transformStrokeDeferred = new DeferredPromise<void>()\n    if (strokeIds.length === 0) {\n      this.transformStrokeDeferred.resolve()\n      return this.transformStrokeDeferred?.promise\n    }\n    await this.send(this.buildTransformScaleMessage(strokeIds, scaleX, scaleY, x0, y0))\n    return this.transformStrokeDeferred?.promise\n  }\n\n  protected buildTransformMatrixMessage(strokeIds: string[], matrix: TMatrixTransform): TOIMessageEvent\n  {\n    return {\n      type: \"transform\",\n      transformationType: \"MATRIX\",\n      strokeIds,\n      ...matrix\n    }\n  }\n  async transformMatrix(strokeIds: string[], matrix: TMatrixTransform): Promise<void>\n  {\n    this.transformStrokeDeferred = new DeferredPromise<void>()\n    if (strokeIds.length === 0) {\n      this.transformStrokeDeferred.resolve()\n      return this.transformStrokeDeferred?.promise\n    }\n    await this.send(this.buildTransformMatrixMessage(strokeIds, matrix))\n    return this.transformStrokeDeferred?.promise\n  }\n\n  protected buildEraseStrokesMessage(strokeIds: string[]): TOIMessageEvent\n  {\n    return {\n      type: \"eraseStrokes\",\n      strokeIds\n    }\n  }\n  async eraseStrokes(strokeIds: string[]): Promise<void>\n  {\n    this.eraseStrokeDeferred = new DeferredPromise<void>()\n    if (strokeIds.length === 0) {\n      this.eraseStrokeDeferred.resolve()\n      return this.eraseStrokeDeferred?.promise\n    }\n    await this.send(this.buildEraseStrokesMessage(strokeIds))\n    return this.eraseStrokeDeferred?.promise\n  }\n\n  async recognizeGesture(stroke: OIStroke): Promise<TOIMessageEventContextlessGesture | undefined>\n  {\n    if (!stroke) {\n      return\n    }\n    this.contextlessGestureDeferred.set(stroke.id, new DeferredPromise<TOIMessageEventContextlessGesture>())\n    const pixelTomm = 25.4 / 96\n    await this.send({\n      type: \"contextlessGesture\",\n      scaleX: pixelTomm,\n      scaleY: pixelTomm,\n      stroke: stroke.formatToSend()\n    })\n    return this.contextlessGestureDeferred.get(stroke.id)!.promise\n  }\n\n  async waitForIdle(): Promise<void>\n  {\n    if (!this.waitForIdleDeferred || this.waitForIdleDeferred.isFullFilled) {\n      this.waitForIdleDeferred = new DeferredPromise<void>()\n    }\n    const message: TOIMessageEvent = {\n      type: \"waitForIdle\",\n    }\n    await this.send(message)\n    return this.waitForIdleDeferred?.promise\n  }\n\n  protected buildUndoRedoChanges(changes: TOIHistoryBackendChanges): TOIMessageEvent[]\n  {\n    const changesMessages: TOIMessageEvent[] = []\n    if (changes.added?.length) {\n      changesMessages.push(this.buildAddStrokesMessage(changes.added, false))\n    }\n    if (changes.erased?.length) {\n      changesMessages.push(this.buildEraseStrokesMessage(changes.erased.map(s => s.id)))\n    }\n    if (changes.replaced?.newStrokes.length) {\n      changesMessages.push(this.buildReplaceStrokesMessage(changes.replaced.oldStrokes.map(s => s.id), changes.replaced.newStrokes))\n    }\n    if (changes.matrix?.strokes.length) {\n      changesMessages.push(this.buildTransformMatrixMessage(changes.matrix.strokes.map(s => s.id), changes.matrix.matrix))\n    }\n    if (changes.translate?.length) {\n      changes.translate.forEach(tr =>\n      {\n        changesMessages.push(this.buildTransformTranslateMessage(tr.strokes.map(s => s.id), tr.tx, tr.ty))\n      })\n    }\n    if (changes.rotate?.length) {\n      changes.rotate.forEach(tr =>\n      {\n        changesMessages.push(this.buildTransformRotateMessage(tr.strokes.map(s => s.id), tr.angle, tr.center.x, tr.center.y))\n      })\n    }\n    if (changes.scale?.length) {\n      changes.scale.forEach(tr =>\n      {\n        changesMessages.push(this.buildTransformScaleMessage(tr.strokes.map(s => s.id), tr.scaleX, tr.scaleY, tr.origin.x, tr.origin.y))\n      })\n    }\n    return changesMessages\n  }\n\n  async undo(actions: TOIHistoryBackendChanges): Promise<void>\n  {\n    const changes = this.buildUndoRedoChanges(actions)\n    if (changes.length === 0) {\n      return\n    }\n    this.undoDeferred = new DeferredPromise<void>()\n    const message: TOIMessageEvent = {\n      type: \"undo\",\n      changes\n    }\n    await this.send(message)\n    return this.undoDeferred?.promise\n  }\n\n  async redo(actions: TOIHistoryBackendChanges): Promise<void>\n  {\n    const changes = this.buildUndoRedoChanges(actions)\n    if (changes.length === 0) {\n      return\n    }\n    this.redoDeferred = new DeferredPromise<void>()\n\n    const message: TOIMessageEvent = {\n      type: \"redo\",\n      changes\n    }\n    await this.send(message)\n    return this.redoDeferred?.promise\n  }\n\n  async export(requestedMimeTypes?: string[]): Promise<TExport>\n  {\n    const mimeTypes: string[] = requestedMimeTypes || this.mimeTypes.slice()\n    await Promise.all(mimeTypes.map(mt => this.exportDeferredMap.get(mt)?.promise))\n    mimeTypes.forEach(mt =>\n    {\n      this.exportDeferredMap.set(mt, new DeferredPromise<TExport>())\n    })\n\n    const message: TOIMessageEvent = {\n      type: \"export\",\n      partId: this.currentPartId,\n      mimeTypes\n    }\n    await this.send(message)\n    const exports = await Promise.all(mimeTypes.map(mt => this.exportDeferredMap.get(mt)!.promise))\n    return Object.assign({}, ...exports)\n  }\n\n  async clear(): Promise<void>\n  {\n    this.clearDeferred = new DeferredPromise<void>()\n    await this.send({\n      type: \"clear\"\n    })\n    return this.clearDeferred?.promise\n  }\n\n  async close(code: number, reason: string): Promise<void>\n  {\n    this.closeDeferred = new DeferredPromise<void>()\n    if (this.socket.readyState === this.socket.OPEN || this.socket.readyState === this.socket.CONNECTING) {\n      this.socket.close(code, reason)\n    }\n    else {\n      this.closeDeferred.resolve()\n    }\n    return this.closeDeferred.promise\n  }\n\n  async destroy(): Promise<void>\n  {\n    this.resetAllDeferred()\n    if (this.socket) {\n      await this.close(1000, \"Recognizer destroyed\")\n    }\n  }\n}\n","import { TConverstionState, TDiagramConfiguration, TExportConfiguration, TMathConfiguration, TRawContentConfiguration, TRecognitionConfiguration, TServerConfiguration, TTextConfiguration } from \"../configuration\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { Model, TExport, TJIIXExport } from \"../model\"\nimport { TStrokeGroup, TStrokeGroupToSend } from \"../primitive\"\nimport { StyleHelper, TPenStyle } from \"../style\"\nimport { computeHmac, isVersionSuperiorOrEqual } from \"../utils\"\nimport { RecognizerError } from \"./RecognizerError\"\n\ntype ApiError = {\n  code?: string\n  message: string\n}\n\n/**\n * @group Recognizer\n */\nexport type TRestPostConfiguration = {\n  lang: string,\n  diagram?: TDiagramConfiguration,\n  math?: TMathConfiguration,\n  \"raw-content\"?: TRawContentConfiguration,\n  text?: TTextConfiguration,\n  export: TExportConfiguration\n}\n\n/**\n * @group Recognizer\n */\nexport type TRestPostData = {\n  configuration: TRestPostConfiguration,\n  xDPI: number,\n  yDPI: number,\n  contentType: string,\n  conversionState?: TConverstionState\n  height: number,\n  width: number,\n  strokeGroups: TStrokeGroupToSend[]\n}\n\n/**\n * @group Recognizer\n */\nexport class RestRecognizer\n{\n  #logger = LoggerManager.getLogger(LoggerClass.RECOGNIZER)\n\n  protected serverConfiguration: TServerConfiguration\n  protected recognitionConfiguration: TRecognitionConfiguration\n\n  constructor(serverConfig: TServerConfiguration, recognitionConfig: TRecognitionConfiguration)\n  {\n    this.#logger.info(\"constructor\", { serverConfig, recognitionConfig })\n    this.serverConfiguration = serverConfig\n    this.recognitionConfiguration = recognitionConfig\n  }\n\n  get url()\n  {\n    return `${ this.serverConfiguration.scheme }://${ this.serverConfiguration.host }/api/v4.0/iink/batch`\n  }\n\n  get postConfig(): TRestPostConfiguration\n  {\n    switch (this.recognitionConfiguration.type) {\n      case \"DIAGRAM\":\n        return {\n          lang: this.recognitionConfiguration.lang,\n          diagram: this.recognitionConfiguration.diagram,\n          export: this.recognitionConfiguration.export\n        }\n      case \"MATH\":\n        return {\n          lang: this.recognitionConfiguration.lang,\n          math: this.recognitionConfiguration.math,\n          export: this.recognitionConfiguration.export\n        }\n      case \"Raw Content\":\n        return {\n          lang: this.recognitionConfiguration.lang,\n          \"raw-content\": this.recognitionConfiguration[\"raw-content\"],\n          export: this.recognitionConfiguration.export\n        }\n      case \"TEXT\":\n        return {\n          lang: this.recognitionConfiguration.lang,\n          text: this.recognitionConfiguration.text,\n          export: this.recognitionConfiguration.export\n        }\n      default:\n        throw new Error(`get postConfig error Recognition type unkow \"${ this.recognitionConfiguration.type }\"`)\n        break\n    }\n  }\n\n  protected buildData(model: Model): TRestPostData\n  {\n    this.#logger.info(\"buildData\", { model })\n    const isPenStyleEqual = (ps1: TPenStyle, ps2: TPenStyle) =>\n    {\n      return ps1 && ps2 && ps1[\"-myscript-pen-fill-color\"] === ps2[\"-myscript-pen-fill-color\"] &&\n        ps1[\"-myscript-pen-fill-style\"] === ps2[\"-myscript-pen-fill-style\"] &&\n        ps1[\"-myscript-pen-width\"] === ps2[\"-myscript-pen-width\"] &&\n        ps1.color === ps2.color &&\n        ps1.width === ps2.width\n    }\n\n    const strokeGroupByPenStyle: TStrokeGroup[] = []\n    model.symbols.forEach((s) =>\n    {\n      const groupIndex = strokeGroupByPenStyle.findIndex(sg => isPenStyleEqual(sg.penStyle, s.style))\n      if (groupIndex > -1) {\n        strokeGroupByPenStyle[groupIndex].strokes.push(s)\n      } else {\n        strokeGroupByPenStyle.push({\n          penStyle: s.style,\n          strokes: [s]\n        })\n      }\n    })\n\n    const strokeGroupsToSend: TStrokeGroupToSend[] = []\n    strokeGroupByPenStyle.forEach((group: TStrokeGroup) =>\n    {\n      const newPenStyle = JSON.stringify(group.penStyle) === \"{}\" ? undefined : StyleHelper.penStyleToCSS(group.penStyle as TPenStyle)\n      const newGroup = {\n        penStyle: newPenStyle,\n        strokes: group.strokes.map(s => s.formatToSend())\n      }\n      strokeGroupsToSend.push(newGroup)\n    })\n\n    const contentType: string = this.recognitionConfiguration.type === \"Raw Content\" ?\n      \"Raw Content\" :\n      this.recognitionConfiguration.type.charAt(0).toUpperCase() + this.recognitionConfiguration.type.slice(1).toLowerCase()\n\n    const data = {\n      configuration: this.postConfig,\n      xDPI: 96,\n      yDPI: 96,\n      contentType,\n      height: model.height,\n      width: model.width,\n      strokeGroups: strokeGroupsToSend\n    }\n    this.#logger.debug(\"buildData\", { data })\n    return data\n  }\n\n  protected async post(data: unknown, mimeType: string): Promise<unknown>\n  {\n    this.#logger.info(\"post\", { data, mimeType })\n    const headers = new Headers()\n    headers.append(\"Accept\", \"application/json,\" + mimeType)\n    headers.append(\"applicationKey\", this.serverConfiguration.applicationKey)\n    try {\n      const hmac = await computeHmac(JSON.stringify(data), this.serverConfiguration.applicationKey, this.serverConfiguration.hmacKey)\n      headers.append(\"hmac\", hmac)\n    } catch (error) {\n      this.#logger.error(\"post.computeHmac\", error)\n    }\n    headers.append(\"Content-Type\", \"application/json\")\n\n    if (isVersionSuperiorOrEqual(this.serverConfiguration.version, \"2.0.4\")) {\n      headers.append(\"myscript-client-name\", \"iink-ts\")\n      headers.append(\"myscript-client-version\", \"2.0.1\")\n    }\n\n    const reqInit: RequestInit = {\n      method: \"POST\",\n      headers,\n      body: JSON.stringify(data)\n    }\n    const request = new Request(this.url, reqInit)\n    const response: Response = await fetch(request)\n    if (response.ok) {\n      const contentType = response.headers.get(\"content-type\")\n      let result: unknown\n      switch (contentType) {\n        case \"application/vnd.openxmlformats-officedocument.presentationml.presentation\":\n        case \"image/png\":\n        case \"image/jpeg\":\n          result = await response.blob()\n          break\n        case \"application/json\":\n          result = await response.json()\n          break\n        case \"application/vnd.myscript.jiix\":\n          result = await response.clone().json().catch(async () => await response.text())\n          break\n        default:\n          result = await response.text()\n          break\n      }\n      this.#logger.debug(\"post\", { result })\n      return result\n    } else {\n      const err = await response.json() as ApiError\n      this.#logger.error(\"post\", { err })\n      throw err\n    }\n  }\n\n  protected async tryFetch(data: TRestPostData, mimeType: string): Promise<TExport | never>\n  {\n    this.#logger.debug(\"tryFetch\", { data, mimeType })\n    return this.post(data, mimeType)\n      .then((res) =>\n      {\n        const exports: TExport = {}\n        exports[mimeType] = res as TJIIXExport | string | Blob\n        this.#logger.debug(\"tryFetch\", { exports })\n        return exports\n      })\n      .catch((err) =>\n      {\n        this.#logger.error(\"tryFetch\", { data, mimeType, err })\n        let message = err.message || RecognizerError.UNKNOW\n        if (!err.code) {\n          message = RecognizerError.CANT_ESTABLISH\n        } else if (err.code === \"access.not.granted\") {\n          message = RecognizerError.WRONG_CREDENTIALS\n        }\n        const error = new Error(message)\n        throw error\n      })\n  }\n\n  protected getMimeTypes(requestedMimeTypes?: string[]): string[]\n  {\n    this.#logger.info(\"getMimeTypes\", { requestedMimeTypes })\n    let mimeTypes: string[] = requestedMimeTypes || []\n    if (!mimeTypes.length) {\n      switch (this.recognitionConfiguration.type) {\n        case \"DIAGRAM\":\n          mimeTypes = this.recognitionConfiguration.diagram.mimeTypes\n          break\n        case \"MATH\":\n          mimeTypes = this.recognitionConfiguration.math.mimeTypes\n          break\n        case \"Raw Content\":\n          mimeTypes = [\"application/vnd.myscript.jiix\"]\n          break\n        case \"TEXT\":\n          mimeTypes = this.recognitionConfiguration.text.mimeTypes\n          break\n        default:\n          throw new Error(`Recognition type \"${ this.recognitionConfiguration.type }\" is unknown.\\n Possible types are:\\n -DIAGRAM\\n -MATH\\n -Raw Content\\n -TEXT`)\n          break\n      }\n    }\n    return mimeTypes\n  }\n\n  async convert(model: Model, conversionState?: TConverstionState, requestedMimeTypes?: string[]): Promise<Model>\n  {\n    this.#logger.info(\"convert\", { model, conversionState, requestedMimeTypes })\n    const myModel = model.clone()\n    const mimeTypes = this.getMimeTypes(requestedMimeTypes)\n    const dataToConcert = this.buildData(myModel)\n    dataToConcert.conversionState = conversionState\n    const promises = mimeTypes.map(mt => this.tryFetch(dataToConcert, mt))\n    const exports: TExport[] = await Promise.all(promises)\n    exports.forEach(e =>\n    {\n      myModel.mergeConvert(e)\n    })\n    this.#logger.debug(\"convert\", { model: myModel })\n    return myModel\n  }\n\n  async export(model: Model, requestedMimeTypes?: string[]): Promise<Model>\n  {\n    this.#logger.info(\"export\", { model, requestedMimeTypes })\n    const myModel = model.clone()\n    if (myModel.symbols.length === 0) {\n      return Promise.resolve(myModel)\n    }\n    const mimeTypes = this.getMimeTypes(requestedMimeTypes)\n    if (!mimeTypes.length) {\n      this.#logger.error(\"export\", { model, requestedMimeTypes, \"Export failed, no mimeTypes define in recognition configuration\": String })\n      return Promise.reject(new Error(\"Export failed, no mimeTypes define in recognition configuration\"))\n    }\n    const mimeTypesRequiringExport: string[] = mimeTypes.filter(m => !myModel.exports || !myModel.exports[m])\n    const data = this.buildData(model)\n    const exports: TExport[] = await Promise.all(mimeTypesRequiringExport.map(mimeType => this.tryFetch(data, mimeType)))\n    exports.forEach(e =>\n    {\n      myModel.mergeExport(e)\n    })\n    this.#logger.debug(\"export\", { model: myModel })\n    return myModel\n  }\n\n  async resize(model: Model): Promise<Model>\n  {\n    this.#logger.info(\"resize\", { model })\n    return this.export(model)\n  }\n\n}\n","import { TConverstionState, TRecognitionConfiguration, TServerConfiguration } from \"../configuration\"\nimport { InternalEvent } from \"../event\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { Model, TExport, TJIIXExport } from \"../model\"\nimport { Stroke } from \"../primitive\"\nimport { StyleHelper, TPenStyle, TTheme } from \"../style\"\nimport { TUndoRedoContext } from \"../history\"\nimport { DeferredPromise, PartialDeep, computeHmac, isVersionSuperiorOrEqual } from \"../utils\"\nimport\n{\n  TWSMessageEvent,\n  TWSMessageEventContentChange,\n  TWSMessageEventError,\n  TWSMessageEventExport,\n  TWSMessageEventHMACChallenge,\n  TWSMessageEventPartChange,\n  TWSMessageEventSVGPatch\n} from \"./WSRecognizerMessage\"\nimport { RecognizerError } from \"./RecognizerError\"\n\n/**\n * A websocket dialog have this sequence :\n * --------------------------- Client --------------------------------------------------- Server ----------------------------------\n * init: send newContentPackage or restoreIInkSession           ==================>\n *                                                              <==================       ack\n * answer ack:\n *  send the hmac (if enable)                                   ==================>\n *  send the configuration                                      ==================>\n *                                                              <==================       contentPackageDescription\n * answer contentPackageDescription:\n *  send newContentPart or openContentPart                      ==================>\n *                                                              <==================        partChanged\n *                                                              <==================        contentChanged\n *                                                              <==================        newPart\n *                                                              <==================        svgPatch\n *\n * setPenStyle (send the parameters)                            ==================>\n * setTheme (send the parameters)                               ==================>\n * setPenStyleClasses (send the parameters)                     ==================>\n *                                                              <==================        svgPatch\n * addStrokes (send the strokes ) ============>\n *                                                              <==================        update\n */\n\n/**\n * @group Recognizer\n */\nexport class WSRecognizer\n{\n  #logger = LoggerManager.getLogger(LoggerClass.RECOGNIZER)\n  protected serverConfiguration: TServerConfiguration\n  protected recognitionConfiguration: TRecognitionConfiguration\n\n  protected socket!: WebSocket\n  protected pingCount = 0\n  protected reconnectionCount = 0\n  protected viewSizeHeight!: number\n  protected viewSizeWidth!: number\n  protected sessionId?: string\n  // contentPartCount = 0\n  currentPartId?: string\n  protected currentErrorCode?: string | number\n\n  protected penStyle?: TPenStyle\n  protected penStyleClasses?: string\n  protected theme?: TTheme\n\n  protected connected?: DeferredPromise<void>\n  protected initialized?: DeferredPromise<void>\n  protected ackDeferred?: DeferredPromise<void>\n  protected addStrokeDeferred?: DeferredPromise<TExport>\n  protected exportDeferred?: DeferredPromise<TExport>\n  protected convertDeferred?: DeferredPromise<TExport>\n  protected importDeferred?: DeferredPromise<TExport>\n  protected resizeDeferred?: DeferredPromise<void>\n  protected undoDeferred?: DeferredPromise<TExport>\n  protected redoDeferred?: DeferredPromise<TExport>\n  protected clearDeferred?: DeferredPromise<TExport>\n  protected importPointEventsDeferred?: DeferredPromise<TExport>\n  protected waitForIdleDeferred?: DeferredPromise<void>\n\n  url: string\n\n  constructor(serverConfig: TServerConfiguration, recognitionConfig: TRecognitionConfiguration)\n  {\n    this.serverConfiguration = serverConfig\n    this.recognitionConfiguration = recognitionConfig\n    const scheme = (this.serverConfiguration.scheme === \"https\") ? \"wss\" : \"ws\"\n    this.url = `${ scheme }://${ this.serverConfiguration.host }/api/v4.0/iink/document?applicationKey=${ this.serverConfiguration.applicationKey }`\n    this.#logger.info(\"constructor\", { serverConfig, recognitionConfig, url: this.url })\n  }\n\n  get mimeTypes(): string[]\n  {\n    switch (this.recognitionConfiguration.type.toLocaleLowerCase()) {\n      case \"text\":\n        return this.recognitionConfiguration.text.mimeTypes\n      case \"math\":\n        return this.recognitionConfiguration.math.mimeTypes\n      default:\n        throw new Error(`Unauthorized recognition type: \"${ this.recognitionConfiguration.type }\"`)\n    }\n  }\n\n  get internalEvent(): InternalEvent\n  {\n    return InternalEvent.getInstance()\n  }\n\n  protected infinitePing(): void\n  {\n    this.pingCount++\n    if (this.serverConfiguration.websocket.maxPingLostCount < this.pingCount) {\n      this.socket.close(1000, \"MAXIMUM_PING_REACHED\")\n    } else if (this.socket.readyState <= 1) {\n      setTimeout(() =>\n      {\n        if (this.socket.readyState <= 1) {\n          this.socket.send(JSON.stringify({ type: \"ping\" }))\n          this.infinitePing()\n        }\n      }, this.serverConfiguration.websocket.pingDelay)\n    }\n  }\n\n  protected openCallback(): void\n  {\n    this.connected?.resolve()\n    const params: TWSMessageEvent = {\n      type: this.sessionId ? \"restoreIInkSession\" : \"newContentPackage\",\n      iinkSessionId: this.sessionId,\n      applicationKey: this.serverConfiguration.applicationKey,\n      xDpi: 96,\n      yDpi: 96,\n      viewSizeHeight: this.viewSizeHeight,\n      viewSizeWidth: this.viewSizeWidth\n    }\n    if (isVersionSuperiorOrEqual(this.serverConfiguration.version, \"2.0.4\")) {\n      params[\"myscript-client-name\"] = \"iink-ts\"\n      params[\"myscript-client-version\"] = \"2.0.1\"\n    }\n    this.send(params)\n  }\n\n  protected rejectDeferredPending(error: Error): void\n  {\n    if (this.connected?.isPending) {\n      this.connected?.reject(error)\n    }\n    if (this.initialized?.isPending) {\n      this.initialized?.reject(error)\n    }\n    if (this.addStrokeDeferred?.isPending) {\n      this.addStrokeDeferred?.reject(error)\n    }\n    if (this.exportDeferred?.isPending) {\n      this.exportDeferred?.reject(error)\n    }\n    if (this.convertDeferred?.isPending) {\n      this.convertDeferred?.reject(error)\n    }\n    if (this.importDeferred?.isPending) {\n      this.importDeferred?.reject(error)\n    }\n    if (this.resizeDeferred?.isPending) {\n      this.resizeDeferred?.reject(error)\n    }\n    if (this.undoDeferred?.isPending) {\n      this.undoDeferred?.reject(error)\n    }\n    if (this.redoDeferred?.isPending) {\n      this.redoDeferred?.reject(error)\n    }\n    if (this.clearDeferred?.isPending) {\n      this.clearDeferred.reject(error)\n    }\n    if (this.waitForIdleDeferred?.isPending) {\n      this.waitForIdleDeferred.reject(error)\n    }\n  }\n\n  protected closeCallback(evt: CloseEvent): void\n  {\n    let message = \"\"\n    if (!this.currentErrorCode) {\n      switch (evt.code) {\n        case 1000:\n          // Normal Closure\n          break\n        case 1001:\n          message = RecognizerError.GOING_AWAY\n          break\n        case 1002:\n          message = RecognizerError.PROTOCOL_ERROR\n          break\n        case 1003:\n          message = RecognizerError.UNSUPPORTED_DATA\n          break\n        case 1006:\n          message = RecognizerError.ABNORMAL_CLOSURE\n          break\n        case 1007:\n          message = RecognizerError.INVALID_FRAME_PAYLOAD\n          break\n        case 1008:\n          message = RecognizerError.POLICY_VIOLATION\n          break\n        case 1009:\n          message = RecognizerError.MESSAGE_TOO_BIG\n          break\n        case 1011:\n          message = RecognizerError.INTERNAL_ERROR\n          break\n        case 1012:\n          message = RecognizerError.SERVICE_RESTART\n          break\n        case 1013:\n          message = RecognizerError.TRY_AGAIN\n          break\n        case 1014:\n          message = RecognizerError.BAD_GATEWAY\n          break\n        case 1015:\n          message = RecognizerError.TLS_HANDSHAKE\n          break\n        default:\n          this.#logger.warn(\"closeCallback\", \"unknow CloseEvent.code\", { evt })\n          message = RecognizerError.CANT_ESTABLISH\n          break\n      }\n    }\n    const error = new Error(message || evt.reason)\n\n    this.rejectDeferredPending(error)\n\n    if (!this.currentErrorCode && evt.code !== 1000) {\n      this.internalEvent.emitError(error)\n    }\n  }\n\n  protected async manageAckMessage(websocketMessage: TWSMessageEvent): Promise<void>\n  {\n    this.#logger.info(\"manageAckMessage\", { websocketMessage })\n    const hmacChallengeMessage = websocketMessage as TWSMessageEventHMACChallenge\n    if (hmacChallengeMessage.hmacChallenge) {\n      this.send({\n        type: \"hmac\",\n        hmac: await computeHmac(hmacChallengeMessage.hmacChallenge, this.serverConfiguration.applicationKey, this.serverConfiguration.hmacKey)\n      })\n    }\n    if (hmacChallengeMessage.iinkSessionId) {\n      this.sessionId = hmacChallengeMessage.iinkSessionId\n    }\n\n    const recognitionConfig = structuredClone(this.recognitionConfiguration) as PartialDeep<TRecognitionConfiguration>\n    if (!isVersionSuperiorOrEqual(this.serverConfiguration.version, \"2.3.0\")) {\n      delete recognitionConfig.convert\n    }\n    this.send({ ...recognitionConfig, type: \"configuration\" })\n    this.ackDeferred?.resolve()\n  }\n\n  protected async manageContentPackageDescriptionMessage(): Promise<void>\n  {\n    this.reconnectionCount = 0\n    await this.ackDeferred?.promise\n    this.#logger.info(\"manageContentPackageDescriptionMessage\")\n    if (this.currentPartId) {\n      this.send({ type: \"openContentPart\", id: this.currentPartId, mimeTypes: this.mimeTypes })\n    }\n    else {\n      this.send({ type: \"newContentPart\", contentType: this.recognitionConfiguration.type, mimeTypes: this.mimeTypes })\n    }\n  }\n\n  protected managePartChangeMessage(websocketMessage: TWSMessageEvent): void\n  {\n    this.#logger.info(\"managePartChangeMessage\", { websocketMessage })\n    const partChangeMessage = websocketMessage as TWSMessageEventPartChange\n    this.currentPartId = partChangeMessage.partId\n    this.initialized?.resolve()\n  }\n\n  protected manageExportMessage(websocketMessage: TWSMessageEvent): void\n  {\n    this.#logger.info(\"manageExportMessage\", { websocketMessage })\n    const exportMessage = websocketMessage as TWSMessageEventExport\n    if (exportMessage.exports[\"application/vnd.myscript.jiix\"]) {\n      exportMessage.exports[\"application/vnd.myscript.jiix\"] = JSON.parse(exportMessage.exports[\"application/vnd.myscript.jiix\"].toString()) as TJIIXExport\n    }\n    this.initialized?.resolve()\n    this.addStrokeDeferred?.resolve(exportMessage.exports)\n    this.exportDeferred?.resolve(exportMessage.exports)\n    this.convertDeferred?.resolve(exportMessage.exports)\n    this.importDeferred?.resolve(exportMessage.exports)\n    this.undoDeferred?.resolve(exportMessage.exports)\n    this.redoDeferred?.resolve(exportMessage.exports)\n    this.clearDeferred?.resolve(exportMessage.exports)\n    this.importPointEventsDeferred?.resolve(exportMessage.exports)\n    this.internalEvent.emitExported(exportMessage.exports)\n  }\n\n  protected async manageWaitForIdle(): Promise<void>\n  {\n    this.internalEvent.emitIdle(true)\n    this.waitForIdleDeferred?.resolve()\n  }\n\n  protected manageErrorMessage(websocketMessage: TWSMessageEvent): void\n  {\n    const err = websocketMessage as TWSMessageEventError\n    this.currentErrorCode = err.data?.code || err.code\n    let message = err.data?.message || err.message || RecognizerError.UNKNOW\n\n    switch (this.currentErrorCode) {\n      case \"no.activity\":\n        message = RecognizerError.NO_ACTIVITY\n        break\n      case \"access.not.granted\":\n        message = RecognizerError.WRONG_CREDENTIALS\n        break\n      case \"session.too.old\":\n        message = RecognizerError.TOO_OLD\n        break\n    }\n    const error = new Error(message)\n    this.rejectDeferredPending(error)\n    this.internalEvent.emitError(error)\n  }\n\n  protected manageContentChangeMessage(websocketMessage: TWSMessageEvent): void\n  {\n    this.#logger.info(\"manageContentChangeMessage\", { websocketMessage })\n    const contentChangeMessage = websocketMessage as TWSMessageEventContentChange\n    const context: TUndoRedoContext = {\n      canRedo: contentChangeMessage.canRedo,\n      canUndo: contentChangeMessage.canUndo,\n      empty: contentChangeMessage.empty,\n      stackIndex: contentChangeMessage.undoStackIndex,\n      possibleUndoCount: contentChangeMessage.possibleUndoCount,\n    }\n    this.internalEvent.emitContextChange(context)\n  }\n\n  protected manageSVGPatchMessage(websocketMessage: TWSMessageEvent): void\n  {\n    this.#logger.info(\"manageSVGPatchMessage\", { websocketMessage })\n    this.resizeDeferred?.resolve()\n    const svgPatchMessage = websocketMessage as TWSMessageEventSVGPatch\n    this.internalEvent.emitSVGPatch(svgPatchMessage)\n  }\n\n  protected messageCallback(message: MessageEvent<string>): void\n  {\n    this.#logger.debug(\"messageCallback\", { message })\n    this.currentErrorCode = undefined\n    const websocketMessage: TWSMessageEvent = JSON.parse(message.data)\n    if (websocketMessage.type !== \"pong\") {\n      this.pingCount = 0\n      switch (websocketMessage.type) {\n        case \"ack\":\n          this.manageAckMessage(websocketMessage)\n          break\n        case \"contentPackageDescription\":\n          this.manageContentPackageDescriptionMessage()\n          break\n        case \"partChanged\":\n          this.managePartChangeMessage(websocketMessage)\n          break\n        case \"newPart\":\n          this.initialized?.resolve()\n          break\n        case \"contentChanged\":\n          this.manageContentChangeMessage(websocketMessage)\n          break\n        case \"exported\":\n          this.manageExportMessage(websocketMessage)\n          break\n        case \"svgPatch\":\n          this.manageSVGPatchMessage(websocketMessage)\n          break\n        case \"error\":\n          this.manageErrorMessage(websocketMessage)\n          break\n        case \"idle\":\n          this.manageWaitForIdle()\n          break\n        default:\n          this.#logger.warn(\"messageCallback\", `Message type unknow: \"${ websocketMessage.type }\".`)\n      }\n    }\n  }\n\n  async init(height: number, width: number): Promise<void>\n  {\n    try {\n      this.#logger.info(\"init\", { height, width })\n      this.destroy()\n      this.connected = new DeferredPromise<void>()\n      this.initialized = new DeferredPromise<void>()\n      this.ackDeferred = new DeferredPromise<void>()\n      this.viewSizeHeight = height\n      this.viewSizeWidth = width\n      this.pingCount = 0\n      this.socket = new WebSocket(this.url)\n\n      if (this.serverConfiguration.websocket.pingEnabled) {\n        this.infinitePing()\n      }\n\n      this.socket.addEventListener(\"open\", this.openCallback.bind(this))\n      this.socket.addEventListener(\"close\", this.closeCallback.bind(this))\n      this.socket.addEventListener(\"message\", this.messageCallback.bind(this))\n\n      return this.initialized.promise\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    } catch (err: any) {\n      const error = new Error(RecognizerError.CANT_ESTABLISH)\n      this.internalEvent.emitError(error)\n      this.initialized?.reject(error)\n      return this.initialized?.promise\n    }\n  }\n\n  async send(message: TWSMessageEvent): Promise<void>\n  {\n    if (!this.connected) {\n      return Promise.reject(new Error(\"Recognizer must be initilized\"))\n    }\n    await this.connected.promise\n    if (this.socket.readyState === this.socket.OPEN) {\n      this.#logger.debug(\"send\", { message })\n      this.socket.send(JSON.stringify(message))\n      return Promise.resolve()\n    } else {\n      if (this.socket.readyState != this.socket.CONNECTING && this.serverConfiguration.websocket.autoReconnect) {\n        this.reconnectionCount++\n        if (this.serverConfiguration.websocket.maxRetryCount >= this.reconnectionCount) {\n          this.#logger.debug(\"send\", `try to reconnect number: ${ this.reconnectionCount }.`)\n          this.internalEvent.emitClearMessage()\n          await this.init(this.viewSizeHeight, this.viewSizeWidth)\n          await this.setPenStyle(this.penStyle as TPenStyle)\n          await this.setPenStyleClasses(this.penStyleClasses as string)\n          await this.setTheme(this.theme as TTheme)\n          return this.send(message)\n        }\n        else {\n          return Promise.reject(new Error(\"Unable to send message. The maximum number of connection attempts has been reached.\"))\n        }\n      }\n    }\n  }\n\n  async addStrokes(strokes: Stroke[]): Promise<TExport>\n  {\n    this.#logger.info(\"addStrokes\", { strokes })\n    await this.initialized?.promise\n    this.addStrokeDeferred = new DeferredPromise<TExport>()\n    if (strokes.length === 0) {\n      this.addStrokeDeferred.resolve({} as TExport)\n    }\n    else {\n      await this.send({\n        type: \"addStrokes\",\n        strokes: strokes.map(s => s.formatToSend())\n      })\n    }\n    return this.addStrokeDeferred?.promise\n  }\n\n  async setPenStyle(penStyle: TPenStyle): Promise<void>\n  {\n    this.#logger.info(\"setPenStyle\", { penStyle })\n    await this.initialized?.promise\n    this.penStyle = penStyle\n    const message: TWSMessageEvent = {\n      type: \"setPenStyle\",\n      style: StyleHelper.penStyleToCSS(penStyle)\n    }\n    return this.send(message)\n  }\n\n  async setPenStyleClasses(penStyleClasses: string): Promise<void>\n  {\n    await this.initialized?.promise\n    this.penStyleClasses = penStyleClasses\n    this.#logger.info(\"setPenStyleClasses\", { penStyleClasses })\n    const message: TWSMessageEvent = {\n      type: \"setPenStyleClasses\",\n      styleClasses: penStyleClasses\n    }\n    return this.send(message)\n  }\n\n  async setTheme(theme: TTheme): Promise<void>\n  {\n    this.#logger.info(\"setTheme\", { theme })\n    await this.initialized?.promise\n    this.theme = theme\n    const message: TWSMessageEvent = {\n      type: \"setTheme\",\n      theme: StyleHelper.themeToCSS(theme)\n    }\n    return this.send(message)\n  }\n\n  async export(model: Model, requestedMimeTypes?: string[]): Promise<Model>\n  {\n    this.#logger.info(\"export\", { model, requestedMimeTypes })\n    await this.initialized?.promise\n    this.exportDeferred = new DeferredPromise<TExport>()\n    const localModel = model.clone()\n    let mimeTypes: string[] = requestedMimeTypes || []\n    if (!mimeTypes.length) {\n      switch (this.recognitionConfiguration.type) {\n        case \"DIAGRAM\":\n          mimeTypes = this.recognitionConfiguration.diagram.mimeTypes\n          break\n        case \"MATH\":\n          mimeTypes = this.recognitionConfiguration.math.mimeTypes\n          break\n        case \"Raw Content\":\n          mimeTypes = [\"application/vnd.myscript.jiix\"]\n          break\n        case \"TEXT\":\n          mimeTypes = this.recognitionConfiguration.text.mimeTypes\n          break\n        default:\n          throw new Error(`Recognition type \"${ this.recognitionConfiguration.type }\" is unknown.\\n Possible types are:\\n -DIAGRAM\\n -MATH\\n -Raw Content\\n -TEXT`)\n      }\n    }\n\n    if (!mimeTypes.length) {\n      return Promise.reject(new Error(`Export failed, no mimeTypes define in recognition ${ this.recognitionConfiguration.type } configuration`))\n    }\n\n    const message: TWSMessageEvent = {\n      type: \"export\",\n      partId: this.currentPartId,\n      mimeTypes\n    }\n    await this.send(message)\n    const exports: TExport = await this.exportDeferred?.promise\n    localModel.updatePositionReceived()\n    localModel.mergeExport(exports)\n    this.#logger.debug(\"export\", { model: localModel })\n    return localModel\n  }\n\n  async import(model: Model, data: Blob, mimeType?: string): Promise<Model>\n  {\n    this.#logger.info(\"import\", { data, mimeType })\n    await this.initialized?.promise\n    const localModel = model.clone()\n    const chunkSize = this.serverConfiguration.websocket.fileChunkSize\n    const importFileId = Math.random().toString(10).substring(2, 6)\n    this.importDeferred = new DeferredPromise<TExport>()\n    const readBlob = (blob: Blob): Promise<string | never> =>\n    {\n      const fileReader = new FileReader()\n      return new Promise((resolve, reject) =>\n      {\n        fileReader.onloadend = (ev) => resolve(ev.target?.result as string)\n        fileReader.onerror = () => reject()\n        fileReader.readAsText(blob)\n      })\n    }\n\n    const importFileMessage: TWSMessageEvent = {\n      type: \"importFile\",\n      importFileId,\n      mimeType\n    }\n    await this.send(importFileMessage)\n    for (let i = 0; i < data.size; i += chunkSize) {\n      const blobPart = data.slice(i, i + chunkSize, data.type)\n      const partFileString = await readBlob(blobPart)\n      const fileChuckMessage: TWSMessageEvent = {\n        type: \"fileChunk\",\n        importFileId,\n        data: partFileString,\n        lastChunk: i + chunkSize > data.size\n      }\n      await this.send(fileChuckMessage)\n    }\n    const exports = await this.importDeferred?.promise\n    this.importDeferred = undefined\n    localModel.mergeExport(exports)\n    return localModel\n  }\n\n  async resize(model: Model): Promise<Model>\n  {\n    this.#logger.info(\"resize\", { model })\n    await this.initialized?.promise\n    this.resizeDeferred = new DeferredPromise<void>()\n    const localModel = model.clone()\n    this.viewSizeHeight = localModel.height\n    this.viewSizeWidth = localModel.width\n    const message: TWSMessageEvent = {\n      type: \"changeViewSize\",\n      height: this.viewSizeHeight,\n      width: this.viewSizeWidth,\n    }\n    await this.send(message)\n    await this.resizeDeferred?.promise\n    return localModel\n  }\n\n  async importPointEvents(strokes: Stroke[]): Promise<TExport>\n  {\n    this.#logger.info(\"importPointsEvents\", { strokes })\n    await this.initialized?.promise\n    this.importPointEventsDeferred = new DeferredPromise<TExport>()\n    const message: TWSMessageEvent = {\n      type: \"pointerEvents\",\n      events: strokes.map(s => s.formatToSend())\n    }\n    this.send(message)\n    const exportPoints = await this.importPointEventsDeferred?.promise\n    this.importPointEventsDeferred = undefined\n    this.#logger.debug(\"importPointEvents\", { exportPoints })\n    return exportPoints as TExport\n  }\n\n  async convert(model: Model, conversionState?: TConverstionState): Promise<Model>\n  {\n    this.#logger.info(\"convert\", { model, conversionState })\n    await this.initialized?.promise\n    this.convertDeferred = new DeferredPromise<TExport>()\n    const localModel = model.clone()\n    const message: TWSMessageEvent = {\n      type: \"convert\",\n      conversionState\n    }\n    await this.send(message)\n    const myExportConverted: TExport = await this.convertDeferred?.promise\n    localModel.updatePositionReceived()\n    localModel.mergeConvert(myExportConverted)\n    this.#logger.debug(\"convert\", { model: localModel })\n    return localModel\n  }\n\n  async waitForIdle(): Promise<void>\n  {\n    await this.initialized?.promise\n    this.waitForIdleDeferred = new DeferredPromise<void>()\n    const message: TWSMessageEvent = {\n      type: \"waitForIdle\",\n    }\n    await this.send(message)\n    return this.waitForIdleDeferred?.promise\n  }\n\n  async undo(model: Model): Promise<Model>\n  {\n    this.#logger.info(\"undo\", { model })\n    await this.initialized?.promise\n    const localModel = model.clone()\n    this.undoDeferred = new DeferredPromise<TExport>()\n    const message: TWSMessageEvent = {\n      type: \"undo\",\n    }\n    await this.send(message)\n    const undoExports = await this.undoDeferred?.promise\n    localModel.updatePositionReceived()\n    localModel.mergeExport(undoExports)\n    this.#logger.debug(\"undo\", { model: localModel })\n    this.undoDeferred = undefined\n    return localModel\n  }\n\n  async redo(model: Model): Promise<Model>\n  {\n    this.#logger.info(\"redo\", { model })\n    await this.initialized?.promise\n    const localModel = model.clone()\n    this.redoDeferred = new DeferredPromise<TExport>()\n    const message: TWSMessageEvent = {\n      type: \"redo\",\n    }\n    await this.send(message)\n    const redoExports = await this.redoDeferred?.promise\n    localModel.updatePositionReceived()\n    localModel.mergeExport(redoExports)\n    this.#logger.debug(\"redo\", { model: redoExports })\n    this.redoDeferred = undefined\n    return localModel\n  }\n\n  async clear(model: Model): Promise<Model>\n  {\n    this.#logger.info(\"clear\", { model })\n    await this.initialized?.promise\n    const localModel = model.clone()\n    localModel.modificationDate = Date.now()\n    this.clearDeferred = new DeferredPromise<TExport>()\n    const message: TWSMessageEvent = {\n      type: \"clear\",\n    }\n    await this.send(message)\n    const clearExports = await this.clearDeferred?.promise\n    localModel.updatePositionReceived()\n    localModel.mergeExport(clearExports)\n    this.clearDeferred = undefined\n    this.#logger.info(\"clear\", { model: localModel })\n    return localModel\n  }\n\n  close(code: number, reason: string): void\n  {\n    if (this.socket.readyState === this.socket.OPEN || this.socket.readyState === this.socket.CONNECTING) {\n      this.#logger.info(\"close\", { code, reason })\n      this.socket.removeEventListener(\"close\", this.closeCallback)\n      this.socket.removeEventListener(\"message\", this.messageCallback)\n      this.socket.removeEventListener(\"open\", this.openCallback)\n      this.socket.close(code, reason)\n    }\n  }\n\n  destroy(): void\n  {\n    this.#logger.info(\"destroy\")\n    this.connected = undefined\n    this.initialized = undefined\n    this.ackDeferred = undefined\n    this.addStrokeDeferred = undefined\n    this.exportDeferred = undefined\n    this.convertDeferred = undefined\n    this.importDeferred = undefined\n    this.resizeDeferred = undefined\n    this.undoDeferred = undefined\n    this.redoDeferred = undefined\n    this.clearDeferred = undefined\n    if (this.socket) {\n      this.socket.removeEventListener(\"close\", this.closeCallback)\n      this.socket.removeEventListener(\"message\", this.messageCallback)\n      this.socket.removeEventListener(\"open\", this.openCallback)\n      this.close(1000, \"Recognizer destroyed\")\n    }\n  }\n}\n","import { LoggerClass, LoggerManager } from \"../../logger\"\nimport { TPoint, TCanvasShapeEllipseSymbol, TCanvasShapeLineSymbol, TCanvasShapeTableSymbol, TSymbol } from \"../../primitive\"\n\n/**\n * @group Renderer\n */\nexport class CanvasRendererShape\n{\n  #logger = LoggerManager.getLogger(LoggerClass.RENDERER)\n\n  symbols = {\n    table: \"table\",\n    ellipse: \"ellipse\",\n    line: \"line\"\n  }\n\n  protected phi(angle: number): number\n  {\n    let returnedAngle = ((angle + Math.PI) % (Math.PI * 2)) - Math.PI\n    if (returnedAngle < -Math.PI) {\n      returnedAngle += Math.PI * 2\n    }\n    this.#logger.debug(\"phi\", { angle, returnedAngle })\n    return returnedAngle\n  }\n\n  protected drawEllipseArc(context2D: CanvasRenderingContext2D, shapeEllipse: TCanvasShapeEllipseSymbol): TPoint[]\n  {\n    this.#logger.debug(\"drawEllipseArc\", { context2D, shapeEllipse })\n    const { centerPoint, maxRadius, minRadius, orientation, startAngle, sweepAngle } = shapeEllipse\n    const angleStep = 0.02\n    const z1 = Math.cos(orientation) * maxRadius\n    const z2 = Math.cos(orientation) * minRadius\n    const z3 = Math.sin(orientation) * maxRadius\n    const z4 = Math.sin(orientation) * minRadius\n    const n = Math.floor(Math.abs(sweepAngle) / angleStep)\n    const boundariesPoints = []\n    context2D.save()\n    try {\n      context2D.beginPath()\n      for (let i = 0; i <= n; i++) {\n        const angle = startAngle + ((i / n) * sweepAngle)\n        const alpha = Math.atan2(Math.sin(angle) / minRadius, Math.cos(angle) / maxRadius)\n        const cosAlpha = Math.cos(alpha)\n        const sinAlpha = Math.sin(alpha)\n        const x = (centerPoint.x + (z1 * cosAlpha)) - (z4 * sinAlpha)\n        const y = (centerPoint.y + (z2 * sinAlpha)) + (z3 * cosAlpha)\n        if (i === 0) {\n          context2D.moveTo(x, y)\n        } else {\n          context2D.lineTo(x, y)\n        }\n        if (i === 0 || i === n) {\n          boundariesPoints.push({ x, y })\n        }\n      }\n      context2D.stroke()\n    } catch(error) {\n      this.#logger.error(\"drawEllipseArc\", { error })\n    } finally {\n      context2D.restore()\n    }\n    return boundariesPoints\n  }\n\n  protected drawLine(context2D: CanvasRenderingContext2D, p1: TPoint, p2: TPoint)\n  {\n    this.#logger.debug(\"drawLine\", { context2D, p1, p2 })\n    context2D.save()\n    try {\n      context2D.beginPath()\n      context2D.moveTo(p1.x, p1.y)\n      context2D.lineTo(p2.x, p2.y)\n      context2D.stroke()\n    } catch(error) {\n      this.#logger.error(\"drawLine\", { error })\n    } finally {\n      context2D.restore()\n    }\n  }\n\n  protected drawArrowHead(context2D: CanvasRenderingContext2D, headPoint: TPoint, angle: number, length: number)\n  {\n    this.#logger.debug(\"drawArrowHead\", { context2D, headPoint, angle, length })\n    const alpha = this.phi(angle + (Math.PI * (7 / 8)))\n    const beta = this.phi(angle - (Math.PI * (7 / 8)))\n    context2D.save()\n    try {\n      context2D.fillStyle = context2D.strokeStyle\n\n      context2D.moveTo(headPoint.x, headPoint.y)\n      context2D.beginPath()\n      context2D.lineTo(headPoint.x + (length * Math.cos(alpha)), headPoint.y + (length * Math.sin(alpha)))\n      context2D.lineTo(headPoint.x + (length * Math.cos(beta)), headPoint.y + (length * Math.sin(beta)))\n      context2D.lineTo(headPoint.x, headPoint.y)\n      context2D.fill()\n    } catch(error) {\n      this.#logger.error(\"drawArrowHead\", { error })\n    } finally {\n      context2D.restore()\n    }\n  }\n\n  protected drawShapeEllipse(context2D: CanvasRenderingContext2D, shapeEllipse: TCanvasShapeEllipseSymbol)\n  {\n    this.#logger.debug(\"drawShapeEllipse\", { context2D, shapeEllipse })\n    const points = this.drawEllipseArc(context2D, shapeEllipse)\n\n    if (shapeEllipse?.beginDecoration === \"ARROW_HEAD\") {\n      this.drawArrowHead(context2D, points[0], shapeEllipse.beginTangentAngle, 12.0)\n    }\n    if (shapeEllipse?.endDecoration === \"ARROW_HEAD\") {\n      this.drawArrowHead(context2D, points[1], shapeEllipse.endTangentAngle, 12.0)\n    }\n  }\n\n  protected drawShapeLine(context2D: CanvasRenderingContext2D, shapeLine: TCanvasShapeLineSymbol)\n  {\n    this.#logger.debug(\"drawShapeLine\", { context2D, shapeLine })\n    this.drawLine(context2D, shapeLine.firstPoint, shapeLine.lastPoint)\n    if (shapeLine.beginDecoration === \"ARROW_HEAD\") {\n      this.drawArrowHead(context2D, shapeLine.firstPoint, shapeLine.beginTangentAngle, 12.0)\n    }\n    if (shapeLine.endDecoration === \"ARROW_HEAD\") {\n      this.drawArrowHead(context2D, shapeLine.lastPoint, shapeLine.endTangentAngle, 12.0)\n    }\n  }\n\n  draw(context2D: CanvasRenderingContext2D, symbol: TSymbol)\n  {\n    this.#logger.info(\"draw\", { context2D, symbol })\n    context2D.save()\n    context2D.lineWidth = symbol.style.width as number\n    context2D.strokeStyle = symbol.style.color as string\n\n    switch (symbol.type) {\n      case this.symbols.table: {\n        const tableSymbols = symbol as TCanvasShapeTableSymbol\n        tableSymbols.lines.forEach(line => this.drawLine(context2D, line.p1, line.p2))\n        break\n      }\n      case this.symbols.ellipse: {\n        this.drawShapeEllipse(context2D, symbol as TCanvasShapeEllipseSymbol)\n        break\n      }\n      case this.symbols.line: {\n        this.drawShapeLine(context2D, symbol as TCanvasShapeLineSymbol)\n        break\n      }\n      default:\n        this.#logger.warn(\"draw\", `${ symbol.type } not implemented`)\n        break\n    }\n  }\n\n}\n","import { LoggerClass, LoggerManager } from \"../../logger\"\nimport { Stroke, TPointer } from \"../../primitive\"\nimport { computeAngleAxeRadian, computeLinksPointers, computeMiddlePointer } from \"../../utils\"\n\n/**\n * @group Renderer\n */\nexport class CanvasRendererStroke\n{\n  #logger = LoggerManager.getLogger(LoggerClass.RENDERER)\n\n  protected renderArc(context2d: CanvasRenderingContext2D, center: TPointer, radius: number): void\n  {\n    this.#logger.debug(\"renderArc\", { context2d, center, radius })\n    context2d.arc(center.x, center.y, radius, 0, Math.PI * 2, true)\n  }\n\n  protected renderLine(context2d: CanvasRenderingContext2D, begin: TPointer, end: TPointer, width: number): void\n  {\n    this.#logger.debug(\"renderLine\", { context2d, begin, end, width })\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, end), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(begin, end), width)\n\n    context2d.moveTo(linkPoints1[0].x, linkPoints1[0].y)\n    context2d.lineTo(linkPoints2[0].x, linkPoints2[0].y)\n    context2d.lineTo(linkPoints2[1].x, linkPoints2[1].y)\n    context2d.lineTo(linkPoints1[1].x, linkPoints1[1].y)\n  }\n\n  protected renderFinal(context2d: CanvasRenderingContext2D, begin: TPointer, end: TPointer, width: number): void\n  {\n    this.#logger.debug(\"renderFinal\", { context2d, begin, end, width })\n    const ARCSPLIT = 6\n    const angle = computeAngleAxeRadian(begin, end)\n    const linkPoints = computeLinksPointers(end, angle, width)\n    context2d.moveTo(linkPoints[0].x, linkPoints[0].y)\n    for (let i = 1; i <= ARCSPLIT; i++) {\n      const newAngle = angle - ((i * Math.PI) / ARCSPLIT)\n      context2d.lineTo(end.x - ((end.p * width) * Math.sin(newAngle)), end.y + (end.p * width * Math.cos(newAngle)))\n    }\n  }\n\n  protected renderQuadratic(context2d: CanvasRenderingContext2D, begin: TPointer, end: TPointer, ctrl: TPointer, width: number): void\n  {\n    this.#logger.debug(\"renderQuadratic\", { context2d, begin, end, ctrl, width })\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, ctrl), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(ctrl, end), width)\n    const linkPoints3 = computeLinksPointers(ctrl, computeAngleAxeRadian(begin, end), width)\n\n    context2d.moveTo(linkPoints1[0].x, linkPoints1[0].y)\n    context2d.quadraticCurveTo(linkPoints3[0].x, linkPoints3[0].y, linkPoints2[0].x, linkPoints2[0].y)\n    context2d.lineTo(linkPoints2[1].x, linkPoints2[1].y)\n    context2d.quadraticCurveTo(linkPoints3[1].x, linkPoints3[1].y, linkPoints1[1].x, linkPoints1[1].y)\n  }\n\n  draw(context2d: CanvasRenderingContext2D, stroke: Stroke): void\n  {\n    this.#logger.info(\"draw\", { context2d, stroke })\n    const NUMBER_POINTS = stroke.pointers.length\n    const NUMBER_QUADRATICS = NUMBER_POINTS - 2\n    const width = (stroke.style.width as number) > 0 ? (stroke.style.width as number) : context2d.lineWidth\n    const color = (stroke.style.color as string) ? (stroke.style.color as string) : context2d.strokeStyle\n    const firstPoint = stroke.pointers[0] as TPointer\n\n    context2d.save()\n    try {\n      context2d.beginPath()\n      if (NUMBER_POINTS < 3) {\n        this.renderArc(context2d, firstPoint, width * 0.6)\n      } else {\n        this.renderArc(context2d, firstPoint, width * firstPoint.p)\n        const secondPoint: TPointer = computeMiddlePointer(firstPoint, stroke.pointers[1])\n        this.renderLine(context2d, firstPoint, secondPoint, width)\n\n        // Possibility to try this (the start looks better when the ink is large)\n        // var first = computeMiddlePoint(stroke.pointers[0], stroke.pointers[1]);\n        // context2d.arc(first.x, first.y, width * first.p, 0, Math.PI * 2, true);\n\n        for (let i = 0; i < NUMBER_QUADRATICS; i++) {\n          const begin: TPointer = computeMiddlePointer(stroke.pointers[i], stroke.pointers[i + 1])\n          const end: TPointer = computeMiddlePointer(stroke.pointers[i + 1], stroke.pointers[i + 2])\n          const ctrl: TPointer = stroke.pointers[i + 1]\n          this.renderQuadratic(context2d, begin, end, ctrl, width)\n        }\n        const beginLine: TPointer = computeMiddlePointer(stroke.pointers[NUMBER_POINTS - 2], stroke.pointers[NUMBER_POINTS - 1])\n        const endLine: TPointer = stroke.pointers[NUMBER_POINTS - 1]\n        this.renderLine(context2d, beginLine, endLine, width)\n\n        const beginFinal: TPointer = stroke.pointers[NUMBER_POINTS - 2]\n        const endFinal: TPointer = stroke.pointers[NUMBER_POINTS - 1]\n        this.renderFinal(context2d, beginFinal, endFinal, width)\n      }\n      context2d.closePath()\n      if (color !== undefined) {\n        context2d.fillStyle = color\n        context2d.fill()\n      }\n      context2d.save()\n    }\n    catch (error) {\n      this.#logger.error(\"draw\", { error })\n    }\n    finally {\n      context2d.restore()\n    }\n  }\n}\n","import { LoggerClass, LoggerManager } from \"../../logger\"\nimport { TSymbol, TCanvasTextSymbol, TCanvasTextUnderlineSymbol, TCanvasUnderLineSymbol, TPoint } from \"../../primitive\"\n\n/**\n * @group Renderer\n */\nexport class CanvasRendererText\n{\n  #logger = LoggerManager.getLogger(LoggerClass.RENDERER)\n\n  symbols = {\n    char: \"char\",\n    string: \"string\",\n    textLine: \"textLine\"\n  }\n\n  protected drawUnderline(context2D: CanvasRenderingContext2D, textUnderline: TCanvasTextUnderlineSymbol, underline: TCanvasUnderLineSymbol)\n  {\n    this.#logger.debug(\"#drawUnderline\", { context2D, textUnderline, underline })\n    context2D.save()\n    try {\n      const delta = textUnderline.data.width / textUnderline.label.length\n      const p1: TPoint = {\n        x: textUnderline.data.topLeftPoint.x + (underline.data.firstCharacter * delta),\n        y: textUnderline.data.topLeftPoint.y + textUnderline.data.height\n      }\n      const p2: TPoint = {\n        x: textUnderline.data.topLeftPoint.x + (underline.data.lastCharacter * delta),\n        y: textUnderline.data.topLeftPoint.y + textUnderline.data.height\n      }\n      context2D.beginPath()\n      context2D.moveTo(p1.x, p1.y)\n      context2D.lineTo(p2.x, p2.y)\n      context2D.stroke()\n    } catch(error) {\n      this.#logger.error(\"#drawUnderline\", { error })\n    } finally {\n      context2D.restore()\n    }\n  }\n\n  protected drawText(context2D: CanvasRenderingContext2D, text: TCanvasTextSymbol)\n  {\n    this.#logger.debug(\"#drawText\", { context2D, text })\n    context2D.save()\n    try {\n      context2D.font = `${ text.data.textHeight }px serif`\n      context2D.textAlign = (text.data.justificationType === \"CENTER\") ? \"center\" : \"left\"\n      context2D.textBaseline = \"bottom\"\n      context2D.fillStyle = context2D.strokeStyle\n      context2D.fillText(text.label, text.data.topLeftPoint.x, (text.data.topLeftPoint.y + text.data.height))\n    } catch(error) {\n      this.#logger.error(\"#drawText\", { error })\n    } finally {\n      context2D.restore()\n    }\n  }\n\n  protected drawTextLine(context2D: CanvasRenderingContext2D, textUnderline: TCanvasTextUnderlineSymbol)\n  {\n    this.#logger.debug(\"#drawTextLine\", { context2D, textUnderline })\n    this.drawText(context2D, textUnderline)\n    textUnderline.underlineList.forEach((underline) =>\n    {\n      this.drawUnderline(context2D, textUnderline, underline)\n    })\n  }\n\n  draw(context2D: CanvasRenderingContext2D, symbol: TSymbol)\n  {\n    this.#logger.info(\"draw\", { context2D, symbol })\n    context2D.lineWidth = (symbol.style.width as number)\n    context2D.strokeStyle = (symbol.style.color as string)\n    switch (symbol.type) {\n      case this.symbols.char:\n      case this.symbols.string:\n        this.drawText(context2D, symbol as TCanvasTextSymbol)\n        break\n      case this.symbols.textLine:\n        this.drawTextLine(context2D, symbol as TCanvasTextUnderlineSymbol)\n        break\n      default:\n        this.#logger.warn(\"draw\", `${symbol.type} not implemented`)\n        break\n    }\n  }\n}\n","import { TRenderingConfiguration } from \"../../configuration\"\nimport { LoggerClass, LoggerManager } from \"../../logger\"\nimport { IModel } from \"../../model\"\nimport { Stroke, TSymbol } from \"../../primitive\"\nimport { CanvasRendererShape } from \"./CanvasRendererShape\"\nimport { CanvasRendererStroke } from \"./CanvasRendererStroke\"\nimport { CanvasRendererText } from \"./CanvasRendererText\"\n\n/**\n * @group Renderer\n */\nexport class CanvasRenderer\n{\n  #logger = LoggerManager.getLogger(LoggerClass.RENDERER)\n  configuration: TRenderingConfiguration\n  strokeRenderer: CanvasRendererStroke\n  shapeRenderer: CanvasRendererShape\n  textRenderer: CanvasRendererText\n  context!: {\n    parent: HTMLElement\n    renderingCanvas: HTMLCanvasElement\n    renderingCanvasContext: CanvasRenderingContext2D\n    capturingCanvas: HTMLCanvasElement\n    capturingCanvasContext: CanvasRenderingContext2D\n  }\n\n  constructor(config: TRenderingConfiguration)\n  {\n    this.#logger.info(\"constructor\", { config })\n    this.configuration = config\n    this.strokeRenderer = new CanvasRendererStroke()\n    this.shapeRenderer = new CanvasRendererShape()\n    this.textRenderer = new CanvasRendererText()\n  }\n\n  protected createCanvas(type: string): HTMLCanvasElement\n  {\n    this.#logger.debug(\"createCanvas\", { type })\n    const canvas: HTMLCanvasElement = document.createElement(\"canvas\")\n    canvas.id = type\n    canvas.classList.add(type)\n    canvas.classList.add(\"ms-canvas\")\n    return canvas\n  }\n\n  protected resizeContent(): void\n  {\n    const pixelRatio: number = window.devicePixelRatio\n    const elements: HTMLCanvasElement[] = [this.context.renderingCanvas, this.context.capturingCanvas]\n    elements.forEach((canvas) =>\n    {\n      const domElement = canvas.parentNode as HTMLElement\n      const width = Math.max(this.configuration.minWidth, domElement.clientWidth)\n      const height = Math.max(this.configuration.minHeight, domElement.clientHeight)\n      canvas.width = width * pixelRatio\n      canvas.height = height * pixelRatio\n      canvas.getContext(\"2d\")?.scale(pixelRatio, pixelRatio)\n      canvas.style.width = `${ width }px`\n      canvas.style.height = `${ height }px`\n    })\n  }\n\n  protected drawSymbol(context2D: CanvasRenderingContext2D, symbol: TSymbol)\n  {\n    this.#logger.debug(\"drawSymbol\", { symbol })\n    if (symbol.type === \"stroke\") {\n      const stroke = symbol as Stroke\n      if (stroke.pointerType !== \"eraser\") {\n        this.strokeRenderer.draw(context2D, stroke)\n      }\n    } else if (Object.keys(this.textRenderer.symbols).includes(symbol.type)) {\n      this.textRenderer.draw(context2D, symbol)\n    } else if (Object.keys(this.shapeRenderer.symbols).includes(symbol.type)) {\n      this.shapeRenderer.draw(context2D, symbol)\n    } else {\n      this.#logger.warn(\"drawSymbol\", `symbol type unknow: ${symbol.type}`)\n    }\n  }\n\n  init(element: HTMLElement): void\n  {\n    this.#logger.info(\"init\", { element })\n    const renderingCanvas: HTMLCanvasElement = this.createCanvas(\"ms-rendering-canvas\")\n    element.appendChild(renderingCanvas)\n\n    const capturingCanvas: HTMLCanvasElement = this.createCanvas(\"ms-capture-canvas\")\n    element.appendChild(capturingCanvas)\n\n    this.context = {\n      parent: element,\n      renderingCanvas,\n      renderingCanvasContext: renderingCanvas.getContext(\"2d\") as CanvasRenderingContext2D,\n      capturingCanvas,\n      capturingCanvasContext: capturingCanvas.getContext(\"2d\") as CanvasRenderingContext2D\n    }\n\n    this.resizeContent()\n  }\n\n  drawModel(model: IModel): void\n  {\n    this.#logger.info(\"drawModel\", { model })\n    this.context.renderingCanvasContext?.clearRect(0, 0, this.context.renderingCanvas.width, this.context.renderingCanvas.height)\n    model.symbols.forEach(symbol => this.drawSymbol(this.context.renderingCanvasContext, symbol))\n    this.context.capturingCanvasContext.clearRect(0, 0, this.context.capturingCanvas.width, this.context.capturingCanvas.height)\n  }\n\n  drawPendingStroke(stroke: Stroke | undefined): void\n  {\n    this.#logger.info(\"drawPendingStroke\", { stroke })\n    this.context.capturingCanvasContext.clearRect(0, 0, this.context.capturingCanvas.width, this.context.capturingCanvas.height)\n    if (stroke && stroke?.pointerType !== \"eraser\") {\n      this.strokeRenderer.draw(this.context.capturingCanvasContext, stroke)\n    }\n  }\n\n  resize(model: IModel): void\n  {\n    this.#logger.info(\"resize\", { model })\n    this.resizeContent()\n    this.drawModel(model)\n  }\n\n  destroy(): void\n  {\n    this.#logger.info(\"destroy\")\n    if (this.context.parent) {\n      this.context.parent.innerHTML = \"\"\n    }\n  }\n}\n","\n/**\n * @group Renderer\n */\nexport const OISVGRendererConst =\n{\n  arrowHeadStartMarker: \"arrow-head-start\",\n  arrowHeadEndMaker: \"arrow-head-end\",\n  selectionFilterId: \"selection-filter\",\n  removalFilterId: \"removal-filter\",\n  crossMarker: \"cross-marker\",\n  noSelection: \"pointer-events: none; -webkit-touch-callout: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;\",\n}\n","import { TBoundingBox, TPoint } from \"../../primitive\"\n\nconst XMLNS = \"http://www.w3.org/2000/svg\"\n/**\n * @group Renderer\n */\nexport class SVGBuilder\n{\n  static createLayer(boundingBox: TBoundingBox, attrs: { [key: string]: string } = {}): SVGElement\n  {\n    const svgEl = document.createElementNS(XMLNS, \"svg\")\n    svgEl.setAttribute(\"width\", `${ boundingBox.width }px`)\n    svgEl.setAttribute(\"height\", `${ boundingBox.height }px`)\n    svgEl.setAttribute(\"viewBox\", `${boundingBox.x}, ${boundingBox.y}, ${boundingBox. width }, ${ boundingBox.height }`)\n    Object.keys(attrs).forEach(k =>\n    {\n      svgEl.setAttribute(k, attrs[k])\n    })\n    return svgEl\n  }\n\n  static createFilter(id: string, attrs: { [key: string]: string } = {}): SVGFilterElement\n  {\n    const filter = document.createElementNS(XMLNS, \"filter\")\n    filter.id = id\n    Object.keys(attrs).forEach(k =>\n    {\n      filter.setAttribute(k, attrs[k])\n    })\n    return filter\n  }\n\n  static createDefs(): SVGDefsElement\n  {\n    return document.createElementNS(XMLNS, \"defs\")\n  }\n\n  static createMarker(id: string, attrs: { [key: string]: string } = {}): SVGMarkerElement\n  {\n    const marker = document.createElementNS(XMLNS, \"marker\")\n    marker.setAttribute(\"id\", id)\n    Object.keys(attrs).forEach(k =>\n    {\n      marker.setAttribute(k, attrs[k])\n    })\n    return marker\n  }\n\n  static createComponentTransfert(): SVGFEComponentTransferElement\n  {\n    return document.createElementNS(XMLNS, \"feComponentTransfer\")\n  }\n\n  static createDropShadow({ dx = 0, dy = 0, deviation = 0, color = \"#3e68ff\", opacity = 1 }): SVGFEDropShadowElement\n  {\n    const shadow = document.createElementNS(XMLNS, \"feDropShadow\")\n    shadow.setAttribute(\"dx\", dx.toString())\n    shadow.setAttribute(\"dy\", dy.toString())\n    shadow.setAttribute(\"stdDeviation\", deviation.toString())\n    shadow.setAttribute(\"flood-color\", color)\n    shadow.setAttribute(\"flood-opacity\", opacity.toString())\n    return shadow\n  }\n\n  static createTransfertFunctionTable(type: \"feFuncA\" | \"feFuncB\" | \"feFuncG\" | \"feFuncR\", values: string): SVGFEFuncAElement\n  {\n    const feFunc = document.createElementNS(XMLNS, type)\n    feFunc.setAttribute(\"type\", \"table\")\n    feFunc.setAttribute(\"tableValues\", values)\n    return feFunc\n  }\n\n  static createGroup(attrs: { [key: string]: string } = {}): SVGGElement\n  {\n    const groupEl = document.createElementNS(XMLNS, \"g\")\n    Object.keys(attrs).forEach(k =>\n    {\n      groupEl.setAttribute(k, attrs[k])\n    })\n    return groupEl\n  }\n\n  static createLine(p1: TPoint, p2: TPoint, attrs: { [key: string]: string } = {}): SVGLineElement\n  {\n    const lineEl = document.createElementNS(XMLNS, \"line\")\n    lineEl.setAttribute(\"x1\", p1.x.toString())\n    lineEl.setAttribute(\"y1\", p1.y.toString())\n    lineEl.setAttribute(\"x2\", p2.x.toString())\n    lineEl.setAttribute(\"y2\", p2.y.toString())\n    Object.keys(attrs).forEach(k =>\n    {\n      lineEl.setAttribute(k, attrs[k])\n    })\n    return lineEl\n  }\n\n  static createCircle(p: TPoint, r: number, attrs: { [key: string]: string } = {}): SVGCircleElement\n  {\n    const circleEl = document.createElementNS(XMLNS, \"circle\")\n    circleEl.setAttribute(\"cx\", p.x.toString())\n    circleEl.setAttribute(\"cy\", p.y.toString())\n    circleEl.setAttribute(\"r\", r.toString())\n    Object.keys(attrs).forEach(k =>\n    {\n      circleEl.setAttribute(k, attrs[k])\n    })\n    return circleEl\n  }\n\n  static createPath(attrs: { [key: string]: string } = {}): SVGPathElement\n  {\n    const pathEl = document.createElementNS(XMLNS, \"path\")\n    Object.keys(attrs).forEach(k =>\n    {\n      pathEl.setAttribute(k, attrs[k])\n    })\n    return pathEl\n  }\n\n  static createPolygon(points: number[], attrs: { [key: string]: string } = {}): SVGPolylineElement\n  {\n    const polygonEl = document.createElementNS(XMLNS, \"polygon\")\n    polygonEl.setAttribute(\"points\", points.join(\",\"))\n    Object.keys(attrs).forEach(k =>\n    {\n      polygonEl.setAttribute(k, attrs[k])\n    })\n    return polygonEl\n  }\n\n  static createRect(box: TBoundingBox, attrs: { [key: string]: string } = {}): SVGRectElement\n  {\n    const rectEl = document.createElementNS(XMLNS, \"rect\")\n    rectEl.setAttribute(\"x\", box.x.toString())\n    rectEl.setAttribute(\"y\", box.y.toString())\n    rectEl.setAttribute(\"width\", box.width.toString())\n    rectEl.setAttribute(\"height\", box.height.toString())\n    Object.keys(attrs).forEach(k =>\n    {\n      rectEl.setAttribute(k, attrs[k])\n    })\n    return rectEl\n  }\n\n  static createTSpan(text: string, attrs: { [key: string]: string } = {}): SVGTSpanElement\n  {\n    const tSpanEl = document.createElementNS(XMLNS, \"tspan\")\n    tSpanEl.textContent = text\n    Object.keys(attrs).forEach(k =>\n    {\n      tSpanEl.setAttribute(k, attrs[k])\n    })\n    return tSpanEl\n  }\n\n  static createForeignObject(box: TBoundingBox, node: HTMLElement, attrs: { [key: string]: string } = {}): SVGForeignObjectElement\n  {\n    const objEl = document.createElementNS(XMLNS, \"foreignObject\")\n    objEl.setAttribute(\"x\", box.x.toString())\n    objEl.setAttribute(\"y\", box.y.toString())\n    objEl.setAttribute(\"width\", box.width.toString())\n    objEl.setAttribute(\"height\", box.height.toString())\n    Object.keys(attrs).forEach(k =>\n    {\n      objEl.setAttribute(k, attrs[k])\n    })\n    objEl.appendChild(node)\n    return objEl\n  }\n\n  static createText(p: TPoint, text: string, attrs: { [key: string]: string } = {}): SVGTextElement\n  {\n    const textEl = document.createElementNS(XMLNS, \"text\")\n    textEl.textContent = text\n    textEl.setAttribute(\"x\", p.x.toString())\n    textEl.setAttribute(\"y\", p.y.toString())\n    Object.keys(attrs).forEach(k =>\n    {\n      textEl.setAttribute(k, attrs[k])\n    })\n    return textEl\n  }\n}\n","import { EdgeDecoration, EdgeKind, OIEdgeArc, OIEdgeLine, OIEdgePolyLine, TOIEdge } from \"../../primitive\"\nimport { DefaultStyle } from \"../../style\"\nimport { OISVGRendererConst } from \"./OISVGRendererConst\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class OISVGRendererEdgeUtil\n{\n  static getLinePath(line: OIEdgeLine): string\n  {\n    return `M ${ line.start.x } ${ line.start.y } L ${ line.end.x } ${ line.end.y }`\n  }\n\n  static getPolyLinePath(line: OIEdgePolyLine): string\n  {\n    return `M ${ line.vertices[0].x } ${ line.vertices[0].y } ${ line.vertices.map(p => `L ${ p.x } ${ p.y }`).join(\" \") }`\n  }\n\n  static getArcPath(arc: OIEdgeArc): string\n  {\n    return `M ${ arc.vertices[0].x } ${ arc.vertices[0].y } Q ${ arc.vertices.map(p => `${ p.x } ${ p.y }`).join(\" \") }`\n  }\n\n  static getSVGPath(edge: TOIEdge): string\n  {\n    switch (edge.kind) {\n      case EdgeKind.Line:\n        return OISVGRendererEdgeUtil.getLinePath(edge)\n      case EdgeKind.PolyEdge:\n        return OISVGRendererEdgeUtil.getPolyLinePath(edge)\n      case EdgeKind.Arc:\n        return OISVGRendererEdgeUtil.getArcPath(edge)\n      default:\n        throw new Error(`Can't getSVGPath for edge cause kind is unknow: \"${ JSON.stringify(edge) }\"`)\n    }\n  }\n\n  static getSVGElement(edge: TOIEdge): SVGGraphicsElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": edge.id,\n      \"type\": edge.type,\n      \"kind\": edge.kind,\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n    }\n    if (edge.selected) {\n      attrs[\"filter\"] = `url(#${ OISVGRendererConst.selectionFilterId })`\n    }\n    if (edge.deleting) {\n      attrs[\"filter\"] = `url(#${ OISVGRendererConst.removalFilterId })`\n    }\n    const group = SVGBuilder.createGroup(attrs)\n\n    const pathAttrs: { [key: string]: string } = {\n      \"fill\": \"transparent\",\n      \"stroke\": edge.style.color || DefaultStyle.color!,\n      \"stroke-width\": (edge.style.width || DefaultStyle.width!).toString(),\n      \"opacity\": (edge.style.opacity || DefaultStyle.opacity!).toString(),\n      \"d\": OISVGRendererEdgeUtil.getSVGPath(edge),\n    }\n\n    if (edge.startDecoration === EdgeDecoration.Arrow) {\n      pathAttrs[\"marker-start\"] = `url(#${ OISVGRendererConst.arrowHeadStartMarker })`\n    }\n    if (edge.endDecoration === EdgeDecoration.Arrow) {\n      pathAttrs[\"marker-end\"] = `url(#${ OISVGRendererConst.arrowHeadEndMaker })`\n    }\n    group.appendChild(SVGBuilder.createPath(pathAttrs))\n    return group\n  }\n\n\n}\n","import { OIEraser, TPointer } from \"../../primitive\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class OISVGRendererEraserUtil\n{\n  static getSVGPath(eraser: OIEraser): string\n  {\n    if (eraser.pointers.length < 1) return \"\"\n\n    const firstPoint = eraser.pointers.at(0) as TPointer\n\n    if (eraser.pointers.length === 1) {\n      const strokeWith = eraser.style.width || 4\n      return `C ${ firstPoint.x - strokeWith / 2 } ${ firstPoint.y } Q ${ firstPoint.x  + strokeWith / 2 } ${ firstPoint.y }`\n    }\n\n    const middlePoints = eraser.pointers.slice(1)\n\n    const startPathMoveTo = `M ${ firstPoint.x } ${ firstPoint.y }`\n\n\n    const middlePathQuadratic = middlePoints.reduce((acc, point) => {\n      return `${ acc } ${ point.x } ${ point.y }`\n    }, \"Q\")\n\n    return `${ startPathMoveTo } ${ middlePathQuadratic }`\n  }\n\n  static getSVGElement(eraser: OIEraser): SVGPathElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": eraser.id,\n      \"type\": \"eraser\",\n      \"stroke-width\": \"12\",\n      \"stroke\": \"grey\",\n      \"opacity\": \"0.2\",\n      \"shadowBlur\": \"5\",\n      \"stroke-linecap\": \"round\",\n      \"fill\": \"transparent\",\n      \"d\": OISVGRendererEraserUtil.getSVGPath(eraser)\n    }\n    return SVGBuilder.createPath(attrs)\n  }\n\n}\n","import { Box, DecoratorKind, OIDecorator, TBoundingBox } from \"../../primitive\"\nimport { DefaultStyle, TStyle } from \"../../style\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class OISVGRendererDecoratorUtil\n{\n  static getSVGElement(decorator: OIDecorator, { deleting, style, bounds }: { deleting: boolean, style: TStyle, bounds: Box }): SVGGeometryElement | undefined\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": decorator.id,\n      \"type\": \"decorator\",\n      \"kind\": decorator.kind,\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n    }\n    attrs[\"opacity\"] = (decorator.style.opacity || DefaultStyle.opacity!).toString()\n    if (deleting) {\n      attrs[\"opacity\"] = ((decorator.style.opacity || DefaultStyle.opacity!) * 0.5).toString()\n    }\n\n    let element: SVGGeometryElement | undefined\n\n    switch (decorator.kind) {\n      case DecoratorKind.Highlight: {\n        attrs[\"opacity\"] = deleting ? \"0.25\" : \"0.5\"\n        attrs[\"stroke\"] = \"transparent\"\n        attrs[\"fill\"] = decorator.style.color || DefaultStyle.color!\n        const boundingBox: TBoundingBox = {\n          x: bounds.x - +(style.width || DefaultStyle.width!),\n          y: bounds.y - +(style.width || DefaultStyle.width!),\n          height: bounds.height + +(style.width || DefaultStyle.width!) * 2,\n          width: bounds.width + +(style.width || DefaultStyle.width!) * 2,\n        }\n        element = SVGBuilder.createRect(boundingBox, attrs)\n        break\n      }\n      case DecoratorKind.Surround: {\n        attrs[\"fill\"] = \"transparent\"\n        attrs[\"stroke\"] = decorator.style.color || DefaultStyle.color!\n        attrs[\"stroke-width\"] = (decorator.style.width || DefaultStyle.width!).toString()\n        const boundingBox: TBoundingBox = {\n          x: bounds.x - +(style.width || DefaultStyle.width!),\n          y: bounds.y - +(style.width || DefaultStyle.width!),\n          height: bounds.height + +(style.width || DefaultStyle.width!) * 2,\n          width: bounds.width + +(style.width || DefaultStyle.width!) * 2,\n        }\n        element = SVGBuilder.createRect(boundingBox, attrs)\n        break\n      }\n      case DecoratorKind.Strikethrough: {\n        attrs[\"fill\"] = \"transparent\"\n        attrs[\"stroke\"] = decorator.style.color || DefaultStyle.color!\n        attrs[\"stroke-width\"] = (decorator.style.width || DefaultStyle.width!).toString()\n        const p1 = {\n          x: bounds.xMin,\n          y: bounds.yMid\n        }\n        const p2 = {\n          x: bounds.xMax,\n          y: bounds.yMid\n        }\n        element = SVGBuilder.createLine(p1, p2, attrs)\n        break\n      }\n      case DecoratorKind.Underline: {\n        attrs[\"fill\"] = \"transparent\"\n        attrs[\"stroke\"] = decorator.style.color || DefaultStyle.color!\n        attrs[\"stroke-width\"] = (decorator.style.width || DefaultStyle.width!).toString()\n        const p1 = {\n          x: bounds.xMin,\n          y: bounds.yMax + +(style.width || DefaultStyle.width!)\n        }\n        const p2 = {\n          x: bounds.xMax,\n          y: bounds.yMax + +(style.width || DefaultStyle.width!)\n        }\n        element = SVGBuilder.createLine(p1, p2, attrs)\n        break\n      }\n    }\n\n    return element\n  }\n}\n","import { OIShapeCircle, OIShapeEllipse, OIShapePolygon, ShapeKind, TOIShape } from \"../../primitive\"\nimport { DefaultStyle } from \"../../style\"\nimport { convertRadianToDegree } from \"../../utils\"\nimport { OISVGRendererConst } from \"./OISVGRendererConst\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class OISVGRendererShapeUtil\n{\n  static getPolygonePath(polygon: OIShapePolygon): string\n  {\n    return `M ${polygon.points[0].x} ${polygon.points[0].y} ${polygon.points.slice(1).map(p => `L ${p.x} ${p.y}`).join(\" \")} Z`\n  }\n\n  static getCirclePath(circle: OIShapeCircle): string\n  {\n    return `M ${circle.center.x - circle.radius} ${circle.center.y} a ${circle.radius} ${circle.radius} 0 1 1 ${circle.radius * 2} 0 a ${circle.radius} ${circle.radius} 0 1 1 -${circle.radius * 2} 0 Z`\n  }\n\n  static getEllipsePath(ellipse: OIShapeEllipse): string\n  {\n    return `M ${ellipse.center.x - ellipse.radiusX} ${ellipse.center.y} a ${ellipse.radiusX} ${ellipse.radiusY} 0 1 1 ${ellipse.radiusX * 2} 0 a ${ellipse.radiusX} ${ellipse.radiusY} 0 1 1 -${ellipse.radiusX * 2} 0 Z`\n  }\n\n  static getSVGPath(shape: TOIShape): string\n  {\n    switch(shape.kind) {\n      case ShapeKind.Polygon:\n        return OISVGRendererShapeUtil.getPolygonePath(shape as OIShapePolygon)\n      case ShapeKind.Circle:\n        return OISVGRendererShapeUtil.getCirclePath(shape as OIShapeCircle)\n      case ShapeKind.Ellipse:\n        return OISVGRendererShapeUtil.getEllipsePath(shape as OIShapeEllipse)\n      default:\n        throw new Error(`Can't getSVGPath for shape cause kind is unknow: \"${ JSON.stringify(shape) }\"`)\n    }\n  }\n\n  static getSVGElement(shape: TOIShape): SVGGraphicsElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": shape.id,\n      \"type\": shape.type,\n      \"kind\": shape.kind,\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n    }\n    if (shape.selected) {\n      attrs[\"filter\"] = `url(#${ OISVGRendererConst.selectionFilterId })`\n    }\n    if (shape.deleting) {\n      attrs[\"filter\"] = `url(#${ OISVGRendererConst.removalFilterId })`\n    }\n\n    const group = SVGBuilder.createGroup(attrs)\n\n    const pathAttrs: { [key: string]: string } = {\n      \"fill\": shape.style.fill || \"transparent\",\n      \"stroke\": shape.style.color || DefaultStyle.color!,\n      \"stroke-width\": (shape.style.width || DefaultStyle.width!).toString(),\n      \"opacity\": (shape.style.opacity || DefaultStyle.opacity!).toString(),\n      \"d\": OISVGRendererShapeUtil.getSVGPath(shape),\n    }\n    if (shape.kind === ShapeKind.Ellipse) {\n      pathAttrs.transform = `rotate(${ convertRadianToDegree(shape.orientation) }, ${shape.center.x}, ${shape.center.y})`\n    }\n\n    group.appendChild(SVGBuilder.createPath(pathAttrs))\n\n    return group\n  }\n}\n","import { DecoratorKind, OIStroke, TPointer } from \"../../primitive\"\nimport { DefaultStyle } from \"../../style\"\nimport { computeAngleAxeRadian, computeLinksPointers, computeMiddlePointer } from \"../../utils\"\nimport { OISVGRendererDecoratorUtil } from \"./OISVGRendererDecoratorUtil\"\nimport { OISVGRendererConst } from \"./OISVGRendererConst\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class OISVGRendererStrokeUtil\n{\n\n  protected static getArcPath(center: TPointer, radius: number): string\n  {\n    const svgPath = [\n      `M ${ center.x } ${ center.y }`,\n      `m ${ -radius } 0`,\n      `a ${ radius } ${ radius } 0 1 0 ${ radius * 2 } 0`,\n      `a ${ radius } ${ radius } 0 1 0 ${ -(radius * 2) } 0`\n    ].join(\" \")\n    return svgPath\n  }\n\n  protected static getLinePath(begin: TPointer, end: TPointer, width: number): string\n  {\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, end), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(begin, end), width)\n    const svgPath = [\n      `M ${ linkPoints1[0].x } ${ linkPoints1[0].y }`,\n      `L ${ linkPoints2[0].x } ${ linkPoints2[0].y }`,\n      `L ${ linkPoints2[1].x } ${ linkPoints2[1].y }`,\n      `L ${ linkPoints1[1].x } ${ linkPoints1[1].y }`\n    ].join(\" \")\n    return svgPath\n  }\n\n  protected static getFinalPath(begin: TPointer, end: TPointer, width: number): string\n  {\n    const ARCSPLIT = 6\n    const angle = computeAngleAxeRadian(begin, end)\n    const linkPoints = computeLinksPointers(end, angle, width)\n    const parts = [`M ${ linkPoints[0].x } ${ linkPoints[0].y }`]\n    for (let i = 1; i <= ARCSPLIT; i++) {\n      const newAngle = angle - (i * (Math.PI / ARCSPLIT))\n      const x = +(end.x - (end.p * width * Math.sin(newAngle))).toFixed(3)\n      const y = +(end.y + (end.p * width * Math.cos(newAngle))).toFixed(3)\n      parts.push(`L ${ x } ${ y }`)\n    }\n    const svgPath = parts.join(\" \")\n    return svgPath\n  }\n\n  protected static getQuadraticPath(begin: TPointer, end: TPointer, central: TPointer, width: number): string\n  {\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, central), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(central, end), width)\n    const linkPoints3 = computeLinksPointers(central, computeAngleAxeRadian(begin, end), width)\n    const svgPath = [\n      `M ${ linkPoints1[0].x } ${ linkPoints1[0].y }`,\n      `Q ${ linkPoints3[0].x } ${ linkPoints3[0].y } ${ linkPoints2[0].x } ${ linkPoints2[0].y }`,\n      `L ${ linkPoints2[1].x } ${ linkPoints2[1].y }`,\n      `Q ${ linkPoints3[1].x } ${ linkPoints3[1].y } ${ linkPoints1[1].x } ${ linkPoints1[1].y }`\n    ].join(\" \")\n    return svgPath\n  }\n\n  static getSVGPath(stroke: OIStroke): string\n  {\n    const STROKE_LENGTH = stroke.pointers.length\n    if (!STROKE_LENGTH) return \"\"\n    const STROKE_WIDTH = (stroke.style.width as number)\n    const NB_QUADRATICS = STROKE_LENGTH - 2\n    const firstPoint = stroke.pointers[0]\n\n    const parts = []\n    if (STROKE_LENGTH < 3) {\n      parts.push(this.getArcPath(firstPoint, STROKE_WIDTH * 0.6))\n    } else {\n      parts.push(this.getArcPath(firstPoint, STROKE_WIDTH * firstPoint.p))\n      parts.push(this.getLinePath(firstPoint, computeMiddlePointer(firstPoint, stroke.pointers[1]), STROKE_WIDTH))\n\n      for (let i = 0; i < NB_QUADRATICS; i++) {\n        const begin = computeMiddlePointer(stroke.pointers[i], stroke.pointers[i + 1])\n        const end = computeMiddlePointer(stroke.pointers[i + 1], stroke.pointers[i + 2])\n        const central = stroke.pointers[i + 1]\n        parts.push(this.getQuadraticPath(begin, end, central, STROKE_WIDTH)\n        )\n      }\n      const beforeLastPoint = stroke.pointers[STROKE_LENGTH - 2]\n      const lastPoint = stroke.pointers[STROKE_LENGTH - 1]\n      parts.push(this.getLinePath(computeMiddlePointer(beforeLastPoint, lastPoint), lastPoint, STROKE_WIDTH))\n      parts.push(this.getFinalPath(beforeLastPoint, lastPoint, STROKE_WIDTH))\n    }\n    return parts.join(\" \")\n  }\n\n  static getSVGElement(stroke: OIStroke): SVGGraphicsElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": stroke.id,\n      \"type\": \"stroke\",\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n    }\n    if (stroke.selected) {\n      attrs[\"filter\"] = `url(#${ OISVGRendererConst.selectionFilterId })`\n    }\n    if (stroke.deleting) {\n      attrs[\"filter\"] = `url(#${ OISVGRendererConst.removalFilterId })`\n    }\n\n    const strokeGroup = SVGBuilder.createGroup(attrs)\n\n    const strokeAttrs: { [key: string]: string } = {\n      \"fill\": stroke.style.color || DefaultStyle.color!,\n      \"stroke-width\": (stroke.style.width || DefaultStyle.width!).toString(),\n      \"opacity\": (stroke.style.opacity || DefaultStyle.opacity!).toString(),\n      \"d\": OISVGRendererStrokeUtil.getSVGPath(stroke)\n    }\n    strokeGroup.append(SVGBuilder.createPath(strokeAttrs))\n\n    stroke.decorators.forEach(d =>\n    {\n      const deco = OISVGRendererDecoratorUtil.getSVGElement(d, stroke)\n      if (deco) {\n        if (d.kind === DecoratorKind.Highlight) {\n          strokeGroup.prepend(deco)\n        }\n        else {\n          strokeGroup.append(deco)\n        }\n      }\n    })\n\n    return strokeGroup\n  }\n\n}\n","import { DecoratorKind, OIText } from \"../../primitive\"\nimport { DefaultStyle } from \"../../style\"\nimport { OISVGRendererDecoratorUtil } from \"./OISVGRendererDecoratorUtil\"\nimport { OISVGRendererConst } from \"./OISVGRendererConst\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class OISVGRendererTextUtil\n{\n  static getSVGElement(text: OIText): SVGGraphicsElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": text.id,\n      \"type\": text.type,\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n      \"style\": OISVGRendererConst.noSelection,\n      \"opacity\": (text.style.opacity || DefaultStyle.opacity!).toString(),\n    }\n    if (text.rotation) {\n      attrs.transform = `rotate(${ text.rotation.degree }, ${ text.rotation.center.x }, ${ text.rotation.center.y })`\n    }\n    if (text.selected) {\n      attrs[\"filter\"] = `url(#${ OISVGRendererConst.selectionFilterId })`\n    }\n    if (text.deleting) {\n      attrs[\"filter\"] = `url(#${ OISVGRendererConst.removalFilterId })`\n    }\n\n    const textGroup = SVGBuilder.createGroup(attrs)\n\n    const textElement = SVGBuilder.createText(text.point, \"\")\n\n    text.chars.forEach(c =>\n    {\n      const attrs: { [key: string]: string } = {\n        id: c.id,\n        fill: c.color,\n        \"font-size\": `${ c.fontSize }px`,\n        \"font-weight\": c.fontWeight.toString(),\n      }\n      textElement.appendChild(SVGBuilder.createTSpan(c.label, attrs))\n    })\n    textGroup.append(textElement)\n\n    text.decorators.forEach(d =>\n    {\n      const deco = OISVGRendererDecoratorUtil.getSVGElement(d, text)\n      if (deco) {\n        if (d.kind === DecoratorKind.Highlight) {\n          textGroup.prepend(deco)\n        }\n        else {\n          textGroup.append(deco)\n        }\n      }\n    })\n\n    return textGroup\n  }\n}\n","import { DecoratorKind, OIEraser, OISymbolGroup, SymbolType, TOISymbol } from \"../../primitive\"\nimport { DefaultStyle } from \"../../style\"\nimport { OISVGRendererDecoratorUtil } from \"./OISVGRendererDecoratorUtil\"\nimport { OISVGRendererEdgeUtil } from \"./OISVGRendererEdgeUtil\"\nimport { OISVGRendererShapeUtil } from \"./OISVGRendererShapeUtil\"\nimport { OISVGRendererStrokeUtil } from \"./OISVGRendererStrokeUtil\"\nimport { OISVGRendererConst } from \"./OISVGRendererConst\"\nimport { SVGBuilder } from \"./SVGBuilder\"\nimport { OISVGRendererTextUtil } from \"./OISVGRendererTextUtil\"\n\n/**\n * @group Renderer\n */\nexport class OISVGRendererGroupUtil\n{\n\n  static getChildElement(symbol: TOISymbol | OIEraser): SVGGraphicsElement | undefined\n  {\n    let element: SVGGraphicsElement | undefined\n    switch (symbol.type) {\n      case SymbolType.Stroke:\n        element = OISVGRendererStrokeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Shape:\n        element = OISVGRendererShapeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Edge:\n        element = OISVGRendererEdgeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Text:\n        element = OISVGRendererTextUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Group:\n        element = OISVGRendererGroupUtil.getSVGElement(symbol)\n        break\n    }\n    return element\n  }\n\n  static getSVGElement(symbolGroup: OISymbolGroup): SVGGraphicsElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": symbolGroup.id,\n      \"type\": \"group\",\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n      \"fill\": symbolGroup.style.color || DefaultStyle.color!,\n      \"stroke-width\": (symbolGroup.style.width || DefaultStyle.width!).toString(),\n      \"opacity\": (symbolGroup.style.opacity || DefaultStyle.opacity!).toString(),\n    }\n    if (symbolGroup.selected) {\n      attrs[\"filter\"] = `url(#${ OISVGRendererConst.selectionFilterId })`\n    }\n    if (symbolGroup.deleting) {\n      attrs[\"filter\"] = `url(#${ OISVGRendererConst.removalFilterId })`\n    }\n\n    const groupEl = SVGBuilder.createGroup(attrs)\n\n    symbolGroup.children.forEach(sym =>\n    {\n      groupEl.append(OISVGRendererGroupUtil.getChildElement(sym)!)\n    })\n\n    symbolGroup.decorators.forEach(d =>\n    {\n      const deco = OISVGRendererDecoratorUtil.getSVGElement(d, symbolGroup)\n      if (deco) {\n        if (d.kind === DecoratorKind.Highlight) {\n          groupEl.prepend(deco)\n        }\n        else {\n          groupEl.append(deco)\n        }\n      }\n    })\n\n    return groupEl\n  }\n\n}\n","\n/**\n * @group Gesture\n * @description List all authorized gestures\n */\nexport type TGestureType = \"UNDERLINE\" | \"SCRATCH\" | \"JOIN\" | \"INSERT\" | \"STRIKETHROUGH\" | \"SURROUND\"\n\n/**\n * @group Gesture\n * @remarks\n *  when gestureType = \"INSERT\", subStrokes represent the two parts\n *  when gestureType = \"SCRATCH\", subStrokes represent the part to substract at the stroke corresponding fullStrokeId\n */\nexport type TGesture = {\n  gestureType: TGestureType\n  gestureStrokeId: string\n  strokeIds: string[]\n  strokeBeforeIds: string[]\n  strokeAfterIds: string[]\n  subStrokes?: { fullStrokeId: string, x: number[], y: number[] }[]\n}\n\n/**\n * @group Gesture\n * @description List all action allowed on surround detected\n * @remarks only usable in the case of offscreen\n */\nexport enum SurroundAction\n{\n  Select = \"select\",\n  Surround = \"surround\",\n  Highlight = \"highlight\"\n}\n\n/**\n * @group Gesture\n * @description List all action allowed on strikeThrough detected\n * @remarks only usable in the case of offscreen\n */\nexport enum StrikeThroughAction\n{\n  Erase = \"erase\",\n  Draw = \"draw\"\n}\n\n/**\n * @group Gesture\n * @description List all action allowed on split detected\n * @remarks only usable in the case of offscreen\n */\nexport enum InsertAction\n{\n  /**\n   * Add lien break on gesture place\n   */\n  LineBreak = \"line-break\",\n  /**\n   * Insert place in gesture place\n   */\n  Insert = \"insert\"\n}\n","import { SvgElementRole } from \"../../Constants\"\nimport { TRenderingConfiguration } from \"../../configuration\"\nimport { LoggerClass, LoggerManager } from \"../../logger\"\nimport { TOISymbol, TPoint, TBoundingBox, Box, OIEraser, SymbolType } from \"../../primitive\"\nimport { getClosestPoints } from \"../../utils\"\nimport { OISVGRendererConst } from \"./OISVGRendererConst\"\nimport { OISVGRendererEdgeUtil } from \"./OISVGRendererEdgeUtil\"\nimport { OISVGRendererEraserUtil } from \"./OISVGRendererEraserUtil\"\nimport { OISVGRendererGroupUtil } from \"./OISVGRendererGroupUtil\"\nimport { OISVGRendererShapeUtil } from \"./OISVGRendererShapeUtil\"\nimport { OISVGRendererStrokeUtil } from \"./OISVGRendererStrokeUtil\"\nimport { OISVGRendererTextUtil } from \"./OISVGRendererTextUtil\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class OISVGRenderer\n{\n  #logger = LoggerManager.getLogger(LoggerClass.RENDERER)\n  groupGuidesId = \"guides-wrapper\"\n\n  configuration: TRenderingConfiguration\n  parent!: HTMLElement\n  layer!: SVGElement\n  definitionGroup!: SVGGElement\n\n  verticalGuides: number[] = []\n  horizontalGuides: number[] = []\n\n  constructor(configuration: TRenderingConfiguration)\n  {\n    this.#logger.info(\"constructor\", { configuration })\n    this.configuration = configuration\n  }\n\n  protected initLayer(): void\n  {\n    const width = Math.max(this.configuration.minWidth, this.parent.clientWidth)\n    const height = Math.max(this.configuration.minHeight, this.parent.clientHeight)\n    this.layer = SVGBuilder.createLayer({ x: 0, y: 0, width, height })\n    this.layer.style.setProperty(\"height\", \"auto\")\n    this.layer.style.setProperty(\"width\", \"auto\")\n    this.layer.appendChild(this.createSVGTools())\n    this.parent.style.setProperty(\"overflow\", \"auto\")\n    this.parent.appendChild(this.layer)\n  }\n\n  protected createDefs(): SVGDefsElement\n  {\n    const defs = SVGBuilder.createDefs()\n\n    const SIZE = 5\n    const REFX = SIZE - 1, REFY = SIZE / 2\n    const arrowHeadMarkerAttrs = {\n      style: OISVGRendererConst.noSelection,\n      fill: \"context-stroke\",\n      markerWidth: SIZE.toString(),\n      markerHeight: SIZE.toString(),\n      refX: REFX.toString(),\n      refY: REFY.toString(),\n    }\n\n    const arrowHeadStart = SVGBuilder.createMarker(OISVGRendererConst.arrowHeadStartMarker, { ...arrowHeadMarkerAttrs, orient: \"auto-start-reverse\" })\n    arrowHeadStart.appendChild(SVGBuilder.createPolygon([0, 0, SIZE, REFY, 0, SIZE], arrowHeadMarkerAttrs))\n    defs.appendChild(arrowHeadStart)\n\n    const arrowHeadEnd = SVGBuilder.createMarker(OISVGRendererConst.arrowHeadEndMaker, { ...arrowHeadMarkerAttrs, orient: \"auto\" })\n    arrowHeadEnd.appendChild(SVGBuilder.createPolygon([0, 0, SIZE, REFY, 0, SIZE], arrowHeadMarkerAttrs))\n    defs.appendChild(arrowHeadEnd)\n\n    const crossMarkerAttrs = {\n      style: OISVGRendererConst.noSelection,\n      markerWidth: \"5\",\n      markerHeight: \"5\",\n      refX: \"0\",\n      refY: \"0\",\n      viewBox: \"-5 -5 10 10\"\n    }\n    const cross = SVGBuilder.createMarker(OISVGRendererConst.crossMarker, crossMarkerAttrs)\n    cross.appendChild(SVGBuilder.createPath({ d: \"M -4,-4 L 4,4 M -4,4 L 4,-4\", stroke: \"white\", \"stroke-width\": \"3\" }))\n    cross.appendChild(SVGBuilder.createPath({ d: \"M -4,-4 L 4,4 M -4,4 L 4,-4\", stroke: \"context-stroke\", \"stroke-width\": \"2\" }))\n    defs.appendChild(cross)\n\n    return defs\n  }\n\n  protected createFilters(): SVGGElement\n  {\n    const filtersGroup = SVGBuilder.createGroup({ id: \"definition-group\" })\n    const removalFilter = SVGBuilder.createFilter(OISVGRendererConst.removalFilterId, { filterUnits: \"userSpaceOnUse\" })\n    const bfeComponentTransfer = SVGBuilder.createComponentTransfert()\n    const bfeFuncA = SVGBuilder.createTransfertFunctionTable(\"feFuncA\", \"0 0.25\")\n    bfeComponentTransfer.appendChild(bfeFuncA)\n    removalFilter.appendChild(bfeComponentTransfer)\n    filtersGroup.appendChild(removalFilter)\n\n    const selectionFilter = SVGBuilder.createFilter(OISVGRendererConst.selectionFilterId, { filterUnits: \"userSpaceOnUse\" })\n    selectionFilter.appendChild(SVGBuilder.createDropShadow({ dx: -1, dy: -1, deviation: 1 }))\n    filtersGroup.appendChild(selectionFilter)\n\n    return filtersGroup\n  }\n\n  protected drawGuides(): void\n  {\n    this.verticalGuides = []\n    this.horizontalGuides = []\n    const height = Number(this.layer.getAttribute(\"height\")?.replace(\"px\", \"\"))\n    const width = Number(this.layer.getAttribute(\"width\")?.replace(\"px\", \"\"))\n    const offSet = this.configuration.guides.gap\n    const subOffSet = this.configuration.guides.gap / 5\n    const attrs = {\n      id: this.groupGuidesId,\n      stroke: \"grey\",\n      opacity: \"0.5\",\n      style: OISVGRendererConst.noSelection,\n      role: SvgElementRole.Guide\n    }\n    const guidesGroup = SVGBuilder.createGroup(attrs)\n    switch (this.configuration.guides.type) {\n      case \"line\":\n        for (let y = offSet; y < height; y += offSet) {\n          const begin: TPoint = { x: offSet, y }\n          const end: TPoint = { x: width - offSet, y }\n          this.horizontalGuides.push(y)\n          const svgLine = SVGBuilder.createLine(begin, end, { \"stroke-width\": \"1\", style: OISVGRendererConst.noSelection })\n          guidesGroup.appendChild(svgLine)\n        }\n        break\n      case \"grid\":\n        for (let y = 0; y < height; y += offSet) {\n          const begin: TPoint = { x: 0, y }\n          const end: TPoint = { x: width, y }\n          const svgLine = SVGBuilder.createLine(begin, end, { \"stroke-width\": \"1\", style: OISVGRendererConst.noSelection })\n          guidesGroup.appendChild(svgLine)\n          this.horizontalGuides.push(y)\n          for (let subY = y + subOffSet; subY < y + offSet; subY += subOffSet) {\n            this.horizontalGuides.push(subY)\n            const svgLine = SVGBuilder.createLine({ x: 0, y: subY }, { x: width, y: subY }, { \"stroke-width\": \"0.25\", style: OISVGRendererConst.noSelection })\n            guidesGroup.appendChild(svgLine)\n          }\n        }\n        for (let x = 0; x < width; x += offSet) {\n          const begin: TPoint = { x, y: 0 }\n          const end: TPoint = { x, y: height }\n          const svgLine = SVGBuilder.createLine(begin, end, { \"stroke-width\": \"1\", style: OISVGRendererConst.noSelection })\n          guidesGroup.appendChild(svgLine)\n          this.verticalGuides.push(x)\n          for (let subX = x + subOffSet; subX < x + offSet; subX += subOffSet) {\n            this.verticalGuides.push(subX)\n            const svgLine = SVGBuilder.createLine({ x: subX, y: 0 }, { x: subX, y: height }, { \"stroke-width\": \"0.25\", style: OISVGRendererConst.noSelection })\n            guidesGroup.appendChild(svgLine)\n          }\n        }\n        break\n      case \"point\":\n        for (let x = offSet; x < width; x += offSet) {\n          this.verticalGuides.push(x)\n          for (let y = offSet; y < height; y += offSet) {\n            this.horizontalGuides.push(y)\n            const svgPoint = SVGBuilder.createCircle({ x, y }, 1)\n            guidesGroup.appendChild(svgPoint)\n          }\n        }\n        break\n      default:\n        this.#logger.error(\"drawGuides\", `Guide type unknow: ${ this.configuration.guides.type }`)\n        break\n    }\n    this.horizontalGuides = [...new Set(this.horizontalGuides)]\n    this.verticalGuides = [...new Set(this.verticalGuides)]\n    this.definitionGroup.appendChild(guidesGroup)\n  }\n\n  protected removeGuides(): void\n  {\n    this.verticalGuides = []\n    this.horizontalGuides = []\n    this.layer.querySelector(`#${ this.groupGuidesId }`)?.remove()\n  }\n\n  protected createSVGTools(): SVGGElement\n  {\n    this.definitionGroup = SVGBuilder.createGroup({ id: \"definition-group\" })\n    this.definitionGroup.appendChild(this.createDefs())\n    this.definitionGroup.appendChild(this.createFilters())\n    if (this.configuration.guides.enable) {\n      this.drawGuides()\n    }\n    return this.definitionGroup\n  }\n\n  init(element: HTMLElement): void\n  {\n    this.#logger.info(\"init\", { element })\n    this.parent = element\n    this.parent.oncontextmenu = () => false\n    this.initLayer()\n  }\n\n  getAttribute(id: string, name: string): string | undefined | null\n  {\n    const element = this.layer.querySelector(`#${ id }`) as HTMLElement | null\n    return element?.getAttribute(name)\n  }\n\n  setAttribute(id: string, name: string, value: string): void\n  {\n    const element = this.layer.querySelector(`#${ id }`) as HTMLElement | null\n    element?.setAttribute(name, value)\n  }\n\n  buildElementFromSymbol(symbol: TOISymbol | OIEraser): SVGGraphicsElement | undefined\n  {\n    let element: SVGGraphicsElement | undefined\n    switch (symbol.type) {\n      case SymbolType.Stroke:\n        element = OISVGRendererStrokeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Eraser:\n        element = OISVGRendererEraserUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Shape:\n        element = OISVGRendererShapeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Edge:\n        element = OISVGRendererEdgeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Text:\n        element = OISVGRendererTextUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Group:\n        element = OISVGRendererGroupUtil.getSVGElement(symbol)\n        break\n      default:\n        this.#logger.error(\"buildElementFromSymbol\", `symbol unknow: \"${ JSON.stringify(symbol) }\"`)\n    }\n    return element\n  }\n\n  prependElement(el: Element): void\n  {\n    this.layer.prepend(el)\n  }\n\n  changeOrderSymbol(symbolToMove: TOISymbol, position: \"first\" | \"last\" | \"forward\" | \"backward\"): void\n  {\n    const moveEl = this.layer.querySelector(`#${ symbolToMove.id }`)\n    if (!moveEl) return\n    switch (position) {\n      case \"first\":\n        this.definitionGroup.insertAdjacentElement(\"afterend\", moveEl)\n        break\n      case \"last\":\n        this.layer.insertAdjacentElement(\"beforeend\", moveEl)\n        break\n      case \"forward\":\n        moveEl.nextElementSibling?.insertAdjacentElement(\"afterend\", moveEl)\n        break\n      case \"backward\":\n        if (moveEl.previousElementSibling !== this.definitionGroup) {\n          moveEl.previousElementSibling?.insertAdjacentElement(\"beforebegin\", moveEl)\n        }\n        break\n    }\n  }\n\n  appendElement(el: Element): void\n  {\n    this.layer.appendChild(el)\n  }\n\n  removeElement(id: string): void\n  {\n    this.#logger.debug(\"Element\", { id })\n    const oldStroke = this.layer.querySelector(`#${ id }`)\n    if (oldStroke) {\n      oldStroke.remove()\n    }\n  }\n\n  drawSymbol(symbol: TOISymbol | OIEraser): SVGGraphicsElement | undefined\n  {\n    this.#logger.debug(\"drawSymbol\", { symbol })\n    const oldNode = this.layer.querySelector(`#${ symbol?.id }`)\n    const svgEl = this.buildElementFromSymbol(symbol)\n\n    if (svgEl) {\n      if (oldNode) {\n        oldNode.replaceWith(svgEl)\n      }\n      else {\n        this.layer.appendChild(svgEl)\n      }\n    }\n    return svgEl\n  }\n\n  replaceSymbol(id: string, symbols: TOISymbol[]): SVGGraphicsElement[] | undefined\n  {\n    this.#logger.debug(\"drawSymbol\", { symbols })\n    const oldNode = this.layer.querySelector(`#${ id }`)\n    const elements = symbols.map(s => this.buildElementFromSymbol(s)).filter(x => !!x) as SVGGraphicsElement[]\n\n    if (elements.length) {\n      if (oldNode) {\n        elements.forEach(e => oldNode.insertAdjacentElement(\"beforebegin\", e))\n        oldNode.remove()\n      }\n      else {\n        elements.forEach(e => this.layer.appendChild(e))\n      }\n    }\n    return elements\n  }\n\n  removeSymbol(id: string): void\n  {\n    this.#logger.debug(\"removeSymbol\", { id })\n    this.removeElement(id)\n  }\n\n  drawCircle(point: TPoint, radius: number, attrs: { [key: string]: string } = {}): void\n  {\n    this.#logger.info(\"drawCircle\", { point, radius, attrs })\n    this.layer.appendChild(SVGBuilder.createCircle(point, radius, attrs))\n  }\n\n  drawRect(box: TBoundingBox, attrs: { [key: string]: string } = {}): void\n  {\n    this.#logger.info(\"drawCircle\", { box, attrs })\n    this.layer.appendChild(SVGBuilder.createRect(box, attrs))\n  }\n\n  drawLine(p1: TPoint, p2: TPoint, attrs: { [key: string]: string } = {}): void\n  {\n    this.#logger.info(\"drawLine\", { p1, p2, attrs })\n    this.layer.appendChild(SVGBuilder.createLine(p1, p2, attrs))\n  }\n\n  drawConnectionBetweenBox(id: string, box1: TBoundingBox, box2: TBoundingBox, attrs?: { [key: string]: string }): void\n  {\n    const points1: TPoint[] = new Box(box1).corners\n    const points2: TPoint[] = new Box(box2).corners\n    const { p1, p2 } = getClosestPoints(points1, points2)\n    const attrsLine = {\n      id,\n      fill: \"transparent\",\n      style: OISVGRendererConst.noSelection,\n      ...attrs\n    }\n    this.drawLine(p1, p2, attrsLine)\n  }\n\n  resize(height: number, width: number): void\n  {\n    this.#logger.info(\"resize\", { height, width })\n    this.layer.setAttribute(\"width\", `${ width }px`)\n    this.layer.setAttribute(\"height\", `${ height }px`)\n    this.layer.setAttribute(\"viewBox\", `0, 0, ${ width }, ${ height }`)\n    this.removeGuides()\n    if (this.configuration.guides.enable) {\n      this.drawGuides()\n    }\n  }\n\n  getElementById(id: string): SVGGraphicsElement | null\n  {\n    return this.layer.querySelector(`#${ id }`) as SVGGraphicsElement | null\n  }\n\n  getElements({ tagName, attrs }: { tagName?: string, attrs?: { [key: string]: string } }): NodeListOf<Element>\n  {\n    this.#logger.info(\"getElements\", { tagName, attrs })\n    let query = tagName || \"*\"\n    if (attrs) {\n      Object.keys(attrs).forEach(k =>\n      {\n        query += `[${ k }=${ attrs[k] }]`\n      })\n    }\n    return this.layer.querySelectorAll(query)\n  }\n\n  clearElements({ tagName, attrs }: { tagName?: string, attrs?: { [key: string]: string } }): void\n  {\n    this.#logger.info(\"clearElements\", { tagName, attrs })\n    this.getElements({ tagName, attrs })\n      .forEach(e => e.remove())\n  }\n\n  clear(): void\n  {\n    this.#logger.info(\"clear\")\n    if (this.layer) {\n      while (this.layer.firstChild) {\n        this.layer.firstChild.remove()\n      }\n      this.layer.appendChild(this.createSVGTools())\n    }\n  }\n\n  destroy(): void\n  {\n    if (this.layer) {\n      this.layer.remove()\n    }\n  }\n}\n","import { TPointer, TStroke } from \"../../primitive\"\nimport { computeAngleAxeRadian, computeLinksPointers, computeMiddlePointer } from \"../../utils\"\n\n/**\n * @group Renderer\n */\nexport class SVGStroker\n{\n\n  protected getArcPath(center: TPointer, radius: number): string\n  {\n    const svgPath = [\n      `M ${ center.x },${ center.y }`,\n      `m ${ -radius },0`,\n      `a ${ radius },${ radius } 0 1 0 ${ radius * 2 },0`,\n      `a ${ radius },${ radius } 0 1 0 ${ -(radius * 2) },0`\n    ].join(\" \")\n    return svgPath\n  }\n\n  protected getLinePath(begin: TPointer, end: TPointer, width: number): string\n  {\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, end), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(begin, end), width)\n    const svgPath = [\n      `M ${ linkPoints1[0].x },${ linkPoints1[0].y }`,\n      `L ${ linkPoints2[0].x },${ linkPoints2[0].y }`,\n      `L ${ linkPoints2[1].x },${ linkPoints2[1].y }`,\n      `L ${ linkPoints1[1].x },${ linkPoints1[1].y }`\n    ].join(\" \")\n    return svgPath\n  }\n\n  protected getFinalPath(begin: TPointer, end: TPointer, width: number): string\n  {\n    const ARCSPLIT = 6\n    const angle = computeAngleAxeRadian(begin, end)\n    const linkPoints = computeLinksPointers(end, angle, width)\n    const parts = [`M ${ linkPoints[0].x },${ linkPoints[0].y }`]\n    for (let i = 1; i <= ARCSPLIT; i++) {\n      const newAngle = angle - (i * (Math.PI / ARCSPLIT))\n      parts.push(`L ${ end.x - (end.p * width * Math.sin(newAngle)) },${ end.y + (end.p * width * Math.cos(newAngle)) }`)\n    }\n    const svgPath = parts.join(\" \")\n    return svgPath\n  }\n\n  protected getQuadraticPath(begin: TPointer, end: TPointer, central: TPointer, width: number): string\n  {\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, central), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(central, end), width)\n    const linkPoints3 = computeLinksPointers(central, computeAngleAxeRadian(begin, end), width)\n    const svgPath = [\n      `M ${ linkPoints1[0].x },${ linkPoints1[0].y }`,\n      `Q ${ linkPoints3[0].x },${ linkPoints3[0].y } ${ linkPoints2[0].x },${ linkPoints2[0].y }`,\n      `L ${ linkPoints2[1].x },${ linkPoints2[1].y }`,\n      `Q ${ linkPoints3[1].x },${ linkPoints3[1].y } ${ linkPoints1[1].x },${ linkPoints1[1].y }`\n    ].join(\" \")\n    return svgPath\n  }\n\n  protected buildSVGPath(stroke: TStroke): string\n  {\n    const STROKE_LENGTH = stroke.pointers.length\n    const STROKE_WIDTH = (stroke.style.width as number)\n    const NB_QUADRATICS = STROKE_LENGTH - 2\n    const firstPoint = stroke.pointers[0]\n\n    const parts = []\n    if (STROKE_LENGTH < 3) {\n      parts.push(this.getArcPath(firstPoint, STROKE_WIDTH * 0.6))\n    } else {\n      parts.push(this.getArcPath(firstPoint, STROKE_WIDTH * firstPoint.p))\n      parts.push(this.getLinePath(firstPoint, computeMiddlePointer(firstPoint, stroke.pointers[1]), STROKE_WIDTH))\n\n      for (let i = 0; i < NB_QUADRATICS; i++) {\n        const begin = computeMiddlePointer(stroke.pointers[i], stroke.pointers[i + 1])\n        const end = computeMiddlePointer(stroke.pointers[i + 1], stroke.pointers[i + 2])\n        const central = stroke.pointers[i + 1]\n        parts.push(this.getQuadraticPath(begin, end, central, STROKE_WIDTH)\n        )\n      }\n      const beforeLastPoint = stroke.pointers[STROKE_LENGTH - 2]\n      const lastPoint = stroke.pointers[STROKE_LENGTH - 1]\n      parts.push(this.getLinePath(computeMiddlePointer(beforeLastPoint, lastPoint), lastPoint, STROKE_WIDTH))\n      parts.push(this.getFinalPath(beforeLastPoint, lastPoint, STROKE_WIDTH))\n    }\n    return parts.join(\" \")\n  }\n\n  drawStroke(svgElement: SVGElement, stroke: TStroke, attrs?: { name: string, value: string }[]): void\n  {\n    const svgPathElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"path\")\n    svgPathElement.classList.add(\"pending-stroke\")\n    svgPathElement.setAttribute(\"id\", stroke.id)\n    svgPathElement.setAttribute(\"type\", stroke.pointerType)\n    attrs?.forEach(a =>\n    {\n      svgPathElement.setAttribute(a.name, a.value)\n    })\n    const svgPath = this.buildSVGPath(stroke)\n    svgPathElement.setAttribute(\"d\", `${ svgPath }Z`)\n    svgElement.appendChild(svgPathElement)\n  }\n}\n","import { TRenderingConfiguration } from \"../../configuration\"\nimport { LoggerClass, LoggerManager } from \"../../logger\"\nimport { IModel } from \"../../model\"\nimport { TStroke } from \"../../primitive\"\nimport { TUpdatePatch, TUpdatePatchAppendChild, TUpdatePatchInsertBefore, TUpdatePatchRemoveAttribut, TUpdatePatchRemoveChild, TUpdatePatchRemoveElement, TUpdatePatchReplaceAll, TUpdatePatchReplaceELement, TUpdatePatchSetAttribut } from \"../../recognizer\"\nimport { SVGStroker } from \"./SVGStroker\"\n\n/**\n * @group Renderer\n */\nexport class WSSVGRenderer\n{\n  #logger = LoggerManager.getLogger(LoggerClass.RENDERER)\n\n  config: TRenderingConfiguration\n  stroker: SVGStroker\n  context!: {\n    parent: HTMLElement\n  }\n\n  constructor(config: TRenderingConfiguration)\n  {\n    this.#logger.info(\"constructor\", { config })\n    this.config = config\n    this.stroker = new SVGStroker()\n  }\n\n  init(element: HTMLElement): void\n  {\n    this.#logger.info(\"init\", { element })\n    element.style.fontSize = \"10px\"\n    this.context = {\n      parent: element\n    }\n  }\n\n  protected drawStroke(svgElement: SVGElement, stroke: TStroke)\n  {\n    let style: string\n    if (stroke.pointerType === \"eraser\") {\n      stroke.style.width = 12\n      style = \"fill:grey;stroke:transparent;shadowBlur:5;opacity:0.2;\"\n    } else {\n      style = `fill:${ stroke.style.color };stroke:transparent;`\n    }\n    this.stroker.drawStroke(svgElement, stroke, [{ name: \"style\", value: style }])\n  }\n\n  protected replaceAll(layerName: string, update: TUpdatePatchReplaceAll): void\n  {\n    const oldLayer = this.context.parent.querySelector(`svg[data-layer=\"${ layerName }\"]`) as SVGElement | null\n    oldLayer?.remove()\n    this.context.parent.insertAdjacentHTML(\"beforeend\", update.svg)\n    const layer = this.context.parent.querySelector(`svg[data-layer=\"${ layerName }\"]`) as SVGElement\n    if (layerName === \"MODEL\") {\n      const pendingStrokesGroup = document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\")\n      pendingStrokesGroup.id = \"pendingStrokes\"\n      layer.appendChild(pendingStrokesGroup)\n    }\n  }\n\n  protected replaceElement(update: TUpdatePatchReplaceELement): void\n  {\n    const elementToRemove = this.context.parent.querySelector(`#${ update.id }`) as HTMLElement | null\n    if (elementToRemove) {\n      const parent = elementToRemove.parentNode as HTMLElement | null | undefined\n      elementToRemove?.remove()\n      parent?.insertAdjacentHTML(\"beforeend\", update.svg)\n    }\n  }\n\n  protected appendChild(layerName: string, update: TUpdatePatchAppendChild): void\n  {\n    const parentSelector = update.parentId ? `#${ update.parentId }` : `svg[data-layer=\"${ layerName }\"]`\n    const parent = this.context.parent.querySelector(parentSelector) as HTMLElement\n    parent?.insertAdjacentHTML(\"beforeend\", update.svg)\n  }\n\n  protected removeChild(update: TUpdatePatchRemoveChild): void\n  {\n    this.context.parent.querySelector(`#${ update.parentId } > *:nth-child(${ update.index + 1 })`)?.remove()\n  }\n\n  protected removeElement(update: TUpdatePatchRemoveElement): void\n  {\n    const elementToRemove = this.context.parent.querySelector(`#${ update.id }`)\n    if (elementToRemove) {\n      if (update.id.includes(\"s\") || update.id.includes(\"MODEL\")) {\n        elementToRemove.remove()\n      } else {\n        elementToRemove.setAttribute(\"class\", \"removed-stroke\")\n        setTimeout(() =>\n        {\n          elementToRemove?.remove()\n        }, 100)\n      }\n    }\n  }\n\n  protected insertBefore(update: TUpdatePatchInsertBefore): void\n  {\n    const parent = this.context.parent.querySelector(`#${ update.refId }`) as HTMLElement | null\n    parent?.insertAdjacentHTML(\"beforebegin\", update.svg)\n  }\n\n  protected setAttribute(update: TUpdatePatchSetAttribut): void\n  {\n    const selector = update.id ? `#${ update.id }` : \"svg\"\n    const element = this.context.parent.querySelector(selector) as HTMLElement | null\n    element?.setAttribute(update.name, update.value)\n  }\n\n  protected removeAttribute(update: TUpdatePatchRemoveAttribut): void\n  {\n    const selector = update.id ? `#${ update.id }` : \"svg\"\n    const element = this.context.parent.querySelector(selector) as HTMLElement | null\n    element?.removeAttribute(update.name)\n  }\n\n  updateLayer(layerName: string, update: TUpdatePatch): void\n  {\n    this.#logger.info(\"updateLayer\", { layerName, update })\n    switch (update.type) {\n      case \"REPLACE_ALL\":\n        this.replaceAll(layerName, update as TUpdatePatchReplaceAll)\n        break\n      case \"REPLACE_ELEMENT\":\n        this.replaceElement(update as TUpdatePatchReplaceELement)\n        break\n      case \"APPEND_CHILD\":\n        this.appendChild(layerName, update as TUpdatePatchAppendChild)\n        break\n      case \"REMOVE_ELEMENT\":\n        this.removeElement(update as TUpdatePatchRemoveElement)\n        break\n      case \"REMOVE_CHILD\":\n        this.removeChild(update as TUpdatePatchRemoveChild)\n        break\n      case \"INSERT_BEFORE\":\n        this.insertBefore(update as TUpdatePatchInsertBefore)\n        break\n      case \"SET_ATTRIBUTE\":\n        this.setAttribute(update as TUpdatePatchSetAttribut)\n        break\n      case \"REMOVE_ATTRIBUTE\":\n        this.removeAttribute(update as TUpdatePatchRemoveAttribut)\n        break\n      default:\n        this.#logger.warn(\"updateLayer\", `update.type unknow ${update.type}`)\n        break\n    }\n  }\n\n  updatesLayer(layerName: string, updates: TUpdatePatch[]): void\n  {\n    this.#logger.info(\"updatesLayer\", { layerName, updates })\n    updates.forEach(u => this.updateLayer(layerName, u))\n    this.clearPendingStroke()\n  }\n\n  clearPendingStroke(): void\n  {\n    this.#logger.info(\"clearPendingStroke\")\n    const pendingStrokeGroup = this.context.parent.querySelector(\"#pendingStrokes\") as SVGElement\n    if (pendingStrokeGroup) {\n      pendingStrokeGroup.innerHTML = \"\"\n    }\n  }\n\n  drawPendingStroke(stroke: TStroke): void\n  {\n    this.#logger.info(\"drawPendingStroke\", { stroke })\n    if (stroke) {\n      const pendingStrokeGroup = this.context.parent.querySelector(\"#pendingStrokes\") as SVGElement\n      if (pendingStrokeGroup) {\n        const oldStroke = pendingStrokeGroup.querySelector(`#${ stroke?.id }`)\n        if (oldStroke) {\n          oldStroke.remove()\n        }\n        this.drawStroke(pendingStrokeGroup, stroke)\n      }\n    }\n  }\n\n  clearErasingStrokes(): void\n  {\n    const erasingStrokeList = this.context.parent.querySelectorAll(\"[type=eraser]\") as NodeListOf<SVGElement>\n    erasingStrokeList.forEach(erasingStroke => {\n      erasingStroke.remove()\n    })\n  }\n\n  resize(model: IModel): void\n  {\n    this.#logger.info(\"resize\", { model })\n    const rect = this.context.parent.getBoundingClientRect()\n    const svgList = this.context.parent.querySelectorAll(\"svg\")\n    const width = Math.max(rect.width, model.width)\n    const height = Math.max(rect.height, model.height)\n    svgList.forEach(svg =>\n    {\n      svg.setAttribute(\"viewBox\", `0 0 ${ width }, ${ height }`)\n      svg.setAttribute(\"width\", `${ width }px`)\n      svg.setAttribute(\"height\", `${ height }px`)\n    })\n  }\n\n  destroy(): void\n  {\n    this.#logger.info(\"destroy\", { context: this.context })\n    if (this.context?.parent) {\n      this.context.parent.querySelectorAll(\"svg\").forEach(n => n.remove())\n    }\n  }\n}\n","import { OIBehaviors } from \"../behaviors\"\nimport { LoggerManager, LoggerClass } from \"../logger\"\nimport\n{\n  OIModel,\n  TJIIXChar,\n  TJIIXEdgeArc,\n  TJIIXEdgeElement,\n  JIIXEdgeKind,\n  TJIIXEdgeLine,\n  TJIIXEdgePolyEdge,\n  TJIIXExport,\n  TJIIXNodeCircle,\n  TJIIXNodeElement,\n  TJIIXNodeEllipse,\n  JIIXNodeKind,\n  TJIIXNodeParrallelogram,\n  TJIIXNodePolygon,\n  TJIIXNodeRectangle,\n  TJIIXNodeRhombus,\n  TJIIXNodeTriangle,\n  TJIIXTextElement,\n  TJIIXWord\n} from \"../model\"\nimport\n{\n  Box,\n  DecoratorKind,\n  OIDecorator,\n  OIEdgeArc,\n  OIEdgeLine,\n  OIEdgePolyLine,\n  OIShapeCircle,\n  OIShapeEllipse,\n  OIShapePolygon,\n  OIStroke,\n  OISymbolGroup,\n  OIText,\n  SymbolType,\n  TOIEdge,\n  TOIShape,\n  TOISymbol,\n  TOISymbolChar,\n  TPoint\n} from \"../primitive\"\nimport { computeAngleAxeRadian, computeAverage, convertBoundingBoxMillimeterToPixel, convertMillimeterToPixel, createUUID } from \"../utils\"\n\n/**\n * @group Manager\n */\nexport class OIConversionManager\n{\n  #logger = LoggerManager.getLogger(LoggerClass.CONVERTER)\n  behaviors: OIBehaviors\n  fontSize?: number\n  fontWeight?: \"bold\" | \"normal\"\n\n  constructor(behaviors: OIBehaviors, fontStyle?: { size?: number | undefined, weight?: (\"bold\" | \"normal\") | undefined })\n  {\n    this.#logger.info(\"constructor\")\n    this.behaviors = behaviors\n    this.fontSize = fontStyle?.size\n    this.fontWeight = fontStyle?.weight\n  }\n\n  get model(): OIModel\n  {\n    return this.behaviors.model\n  }\n\n  get rowHeight(): number\n  {\n    return this.behaviors.configuration.rendering.guides.gap\n  }\n\n  protected computeFontSize(chars: TJIIXChar[]): number\n  {\n    if (chars.some(c => c[\"bounding-box\"])) {\n      const height = convertMillimeterToPixel(computeAverage(chars.map(c => c[\"bounding-box\"]?.height || 1)))\n      return Math.round(Math.round(height * this.rowHeight) / this.rowHeight / 2) * 2\n    }\n    return Math.round(this.rowHeight / 2)\n  }\n\n  buildChar(char: TJIIXChar, strokes: OIStroke[], fontSize: number): TOISymbolChar\n  {\n    const points = char.grid.map(p => ({\n      x: convertMillimeterToPixel(p.x),\n      y: convertMillimeterToPixel(p.y),\n    }))\n    let fontWeight = this.fontWeight\n    if (!fontWeight) {\n      fontWeight = (strokes[0].style.width || 1) > 2 ? \"bold\" : \"normal\"\n    }\n\n    const color = strokes[0].style.color || \"black\"\n    return {\n      id: `text-char-${ createUUID() }`,\n      label: char.label,\n      color,\n      fontSize,\n      fontWeight,\n      bounds: Box.createFromPoints(points)\n    }\n  }\n\n  buildWord(word: TJIIXWord, chars: TJIIXChar[], strokes: OIStroke[], fontSize?: number): OIText\n  {\n    const boundingBox = Box.createFromBoxes([convertBoundingBoxMillimeterToPixel(word[\"bounding-box\"])])\n    const charSymbols: TOISymbolChar[] = []\n    fontSize = fontSize || this.computeFontSize(chars)\n\n    chars.forEach(char =>\n    {\n      const charStrokes = strokes.filter(s => char.items?.some(i => i[\"full-id\"] === s.id)) as OIStroke[]\n      if (charStrokes.length) {\n        charSymbols.push(this.buildChar(char, charStrokes, fontSize!))\n      }\n    })\n    const point: TPoint = {\n      x: boundingBox.xMin,\n      y: boundingBox.yMax\n    }\n    const text = new OIText(charSymbols, point, boundingBox, strokes[0].style)\n    const decorators = strokes.flatMap(s => s.decorators)\n    strokes.forEach(s =>\n    {\n      const sym = this.model.getRootSymbol(s.id)\n      if (sym?.type === SymbolType.Group) {\n        const g = sym as OISymbolGroup\n        const hightlight = g.decorators.find(d => d.kind === DecoratorKind.Highlight)\n        if (hightlight) decorators.push(hightlight)\n        const strikethrough = g.decorators.find(d => d.kind === DecoratorKind.Strikethrough)\n        if (strikethrough) decorators.push(strikethrough)\n        const surround = g.decorators.find(d => d.kind === DecoratorKind.Surround)\n        if (surround) decorators.push(surround)\n        const underline = g.decorators.find(d => d.kind === DecoratorKind.Underline)\n        if (underline) decorators.push(underline)\n      }\n    })\n    if (decorators.length) {\n      const hightlight = decorators.find(d => d.kind === DecoratorKind.Highlight)\n      if (hightlight) {\n        text.decorators.push(new OIDecorator(DecoratorKind.Highlight, hightlight.style))\n      }\n      const strikethrough = decorators.find(d => d.kind === DecoratorKind.Strikethrough)\n      if (strikethrough) {\n        text.decorators.push(new OIDecorator(DecoratorKind.Strikethrough, strikethrough.style))\n      }\n      const surround = decorators.find(d => d.kind === DecoratorKind.Surround)\n      if (surround) {\n        text.decorators.push(new OIDecorator(DecoratorKind.Surround, surround.style))\n      }\n      const underline = decorators.find(d => d.kind === DecoratorKind.Underline)\n      if (underline) {\n        text.decorators.push(new OIDecorator(DecoratorKind.Underline, underline.style))\n      }\n    }\n\n    return text\n  }\n\n  convertText(text: TJIIXTextElement, strokes: OIStroke[], onlyText: boolean): { symbol: OIText, strokes: OIStroke[] }[] | undefined\n  {\n    if (!text.words) {\n      throw new Error(\"You need to active configuration.recognition.export.jiix.text.words = true\")\n    }\n    if (!text.chars) {\n      throw new Error(\"You need to active configuration.recognition.export.jiix.text.chars = true\")\n    }\n    if (!text.chars.some(c => c.items)) {\n      throw new Error(\"You need to active configuration.recognition.export.jiix.strokes = true\")\n    }\n\n    const jiixWords = text.words as TJIIXWord[]\n    const jiixChars = text.chars as TJIIXChar[]\n\n    const result: { symbol: OIText, strokes: OIStroke[] }[] = []\n\n    const textBounds = convertBoundingBoxMillimeterToPixel(text[\"bounding-box\"])\n    let fontSize = this.fontSize\n    if (onlyText && !fontSize) {\n      fontSize = Math.round(this.computeFontSize(jiixChars.filter(c => c.items?.length)) / 2) * 2\n    }\n\n    let isNewLine = false\n    let currentY = textBounds.y + this.rowHeight\n    let currentX = convertMillimeterToPixel(jiixWords[0][\"bounding-box\"]?.x || 0)\n    jiixWords.forEach(word =>\n    {\n      if (word.label === \" \") {\n        currentX += this.behaviors.texter.getSpaceWidth(result.at(-1)?.symbol.chars[0].fontSize || (this.rowHeight / 2))\n        return\n      }\n      const wordStrokes = strokes.filter(s => word.items?.some(i => i[\"full-id\"] === s.id)) as OIStroke[]\n      if (wordStrokes.length) {\n        const chars = jiixChars.slice(word[\"first-char\"] as number, (word[\"last-char\"] || 0) + 1)\n        const textSymbol = this.buildWord(word, chars, wordStrokes, fontSize)\n\n        if (onlyText) {\n          if (isNewLine) {\n            isNewLine = false\n            const nbRow = Math.round((textSymbol.point.y - currentY) / this.rowHeight) || 1\n            currentY += nbRow * this.rowHeight\n            if (Math.abs(textSymbol.point.x - textBounds.x) < this.behaviors.texter.getSpaceWidth(fontSize!) * 2) {\n              currentX = textBounds.x\n            }\n          }\n          textSymbol.point.x = currentX\n          textSymbol.point.y = this.model.roundToLineGuide(currentY)\n        }\n\n        this.behaviors.texter.setBounds(textSymbol)\n        currentX += textSymbol.bounds.width\n        result.push({\n          symbol: textSymbol,\n          strokes: wordStrokes\n        })\n      }\n      isNewLine = word.label === \"\\n\"\n    })\n\n    return result\n  }\n\n  buildCircle(circle: TJIIXNodeCircle, strokes: OIStroke[]): OIShapeCircle\n  {\n    const center: TPoint = {\n      x: convertMillimeterToPixel(circle.cx),\n      y: convertMillimeterToPixel(circle.cy)\n    }\n    return new OIShapeCircle(center, convertMillimeterToPixel(circle.r), strokes[0]?.style)\n  }\n\n  buildEllipse(ellipse: TJIIXNodeEllipse, strokes: OIStroke[]): OIShapeEllipse\n  {\n    const center: TPoint = {\n      x: convertMillimeterToPixel(ellipse.cx),\n      y: convertMillimeterToPixel(ellipse.cy),\n    }\n    return new OIShapeEllipse(center, convertMillimeterToPixel(ellipse.rx), convertMillimeterToPixel(ellipse.ry), ellipse.orientation, strokes[0]?.style)\n  }\n\n  buildRectangle(rectangle: TJIIXNodeRectangle, strokes: OIStroke[]): OIShapePolygon\n  {\n    const height = convertMillimeterToPixel(rectangle.height)\n    const width = convertMillimeterToPixel(rectangle.width)\n    const x = convertMillimeterToPixel(rectangle.x)\n    const y = convertMillimeterToPixel(rectangle.y)\n    const points: TPoint[] = [\n      { x, y },\n      { x: x + width, y },\n      { x: x + width, y: y + height },\n      { x, y: y + height }\n    ]\n    return new OIShapePolygon(points, strokes[0]?.style)\n  }\n\n  buildPolygon(polygon: TJIIXNodePolygon, strokes: OIStroke[]): OIShapePolygon\n  {\n    const points: TPoint[] = []\n    for (let i = 0; i < polygon.points.length; i += 2) {\n      points.push({\n        x: convertMillimeterToPixel(polygon.points[i]),\n        y: convertMillimeterToPixel(polygon.points[i + 1])\n      })\n    }\n\n    return new OIShapePolygon(points, strokes[0]?.style)\n  }\n\n  buildRhombus(polygon: TJIIXNodeRhombus, strokes: OIStroke[]): OIShapePolygon\n  {\n    const points: TPoint[] = []\n    for (let i = 0; i < polygon.points.length; i += 2) {\n      points.push({\n        x: convertMillimeterToPixel(polygon.points[i]),\n        y: convertMillimeterToPixel(polygon.points[i + 1])\n      })\n    }\n\n    return new OIShapePolygon(points, strokes[0]?.style)\n  }\n\n  buildTriangle(polygon: TJIIXNodeTriangle, strokes: OIStroke[]): OIShapePolygon\n  {\n    const points: TPoint[] = []\n    for (let i = 0; i < polygon.points.length; i += 2) {\n      points.push({\n        x: convertMillimeterToPixel(polygon.points[i]),\n        y: convertMillimeterToPixel(polygon.points[i + 1])\n      })\n    }\n\n    return new OIShapePolygon(points, strokes[0]?.style)\n  }\n\n  buildParallelogram(polygon: TJIIXNodeParrallelogram, strokes: OIStroke[]): OIShapePolygon\n  {\n    const points: TPoint[] = []\n    for (let i = 0; i < polygon.points.length; i += 2) {\n      points.push({\n        x: convertMillimeterToPixel(polygon.points[i]),\n        y: convertMillimeterToPixel(polygon.points[i + 1])\n      })\n    }\n\n    return new OIShapePolygon(points, strokes[0]?.style)\n  }\n\n  convertNode(node: TJIIXNodeElement, strokes: OIStroke[]): { symbol: TOIShape, strokes: OIStroke[] } | undefined\n  {\n    const associatedStroke = strokes.filter(s => node.items?.some(i => i[\"full-id\"] === s.id))\n    if (!associatedStroke.length) return\n\n    const uniqStrokes = associatedStroke.filter((a, i) => associatedStroke.findIndex((s) => a.id === s.id) === i)\n\n    let shape: TOIShape\n    switch (node.kind) {\n      case JIIXNodeKind.Circle:\n        shape = this.buildCircle(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Ellipse:\n        shape = this.buildEllipse(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Rectangle:\n        shape = this.buildRectangle(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Triangle:\n        shape = this.buildTriangle(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Parallelogram:\n        shape = this.buildParallelogram(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Polygon:\n        shape = this.buildPolygon(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Rhombus:\n        shape = this.buildRhombus(node, uniqStrokes)\n        break\n      default:\n        this.#logger.warn(\"convertNode\", `Conversion of Node with kind equal to ${ JSON.stringify(node) } is unknow`)\n        return\n    }\n    return { symbol: shape, strokes: uniqStrokes }\n  }\n\n  buildLine(line: TJIIXEdgeLine, strokes: OIStroke[]): OIEdgeLine\n  {\n    const point1: TPoint = { x: convertMillimeterToPixel(line.x1), y: convertMillimeterToPixel(line.y1) }\n    const point2: TPoint = { x: convertMillimeterToPixel(line.x2), y: convertMillimeterToPixel(line.y2) }\n    const angle = computeAngleAxeRadian(point1, point2)\n\n    if (Math.abs(angle % Math.PI) < 0.1) {\n      // to adjust the line with the horizontal\n      point1.y = +((point1.y + point2.y) / 2).toFixed(3)\n      point2.y = point1.y\n    }\n    else if (Math.abs(angle % (Math.PI / 2)) < 0.1) {\n      // to adjust the line with the vertical\n      point1.x = +((point1.x + point2.x) / 2).toFixed(3)\n      point2.x = point1.x\n    }\n    return new OIEdgeLine(point1, point2, line.p1Decoration, line.p2Decoration, strokes[0]?.style)\n  }\n\n  buildPolyEdge(polyline: TJIIXEdgePolyEdge, strokes: OIStroke[]): OIEdgePolyLine\n  {\n    const start: TPoint = { x: convertMillimeterToPixel(polyline.edges[0].x1), y: convertMillimeterToPixel(polyline.edges[0].y1) }\n    const points = polyline.edges.map(e => ({ x: convertMillimeterToPixel(e.x2), y: convertMillimeterToPixel(e.y2) }))\n    points.unshift(start)\n    for (let index = 0; index < points.length - 1; index++) {\n      const p1 = points[index]\n      const p2 = points[index + 1]\n      const angle = computeAngleAxeRadian(p1, p2)\n      if (Math.abs(angle % Math.PI) < 0.1) {\n        p1.y = +((p1.y + p2.y) / 2).toFixed(3)\n        p2.y = p1.y\n      }\n      else if (Math.abs(angle % (Math.PI / 2)) < 0.1) {\n        p1.x = +((p1.x + p2.x) / 2).toFixed(3)\n        p2.x = p1.x\n      }\n    }\n\n    return new OIEdgePolyLine(points, polyline.edges[0].p1Decoration, polyline.edges.at(-1)!.p2Decoration, strokes[0]?.style)\n  }\n\n  buildArc(arc: TJIIXEdgeArc, strokes: OIStroke[]): OIEdgeArc\n  {\n    const center: TPoint = { x: convertMillimeterToPixel(arc.cx), y: convertMillimeterToPixel(arc.cy) }\n    const radiusX = convertMillimeterToPixel(arc.rx)\n    const radiusY = convertMillimeterToPixel(arc.ry)\n    return new OIEdgeArc(center, arc.startAngle, arc.sweepAngle, radiusX, radiusY, arc.phi, arc.startDecoration, arc.endDecoration, strokes[0]?.style)\n  }\n\n  convertEdge(edge: TJIIXEdgeElement, strokes: OIStroke[]): { symbol: TOIEdge, strokes: OIStroke[] } | undefined\n  {\n    switch (edge.kind) {\n      case JIIXEdgeKind.Line: {\n        const associatedStroke = strokes.filter(s => edge.items?.some(i => i[\"full-id\"] === s.id))\n        if (!associatedStroke.length) return\n        const uniqStrokes = associatedStroke.filter((a, i) => associatedStroke.findIndex((s) => a.id === s.id) === i)\n        const oiEdge = this.buildLine(edge, uniqStrokes)\n        return {\n          symbol: oiEdge,\n          strokes: uniqStrokes\n        }\n      }\n      case JIIXEdgeKind.Arc: {\n        const associatedStroke = strokes.filter(s => edge.items?.some(i => i[\"full-id\"] === s.id))\n        if (!associatedStroke.length) return\n        const uniqStrokes = associatedStroke.filter((a, i) => associatedStroke.findIndex((s) => a.id === s.id) === i)\n        const oiEdge = this.buildArc(edge, uniqStrokes)\n        return {\n          symbol: oiEdge,\n          strokes: uniqStrokes\n        }\n      }\n      case JIIXEdgeKind.PolyEdge: {\n        const associatedStroke = strokes.filter(s => edge.edges.flatMap(e => e.items)?.some(i => i![\"full-id\"] === s.id))\n        if (!associatedStroke.length) return\n        const uniqStrokes = associatedStroke.filter((a, i) => associatedStroke.findIndex((s) => a.id === s.id) === i)\n        const oiEdge = this.buildPolyEdge(edge, uniqStrokes)\n        return {\n          symbol: oiEdge,\n          strokes: uniqStrokes\n        }\n      }\n      default:\n        this.#logger.error(\"convertEdge\", `Conversion of Edge with kind equal to ${ JSON.stringify(edge) } is unknow`)\n        return\n    }\n  }\n\n  async apply(symbols: TOISymbol[] = []): Promise<void>\n  {\n    this.#logger.info(\"convert\")\n    if (!this.model.exports?.[\"application/vnd.myscript.jiix\"]) {\n      await this.behaviors.export([\"application/vnd.myscript.jiix\"])\n    }\n    this.behaviors.selector.removeSelectedGroup()\n    const jiix = this.model.exports?.[\"application/vnd.myscript.jiix\"] as TJIIXExport\n    if (jiix?.elements?.length) {\n      const strokesToConvert = this.behaviors.extractStrokesFromSymbols(symbols.length ? symbols : this.model.symbols)\n\n      const onlyText = !jiix.elements?.some(e => e.type !== \"Text\")\n      const conversionResults: { symbol: TOISymbol, strokes: OIStroke[] }[] = []\n      jiix.elements.forEach(el =>\n      {\n        switch (el.type) {\n          case \"Text\": {\n            const conversion = this.convertText(el, strokesToConvert, onlyText)\n            if (conversion) {\n              conversionResults.push(...conversion)\n            }\n            break\n          }\n          case \"Node\": {\n            const conversion = this.convertNode(el, strokesToConvert)\n            if (conversion) {\n              conversionResults.push(conversion)\n            }\n            break\n          }\n          case \"Edge\": {\n            const conversion = this.convertEdge(el, strokesToConvert)\n            if (conversion) {\n              conversionResults.push(conversion)\n            }\n            break\n          }\n          default: {\n            this.#logger.warn(\"buildConversions\", `Unknow jiix element type: ${ el.type }`)\n          }\n        }\n      })\n\n      this.behaviors.addSymbols(conversionResults.map(cs => cs.symbol), false)\n      this.behaviors.removeSymbols(conversionResults.flatMap(cs => cs.strokes.map(s => s.id)), false)\n      this.behaviors.history.push(this.model, { added: conversionResults.map(c => c.symbol), erased: conversionResults.flatMap(cs => cs.strokes) })\n    }\n  }\n}\n","import { Intention } from \"../Constants\"\nimport { OIBehaviors } from \"../behaviors\"\nimport { LoggerManager, LoggerClass } from \"../logger\"\nimport { OIModel } from \"../model\"\nimport\n{\n  OIDecorator,\n  OIStroke,\n  SymbolType,\n  OIText,\n  DecoratorKind,\n  OISymbolGroup,\n  TOISymbol,\n  Box,\n  TPoint,\n} from \"../primitive\"\nimport { OIRecognizer } from \"../recognizer\"\nimport { OISVGRenderer } from \"../renderer\"\nimport { TStyle } from \"../style\"\nimport { OIHistoryManager, TOIHistoryChanges } from \"../history\"\nimport { computeAverage, isBetween } from \"../utils\"\nimport { TGesture, StrikeThroughAction, SurroundAction, InsertAction } from \"../gesture\"\nimport { OITranslateManager } from \"./OITranslateManager\"\nimport { OITextManager } from \"./OITextManager\"\n\n/**\n * @group Manager\n */\nexport class OIGestureManager\n{\n  #logger = LoggerManager.getLogger(LoggerClass.GESTURE)\n\n  insertAction: InsertAction = InsertAction.LineBreak\n  surroundAction: SurroundAction = SurroundAction.Select\n  strikeThroughAction: StrikeThroughAction = StrikeThroughAction.Draw\n  behaviors: OIBehaviors\n\n  constructor(behaviors: OIBehaviors, gestureAction?: { surround?: SurroundAction, strikeThrough?: StrikeThroughAction, insert?: InsertAction })\n  {\n    this.#logger.info(\"constructor\")\n    this.behaviors = behaviors\n    this.surroundAction = gestureAction?.surround || SurroundAction.Select\n    this.strikeThroughAction = gestureAction?.strikeThrough || StrikeThroughAction.Draw\n    this.insertAction = gestureAction?.insert || InsertAction.LineBreak\n  }\n\n  get renderer(): OISVGRenderer\n  {\n    return this.behaviors.renderer\n  }\n\n  get recognizer(): OIRecognizer\n  {\n    return this.behaviors.recognizer\n  }\n\n  get translator(): OITranslateManager\n  {\n    return this.behaviors.translator\n  }\n\n  get texter(): OITextManager\n  {\n    return this.behaviors.texter\n  }\n\n  get model(): OIModel\n  {\n    return this.behaviors.model\n  }\n\n  get history(): OIHistoryManager\n  {\n    return this.behaviors.history\n  }\n\n  get currentStyle(): TStyle\n  {\n    return this.behaviors.styler.currentPenStyle\n  }\n\n  get rowHeight(): number\n  {\n    return this.behaviors.configuration.rendering.guides.gap\n  }\n\n  get strokeSpaceWidth(): number\n  {\n    return this.behaviors.configuration.rendering.guides.gap / 2\n  }\n\n  async applySurroundGesture(gestureStroke: OIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.info(\"applySurroundGesture\", { gestureStroke, gesture })\n    const changes: TOIHistoryChanges = {}\n    const ids = this.model.symbols.filter(s => gestureStroke.bounds.contains(s.bounds)).map(s => s.id)\n    switch (this.surroundAction) {\n      case SurroundAction.Select: {\n        if (ids.length) {\n          this.behaviors.internalEvent.emitIntention(Intention.Select)\n          this.behaviors.select(ids)\n        }\n        break\n      }\n      case SurroundAction.Highlight: {\n        const symbolIds: string[] = []\n        changes.decorator = []\n        ids.forEach(id =>\n        {\n          const sym = this.model.getRootSymbol(id)\n          if (sym && [SymbolType.Group, SymbolType.Stroke, SymbolType.Text].includes(sym.type) && !symbolIds.includes(sym.id)) {\n            const symWithDec = sym as (OIText | OIStroke | OISymbolGroup)\n            const highlight = new OIDecorator(DecoratorKind.Highlight, this.currentStyle)\n            const index = symWithDec.decorators.findIndex(d => d.kind === DecoratorKind.Highlight)\n            const added = index === -1\n            added ? symWithDec.decorators.push(highlight) : symWithDec.decorators.splice(index, 1)\n            this.model.updateSymbol(symWithDec)\n            this.renderer.drawSymbol(symWithDec)\n            symbolIds.push(symWithDec.id)\n            changes.decorator!.push({ symbol: symWithDec, decorator: highlight, added })\n          }\n        })\n        if (changes.decorator.length) {\n          this.history.push(this.model, changes)\n        }\n        break\n      }\n      case SurroundAction.Surround: {\n        const symbolIds: string[] = []\n        changes.decorator = []\n        ids.forEach(id =>\n        {\n          const sym = this.model.getRootSymbol(id)\n          if (sym && [SymbolType.Group, SymbolType.Stroke, SymbolType.Text].includes(sym.type) && !symbolIds.includes(sym.id)) {\n            const symWithDec = sym as (OIText | OIStroke | OISymbolGroup)\n            const surround = new OIDecorator(DecoratorKind.Surround, this.currentStyle)\n            const index = symWithDec.decorators.findIndex(d => d.kind === DecoratorKind.Surround)\n            const added = index === -1\n            added ? symWithDec.decorators.push(surround) : symWithDec.decorators.splice(index, 1)\n            this.model.updateSymbol(symWithDec)\n            this.renderer.drawSymbol(symWithDec)\n            changes.decorator!.push({ symbol: symWithDec, decorator: surround, added })\n            symbolIds.push(symWithDec.id)\n          }\n        })\n        this.history.push(this.model, changes)\n        break\n      }\n      default:\n        this.#logger.error(\"applySurroundGesture\", `Unknow surroundAction: ${ this.surroundAction }, values allowed are: ${ SurroundAction.Highlight }, ${ SurroundAction.Select }, ${ SurroundAction.Surround }`)\n        break\n    }\n    return\n  }\n\n  protected computeScratchOnStrokes(gesture: TGesture, stroke: OIStroke): OIStroke[]\n  {\n    const newStrokes: OIStroke[] = []\n    const partPointersToRemove = gesture.subStrokes?.find(ss => ss.fullStrokeId === stroke.id)\n    if (partPointersToRemove) {\n      const strokePartToErase = new OIStroke()\n      partPointersToRemove.x.forEach((x, i) => strokePartToErase.addPointer({ x, y: partPointersToRemove.y[i], p: 1, t: 1 }))\n      const subStrokes = OIStroke.substract(stroke, strokePartToErase)\n      if (subStrokes.before) newStrokes.push(subStrokes.before)\n      if (subStrokes.after) newStrokes.push(subStrokes.after)\n    }\n    return newStrokes\n  }\n\n  protected computeScratchOnText(gestureStroke: OIStroke, textSymbol: OIText): OIText | undefined\n  {\n    const charsToRemove = textSymbol.getCharsOverlaps(gestureStroke.pointers)\n    if (textSymbol.chars.length == charsToRemove.length) {\n      return\n    }\n    else {\n      charsToRemove.forEach(c =>\n      {\n        const cIndex = textSymbol.chars.findIndex(c1 => c1.id === c.id)\n        textSymbol.chars.splice(cIndex, 1)\n      })\n      this.texter.updateBounds(textSymbol)\n      return textSymbol\n    }\n  }\n\n  protected computeScratchOnSymbol(gestureStroke: OIStroke, gesture: TGesture, symbol: TOISymbol): { erased?: boolean, replaced?: TOISymbol[] }\n  {\n    switch (symbol.type) {\n      case SymbolType.Stroke: {\n        const strokesScratchedResult = this.computeScratchOnStrokes(gesture, symbol)\n        if (strokesScratchedResult.length) {\n          return {\n            replaced: strokesScratchedResult\n          }\n        }\n        else {\n          return { erased: true }\n        }\n      }\n      case SymbolType.Group: {\n        const childrenNotTouch = symbol.extractSymbols().filter(s => !gestureStroke.bounds.overlaps(s.bounds))\n        const childrenTouch = symbol.extractSymbols().filter(s => gestureStroke.bounds.overlaps(s.bounds))\n        const results = childrenTouch.map(s =>\n        {\n          return {\n            symbol: s,\n            result: this.computeScratchOnSymbol(gestureStroke, gesture, s)\n          }\n        })\n        if (childrenNotTouch.length === 0 && results.every(r => r.result.erased)) {\n          return { erased: true }\n        }\n        else {\n          const symbolsGroup: TOISymbol[] = childrenNotTouch\n          results.forEach(r =>\n          {\n            if (r.result.replaced) {\n              symbolsGroup.push(...r.result.replaced)\n            }\n          })\n          const newGroup = new OISymbolGroup(symbolsGroup, symbol.style)\n          newGroup.decorators = symbol.decorators\n          return {\n            replaced: [newGroup]\n          }\n        }\n      }\n      case SymbolType.Text: {\n        const textScratchedResult = this.computeScratchOnText(gestureStroke, symbol)\n        if (textScratchedResult) {\n          return {\n            replaced: [textScratchedResult]\n          }\n        }\n        else {\n          return {\n            erased: true\n          }\n        }\n      }\n      case SymbolType.Shape:\n      case SymbolType.Edge:\n        return {\n          erased: true\n        }\n    }\n  }\n\n  async applyScratch(gestureStroke: OIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.debug(\"applyScratchGesture\", { gestureStroke, gesture })\n    if (!gesture.strokeIds.length) {\n      this.#logger.warn(\"applyScratchGesture\", \"Unable to apply underline because there are no strokes\")\n      return\n    }\n    const symbolsToUpdate: TOISymbol[] = []\n    const symbolsToErase: TOISymbol[] = []\n    const symbolsToReplace: { oldSymbols: TOISymbol[], newSymbols: TOISymbol[] } = { oldSymbols: [], newSymbols: [] }\n\n    gesture.strokeIds.forEach(id =>\n    {\n      const sym = this.model.getRootSymbol(id)\n      if (sym && !symbolsToErase.some(s => s.id === sym.id) && !symbolsToReplace.oldSymbols.some(s => s.id === sym.id)) {\n        const result = this.computeScratchOnSymbol(gestureStroke, gesture, sym)\n        if (result.erased) symbolsToErase.push(sym)\n        else if (result.replaced) {\n          symbolsToReplace.newSymbols.push(...result.replaced)\n          symbolsToReplace.oldSymbols.push(sym)\n        }\n      }\n    })\n\n    const promises: Promise<void | TOISymbol[]>[] = []\n    const changes: TOIHistoryChanges = {}\n    if (symbolsToUpdate.length) {\n      promises.push(this.behaviors.updateSymbols(symbolsToUpdate, false))\n      changes.updated = symbolsToUpdate\n    }\n\n    if (symbolsToErase.length) {\n      promises.push(this.behaviors.removeSymbols(symbolsToErase.map(s => s.id), false))\n      changes.erased = symbolsToErase\n    }\n\n    if (symbolsToReplace.newSymbols.length) {\n      changes.replaced = symbolsToReplace\n      promises.push(this.behaviors.replaceSymbols(symbolsToReplace.oldSymbols, symbolsToReplace.newSymbols, false))\n    }\n\n    this.history.push(this.model, changes)\n    await Promise.all(promises)\n  }\n\n  async applyJoinGesture(gestureStroke: OIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.debug(\"applyJoinGesture\", { gestureStroke, gesture })\n\n    const symbolsAbove = this.model.symbols.filter(s => this.model.isSymbolAbove(gestureStroke, s))\n    const symbolsRow = this.model.symbols.filter(s => gestureStroke.id !== s.id && this.model.isSymbolInRow(gestureStroke, s))\n\n    const symbolsBeforeGestureInRow = symbolsRow.filter(s => s.bounds.xMax <= gestureStroke.bounds.xMid)\n    const symbolsOnGestureInRow = symbolsRow.filter(s => s.bounds.xMax > gestureStroke.bounds.xMid && s.bounds.xMin <= gestureStroke.bounds.xMid)\n    const symbolsAfterGestureInRow = symbolsRow.filter(s => s.bounds.xMin > gestureStroke.bounds.xMid)\n    const symbolsBelow = this.model.symbols.filter(s => this.model.isSymbolBelow(gestureStroke, s))\n\n    const changes: TOIHistoryChanges = {}\n    const translate: { symbols: TOISymbol[], tx: number, ty: number }[] = []\n    if (symbolsOnGestureInRow.length) {\n      const symbolToJoin = symbolsOnGestureInRow[0]\n      if (symbolToJoin?.type === SymbolType.Group) {\n        const children = symbolToJoin.extractSymbols().map(c => c.clone())\n        const childBefore = children.filter(c => c.bounds.xMid <= gestureStroke.bounds.xMid)\n        const childAfter = children.filter(c => c.bounds.xMid > gestureStroke.bounds.xMid)\n        if (childBefore.length && childAfter.length) {\n          const tx = Math.max(...childBefore.map(c => c.bounds.xMax)) - Math.min(...childAfter.map(c => c.bounds.xMin))\n          childAfter.forEach(c => this.translator.applyToSymbol(c, tx, 0))\n          const newGroup = new OISymbolGroup(children, symbolToJoin.style)\n          newGroup.decorators = symbolToJoin.decorators.map(d => d.clone())\n          changes.replaced = {\n            oldSymbols: [symbolToJoin],\n            newSymbols: [newGroup]\n          }\n          if (symbolsAfterGestureInRow.length) {\n            translate.push({ symbols: symbolsAfterGestureInRow, tx, ty: 0 })\n          }\n          const symbolsAfterNextRow = symbolsBelow.filter(s => this.model.isSymbolBelow(symbolToJoin, s))\n          if (symbolsAfterNextRow.length) {\n            translate.push({ symbols: symbolsAfterNextRow, tx: 0, ty: -this.rowHeight })\n          }\n        }\n        else if (symbolsAfterGestureInRow.length) {\n          const tx = symbolToJoin.bounds.xMax - Math.min(...symbolsAfterGestureInRow.map(s => s.bounds.xMin))\n          translate.push({ symbols: symbolsAfterGestureInRow, tx, ty: 0 })\n        }\n      }\n    }\n    else if (symbolsBeforeGestureInRow.length && symbolsAfterGestureInRow.length) {\n      const lastSymbBefore = this.model.getLastSymbol(symbolsBeforeGestureInRow)!\n      const firstSymbolAfter = this.model.getFirstSymbol(symbolsAfterGestureInRow)!\n\n      const lastXBefore = Math.max(...symbolsBeforeGestureInRow.map(s => s.bounds.xMax))\n      const firstXAfter = Math.min(...symbolsAfterGestureInRow.map(s => s.bounds.xMin))\n      const translateX = lastXBefore - firstXAfter\n\n      const lastSymbBeforeClone = lastSymbBefore.clone()\n      const firstSymbolAfterClone = firstSymbolAfter.clone()\n      this.translator.applyToSymbol(firstSymbolAfterClone, translateX, 0)\n      const symbolsToGroup = lastSymbBefore.type === SymbolType.Group ? (lastSymbBeforeClone as OISymbolGroup).extractSymbols() : [lastSymbBeforeClone]\n      symbolsToGroup.push(...(firstSymbolAfterClone.type === SymbolType.Group ? (firstSymbolAfterClone as OISymbolGroup).extractSymbols() : [firstSymbolAfterClone]))\n\n      if (symbolsToGroup.every(s => s.type === SymbolType.Text)) {\n        const texts = symbolsToGroup as OIText[]\n        const text = new OIText(texts.flatMap(s => s.chars), texts[0].point, Box.createFromBoxes(texts.map(t => t.bounds)))\n        this.texter.setBounds(text)\n        changes.replaced = {\n          oldSymbols: [lastSymbBefore, firstSymbolAfter],\n          newSymbols: [text]\n        }\n      }\n      else {\n        const group = new OISymbolGroup(symbolsToGroup, lastSymbBefore.style)\n        if ([SymbolType.Group, SymbolType.Stroke, SymbolType.Text].includes(lastSymbBefore.type)) {\n          (lastSymbBefore as OIStroke).decorators.forEach(d =>\n          {\n            group.decorators.push(new OIDecorator(d.kind, d.style))\n          })\n        }\n        if ([SymbolType.Group, SymbolType.Stroke, SymbolType.Text].includes(firstSymbolAfter.type)) {\n          (firstSymbolAfter as OIStroke).decorators.forEach(d =>\n          {\n            if (!group.decorators.some(d1 => d1.kind == d.kind)) {\n              group.decorators.push(new OIDecorator(d.kind, d.style))\n            }\n          })\n        }\n\n        changes.replaced = {\n          oldSymbols: [lastSymbBefore, firstSymbolAfter],\n          newSymbols: [group]\n        }\n      }\n\n      const rest = symbolsAfterGestureInRow.filter(s => s.id !== firstSymbolAfter.id)\n      if (rest.length) {\n        translate.push({ symbols: rest, tx: translateX, ty: 0 })\n      }\n    }\n    else if (symbolsBeforeGestureInRow.length) {\n      const lastSymbolBeforeGesture = this.model.getLastSymbol(symbolsBeforeGestureInRow)!\n      const firstSymbolAfterGesture = this.model.getFirstSymbol(symbolsBelow)\n      if (firstSymbolAfterGesture) {\n        if (this.model.roundToLineGuide(lastSymbolBeforeGesture.bounds.yMid) >= this.model.roundToLineGuide(firstSymbolAfterGesture.bounds.yMid - this.rowHeight)) {\n          const symbolInNextRow = symbolsBelow.filter(s => this.model.isSymbolInRow(firstSymbolAfterGesture, s))\n          if (symbolInNextRow.length) {\n            const translateX = lastSymbolBeforeGesture.bounds.xMax + this.strokeSpaceWidth - firstSymbolAfterGesture.bounds.xMin\n            translate.push({ symbols: symbolInNextRow, tx: translateX, ty: -this.rowHeight })\n          }\n          const symbolsAfterNextRow = symbolsBelow.filter(s => this.model.isSymbolBelow(firstSymbolAfterGesture, s))\n          if (symbolsAfterNextRow.length) {\n            translate.push({ symbols: symbolsAfterNextRow, tx: 0, ty: -this.rowHeight })\n          }\n        }\n      }\n      else {\n        translate.push({ symbols: symbolsBelow, tx: 0, ty: -this.rowHeight })\n      }\n    }\n    else if (symbolsAfterGestureInRow.length) {\n      const firstSymbolAfterGesture = this.model.getFirstSymbol(symbolsAfterGestureInRow)!\n      const lastSymbolAbove = this.model.getLastSymbol(symbolsAbove)\n      if (lastSymbolAbove) {\n        if (this.model.roundToLineGuide(lastSymbolAbove.bounds.yMid) >= this.model.roundToLineGuide(firstSymbolAfterGesture.bounds.yMid - this.rowHeight)) {\n          const translateX = lastSymbolAbove.bounds.xMax + this.strokeSpaceWidth - firstSymbolAfterGesture.bounds.xMin\n          translate.push({ symbols: symbolsAfterGestureInRow, tx: translateX, ty: -this.rowHeight })\n        }\n        else {\n          translate.push({ symbols: symbolsAfterGestureInRow, tx: 0, ty: -this.rowHeight })\n        }\n\n        if (symbolsBelow.length) {\n          translate.push({ symbols: symbolsBelow, tx: 0, ty: -this.rowHeight })\n        }\n      }\n      else {\n        translate.push({ symbols: symbolsAfterGestureInRow.concat(...symbolsBelow), tx: 0, ty: -this.rowHeight })\n      }\n\n    }\n    if (changes.replaced?.oldSymbols.length) {\n      this.behaviors.replaceSymbols(changes.replaced.oldSymbols, changes.replaced.newSymbols, false)\n    }\n    if (translate.length) {\n      changes.translate = translate\n      Promise.all(translate.map(tr => this.translator.translate(tr.symbols, tr.tx, tr.ty, false)))\n    }\n    this.history.push(this.model, changes)\n  }\n\n  protected createStrokesFromGestureSubStroke(strokeOrigin: OIStroke, subStrokes: { x: number[], y: number[] }[]): OIStroke[]\n  {\n    const strokes: OIStroke[] = []\n    if (subStrokes[0]) {\n      const subStroke = new OIStroke(strokeOrigin.style)\n      subStrokes![0].x.forEach((x, i) =>\n      {\n        subStroke.pointers.push({\n          x,\n          y: subStrokes![0].y[i],\n          p: strokeOrigin.pointers.at(i)?.p || 1,\n          t: strokeOrigin.pointers.at(i)?.t || Math.max(...subStroke.pointers.map(p => p.t + 20))\n        })\n      })\n      strokes.push(subStroke)\n    }\n    if (subStrokes[1]) {\n      const subStroke = new OIStroke(strokeOrigin.style)\n      subStrokes[1].x.forEach((x, i) =>\n      {\n        subStroke.pointers.push({\n          x,\n          y: subStrokes![1].y[i],\n          p: strokeOrigin.pointers.at(subStroke.pointers.length + i)?.p || 1,\n          t: strokeOrigin.pointers.at(subStroke.pointers.length + i)?.t || Math.max(...subStroke.pointers.map(p => p.t + 20))\n        })\n      })\n      strokes.push(subStroke)\n    }\n    return strokes\n  }\n\n  protected computeSplitStroke(strokeOrigin: OIStroke, subStrokes: { x: number[], y: number[] }[]): { before?: OIStroke, after?: OIStroke }\n  {\n    let after: OIStroke | undefined\n    const newStrokes = this.createStrokesFromGestureSubStroke(strokeOrigin, subStrokes)\n\n    if (newStrokes[1]) {\n      after = newStrokes[1]\n      this.translator.applyToSymbol(after, this.strokeSpaceWidth, 0)\n    }\n    return {\n      before: newStrokes[0],\n      after\n    }\n  }\n\n  protected computeSplitStrokeInGroup(gestureStroke: OIStroke, group: OISymbolGroup, subStrokes: { fullStrokeId: string, x: number[], y: number[] }[]): OISymbolGroup[]\n  {\n    const newGroups: OISymbolGroup[] = []\n    const groupSymbols = group.extractSymbols()\n\n    const symbolsBefore: TOISymbol[] = []\n    const symbolsAfter: TOISymbol[] = []\n\n    const strokeIdToSplit = subStrokes[0].fullStrokeId\n\n    groupSymbols.forEach(gs =>\n    {\n      if (gs.id === strokeIdToSplit) {\n        const subStroke = this.computeSplitStroke(gs as OIStroke, subStrokes)\n        if (subStroke.before) {\n          symbolsBefore.push(subStroke.before)\n        }\n        if (subStroke.after) {\n          symbolsAfter.push(subStroke.after)\n        }\n      }\n      else if (gs.bounds.xMid < gestureStroke.bounds.xMid) {\n        symbolsBefore.push(gs)\n      }\n      else if (gs.bounds.xMid > gestureStroke.bounds.xMid) {\n        this.translator.applyToSymbol(gs, this.strokeSpaceWidth, 0)\n        symbolsAfter.push(gs)\n      }\n    })\n\n    if (symbolsBefore.length) {\n      newGroups.push(new OISymbolGroup(symbolsBefore, group.style))\n    }\n    if (symbolsAfter.length) {\n      newGroups.push(new OISymbolGroup(symbolsAfter, group.style))\n    }\n    return newGroups\n  }\n\n  protected computeChangesOnSplitStroke(gestureStroke: OIStroke, strokeIdToSplit: string, subStrokes: { fullStrokeId: string, x: number[], y: number[] }[]): TOIHistoryChanges\n  {\n    const translate: { symbols: TOISymbol[], tx: number, ty: number }[] = []\n    const replaced: { oldSymbols: TOISymbol[], newSymbols: TOISymbol[] } = { oldSymbols: [], newSymbols: [] }\n\n    const symbolsAfterGestureInRow = this.model.symbols.filter(s => gestureStroke.id !== s.id && this.model.isSymbolInRow(gestureStroke, s) && gestureStroke.bounds.xMid < s.bounds.xMin)\n\n    const symbolToSplit = this.model.getRootSymbol(strokeIdToSplit)\n    if (symbolToSplit?.type === SymbolType.Group) {\n      const newGroups = this.computeSplitStrokeInGroup(gestureStroke, symbolToSplit, subStrokes)\n      replaced.newSymbols.push(...newGroups)\n      replaced.oldSymbols.push(symbolToSplit)\n    }\n    else if (symbolToSplit?.type === SymbolType.Stroke) {\n      const newStrokes = this.computeSplitStroke(symbolToSplit, subStrokes)\n      if (newStrokes.before) {\n        replaced.newSymbols.push(newStrokes.before)\n      }\n      if (newStrokes.after) {\n        replaced.newSymbols.push(newStrokes.after)\n      }\n      replaced.oldSymbols.push(symbolToSplit)\n    }\n    if (symbolsAfterGestureInRow.length) {\n      translate.push({ symbols: symbolsAfterGestureInRow, tx: this.strokeSpaceWidth, ty: 0 })\n    }\n\n    return {\n      translate,\n      replaced\n    }\n  }\n\n  protected computeChangesOnSplitGroup(gestureStroke: OIStroke, groupToSplit: OISymbolGroup): TOIHistoryChanges\n  {\n    const translate: { symbols: TOISymbol[], tx: number, ty: number }[] = []\n    const replaced: { oldSymbols: TOISymbol[], newSymbols: TOISymbol[] } = { oldSymbols: [], newSymbols: [] }\n\n    const symbolsAfterGestureInRow = this.model.symbols.filter(s => gestureStroke.id !== s.id && this.model.isSymbolInRow(gestureStroke, s) && gestureStroke.bounds.xMid < s.bounds.xMin)\n\n    const groupSymbolsBefore = groupToSplit.children.filter(s => s.bounds.xMid <= gestureStroke.bounds.xMid)\n    const groupsSymbolsAfter = groupToSplit.children.filter(s => s.bounds.xMid > gestureStroke.bounds.xMid)\n\n    replaced.oldSymbols.push(groupToSplit)\n    if (groupSymbolsBefore.length) {\n      const groupBefore = new OISymbolGroup(groupSymbolsBefore.map(s => s.clone()), groupToSplit.style)\n      groupBefore.decorators = groupToSplit.decorators.map(d => new OIDecorator(d.kind, d.style))\n      replaced.newSymbols.push(groupBefore)\n    }\n    if (groupsSymbolsAfter.length) {\n      const grouAfter = new OISymbolGroup(groupsSymbolsAfter.map(s => s.clone()), groupToSplit.style)\n      grouAfter.decorators = groupToSplit.decorators.map(d => new OIDecorator(d.kind, d.style))\n      this.translator.applyToSymbol(grouAfter, this.strokeSpaceWidth, 0)\n      replaced.newSymbols.push(grouAfter)\n    }\n    if (symbolsAfterGestureInRow?.length) {\n      translate.push({ symbols: symbolsAfterGestureInRow.filter(s => s.id !== groupToSplit.id), tx: this.strokeSpaceWidth, ty: 0 })\n    }\n\n    return {\n      translate,\n      replaced\n    }\n  }\n\n  protected computeChangesOnSplitText(gestureStroke: OIStroke, textToSplit: OIText): TOIHistoryChanges\n  {\n    const translate: { symbols: TOISymbol[], tx: number, ty: number }[] = []\n    const replaced: { oldSymbols: TOISymbol[], newSymbols: TOISymbol[] } = { oldSymbols: [], newSymbols: [] }\n\n    const symbolsAfterGestureInRow = this.model.symbols.filter(s => gestureStroke.id !== s.id && this.model.isSymbolInRow(gestureStroke, s) && gestureStroke.bounds.xMid < s.bounds.xMin)\n\n    const charsBefore = textToSplit.chars.filter(c => c.bounds.x + c.bounds.width / 2 <= gestureStroke.bounds.xMid)\n    const charsAfter = textToSplit.chars.filter(c => c.bounds.x + c.bounds.width / 2 > gestureStroke.bounds.xMid)\n    const newTexts: OIText[] = []\n    if (charsBefore.length && charsAfter.length) {\n      const textBefore = new OIText(charsBefore, textToSplit.point, Box.createFromBoxes(charsBefore.map(c => c.bounds)))\n      this.texter.setBounds(textBefore)\n      newTexts.push(textBefore)\n      const pointAfter: TPoint = {\n        x: textBefore.point.x + textBefore.bounds.width + this.texter.getSpaceWidth(computeAverage(textBefore.chars.map(c => c.fontSize))),\n        y: textBefore.point.y\n      }\n      const textAfter = new OIText(charsAfter, pointAfter, Box.createFromBoxes(charsAfter.map(c => c.bounds)))\n      this.texter.setBounds(textAfter)\n      newTexts.push(textAfter)\n      replaced.newSymbols = newTexts\n      replaced.oldSymbols = [textToSplit]\n    }\n    if (symbolsAfterGestureInRow?.length) {\n      translate.push({ symbols: symbolsAfterGestureInRow.filter(s => s.id !== gestureStroke.id), tx: this.strokeSpaceWidth, ty: 0 })\n    }\n\n    return {\n      translate,\n      replaced\n    }\n  }\n\n  async applyInsertGesture(gestureStroke: OIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.debug(\"applyInsertGesture\", { gestureStroke, gesture })\n\n    const symbolsRow = this.model.symbols.filter(s => gestureStroke.id !== s.id && this.model.isSymbolInRow(gestureStroke, s))\n    const textToSplit = symbolsRow.find(s => s.type === SymbolType.Text && isBetween(gestureStroke.bounds.xMid, s.bounds.xMin, s.bounds.xMax)) as OIText | undefined\n    const groupToSplit = symbolsRow.find(s => s.type === SymbolType.Group && isBetween(gestureStroke.bounds.xMid, s.bounds.xMin, s.bounds.xMax)) as OISymbolGroup | undefined\n\n    const symbolsBeforeGestureInRow = symbolsRow.filter(s => gestureStroke.bounds.xMid > s.bounds.xMax)\n    const symbolsAfterGestureInRow = symbolsRow.filter(s => gestureStroke.bounds.xMid < s.bounds.xMin)\n\n    const symbolsBelow = this.model.symbols.filter(s => this.model.isSymbolBelow(gestureStroke, s))\n\n\n    let changes: TOIHistoryChanges | undefined\n    if (gesture.strokeIds.length && gesture.subStrokes?.length) {\n      changes = this.computeChangesOnSplitStroke(gestureStroke, gesture.strokeIds[0], gesture.subStrokes)\n    }\n    else if (groupToSplit) {\n      changes = this.computeChangesOnSplitGroup(gestureStroke, groupToSplit)\n    }\n    else if (textToSplit) {\n      changes = this.computeChangesOnSplitText(gestureStroke, textToSplit)\n    }\n    else if (symbolsAfterGestureInRow.length) {\n      const translate: { symbols: TOISymbol[], tx: number, ty: number }[] = []\n      let translateX = 0\n      if (symbolsBeforeGestureInRow.length) {\n        translateX = Math.min(...symbolsBeforeGestureInRow.map(s => s.bounds.xMin)) - Math.min(...symbolsAfterGestureInRow.map(s => s.bounds.xMin))\n      }\n\n      switch (this.insertAction) {\n        case InsertAction.LineBreak:\n          translate.push({ symbols: symbolsAfterGestureInRow, tx: translateX, ty: this.rowHeight })\n          if (symbolsBelow.length) {\n            translate.push({ symbols: symbolsBelow, tx: 0, ty: this.rowHeight })\n          }\n          break\n        case InsertAction.Insert:\n          translate.push({ symbols: symbolsAfterGestureInRow, tx: this.strokeSpaceWidth * 2, ty: 0 })\n          break\n      }\n      changes = { translate }\n    }\n    else if (symbolsBeforeGestureInRow.length && symbolsBelow.length && this.insertAction === InsertAction.LineBreak) {\n      changes = { translate: [{ symbols: symbolsBelow, tx: 0, ty: this.rowHeight }] }\n    }\n\n    if (changes) {\n      const promises: Promise<void>[] = []\n      if (changes.translate?.length) {\n        promises.push(...changes.translate.map(tr => this.translator.translate(tr.symbols, tr.tx, tr.ty, false)))\n      }\n      if (changes.replaced?.newSymbols.length) {\n        promises.push(this.behaviors.replaceSymbols(changes.replaced.oldSymbols, changes.replaced.newSymbols, false))\n      }\n      this.history.push(this.model, changes)\n      await Promise.all(promises)\n    }\n  }\n\n  async applyUnderlineGesture(gestureStroke: OIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.debug(\"applyUnderlineGesture\", { gestureStroke, gesture })\n    if (!gesture.strokeIds.length) {\n      this.#logger.warn(\"applyUnderlineGesture\", \"Unable to apply underline because there are no strokes\")\n      return\n    }\n\n    const changes: TOIHistoryChanges = { decorator: [] }\n    const symbolIds: string[] = []\n    gesture.strokeIds.forEach(id =>\n    {\n      const sym = this.model.getRootSymbol(id)\n      if (sym && [SymbolType.Group, SymbolType.Stroke, SymbolType.Text].includes(sym.type) && !symbolIds.includes(sym.id)) {\n        const symWithDec = sym as (OIText | OIStroke | OISymbolGroup)\n        const underline = new OIDecorator(DecoratorKind.Underline, this.currentStyle)\n        const index = symWithDec.decorators.findIndex(d => d.kind === DecoratorKind.Underline)\n        const added = index === -1\n        added ? symWithDec.decorators.push(underline) : symWithDec.decorators.splice(index, 1)\n        this.model.updateSymbol(symWithDec)\n        this.renderer.drawSymbol(symWithDec)\n        changes.decorator?.push({ symbol: symWithDec, decorator: underline, added })\n        symbolIds.push(symWithDec.id)\n      }\n    })\n    if (changes.decorator?.length) {\n      this.history.push(this.model, changes)\n    }\n  }\n\n  async applyStrikeThroughGesture(gestureStroke: OIStroke, gesture: TGesture): Promise<void | TOISymbol[]>\n  {\n    this.#logger.debug(\"applyStrikeThroughGesture\", { gestureStroke, gesture })\n    if (!gesture.strokeIds.length) {\n      this.#logger.warn(\"applyStrikeThroughGesture\", \"Unable to apply strikethrough because there are no strokes\")\n      return\n    }\n    switch (this.strikeThroughAction) {\n      case StrikeThroughAction.Draw: {\n        const changes: TOIHistoryChanges = { decorator: [] }\n        const symbolIds: string[] = []\n        gesture.strokeIds.forEach(id =>\n        {\n          const symbol = this.model.getRootSymbol(id)\n          if (symbol && [SymbolType.Group, SymbolType.Stroke, SymbolType.Text].includes(symbol.type) && !symbolIds.includes(symbol.id)) {\n            const symWithDec = symbol as (OIText | OIStroke | OISymbolGroup)\n            const strikethrough = new OIDecorator(DecoratorKind.Strikethrough, this.currentStyle)\n            const index = symWithDec.decorators.findIndex(d => d.kind === DecoratorKind.Strikethrough)\n            const added = index === -1\n            added ? symWithDec.decorators.push(strikethrough) : symWithDec.decorators.splice(index, 1)\n            this.model.updateSymbol(symWithDec)\n            this.renderer.drawSymbol(symWithDec)\n            changes.decorator?.push({ symbol: symWithDec, decorator: strikethrough, added })\n            symbolIds.push(symWithDec.id)\n          }\n        })\n        if (changes.decorator?.length) {\n          this.history.push(this.model, changes)\n        }\n        break\n      }\n      case StrikeThroughAction.Erase: {\n        return this.behaviors.removeSymbols(gesture.strokeIds)\n      }\n      default:\n        this.#logger.warn(\"#applyStrikeThroughGesture\", `Unknow OnStrikeThrough: ${ this.strikeThroughAction }, values allowed are: ${ StrikeThroughAction.Draw }, ${ StrikeThroughAction.Erase }`)\n        break\n    }\n  }\n\n  async apply(gestureStroke: OIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.info(\"apply\", { gestureStroke, gesture })\n    this.behaviors.updateSymbolsStyle([gestureStroke.id], { opacity: (gestureStroke.style.opacity || 1) / 2 }, false)\n    await this.behaviors.groupStrokesByJIIXElement()\n    await this.behaviors.removeSymbol(gestureStroke.id, false)\n    switch (gesture.gestureType) {\n      case \"UNDERLINE\":\n        await this.applyUnderlineGesture(gestureStroke, gesture)\n        break\n      case \"SCRATCH\":\n        await this.applyScratch(gestureStroke, gesture)\n        break\n      case \"JOIN\":\n        await this.applyJoinGesture(gestureStroke, gesture)\n        break\n      case \"INSERT\":\n        await this.applyInsertGesture(gestureStroke, gesture)\n        break\n      case \"STRIKETHROUGH\":\n        await this.applyStrikeThroughGesture(gestureStroke, gesture)\n        break\n      case \"SURROUND\":\n        await this.applySurroundGesture(gestureStroke, gesture)\n        break\n      default:\n        this.#logger.warn(\"apply\", `Gesture unknow: ${ gesture.gestureType }`)\n        break\n    }\n\n    this.behaviors.svgDebugger.apply()\n    return Promise.resolve()\n  }\n\n  async getGestureFromContextLess(gestureStroke: OIStroke): Promise<TGesture | undefined>\n  {\n    const gesture = await this.recognizer.recognizeGesture(gestureStroke)\n    if (!gesture) return\n    switch (gesture.gestureType) {\n      case \"surround\": {\n        const hasSymbolsToSurrond = this.model.symbols.some(s =>\n        {\n          if (s.id !== gestureStroke.id && gestureStroke.bounds.contains(s.bounds)) {\n            return this.surroundAction === SurroundAction.Select || [SymbolType.Group, SymbolType.Stroke, SymbolType.Text].includes(s.type)\n          }\n          return false\n        })\n        if (hasSymbolsToSurrond) {\n          return {\n            gestureType: \"SURROUND\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: [],\n          }\n        }\n        return\n      }\n      case \"left-right\":\n      case \"right-left\": {\n        const symbolsToUnderline = this.model.symbols.filter(s =>\n        {\n          return [SymbolType.Text, SymbolType.Stroke, SymbolType.Group].includes(s.type) &&\n            isBetween(s.bounds.xMid, gestureStroke.bounds.xMin, gestureStroke.bounds.xMax) &&\n            isBetween(gestureStroke.bounds.yMid, s.bounds.y + s.bounds.height * 3 / 4, s.bounds.y + s.bounds.height * 5 / 4)\n        })\n        if (symbolsToUnderline.length) {\n          return {\n            gestureType: \"UNDERLINE\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: symbolsToUnderline.map(s => s.id),\n          }\n        }\n        const symbolsToStrikeThrough = this.model.symbols.filter(s =>\n        {\n          return [SymbolType.Text, SymbolType.Stroke, SymbolType.Group].includes(s.type) &&\n            isBetween(s.bounds.xMid, gestureStroke.bounds.xMin, gestureStroke.bounds.xMax) &&\n            isBetween(gestureStroke.bounds.yMid, s.bounds.y + s.bounds.height / 4, s.bounds.y + s.bounds.height * 3 / 4)\n        })\n        if (symbolsToStrikeThrough.length) {\n          return {\n            gestureType: \"STRIKETHROUGH\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: symbolsToStrikeThrough.map(s => s.id),\n          }\n        }\n        return\n      }\n      case \"scratch\": {\n        const symbolsToErase = this.model.symbols.filter(s =>\n        {\n          return s.id !== gestureStroke.id &&\n            (\n              gestureStroke.bounds.overlaps(s.bounds) && [SymbolType.Stroke, SymbolType.Text, SymbolType.Group].includes(s.type) ||\n              gestureStroke.bounds.contains(s.bounds) && [SymbolType.Shape, SymbolType.Edge].includes(s.type)\n            )\n        })\n\n        if (symbolsToErase.length) {\n          return {\n            gestureType: \"SCRATCH\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: symbolsToErase.map(s => s.id),\n          }\n        }\n        return\n      }\n      case \"bottom-top\": {\n        const hasSymbolsInRow = this.model.symbols.some(s =>\n          s.id !== gestureStroke.id &&\n          [SymbolType.Text, SymbolType.Stroke, SymbolType.Group].includes(s.type) &&\n          isBetween(s.bounds.yMid, gestureStroke.bounds.yMin, gestureStroke.bounds.yMax)\n        )\n        if (hasSymbolsInRow) {\n          return {\n            gestureType: \"JOIN\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: [],\n          }\n        }\n        return\n      }\n      case \"top-bottom\": {\n        const hasSymbolsInRow = this.model.symbols.some(s =>\n          s.id !== gestureStroke.id &&\n          [SymbolType.Text, SymbolType.Stroke, SymbolType.Group].includes(s.type) &&\n          isBetween(s.bounds.yMid, gestureStroke.bounds.yMin, gestureStroke.bounds.yMax)\n        )\n        if (hasSymbolsInRow) {\n          return {\n            gestureType: \"INSERT\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: [],\n          }\n        }\n        return\n      }\n      case \"none\":\n      default:\n        return\n    }\n  }\n}\n","import { ResizeDirection, SvgElementRole } from \"../Constants\"\nimport { OIBehaviors } from \"../behaviors\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { OIModel } from \"../model\"\nimport\n{\n  Box,\n  EdgeKind,\n  OIStroke,\n  OISymbolGroup,\n  OIText,\n  ShapeKind,\n  SymbolType,\n  TOIEdge,\n  TOIShape,\n  TOISymbol,\n  TPoint\n} from \"../primitive\"\n\n/**\n * @group Manager\n */\nexport class OIResizeManager\n{\n  #logger = LoggerManager.getLogger(LoggerClass.TRANSFORMER)\n  behaviors: OIBehaviors\n\n  interactElementsGroup?: SVGElement\n  direction!: ResizeDirection\n  boundingBox!: Box\n  transformOrigin!: TPoint\n  keepRatio = false\n\n  constructor(behaviors: OIBehaviors)\n  {\n    this.#logger.info(\"constructor\")\n    this.behaviors = behaviors\n  }\n\n  get model(): OIModel\n  {\n    return this.behaviors.model\n  }\n\n  protected applyToStroke(stroke: OIStroke, origin: TPoint, scaleX: number, scaleY: number): OIStroke\n  {\n    this.#logger.debug(\"applyToStroke\", { stroke, origin, scaleX, scaleY })\n    stroke.pointers.forEach(p =>\n    {\n      p.x = +(origin.x + scaleX * (p.x - origin.x)).toFixed(3)\n      p.y = +(origin.y + scaleY * (p.y - origin.y)).toFixed(3)\n    })\n    return stroke\n  }\n\n  protected applyToShape(shape: TOIShape, origin: TPoint, scaleX: number, scaleY: number): TOIShape\n  {\n    this.#logger.debug(\"applyToShape\", { shape, origin, scaleX, scaleY })\n    switch (shape.kind) {\n      case ShapeKind.Ellipse: {\n        const cosPhi = Math.cos(shape.orientation)\n        const sinPhi = Math.sin(shape.orientation)\n        shape.center.x = +(shape.center.x + ((scaleX - 1) * cosPhi + (scaleY - 1) * sinPhi) * (shape.center.x - origin.x)).toFixed(3)\n        shape.center.y = +(shape.center.y + ((scaleX - 1) * -sinPhi + (scaleY - 1) * cosPhi) * (shape.center.y - origin.y)).toFixed(3)\n        shape.radiusX = +(Math.abs(shape.radiusX * (scaleX * cosPhi - scaleY * sinPhi))).toFixed(3)\n        shape.radiusY = +(Math.abs(shape.radiusY * (scaleX * sinPhi + scaleY * cosPhi))).toFixed(3)\n        return shape\n      }\n      case ShapeKind.Circle: {\n        shape.radius = +(shape.radius * (scaleX + scaleY) / 2).toFixed(3)\n        shape.center.x = +(origin.x + scaleX * (shape.center.x - origin.x)).toFixed(3)\n        shape.center.y = +(origin.y + scaleY * (shape.center.y - origin.y)).toFixed(3)\n        return shape\n      }\n      case ShapeKind.Polygon: {\n        shape.points.forEach(p =>\n        {\n          p.x = +(origin.x + scaleX * (p.x - origin.x)).toFixed(3)\n          p.y = +(origin.y + scaleY * (p.y - origin.y)).toFixed(3)\n        })\n        return shape\n      }\n      default:\n        throw new Error(`Can't apply resize on shape, kind unknow: ${ JSON.stringify(shape) }`)\n    }\n  }\n\n  protected applyToEdge(edge: TOIEdge, origin: TPoint, scaleX: number, scaleY: number): TOIEdge\n  {\n    this.#logger.debug(\"applyToEdge\", { edge, origin, scaleX, scaleY })\n    switch (edge.kind) {\n      case EdgeKind.Arc: {\n        const cosPhi = Math.cos(edge.phi)\n        const sinPhi = Math.sin(edge.phi)\n        edge.center.x = +(edge.center.x + ((scaleX - 1) * cosPhi + (scaleY - 1) * sinPhi) * (edge.center.x - origin.x)).toFixed(3)\n        edge.center.y = +(edge.center.y + ((scaleX - 1) * -sinPhi + (scaleY - 1) * cosPhi) * (edge.center.y - origin.y)).toFixed(3)\n        edge.radiusX = +(edge.radiusX * Math.abs(scaleX * cosPhi + scaleY * sinPhi)).toFixed(3)\n        edge.radiusY = +(edge.radiusY * Math.abs(scaleX * sinPhi + scaleY * cosPhi)).toFixed(3)\n\n        if (scaleX < 0) {\n          edge.startAngle = +(Math.PI - edge.startAngle).toFixed(3)\n          edge.sweepAngle *= -1\n        }\n        else if (scaleY < 0) {\n          edge.sweepAngle *= -1\n        }\n        return edge\n      }\n      case EdgeKind.Line: {\n        edge.start.x = +(origin.x + scaleX * (edge.start.x - origin.x)).toFixed(3)\n        edge.start.y = +(origin.y + scaleY * (edge.start.y - origin.y)).toFixed(3)\n        edge.end.x = +(origin.x + scaleX * (edge.end.x - origin.x)).toFixed(3)\n        edge.end.y = +(origin.y + scaleY * (edge.end.y - origin.y)).toFixed(3)\n        return edge\n      }\n      case EdgeKind.PolyEdge: {\n        edge.points.forEach(p =>\n        {\n          p.x = +(origin.x + scaleX * (p.x - origin.x)).toFixed(3)\n          p.y = +(origin.y + scaleY * (p.y - origin.y)).toFixed(3)\n          return p\n        })\n        return edge\n      }\n      default:\n        throw new Error(`Can't apply resize on edge, kind unknow: ${ JSON.stringify(edge) }`)\n    }\n  }\n\n  protected applyOnText(text: OIText, origin: TPoint, scaleX: number, scaleY: number): OIText\n  {\n    text.point.x = +(origin.x + scaleX * (text.point.x - origin.x)).toFixed(3)\n    text.point.y = +(origin.y + scaleY * (text.point.y - origin.y)).toFixed(3)\n\n    text.chars.forEach(c =>\n    {\n      c.fontSize = +(c.fontSize * (scaleX + scaleY) / 2).toFixed(3)\n    })\n    return this.behaviors.texter.updateBounds(text)\n  }\n\n  protected applyOnGroup(group: OISymbolGroup, origin: TPoint, scaleX: number, scaleY: number): OISymbolGroup\n  {\n    group.children.forEach(s => this.applyToSymbol(s, origin, scaleX, scaleY))\n    return group\n  }\n\n  applyToSymbol(symbol: TOISymbol, origin: TPoint, scaleX: number, scaleY: number): TOISymbol\n  {\n    this.#logger.info(\"applyToSymbol\", { symbol, scaleX, scaleY })\n    switch (symbol.type) {\n      case SymbolType.Stroke:\n        return this.applyToStroke(symbol, origin, scaleX, scaleY)\n      case SymbolType.Shape:\n        return this.applyToShape(symbol, origin, scaleX, scaleY)\n      case SymbolType.Edge:\n        return this.applyToEdge(symbol, origin, scaleX, scaleY)\n      case SymbolType.Text:\n        return this.applyOnText(symbol, origin, scaleX, scaleY)\n      case SymbolType.Group:\n        return this.applyOnGroup(symbol, origin, scaleX, scaleY)\n      default:\n        throw new Error(`Can't apply resize on symbol, type unknow: ${ JSON.stringify(symbol) }`)\n    }\n  }\n\n  setTransformOrigin(id: string, originX: number, originY: number): void\n  {\n    this.behaviors.renderer.setAttribute(id, \"transform-origin\", `${ originX }px ${ originY }px`)\n  }\n\n  scaleElement(id: string, sx: number, sy: number): void\n  {\n    this.#logger.info(\"scaleElement\", { id, sx, sy })\n    this.behaviors.renderer.setAttribute(id, \"transform\", `scale(${ sx },${ sy })`)\n  }\n\n  start(target: Element, origin: TPoint): void\n  {\n    this.#logger.info(\"start\", { target })\n    this.interactElementsGroup = (target.closest(`[role=${ SvgElementRole.InteractElementsGroup }]`) as unknown) as SVGGElement\n    this.direction = target.getAttribute(\"resize-direction\") as ResizeDirection\n\n    this.keepRatio = this.model.symbolsSelected.some(s => s.type === SymbolType.Text || (s.type === SymbolType.Shape && (s as TOIShape).kind === ShapeKind.Circle))\n\n    this.transformOrigin = origin\n    this.boundingBox = Box.createFromPoints(this.model.symbolsSelected.flatMap(s => s.vertices))\n    this.setTransformOrigin(this.interactElementsGroup!.id, this.transformOrigin.x, this.transformOrigin.y)\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.setTransformOrigin(s.id, this.transformOrigin.x, this.transformOrigin.y)\n    })\n\n    this.behaviors.selector.hideInteractElements()\n  }\n\n  continue(point: TPoint): { scaleX: number, scaleY: number }\n  {\n    this.#logger.info(\"continue\", { point })\n    if (!this.interactElementsGroup) {\n      throw new Error(\"Can't resize, you must call start before\")\n    }\n    const localPoint = point\n    const horizontalResize = [\n      ResizeDirection.East,\n      ResizeDirection.NorthEast,\n      ResizeDirection.SouthEast,\n      ResizeDirection.West,\n      ResizeDirection.NorthWest,\n      ResizeDirection.SouthWest\n    ].includes(this.direction)\n    const verticalResize = [\n      ResizeDirection.North,\n      ResizeDirection.NorthEast,\n      ResizeDirection.NorthWest,\n      ResizeDirection.South,\n      ResizeDirection.SouthEast,\n      ResizeDirection.SouthWest\n    ].includes(this.direction)\n    const { x, y } = this.behaviors.snaps.snapResize(point, horizontalResize, verticalResize)\n    localPoint.x = x\n    localPoint.y = y\n\n    let deltaX = 0, deltaY = 0\n    if ([ResizeDirection.East, ResizeDirection.NorthEast, ResizeDirection.SouthEast].includes(this.direction)) {\n      deltaX = localPoint.x - this.boundingBox.xMax\n    }\n    else if ([ResizeDirection.West, ResizeDirection.NorthWest, ResizeDirection.SouthWest].includes(this.direction)) {\n      deltaX = this.boundingBox.xMin - localPoint.x\n    }\n\n    if ([ResizeDirection.North, ResizeDirection.NorthEast, ResizeDirection.NorthWest].includes(this.direction)) {\n      deltaY = this.boundingBox.yMin - localPoint.y\n    }\n    else if ([ResizeDirection.South, ResizeDirection.SouthEast, ResizeDirection.SouthWest].includes(this.direction)) {\n      deltaY = localPoint.y - this.boundingBox.yMax\n    }\n\n    let scaleX = this.boundingBox.width ? 1 + (deltaX / this.boundingBox.width) : 1\n    let scaleY = this.boundingBox.height ? 1 + (deltaY / this.boundingBox.height) : 1\n\n    if (this.keepRatio) {\n      if ([ResizeDirection.North, ResizeDirection.South].includes(this.direction)) {\n        scaleX = scaleY\n      }\n      else if ([ResizeDirection.East, ResizeDirection.West].includes(this.direction)) {\n        scaleY = scaleX\n      }\n      else {\n        scaleX = Math.max(scaleX, scaleY)\n        scaleY = scaleX\n      }\n    }\n    this.scaleElement(this.interactElementsGroup.id, scaleX, scaleY)\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.scaleElement(s.id, scaleX, scaleY)\n    })\n    return {\n      scaleX,\n      scaleY\n    }\n  }\n\n  async end(point: TPoint): Promise<void>\n  {\n    this.#logger.info(\"end\", { point })\n    const { scaleX, scaleY } = this.continue(point)\n    this.behaviors.snaps.clearSnapToElementLines()\n    const oldSymbols = this.model.symbolsSelected.map(s => s.clone())\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.applyToSymbol(s, this.transformOrigin, scaleX, scaleY)\n      this.behaviors.renderer.drawSymbol(s)\n      this.model.updateSymbol(s)\n    })\n\n    const strokesFromSymbols = this.behaviors.extractStrokesFromSymbols(this.model.symbolsSelected)\n    this.behaviors.recognizer.transformScale(strokesFromSymbols.map(s => s.id), scaleX, scaleY, this.transformOrigin.x, this.transformOrigin.y)\n    this.behaviors.history.push(this.model, { scale: [{ symbols: oldSymbols, origin: {...this.transformOrigin}, scaleX, scaleY }] })\n\n    this.behaviors.selector.resetSelectedGroup(this.model.symbolsSelected)\n    this.interactElementsGroup = undefined\n    this.behaviors.selector.showInteractElements()\n    this.behaviors.svgDebugger.apply()\n  }\n}\n","import { SvgElementRole } from \"../Constants\"\nimport { OIBehaviors } from \"../behaviors\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { OIModel } from \"../model\"\nimport\n{\n  Box,\n  EdgeKind,\n  OIStroke,\n  OISymbolGroup,\n  OIText,\n  ShapeKind,\n  SymbolType,\n  TOIEdge,\n  TOIShape,\n  TOISymbol,\n  TPoint\n} from \"../primitive\"\nimport { computeAngleRadian, convertDegreeToRadian, convertRadianToDegree, computeRotatedPoint } from \"../utils\"\n\n/**\n * @group Manager\n */\nexport class OIRotationManager\n{\n  #logger = LoggerManager.getLogger(LoggerClass.TRANSFORMER)\n  behaviors: OIBehaviors\n  interactElementsGroup?: SVGElement\n  center!: TPoint\n  origin!: TPoint\n\n  constructor(behaviors: OIBehaviors)\n  {\n    this.#logger.info(\"constructor\")\n    this.behaviors = behaviors\n  }\n\n  get model(): OIModel\n  {\n    return this.behaviors.model\n  }\n\n  protected applyToStroke(stroke: OIStroke, center: TPoint, angleRad: number): OIStroke\n  {\n    stroke.pointers.forEach(p =>\n    {\n      const { x, y } = computeRotatedPoint(p, center, angleRad)\n      p.x = x\n      p.y = y\n    })\n    return stroke\n  }\n\n  protected applyToShape(shape: TOIShape, center: TPoint, angleRad: number): TOIShape\n  {\n    switch (shape.kind) {\n      case ShapeKind.Ellipse: {\n        shape.center = computeRotatedPoint(shape.center, center, angleRad)\n        shape.orientation = (shape.orientation + angleRad) % (2 * Math.PI)\n        return shape\n      }\n      case ShapeKind.Circle: {\n        shape.center = computeRotatedPoint(shape.center, center, angleRad)\n        return shape\n      }\n      case ShapeKind.Polygon: {\n        shape.points.forEach(p =>\n        {\n          const { x, y } = computeRotatedPoint(p, center, angleRad)\n          p.x = x\n          p.y = y\n        })\n        return shape\n      }\n      default:\n        throw new Error(`Can't apply rotate on shape, kind unknow: ${ JSON.stringify(shape) }`)\n    }\n  }\n\n  protected applyToEdge(edge: TOIEdge, center: TPoint, angleRad: number): TOIEdge\n  {\n    switch (edge.kind) {\n      case EdgeKind.Arc: {\n        edge.phi = (edge.phi - angleRad) % (2 * Math.PI)\n        edge.center = computeRotatedPoint(edge.center, center, angleRad)\n        return edge\n      }\n      case EdgeKind.Line: {\n        edge.start = computeRotatedPoint(edge.start, center, angleRad)\n        edge.end = computeRotatedPoint(edge.end, center, angleRad)\n        return edge\n      }\n      case EdgeKind.PolyEdge: {\n        edge.points = edge.points.map(p => computeRotatedPoint(p, center, angleRad))\n        return edge\n      }\n      default:\n        throw new Error(`Can't apply rotate on edge, kind unknow: ${ JSON.stringify(edge) }`)\n    }\n    return edge\n  }\n\n  protected applyOnText(text: OIText, center: TPoint, angleRad: number): OIText\n  {\n    text.rotation = {\n      degree: convertRadianToDegree(angleRad) + (text.rotation?.degree || 0),\n      center: center\n    }\n    return this.behaviors.texter.updateBounds(text)\n  }\n\n  protected applyOnGroup(group: OISymbolGroup, center: TPoint, angleRad: number): OISymbolGroup\n  {\n    group.children.forEach(s => this.applyToSymbol(s, center, angleRad))\n    return group\n  }\n\n  applyToSymbol(symbol: TOISymbol, center: TPoint, angleRad: number): TOISymbol\n  {\n    switch (symbol.type) {\n      case SymbolType.Stroke:\n        return this.applyToStroke(symbol, center, angleRad)\n      case SymbolType.Shape:\n        return this.applyToShape(symbol, center, angleRad)\n      case SymbolType.Edge:\n        return this.applyToEdge(symbol, center, angleRad)\n      case SymbolType.Text:\n        return this.applyOnText(symbol, center, angleRad)\n      case SymbolType.Group:\n        return this.applyOnGroup(symbol, center, angleRad)\n      default:\n        throw new Error(`Can't apply rotate on symbol, type unknow: ${ JSON.stringify(symbol) }`)\n    }\n  }\n\n  setTransformOrigin(id: string, originX: number, originY: number): void\n  {\n    this.behaviors.renderer.setAttribute(id, \"transform-origin\", `${ originX }px ${ originY }px`)\n  }\n\n  rotateElement(id: string, degree: number): void\n  {\n    this.#logger.info(\"rotateElement\", { id, degree })\n    this.behaviors.renderer.setAttribute(id, \"transform\", `rotate(${ degree })`)\n  }\n\n  start(target: Element, origin: TPoint): void\n  {\n    this.#logger.info(\"start\", { target })\n    this.interactElementsGroup = (target.closest(`[role=${ SvgElementRole.InteractElementsGroup }]`) as unknown) as SVGGElement\n    const boundingBox = Box.createFromPoints(this.model.symbolsSelected.flatMap(s => s.vertices))\n\n    this.center = {\n      x: boundingBox.xMin + boundingBox.width / 2,\n      y: boundingBox.yMid\n    }\n    this.origin = origin\n    this.setTransformOrigin(this.interactElementsGroup.id, this.center.x, this.center.y)\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.setTransformOrigin(s.id, this.center.x, this.center.y)\n    })\n    this.behaviors.selector.hideInteractElements()\n  }\n\n  continue(point: TPoint): number\n  {\n    this.#logger.info(\"continue\", { point })\n    if (!this.interactElementsGroup) {\n      throw new Error(\"Can't rotate, you must call start before\")\n    }\n    let angleDegree = Math.round(convertRadianToDegree(computeAngleRadian(this.origin, this.center, point)))\n\n    angleDegree = this.behaviors.snaps.snapRotation(angleDegree)\n\n    if (point.x - this.center.x < 0) {\n      angleDegree = 360 - angleDegree\n    }\n\n    this.rotateElement(this.interactElementsGroup.id, angleDegree)\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.rotateElement(s.id, angleDegree)\n    })\n    return angleDegree\n  }\n\n  async end(point: TPoint): Promise<void>\n  {\n    this.#logger.info(\"end\", { point })\n    const angleDegree = this.continue(point)\n    const angleRad = convertDegreeToRadian(angleDegree) % (2 * Math.PI)\n    const oldSymbols = this.model.symbolsSelected.map(s => s.clone())\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.applyToSymbol(s, this.center, angleRad)\n      this.behaviors.renderer.drawSymbol(s)\n      this.model.updateSymbol(s)\n    })\n    const strokesFromSymbols = this.behaviors.extractStrokesFromSymbols(this.model.symbolsSelected)\n    this.behaviors.recognizer.transformRotate(strokesFromSymbols.map(s => s.id), angleRad, this.center.x, this.center.y)\n    this.behaviors.history.push(this.model, { rotate: [{ symbols: oldSymbols, angle: angleRad, center: {...this.center}, }] })\n\n    this.behaviors.selector.resetSelectedGroup(this.model.symbolsSelected)\n    this.interactElementsGroup = undefined\n    this.behaviors.selector.showInteractElements()\n    this.behaviors.svgDebugger.apply()\n  }\n}\n","import { ResizeDirection, SELECTION_MARGIN, SvgElementRole } from \"../Constants\"\nimport { OIBehaviors } from \"../behaviors\"\nimport { InternalEvent } from \"../event\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { OIModel } from \"../model\"\nimport { Box, OIText, SymbolType, TBoundingBox, TOISymbol, TPoint } from \"../primitive\"\nimport { OISVGRenderer, SVGBuilder } from \"../renderer\"\nimport { OIResizeManager } from \"./OIResizeManager\"\nimport { OIRotationManager } from \"./OIRotationManager\"\nimport { OITranslateManager } from \"./OITranslateManager\"\n\n/**\n * @group Manager\n */\nexport class OISelectionManager\n{\n  #logger = LoggerManager.getLogger(LoggerClass.SELECTION)\n  #selectingId = \"selecting-rect\"\n  startSelectionPoint?: TPoint\n  endSelectionPoint?: TPoint\n  selectedGroup?: SVGGElement\n\n  behaviors: OIBehaviors\n\n  constructor(behaviors: OIBehaviors)\n  {\n    this.#logger.info(\"constructor\")\n    this.behaviors = behaviors\n  }\n\n  get model(): OIModel\n  {\n    return this.behaviors.model\n  }\n\n  get renderer(): OISVGRenderer\n  {\n    return this.behaviors.renderer\n  }\n\n  get internalEvent(): InternalEvent\n  {\n    return this.behaviors.internalEvent\n  }\n\n  get rotator(): OIRotationManager\n  {\n    return this.behaviors.rotator\n  }\n\n  get translator(): OITranslateManager\n  {\n    return this.behaviors.translator\n  }\n\n  get resizer(): OIResizeManager\n  {\n    return this.behaviors.resizer\n  }\n\n  get selectionBox(): Box | undefined\n  {\n    if (this.startSelectionPoint && this.endSelectionPoint) {\n      return Box.createFromPoints([this.startSelectionPoint, this.endSelectionPoint])\n    }\n    return\n  }\n\n  drawSelectingRect(box: TBoundingBox): void\n  {\n    this.clearSelectingRect()\n    const attrs = {\n      id: this.#selectingId,\n      fill: \"transparent\",\n      stroke: \"grey\",\n      opacity: \"0.25\",\n    }\n    this.renderer.appendElement(SVGBuilder.createRect(box, attrs))\n  }\n\n  clearSelectingRect(): void\n  {\n    this.renderer.clearElements({ attrs: { id: this.#selectingId } })\n  }\n\n  protected getPoint(ev: PointerEvent): TPoint\n  {\n    const { clientLeft, scrollLeft, clientTop, scrollTop } = this.renderer.parent\n    const rect: DOMRect = this.renderer.parent.getBoundingClientRect()\n    return {\n      x: ev.clientX - rect.left - clientLeft + scrollLeft,\n      y: ev.clientY - rect.top - clientTop + scrollTop,\n    }\n  }\n\n  protected createTranslateRect(box: TBoundingBox): SVGRectElement\n  {\n    const attrs = {\n      role: SvgElementRole.Translate,\n      style: \"cursor:move\",\n      fill: \"transparent\",\n      stroke: \"transparent\",\n    }\n    const boxWithMarge: TBoundingBox = {\n      height: box.height,\n      width: box.width,\n      x: box.x,\n      y: box.y\n    }\n    const translateEl = SVGBuilder.createRect(boxWithMarge, attrs)\n    const handler = (ev: PointerEvent) =>\n    {\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.translator.continue(this.getPoint(ev))\n    }\n    const endHandler = (ev: PointerEvent) =>\n    {\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.translator.end(this.getPoint(ev))\n      this.renderer.layer.removeEventListener(\"pointermove\", handler)\n      this.renderer.layer.removeEventListener(\"pointercancel\", endHandler)\n      this.renderer.layer.removeEventListener(\"pointerleave\", endHandler)\n      this.renderer.layer.removeEventListener(\"pointerup\", endHandler)\n    }\n\n    translateEl.addEventListener(\"pointerdown\", (ev) =>\n    {\n      if (ev.button !== 0 || ev.buttons !== 1) {\n        return\n      }\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.translator.start(ev.target as Element, this.getPoint(ev))\n      this.renderer.layer.addEventListener(\"pointermove\", handler)\n      this.renderer.layer.addEventListener(\"pointercancel\", endHandler)\n      this.renderer.layer.addEventListener(\"pointerleave\", endHandler)\n      this.renderer.layer.addEventListener(\"pointerup\", endHandler)\n    })\n    return translateEl\n  }\n\n  protected createRotateGroup(box: TBoundingBox): SVGGElement\n  {\n    const group = SVGBuilder.createGroup({\n      role: SvgElementRole.Rotate,\n      \"vector-effect\": \"non-scaling-size\",\n      \"style\": \"cursor:pointer;\",\n      \"opacity\": \"1\",\n    })\n    const radius = 8\n    const center: TPoint = {\n      x: (box.x + box.width / 2),\n      y: box.y - 4 * SELECTION_MARGIN\n    }\n    const attrs1 = {\n      role: SvgElementRole.Rotate,\n      \"stroke-width\": \"2\",\n      \"stroke\": \"black\",\n      fill: \"white\",\n    }\n    group.appendChild(SVGBuilder.createCircle(center, radius, attrs1))\n\n    const attrs2 = {\n      role: SvgElementRole.Rotate,\n      fill: \"black\",\n    }\n\n    group.appendChild(SVGBuilder.createCircle(center, radius / 2, attrs2))\n    const attrs3 = {\n      role: SvgElementRole.Rotate,\n      stroke: \"black\",\n      \"stroke-width\": \"2\"\n    }\n    group.appendChild(SVGBuilder.createLine({ x: center.x, y: center.y + radius }, { x: center.x, y: box.y - SELECTION_MARGIN }, attrs3))\n\n    const handler = (ev: PointerEvent) =>\n    {\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.rotator.continue(this.getPoint(ev))\n    }\n    const endHandler = (ev: PointerEvent) =>\n    {\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.rotator.end(this.getPoint(ev))\n      this.renderer.layer.removeEventListener(\"pointermove\", handler)\n      this.renderer.layer.removeEventListener(\"pointercancel\", endHandler)\n      this.renderer.layer.removeEventListener(\"pointerleave\", endHandler)\n      this.renderer.layer.removeEventListener(\"pointerup\", endHandler)\n    }\n\n    group.addEventListener(\"pointerdown\", (ev) =>\n    {\n      if (ev.button !== 0 || ev.buttons !== 1) {\n        return\n      }\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.rotator.start(ev.target as Element, this.getPoint(ev))\n      this.renderer.layer.addEventListener(\"pointermove\", handler)\n      this.renderer.layer.addEventListener(\"pointercancel\", endHandler)\n      this.renderer.layer.addEventListener(\"pointerleave\", endHandler)\n      this.renderer.layer.addEventListener(\"pointerup\", endHandler)\n    })\n    return group\n  }\n\n  protected createResizeGroup(box: TBoundingBox): SVGGElement\n  {\n    const group = SVGBuilder.createGroup({\n      role: SvgElementRole.Resize,\n      \"vector-effect\": \"non-scaling-size\",\n      \"stroke-width\": \"4\",\n      \"stroke\": \"#3e68ff\",\n    })\n    const P_NW: TPoint = { x: box.x - SELECTION_MARGIN, y: box.y - SELECTION_MARGIN }\n    const P_NE: TPoint = { x: box.x + box.width + SELECTION_MARGIN, y: box.y - SELECTION_MARGIN }\n    const P_SE: TPoint = { x: box.x + box.width + SELECTION_MARGIN, y: box.y + box.height + SELECTION_MARGIN }\n    const P_SW: TPoint = { x: box.x - SELECTION_MARGIN, y: box.y + box.height + SELECTION_MARGIN }\n\n    const bindEl = (el: SVGElement, transformOrigin: TPoint) =>\n    {\n      const handler = (ev: PointerEvent) =>\n      {\n        ev.preventDefault()\n        ev.stopPropagation()\n        this.resizer.continue(this.getPoint(ev))\n      }\n      const endHandler = (ev: PointerEvent) =>\n      {\n        ev.preventDefault()\n        ev.stopPropagation()\n        this.resizer.end(this.getPoint(ev))\n        this.renderer.layer.removeEventListener(\"pointermove\", handler)\n        this.renderer.layer.removeEventListener(\"pointercancel\", endHandler)\n        this.renderer.layer.removeEventListener(\"pointerleave\", endHandler)\n        this.renderer.layer.removeEventListener(\"pointerup\", endHandler)\n      }\n\n      el.addEventListener(\"pointerdown\", (ev) =>\n      {\n        if (ev.button !== 0 || ev.buttons !== 1) {\n          return\n        }\n        ev.preventDefault()\n        ev.stopPropagation()\n        this.resizer.start(ev.target as Element, transformOrigin)\n        this.renderer.layer.addEventListener(\"pointermove\", handler)\n        this.renderer.layer.addEventListener(\"pointercancel\", endHandler)\n        this.renderer.layer.addEventListener(\"pointerleave\", endHandler)\n        this.renderer.layer.addEventListener(\"pointerup\", endHandler)\n      })\n    }\n\n    const sideResizeDefs = [\n      { direction: ResizeDirection.North, p1: P_NW, p2: P_NE, transformOrigin: { x: box.x + box.width / 2, y: box.y + box.height } },\n      { direction: ResizeDirection.East, p1: P_NE, p2: P_SE, transformOrigin: { x: box.x, y: box.y + box.height / 2 } },\n      { direction: ResizeDirection.South, p1: P_SW, p2: P_SE, transformOrigin: { x: box.x + box.width / 2, y: box.y } },\n      { direction: ResizeDirection.West, p1: P_NW, p2: P_SW, transformOrigin: { x: box.x + box.width, y: box.y + box.height / 2 } },\n    ]\n    sideResizeDefs.forEach(def =>\n    {\n      const attrs = {\n        role: SvgElementRole.Resize,\n        \"resize-direction\": def.direction,\n        \"transform-origin\": JSON.stringify(def.transformOrigin),\n        style: `cursor:${ def.direction };`\n      }\n      const lineResize = SVGBuilder.createLine(def.p1, def.p2, attrs)\n      bindEl(lineResize, def.transformOrigin)\n      group.appendChild(lineResize)\n    })\n    const cornerResizeDefs = [\n      { direction: ResizeDirection.NorthWest, p: P_NW, transformOrigin: { x: box.x + box.width, y: box.y + box.height } },\n      { direction: ResizeDirection.NorthEast, p: P_NE, transformOrigin: { x: box.x, y: box.y + box.height } },\n      { direction: ResizeDirection.SouthEast, p: P_SE, transformOrigin: { x: box.x, y: box.y } },\n      { direction: ResizeDirection.SouthWest, p: P_SW, transformOrigin: { x: box.x + box.width, y: box.y } },\n    ]\n    cornerResizeDefs.forEach(def =>\n    {\n      const attrs = {\n        \"stroke-width\": \"4\",\n        role: SvgElementRole.Resize,\n        \"resize-direction\": def.direction,\n        \"transform-origin\": JSON.stringify(def.transformOrigin),\n        transform: \"scale(1, 1)\",\n        fill: \"white\",\n        style: `cursor:${ def.direction };`\n      }\n      const cornerResize = SVGBuilder.createCircle(def.p, 5, attrs)\n      bindEl(cornerResize, def.transformOrigin)\n      group.appendChild(cornerResize)\n    })\n    return group\n  }\n\n  protected createInteractElementsGroup(symbols: TOISymbol[]): SVGGElement | undefined\n  {\n    this.#logger.info(\"createInteractElementsGroup\", { symbols })\n\n    if (!symbols.length) return\n\n    const symbolElementMap = symbols.map(s =>\n    {\n      return {\n        symbol: s,\n        element: this.renderer.getElementById(s.id),\n      }\n    })\n\n    const box1 = Box.createFromBoxes(symbols.map(s =>\n    {\n      return {\n        x: s.bounds.x - (s.style.width || 1),\n        y: s.bounds.y - (s.style.width || 1),\n        height: s.bounds.height + (s.style.width || 1) * 2,\n        width: s.bounds.width + (s.style.width || 1) * 2,\n      }\n    }))\n\n    const box2 = Box.createFromPoints(symbols.flatMap(s => s.vertices))\n    const box = Box.createFromBoxes([box1, box2])\n\n    const attrs = {\n      id: `selected-${ Date.now() }`,\n      role: SvgElementRole.InteractElementsGroup,\n    }\n    const surroundGroup = SVGBuilder.createGroup(attrs)\n    surroundGroup.appendChild(this.createTranslateRect(box))\n    surroundGroup.appendChild(this.createResizeGroup(box))\n    surroundGroup.appendChild(this.createRotateGroup(box))\n    const SURROUND_ATTRS = {\n      style: \"pointer-events: none\",\n      fill: \"transparent\",\n      stroke: \"#3e68ff\",\n      \"stroke-width\": \"1\",\n      \"stroke-dasharray\": \"4\",\n      \"vector-effect\": \"non-scaling-size\",\n      transform: \"rotate(0, 0, 0)\"\n    }\n    symbolElementMap.forEach(s =>\n    {\n      if (s.element) {\n        const bounds: TBoundingBox = {\n          x: s.symbol.bounds.x - (s.symbol.style.width || 1),\n          y: s.symbol.bounds.y - (s.symbol.style.width || 1),\n          height: s.symbol.bounds.height + (s.symbol.style.width || 1) * 2,\n          width: s.symbol.bounds.width + (s.symbol.style.width || 1) * 2,\n        }\n        if (s.symbol.type === SymbolType.Text) {\n          const t = s.symbol as OIText\n          SURROUND_ATTRS.transform = `rotate(${ t.rotation?.degree || 0 }, ${ t.rotation?.center.x || 0 }, ${ t.rotation?.center.y || 0 })`\n        }\n        else {\n          SURROUND_ATTRS.transform = \"rotate(0, 0, 0)\"\n        }\n        surroundGroup.prepend(SVGBuilder.createRect(bounds, SURROUND_ATTRS))\n      }\n    })\n    return surroundGroup\n  }\n\n  drawSelectedGroup(symbols: TOISymbol[]): void\n  {\n    if (!symbols.length) return\n    this.selectedGroup = this.createInteractElementsGroup(symbols)\n    if (this.selectedGroup) {\n      this.renderer.layer.appendChild(this.selectedGroup)\n      const groupBox = this.selectedGroup.getBBox()\n      this.behaviors.menu.context.position.x = groupBox.x + groupBox.width / 2 - this.renderer.parent.clientLeft\n      this.behaviors.menu.context.position.y = groupBox.y + groupBox.height - this.renderer.parent.clientTop\n      this.behaviors.menu.context.show()\n    }\n    this.behaviors.menu.update()\n  }\n\n  resetSelectedGroup(symbols: TOISymbol[]): void\n  {\n    this.#logger.info(\"resetSelectedGroup\", { symbols })\n    this.removeSelectedGroup()\n    this.drawSelectedGroup(symbols)\n  }\n\n  removeSelectedGroup(): void\n  {\n    this.#logger.info(\"removeSelectedGroup\")\n    this.behaviors.menu.context.hide()\n    this.selectedGroup?.remove()\n    this.selectedGroup = undefined\n  }\n\n  hideInteractElements(): void\n  {\n    this.behaviors.menu.context.hide()\n    const query = `[role=${ SvgElementRole.Resize }],[role=${ SvgElementRole.Rotate }],[role=${ SvgElementRole.Translate }]`\n    this.selectedGroup?.querySelectorAll(query)\n      .forEach(el =>\n      {\n        el.setAttribute(\"visibility\", \"hidden\")\n      })\n  }\n\n  showInteractElements(): void\n  {\n    this.behaviors.menu.context.show()\n    const query = `[role=${ SvgElementRole.Resize }],[role=${ SvgElementRole.Rotate }],[role=${ SvgElementRole.Translate }]`\n    this.selectedGroup?.querySelectorAll(query)\n      .forEach(el => el.setAttribute(\"visibility\", \"visible\"))\n  }\n\n  start(point: TPoint): void\n  {\n    this.startSelectionPoint = point\n    this.endSelectionPoint = point\n    this.drawSelectingRect(this.selectionBox!)\n  }\n\n  continue(point: TPoint): TOISymbol[]\n  {\n    if (!this.startSelectionPoint) {\n      throw new Error(\"You need to call startSelectionByBox before\")\n    }\n    this.endSelectionPoint = point\n    const updatedSymbols: TOISymbol[] = []\n    this.model.symbols.forEach(s =>\n    {\n      if (s.selected !== s.overlaps(this.selectionBox!)) {\n        s.selected = s.overlaps(this.selectionBox!)\n        updatedSymbols.push(s)\n        this.renderer.drawSymbol(s)\n      }\n    })\n    this.drawSelectingRect(this.selectionBox!)\n    return updatedSymbols\n  }\n\n  end(point: TPoint): TOISymbol[]\n  {\n    this.endSelectionPoint = point\n    const updatedSymbols = this.continue(point)\n    this.startSelectionPoint = undefined\n    this.endSelectionPoint = undefined\n    this.clearSelectingRect()\n    this.drawSelectedGroup(this.model.symbolsSelected)\n    this.internalEvent.emitSelected(this.model.symbolsSelected)\n    this.behaviors.menu.style.update()\n    return updatedSymbols\n  }\n}\n","import { OIBehaviors } from \"../behaviors\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { OIModel } from \"../model\"\nimport { Box, TPoint, TSegment } from \"../primitive\"\nimport { OISVGRenderer } from \"../renderer\"\nimport { OISVGRendererConst } from \"../renderer/svg/OISVGRendererConst\"\n\n/**\n * @group Snap\n */\nexport type TSnapNudge = TPoint\n\n/**\n * @group Snap\n */\nexport type TSnapLineInfos = {\n  nudge: TSnapNudge,\n  verticales: TSegment[]\n  horizontales: TSegment[]\n}\n\n/**\n * @group Manager\n */\nexport class OISnapManager\n{\n  #logger = LoggerManager.getLogger(LoggerClass.CONVERTER)\n  behaviors: OIBehaviors\n  snapToGrid: boolean\n  snapToElement: boolean\n  snapAngle: number\n\n  constructor(behaviors: OIBehaviors, options?: { grid?: boolean, element?: boolean, angle?: number })\n  {\n    this.#logger.info(\"constructor\")\n    this.behaviors = behaviors\n    this.snapToElement = options?.element !== undefined ? options.element : true\n    this.snapToGrid = options?.grid !== undefined ? options.grid : true\n    this.snapAngle = options?.angle !== undefined ? options.angle : 0\n  }\n\n  get model(): OIModel\n  {\n    return this.behaviors.model\n  }\n\n  get renderer(): OISVGRenderer\n  {\n    return this.behaviors.renderer\n  }\n\n  get selectionSnapPoints(): TPoint[]\n  {\n    return Box.createFromPoints(this.model.symbolsSelected.flatMap(s => s.snapPoints)).snapPoints\n  }\n\n  get otherSnapPoints(): TPoint[]\n  {\n    const selectSymbolIds = this.model.symbolsSelected.map(s => s.id)\n    return this.model.symbols.filter(s => !selectSymbolIds.includes(s.id)).flatMap(s => s.snapPoints)\n  }\n\n  get snapThreshold(): number\n  {\n    return this.behaviors.configuration.rendering.guides.gap / 2\n  }\n\n  protected getNearestVerticalGuide(x: number): number\n  {\n    if (this.renderer.verticalGuides.length) {\n      return this.renderer.verticalGuides.reduce((prev, curr) =>\n      {\n        return (Math.abs(curr - x) < Math.abs(prev - x) ? curr : prev)\n      })\n    }\n    return x\n  }\n\n  protected getNearestHorizontalGuide(y: number): number\n  {\n    if (this.renderer.horizontalGuides.length) {\n      return this.renderer.horizontalGuides.reduce((prev, curr) =>\n      {\n        return (Math.abs(curr - y) < Math.abs(prev - y) ? curr : prev)\n      })\n    }\n    return y\n  }\n\n  protected getGuidePointToSnap(point: TPoint): TPoint\n  {\n    return {\n      x: this.getNearestVerticalGuide(point.x),\n      y: this.getNearestHorizontalGuide(point.y)\n    }\n  }\n\n  drawSnapToElementLines(lines: TSegment[]): void\n  {\n    const attrs = {\n      role: \"snap-to-element\",\n      fill: \"transparent\",\n      stroke: \"blue\",\n      \"stroke-width\": \"2\",\n      style: OISVGRendererConst.noSelection,\n      \"marker-start\": `url(#${ OISVGRendererConst.crossMarker })`,\n      \"marker-end\": `url(#${ OISVGRendererConst.crossMarker })`\n    }\n    lines.forEach(seg =>\n    {\n      this.renderer.drawLine(seg.p1, seg.p2, attrs)\n    })\n  }\n\n  clearSnapToElementLines(): void\n  {\n    this.renderer.clearElements({ attrs: { role: \"snap-to-element\" } })\n  }\n\n  protected getSnapLinesInfos(sourcePoints: TPoint[], targetPoints: TPoint[]): TSnapLineInfos\n  {\n    const infos: TSnapLineInfos = {\n      nudge: {\n        x: Infinity,\n        y: Infinity\n      },\n      verticales: [],\n      horizontales: [],\n    }\n    if (!sourcePoints.length || !targetPoints.length) return infos\n\n    sourcePoints.forEach(p1 =>\n    {\n      targetPoints.forEach(p2 =>\n      {\n        if (this.snapThreshold > Math.abs(p2.x - p1.x)) {\n          if (Math.abs(infos.nudge.x) > Math.abs(p2.x - p1.x)) {\n            infos.nudge.x = p2.x - p1.x\n            infos.verticales = [{ p1: { ...p1 }, p2 }]\n          }\n          else if (infos.nudge.x === p2.x - p1.x) {\n            infos.verticales.push({ p1: { ...p1 }, p2 })\n          }\n        }\n        if (this.snapThreshold > Math.abs(p2.y - p1.y)) {\n          if (Math.abs(infos.nudge.y) > Math.abs(p2.y - p1.y)) {\n            infos.nudge.y = p2.y - p1.y\n            infos.horizontales = [{ p1: { ...p1 }, p2 }]\n          }\n          else if (infos.nudge.y === p2.y - p1.y) {\n            infos.horizontales.push({ p1: { ...p1 }, p2 })\n          }\n        }\n      })\n    })\n\n    return infos\n  }\n\n  snapResize(point: TPoint, horizontal = true, vertical = true): TPoint\n  {\n    this.clearSnapToElementLines()\n    if (!this.snapToElement && !this.snapToGrid) return point\n\n    let localPoint: TPoint = {\n      x: Infinity,\n      y: Infinity\n    }\n    if (this.snapToGrid) {\n      localPoint = this.getGuidePointToSnap(point)\n    }\n    const snapLines: TSegment[] = []\n\n    if (this.snapToElement) {\n      const snapLinesInfos = this.getSnapLinesInfos([point], this.otherSnapPoints)\n      if (horizontal && Math.abs(snapLinesInfos.nudge.x) <= Math.abs(point.x - localPoint.x)) {\n        localPoint.x = point.x + snapLinesInfos.nudge.x\n        snapLines.push(...snapLinesInfos.verticales)\n      }\n      if (vertical && Math.abs(snapLinesInfos.nudge.y) <= Math.abs(point.y - localPoint.y)) {\n        localPoint.y = point.y + snapLinesInfos.nudge.y\n        snapLines.push(...snapLinesInfos.horizontales)\n      }\n    }\n\n    if (localPoint.x === Infinity) localPoint.x = point.x\n    if (localPoint.y === Infinity) localPoint.y = point.y\n\n    snapLines.forEach(s => s.p1 = localPoint)\n    this.drawSnapToElementLines(snapLines)\n    return localPoint\n  }\n\n  snapTranslate(tx: number, ty: number): TSnapNudge\n  {\n    this.clearSnapToElementLines()\n    const nudge: TSnapNudge = { x: tx, y: ty }\n    if (!this.snapToElement && !this.snapToGrid) return nudge\n\n    const selectionSymbolPoints = this.selectionSnapPoints.map(p => ({ x: p.x + tx, y: p.y + ty }))\n\n    let lastDeltaX = Infinity\n    let lastDeltaY = Infinity\n\n    if (this.snapToGrid) {\n      selectionSymbolPoints.forEach(p =>\n      {\n        const gridPoint = this.getGuidePointToSnap(p)\n        if (lastDeltaX > Math.abs(gridPoint.x - p.x)) {\n          nudge.x = gridPoint.x - p.x + tx\n          lastDeltaX = Math.abs(gridPoint.x - p.x)\n        }\n        if (lastDeltaY > Math.abs(gridPoint.y - p.y)) {\n          nudge.y = gridPoint.y - p.y + ty\n          lastDeltaY = Math.abs(gridPoint.y - p.y)\n        }\n      })\n    }\n\n    const snapLines: TSegment[] = []\n    if (this.snapToElement) {\n      const snapLinesInfos = this.getSnapLinesInfos(selectionSymbolPoints, this.otherSnapPoints)\n      if (lastDeltaX >= Math.abs(snapLinesInfos.nudge.x) && snapLinesInfos.verticales.length) {\n        nudge.x = snapLinesInfos.nudge.x + tx\n        snapLines.push(...snapLinesInfos.verticales)\n      }\n      if (lastDeltaY >= Math.abs(snapLinesInfos.nudge.y) && snapLinesInfos.horizontales.length) {\n        nudge.y = snapLinesInfos.nudge.y + ty\n        snapLines.push(...snapLinesInfos.horizontales)\n      }\n    }\n    if (snapLines.length) {\n      snapLines.forEach(l =>\n      {\n        l.p1.x += nudge.x - tx\n        l.p1.y += nudge.y - ty\n      })\n      this.drawSnapToElementLines(snapLines)\n    }\n    return nudge\n  }\n\n  snapRotation(angleDegree: number): number\n  {\n    if (this.snapAngle > 0) {\n      return this.snapAngle * Math.round(angleDegree / this.snapAngle)\n    }\n    return angleDegree\n  }\n}\n","import { OIBehaviors } from \"../behaviors\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { OIModel } from \"../model\"\nimport { Box, OIText, SymbolType, TOISymbol, TOISymbolChar } from \"../primitive\"\nimport { OISVGRenderer } from \"../renderer\"\n\n/**\n * @group Manager\n */\nexport class OITextManager\n{\n  #logger = LoggerManager.getLogger(LoggerClass.CONVERTER)\n  behaviors: OIBehaviors\n\n  constructor(behaviors: OIBehaviors)\n  {\n    this.#logger.info(\"constructor\")\n    this.behaviors = behaviors\n  }\n\n  get renderer(): OISVGRenderer\n  {\n    return this.behaviors.renderer\n  }\n\n  get rowHeight(): number\n  {\n    return this.behaviors.configuration.rendering.guides.gap\n  }\n\n  get model(): OIModel\n  {\n    return this.behaviors.model\n  }\n\n  protected drawSymbolHidden(text: OIText): SVGGElement\n  {\n    const clone = text.clone()\n    clone.id = \"text-to-measure\"\n    clone.chars.forEach(c => c.id += \"to-measure\")\n    this.renderer.layer.querySelector(`#${ clone.id }`)?.remove()\n    const el = this.renderer.buildElementFromSymbol(clone)!\n    el.setAttribute(\"visibility\", \"hidden\")\n    this.renderer.prependElement(el)\n    return el\n  }\n\n  setCharsBounds(text: OIText, textGroupEl: SVGGElement): OIText\n  {\n    const textEl = textGroupEl.querySelector(\"text\")\n    if (textEl) {\n      for (let i = 0; i < textEl.getNumberOfChars(); i++) {\n        const char = text.chars.at(i)\n        if (char) {\n          const ext = textEl.getExtentOfChar(i)\n          char.bounds = new Box(ext)\n        }\n      }\n    }\n    return text\n  }\n\n  setBounds(text: OIText): void\n  {\n    const element = this.drawSymbolHidden(text)\n    text.bounds = this.getElementBoundingBox(element)\n    this.setCharsBounds(text, element)\n  }\n\n  getElementBoundingBox(textElement: SVGElement): Box\n  {\n    return new Box(textElement.querySelector(\"text\")!.getBBox({ stroke: true, markers: true, clipped: true, fill: true }))\n  }\n\n  getBoundingBox(text: OIText): Box\n  {\n    const element = this.drawSymbolHidden(text)\n    return this.getElementBoundingBox(element)\n  }\n\n  getSpaceWidth(fontSize: number): number\n  {\n    const boundingBox = new Box({ height: 0, width: 0, x: 0, y: 0 })\n    const charSymbol: TOISymbolChar = {\n      id: `text-char-space`,\n      label: \"-\",\n      color: \"\",\n      fontSize,\n      fontWeight: \"normal\",\n      bounds: boundingBox\n    }\n    return this.getBoundingBox(new OIText([charSymbol], { x: 0, y: 0 }, boundingBox))?.width as number\n  }\n\n  updateBounds(textSymbol: OIText): OIText\n  {\n    this.setBounds(textSymbol)\n    this.model.updateSymbol(textSymbol)\n    return textSymbol\n  }\n\n  moveTextAfter(text: OIText, tx: number): TOISymbol[] | undefined\n  {\n    const row = this.model.getSymbolsByRowOrdered().find(r => r.rowIndex === this.model.getSymbolRowIndex(text))\n    if (row) {\n      const textsAfter = row.symbols.filter(s => s.type === SymbolType.Text && s.bounds.xMid > text.bounds.xMid) as OIText[]\n      textsAfter.forEach(symbol => {\n        symbol.point.x += tx\n        this.updateBounds(symbol)\n        this.model.updateSymbol(symbol)\n        this.renderer.drawSymbol(symbol)\n      })\n      return textsAfter\n    }\n    return\n  }\n}\n","import { SvgElementRole } from \"../Constants\"\nimport { OIBehaviors } from \"../behaviors\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { OIModel } from \"../model\"\nimport\n{\n  EdgeKind,\n  OIStroke,\n  OIText,\n  OISymbolGroup,\n  ShapeKind,\n  SymbolType,\n  TOIEdge,\n  TOIShape,\n  TOISymbol,\n  TPoint\n} from \"../primitive\"\n\n/**\n * @group Manager\n */\nexport class OITranslateManager\n{\n  #logger = LoggerManager.getLogger(LoggerClass.TRANSFORMER)\n  behaviors: OIBehaviors\n  interactElementsGroup?: SVGElement\n  transformOrigin!: TPoint\n\n  constructor(behaviors: OIBehaviors)\n  {\n    this.#logger.info(\"constructor\")\n    this.behaviors = behaviors\n  }\n\n  get model(): OIModel\n  {\n    return this.behaviors.model\n  }\n\n  protected applyToStroke(stroke: OIStroke, tx: number, ty: number): OIStroke\n  {\n    stroke.pointers.forEach(p =>\n    {\n      p.x += tx\n      p.y += ty\n    })\n    return stroke\n  }\n\n  protected applyToShape(shape: TOIShape, tx: number, ty: number): TOIShape\n  {\n    switch (shape.kind) {\n      case ShapeKind.Ellipse:\n      case ShapeKind.Circle: {\n        shape.center.x += tx\n        shape.center.y += ty\n        return shape\n      }\n      case ShapeKind.Polygon: {\n        shape.points.forEach(p =>\n        {\n          p.x += tx\n          p.y += ty\n        })\n        return shape\n      }\n      default:\n        throw new Error(`Can't apply translate on shape, kind unknow: ${ JSON.stringify(shape) }`)\n    }\n  }\n\n  protected applyToEdge(edge: TOIEdge, tx: number, ty: number): TOIEdge\n  {\n    switch (edge.kind) {\n      case EdgeKind.Arc: {\n        edge.center.x += tx\n        edge.center.y += ty\n        return edge\n      }\n      case EdgeKind.Line: {\n        edge.start.x += tx\n        edge.start.y += ty\n        edge.end.x += tx\n        edge.end.y += ty\n        return edge\n      }\n      case EdgeKind.PolyEdge: {\n        edge.points.forEach(p =>\n        {\n          p.x += tx\n          p.y += ty\n        })\n        return edge\n      }\n    }\n\n    return edge\n  }\n\n  protected applyOnText(text: OIText, tx: number, ty: number): OIText\n  {\n    if (text.rotation) {\n      text.rotation.center = { x: text.rotation.center.x + tx, y: text.rotation.center.y + ty }\n    }\n    text.point.x += tx\n    text.point.y += ty\n    return this.behaviors.texter.updateBounds(text)\n  }\n\n  protected applyOnGroup(group: OISymbolGroup, tx: number, ty: number): OISymbolGroup\n  {\n    group.children.forEach(s => this.applyToSymbol(s, tx, ty))\n    return group\n  }\n\n  applyToSymbol(symbol: TOISymbol, tx: number, ty: number): TOISymbol\n  {\n    this.#logger.info(\"applyToSymbol\", { symbol, tx, ty })\n    switch (symbol.type) {\n      case SymbolType.Stroke:\n        return this.applyToStroke(symbol, tx, ty)\n      case SymbolType.Shape:\n        return this.applyToShape(symbol, tx, ty)\n      case SymbolType.Edge:\n        return this.applyToEdge(symbol, tx, ty)\n      case SymbolType.Text:\n        return this.applyOnText(symbol, tx, ty)\n      case SymbolType.Group:\n        return this.applyOnGroup(symbol, tx, ty)\n      default:\n        throw new Error(`Can't apply translate on symbol, type unknow: ${ JSON.stringify(symbol) }`)\n    }\n  }\n\n  translate(symbols: TOISymbol[], tx: number, ty: number, addToHistory = true): Promise<void>\n  {\n    this.#logger.info(\"translate\", { symbols, tx, ty })\n    symbols.forEach(s =>\n    {\n      this.applyToSymbol(s, tx, ty)\n      this.model.updateSymbol(s)\n      this.behaviors.renderer.drawSymbol(s)\n    })\n    if (addToHistory) {\n      this.behaviors.history.push(this.model, { translate: [{ symbols: this.model.symbolsSelected, tx, ty }] })\n    }\n    const strokes = this.behaviors.extractStrokesFromSymbols(symbols)\n    return this.behaviors.recognizer.transformTranslate(strokes.map(s => s.id), tx, ty)\n  }\n\n  translateElement(id: string, tx: number, ty: number): void\n  {\n    this.#logger.info(\"translateElement\", { id, tx, ty })\n    this.behaviors.renderer.setAttribute(id, \"transform\", `translate(${ tx },${ ty })`)\n  }\n\n  start(target: Element, origin: TPoint): void\n  {\n    this.#logger.info(\"start\", { origin })\n    this.interactElementsGroup = (target.closest(`[role=${ SvgElementRole.InteractElementsGroup }]`) as unknown) as SVGGElement\n    this.transformOrigin = origin\n    this.behaviors.selector.hideInteractElements()\n  }\n\n  continue(point: TPoint): { tx: number, ty: number }\n  {\n    this.#logger.info(\"continue\", { point })\n    if (!this.interactElementsGroup) {\n      throw new Error(\"Can't translate, you must call start before\")\n    }\n\n    let tx = point.x - this.transformOrigin.x\n    let ty = point.y - this.transformOrigin.y\n\n    const nudge = this.behaviors.snaps.snapTranslate(tx, ty)\n    tx = nudge.x\n    ty = nudge.y\n\n    this.translateElement(this.interactElementsGroup.id as string, tx, ty)\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.translateElement(s.id as string, tx, ty)\n    })\n    return {\n      tx,\n      ty\n    }\n  }\n\n  async end(point: TPoint): Promise<void>\n  {\n    this.#logger.info(\"end\", { point })\n    const { tx, ty } = this.continue(point)\n    this.behaviors.snaps.clearSnapToElementLines()\n    this.translate(this.model.symbolsSelected, tx, ty)\n\n    this.behaviors.selector.resetSelectedGroup(this.model.symbolsSelected)\n    this.interactElementsGroup = undefined\n    this.behaviors.svgDebugger.apply()\n  }\n\n}\n","import { SELECTION_MARGIN, WriteTool } from \"../Constants\"\nimport { OIBehaviors } from \"../behaviors\"\nimport { TGesture } from \"../gesture\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { OIModel } from \"../model\"\nimport\n{\n  EdgeDecoration,\n  EdgeKind,\n  OIEdgeLine,\n  OIShapePolygon,\n  OIShapeCircle,\n  OIShapeEllipse,\n  OIStroke,\n  SymbolType,\n  TOIEdge,\n  TOISymbol,\n  TPoint,\n  TPointer,\n  Box\n} from \"../primitive\"\nimport { OIRecognizer } from \"../recognizer\"\nimport { OISVGRenderer } from \"../renderer\"\nimport { TStyle } from \"../style\"\nimport { OIHistoryManager } from \"../history\"\nimport { OIGestureManager } from \"./OIGestureManager\"\nimport { OISnapManager } from \"./OISnapManager\"\n\n\n/**\n * @group Manager\n */\nexport class OIWriteManager\n{\n  #logger = LoggerManager.getLogger(LoggerClass.WRITE)\n  behaviors: OIBehaviors\n\n  #tool: WriteTool = WriteTool.Pencil\n  detectGesture: boolean = true\n\n  currentSymbolOrigin?: TPoint\n\n  constructor(behaviors: OIBehaviors)\n  {\n    this.#logger.info(\"constructor\")\n    this.behaviors = behaviors\n  }\n\n  get tool(): WriteTool\n  {\n    return this.#tool\n  }\n  set tool(wt: WriteTool)\n  {\n    this.#tool = wt\n    if (wt !== WriteTool.Pencil) {\n      this.renderer.parent.classList.add(\"shape\")\n    }\n    else {\n      this.renderer.parent.classList.remove(\"shape\")\n    }\n    this.behaviors.unselectAll()\n  }\n\n  get model(): OIModel\n  {\n    return this.behaviors.model\n  }\n\n  get renderer(): OISVGRenderer\n  {\n    return this.behaviors.renderer\n  }\n\n  get history(): OIHistoryManager\n  {\n    return this.behaviors.history\n  }\n\n  get gestureManager(): OIGestureManager\n  {\n    return this.behaviors.gesture\n  }\n\n  get snaps(): OISnapManager\n  {\n    return this.behaviors.snaps\n  }\n\n  get recognizer(): OIRecognizer\n  {\n    return this.behaviors.recognizer\n  }\n\n  protected needContextLessGesture(stroke: OIStroke): boolean\n  {\n    const strokeBoundsWithMargin = new Box(stroke.bounds)\n    strokeBoundsWithMargin.x -= SELECTION_MARGIN\n    strokeBoundsWithMargin.y -= SELECTION_MARGIN\n    strokeBoundsWithMargin.width += 2 * SELECTION_MARGIN\n    strokeBoundsWithMargin.height += 2 * SELECTION_MARGIN\n    return this.detectGesture && this.model.symbols.some(s =>\n    {\n      switch (s.type) {\n        case SymbolType.Stroke:\n          return false\n        case SymbolType.Group:\n          if (s.containsOnlyStroke()) {\n            return false\n          }\n          else {\n            return s.extractSymbols().some(subS => subS.bounds.overlaps(strokeBoundsWithMargin))\n          }\n        default:\n          return s.bounds.overlaps(strokeBoundsWithMargin)\n      }\n    })\n  }\n\n  protected createCurrentSymbol(pointer: TPointer, style: TStyle, pointerType: string): TOISymbol\n  {\n    this.#logger.debug(\"createCurrentSymbol\", { pointer, style, pointerType })\n\n    switch (this.tool) {\n      case WriteTool.Pencil:\n        this.model.currentSymbol = new OIStroke(style, pointerType)\n        break\n      case WriteTool.Rectangle:\n        this.model.currentSymbol = OIShapePolygon.createRectangleBetweenPoints(pointer, pointer, style)\n        break\n      case WriteTool.Triangle:\n        this.model.currentSymbol = OIShapePolygon.createTriangleBetweenPoints(pointer, pointer, style)\n        break\n      case WriteTool.Parallelogram:\n        this.model.currentSymbol = OIShapePolygon.createParallelogramBetweenPoints(pointer, pointer, style)\n        break\n      case WriteTool.Rhombus:\n        this.model.currentSymbol = OIShapePolygon.createRhombusBetweenPoints(pointer, pointer, style)\n        break\n      case WriteTool.Circle:\n        this.model.currentSymbol = OIShapeCircle.createBetweenPoints(pointer, pointer, style)\n        break\n      case WriteTool.Ellipse:\n        this.model.currentSymbol = OIShapeEllipse.createBetweenPoints(pointer, pointer, style)\n        break\n      case WriteTool.Line:\n      case WriteTool.Arrow:\n      case WriteTool.DoubleArrow: {\n        let startDecoration, endDecoration\n        if (this.tool === WriteTool.Arrow) {\n          endDecoration = EdgeDecoration.Arrow\n        }\n        else if (this.tool === WriteTool.DoubleArrow) {\n          startDecoration = EdgeDecoration.Arrow\n          endDecoration = EdgeDecoration.Arrow\n        }\n        this.model.currentSymbol = new OIEdgeLine(pointer, pointer, startDecoration, endDecoration, style)\n        break\n      }\n      default:\n        throw new Error(`Can't create symbol, tool is unknow: \"${ this.tool }\"`)\n    }\n    return this.updateCurrentSymbol(pointer)\n  }\n\n  protected updateCurrentSymbolShape(pointer: TPointer): void\n  {\n    switch (this.tool) {\n      case WriteTool.Rectangle:\n        OIShapePolygon.updateRectangleBetweenPoints(this.model.currentSymbol as OIShapePolygon, this.currentSymbolOrigin!, pointer)\n        break\n      case WriteTool.Triangle:\n        OIShapePolygon.updateTriangleBetweenPoints(this.model.currentSymbol as OIShapePolygon, this.currentSymbolOrigin!, pointer)\n        break\n      case WriteTool.Parallelogram:\n        OIShapePolygon.updateParallelogramBetweenPoints(this.model.currentSymbol as OIShapePolygon, this.currentSymbolOrigin!, pointer)\n        break\n      case WriteTool.Rhombus:\n        OIShapePolygon.updateRhombusBetweenPoints(this.model.currentSymbol as OIShapePolygon, this.currentSymbolOrigin!, pointer)\n        break\n      case WriteTool.Circle:\n        OIShapeCircle.updateBetweenPoints(this.model.currentSymbol as OIShapeCircle, this.currentSymbolOrigin!, pointer)\n        break\n      case WriteTool.Ellipse:\n        OIShapeEllipse.updateBetweenPoints(this.model.currentSymbol as OIShapeEllipse, this.currentSymbolOrigin!, pointer)\n        break\n    }\n  }\n\n  protected updateCurrentSymbolEdge(pointer: TPointer): void\n  {\n    const edge = this.model.currentSymbol as TOIEdge\n    switch (edge.kind) {\n      case EdgeKind.Line:\n        edge.end = pointer\n        break\n    }\n  }\n\n  protected updateCurrentSymbol(pointer: TPointer): TOISymbol\n  {\n    this.#logger.debug(\"updateCurrentSymbol\", { pointer })\n    if (!this.model.currentSymbol) {\n      throw new Error(\"Can't update current symbol because currentSymbol is undefined\")\n    }\n\n    switch (this.model.currentSymbol.type) {\n      case SymbolType.Stroke:\n        this.model.currentSymbol!.addPointer(pointer)\n        break\n      case SymbolType.Shape:\n        this.updateCurrentSymbolShape(pointer)\n        break\n      case SymbolType.Edge:\n        this.updateCurrentSymbolEdge(pointer)\n        break\n    }\n    return this.model.currentSymbol\n  }\n\n  start(style: TStyle, pointer: TPointer, pointerType: string): void\n  {\n    this.#logger.info(\"startWriting\", { style, pointer, pointerType })\n    const localPointer = pointer\n    if (this.tool !== WriteTool.Pencil) {\n      const { x, y } = this.snaps.snapResize(pointer)\n      localPointer.x = x\n      localPointer.y = y\n    }\n    this.currentSymbolOrigin = localPointer\n    this.createCurrentSymbol(localPointer, style, pointerType)\n    this.renderer.drawSymbol(this.model.currentSymbol!)\n  }\n\n  continue(pointer: TPointer): void\n  {\n    this.#logger.info(\"continueWriting\", { pointer })\n    const localPointer = pointer\n    if (this.tool !== WriteTool.Pencil) {\n      const { x, y } = this.snaps.snapResize(pointer)\n      localPointer.x = x\n      localPointer.y = y\n    }\n    this.updateCurrentSymbol(localPointer)\n    this.renderer.drawSymbol(this.model.currentSymbol!)\n  }\n\n  protected async interactWithBackend(stroke: OIStroke): Promise<void>\n  {\n    const localStroke = stroke.clone()\n    let gestureFromContextLess: TGesture | undefined\n    if (this.needContextLessGesture(stroke)) {\n      gestureFromContextLess = await this.gestureManager.getGestureFromContextLess(localStroke)\n    }\n    if (gestureFromContextLess) {\n      this.history.pop()\n      this.recognizer.addStrokes([localStroke], this.detectGesture)\n      this.gestureManager.apply(localStroke, gestureFromContextLess)\n    }\n    else {\n      const gesture = await this.recognizer.addStrokes([localStroke], this.detectGesture)\n      if (gesture) {\n        this.history.pop()\n        this.gestureManager.apply(this.model.getRootSymbol(gesture.gestureStrokeId) as OIStroke, gesture)\n      }\n    }\n  }\n\n  async end(pointer: TPointer): Promise<void>\n  {\n    this.#logger.info(\"finishWriting\", { pointer })\n    const localPointer = pointer\n    if (this.tool !== WriteTool.Pencil) {\n      const { x, y } = this.snaps.snapResize(pointer)\n      localPointer.x = x\n      localPointer.y = y\n    }\n    const localSymbol = this.updateCurrentSymbol(localPointer)\n    this.model.currentSymbol = undefined\n    this.currentSymbolOrigin = undefined\n    this.snaps.clearSnapToElementLines()\n\n    this.renderer.drawSymbol(localSymbol!)\n    this.model.addSymbol(localSymbol)\n    this.history.push(this.model, { added: [localSymbol] })\n\n    if (localSymbol.type === SymbolType.Stroke) {\n      await this.interactWithBackend(localSymbol)\n    }\n  }\n}\n","import { OIBehaviors } from \"../behaviors\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { OIModel } from \"../model\"\nimport { OIEraser, TPointer, TSegment } from \"../primitive\"\nimport { OISVGRenderer } from \"../renderer\"\n\n/**\n * @group Manager\n */\nexport class OIEraseManager\n{\n  #logger = LoggerManager.getLogger(LoggerClass.WRITE)\n  behaviors: OIBehaviors\n\n  currentEraser?: OIEraser\n\n  constructor(behaviors: OIBehaviors)\n  {\n    this.#logger.info(\"constructor\")\n    this.behaviors = behaviors\n  }\n\n  get model(): OIModel\n  {\n    return this.behaviors.model\n  }\n\n  get renderer(): OISVGRenderer\n  {\n    return this.behaviors.renderer\n  }\n\n  start(pointer: TPointer): void\n  {\n    this.#logger.info(\"startErase\", { pointer })\n    this.currentEraser = new OIEraser()\n    this.currentEraser.pointers.push(pointer)\n    this.renderer.drawSymbol(this.currentEraser!)\n  }\n\n  continue(pointer: TPointer): void\n  {\n    this.#logger.info(\"continueErase\", { pointer })\n    if (!this.currentEraser) {\n      throw new Error(\"Can't update current eraser because currentEraser is undefined\")\n    }\n    this.currentEraser.pointers.push(pointer)\n    this.renderer.drawSymbol(this.currentEraser)\n    const lastSeg: TSegment = {\n      p1: this.currentEraser.pointers.at(-1)!,\n      p2: this.currentEraser.pointers.at(-2)!\n    }\n    this.model.symbols.forEach(s => {\n      if (s.isIntersected(lastSeg))\n      {\n        s.deleting = true\n      }\n    })\n    this.model.symbolsToDelete.map(s => this.renderer.drawSymbol(s))\n  }\n\n  async end(pointer: TPointer): Promise<void>\n  {\n    this.#logger.info(\"finishErasing\", { pointer })\n    this.continue(pointer)\n\n    this.renderer.removeSymbol(this.currentEraser!.id)\n    this.currentEraser = undefined\n    this.behaviors.removeSymbols(this.model.symbolsToDelete.map(s => s.id))\n  }\n}\n","import { OIBehaviors } from \"../behaviors\"\nimport { LoggerManager, LoggerClass } from \"../logger\"\nimport { OIModel, JIIXEdgeKind } from \"../model\"\nimport { Box, OIText, SymbolType, TBoundingBox, TOISymbol } from \"../primitive\"\nimport { OISVGRenderer, OISVGRendererConst, SVGBuilder } from \"../renderer\"\nimport { convertBoundingBoxMillimeterToPixel, createUUID } from \"../utils\"\n\n/**\n * @group Manager\n */\nexport class OIDebugSVGManager\n{\n  #logger = LoggerManager.getLogger(LoggerClass.SVGDEBUG)\n  #snapPointsVisibility = false\n  #verticesVisibility = false\n  #boundingBoxVisibility = false\n  #recognitionBoxVisibility = false\n  #recognitionItemBoxVisibility = false\n\n  behaviors: OIBehaviors\n\n  constructor(behaviors: OIBehaviors)\n  {\n    this.#logger.info(\"constructor\")\n    this.behaviors = behaviors\n  }\n\n  get model(): OIModel\n  {\n    return this.behaviors.model\n  }\n\n  get renderer(): OISVGRenderer\n  {\n    return this.behaviors.renderer\n  }\n\n  get snapPointsVisibility(): boolean\n  {\n    return this.#snapPointsVisibility\n  }\n  set snapPointsVisibility(show: boolean)\n  {\n    this.#snapPointsVisibility = show\n    this.debugSnapPoints()\n  }\n\n  get verticesVisibility(): boolean\n  {\n    return this.#verticesVisibility\n  }\n  set verticesVisibility(show: boolean)\n  {\n    this.#verticesVisibility = show\n    this.debugVertices()\n  }\n\n  get boundingBoxVisibility(): boolean\n  {\n    return this.#boundingBoxVisibility\n  }\n  set boundingBoxVisibility(show: boolean)\n  {\n    this.#boundingBoxVisibility = show\n    this.#boundingBoxVisibility ? this.showBoundingBox() : this.hideBoundingBox()\n  }\n\n  get recognitionBoxVisibility(): boolean\n  {\n    return this.#recognitionBoxVisibility\n  }\n  set recognitionBoxVisibility(show: boolean)\n  {\n    this.#recognitionBoxVisibility = show\n    this.debugRecognitionBox()\n  }\n\n  get recognitionItemBoxVisibility(): boolean\n  {\n    return this.#recognitionItemBoxVisibility\n  }\n  set recognitionItemBoxVisibility(show: boolean)\n  {\n    this.#recognitionItemBoxVisibility = show\n    this.debugRecognitionItemBox()\n  }\n\n  protected showSnapPoints(): void\n  {\n    this.#logger.info(\"showSnapPoints\")\n    if (this.model.currentSymbol) {\n      this.model.currentSymbol.snapPoints.forEach(p => this.renderer.drawCircle(p, 2, { fill: \"blue\", \"debug\": \"snap-points\" }))\n    }\n    this.model.symbols.forEach(s => s.snapPoints.forEach(p => this.renderer.drawCircle(p, 2, { fill: \"blue\", \"debug\": \"snap-points\" })))\n  }\n  protected hideSnapPoints(): void\n  {\n    this.#logger.info(\"hideSnapPoints\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"snap-points\" } })\n  }\n  debugSnapPoints(): void\n  {\n    this.hideSnapPoints()\n    if (this.snapPointsVisibility) {\n      this.showSnapPoints()\n    }\n  }\n\n  protected showVertices(): void\n  {\n    this.#logger.info(\"showVertices\")\n    if (this.model.currentSymbol) {\n      this.model.currentSymbol.vertices.forEach(p => this.renderer.drawCircle(p, 2, { fill: \"red\", \"debug\": \"vertices\" }))\n    }\n    this.model.symbols.forEach(s => s.vertices.forEach(p => this.renderer.drawCircle(p, 2, { fill: \"red\", \"debug\": \"vertices\" })))\n  }\n  protected hideVertices(): void\n  {\n    this.#logger.info(\"hideVertices\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"vertices\" } })\n  }\n  debugVertices(): void\n  {\n    this.hideVertices()\n    if (this.verticesVisibility) {\n      this.showVertices()\n    }\n  }\n\n  protected drawBoundingBox(symbols: TOISymbol[]): void\n  {\n    const symbolAttrs = {\n      style: \"pointer-events: none\",\n      fill: \"transparent\",\n      stroke: \"red\",\n      \"stroke-width\": \"1\",\n      \"stroke-dasharray\": \"5 5\",\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"debug\": \"bounding-box\"\n    }\n    const charAttrs = {\n      style: \"pointer-events: none\",\n      fill: \"transparent\",\n      stroke: \"orange\",\n      \"stroke-width\": \"1\",\n      \"stroke-dasharray\": \"0 5 0\",\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"debug\": \"bounding-box\"\n    }\n    symbols.forEach(s =>\n    {\n      const symEl = this.renderer.getElementById(s.id)\n      if (symEl) {\n        if (s.type === SymbolType.Text) {\n          const text = s as OIText\n          let transform: string = \"\"\n          if (text.rotation) {\n            transform = `rotate(${ text.rotation.degree }, ${ text.rotation.center.x }, ${ text.rotation.center.y })`\n          }\n          text.chars.forEach(c =>\n          {\n            const ca = {\n              ...charAttrs,\n              char: c.label,\n              transform\n            }\n            symEl.insertAdjacentElement(\"beforebegin\", SVGBuilder.createRect(c.bounds, ca))\n          })\n          const sa = {\n            ...symbolAttrs,\n            symbol: s.id,\n            transform\n          }\n          symEl.insertAdjacentElement(\"beforebegin\", SVGBuilder.createRect(s.bounds, sa))\n        }\n        else {\n          const sa = {\n            ...symbolAttrs,\n            symbol: s.id,\n          }\n          symEl.insertAdjacentElement(\"beforebegin\", SVGBuilder.createRect(s.bounds, sa))\n        }\n      }\n    })\n  }\n  protected showBoundingBox(): void\n  {\n    this.#logger.info(\"showBoundingBox\")\n    if (this.model.currentSymbol) {\n      this.drawBoundingBox([this.model.currentSymbol])\n    }\n    this.drawBoundingBox(this.model.symbols)\n  }\n  protected hideBoundingBox(): void\n  {\n    this.#logger.info(\"hideBoundingBox\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"bounding-box\" } })\n  }\n  debugBoundingBox(): void\n  {\n    this.hideBoundingBox()\n    if (this.boundingBoxVisibility) {\n      this.showBoundingBox()\n    }\n  }\n\n  protected drawRecognitionBox(box: TBoundingBox, infos?: string[]): void\n  {\n    const COLOR = \"green\"\n    const TEXT_HEIGHT = 20\n    const recognitionGroup = SVGBuilder.createGroup({ \"debug\": \"recognition-box\" })\n\n    const rect = SVGBuilder.createRect(box, { fill: \"transparent\", stroke: COLOR, style: OISVGRendererConst.noSelection })\n    recognitionGroup.appendChild(rect)\n\n    const infosGroup = SVGBuilder.createGroup({ id: `infos-group-${ createUUID() }` })\n    const infoX = box.x + box.width\n    let infoY = box.y + TEXT_HEIGHT / 2\n    infos?.forEach(w =>\n    {\n      infosGroup.appendChild(SVGBuilder.createText({ x: infoX, y: infoY }, w, { stroke: COLOR, style: OISVGRendererConst.noSelection }))\n      infoY += TEXT_HEIGHT\n    })\n    recognitionGroup.appendChild(infosGroup)\n    this.renderer.layer.appendChild(recognitionGroup)\n\n    const infosGroupBox = infosGroup.getBBox()\n    const rectBox = {\n      width: infosGroupBox.width + 10,\n      height: infosGroupBox.height + 10,\n      x: infosGroupBox.x - 5,\n      y: infosGroupBox.y - 5,\n    }\n    const rectTranslate = SVGBuilder.createRect(rectBox, { fill: \"white\", style: \"cursor:move\", stroke: COLOR })\n    infosGroup.prepend(rectTranslate)\n\n    const translateEl = (e: PointerEvent) =>\n    {\n      e.preventDefault()\n      e.stopPropagation()\n      const originX = Number(this.renderer.getAttribute(infosGroup.id, \"originX\"))\n      const originY = Number(this.renderer.getAttribute(infosGroup.id, \"originY\"))\n      const tx = e.clientX - originX\n      const ty = e.clientY - originY\n      this.renderer.setAttribute(infosGroup.id, \"transform\", `translate(${ tx },${ ty })`)\n      const newRectBox = {\n        width: rectBox.width,\n        height: rectBox.height,\n        x: rectBox.x + tx,\n        y: rectBox.y + ty,\n      }\n      this.renderer.removeSymbol(`connection-${ infosGroup.id }`)\n      this.renderer.drawConnectionBetweenBox(`connection-${ infosGroup.id }`, box, newRectBox, { stroke: COLOR, debug: \"recognition-box-link\" })\n    }\n\n    rectTranslate.addEventListener(\"pointerdown\", e =>\n    {\n      e.preventDefault()\n      e.stopPropagation()\n      if (!this.renderer.getAttribute(infosGroup.id, \"originX\")) {\n        this.renderer.setAttribute(infosGroup.id, \"originX\", e.clientX.toString())\n        this.renderer.setAttribute(infosGroup.id, \"originY\", e.clientY.toString())\n      }\n      this.renderer.layer.addEventListener(\"pointermove\", translateEl)\n      this.renderer.layer.addEventListener(\"pointerup\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n      this.renderer.layer.addEventListener(\"pointerleave\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n      this.renderer.layer.addEventListener(\"pointercancel\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n    })\n  }\n\n  protected async showRecognitionBox(): Promise<void>\n  {\n    this.#logger.info(\"showRecognitionBox\")\n    await this.behaviors.export([\"application/vnd.myscript.jiix\"])\n    const jiix = this.model.exports?.[\"application/vnd.myscript.jiix\"]\n    this.#logger.debug(\"showRecognitionBox\", { jiix })\n    if (jiix) {\n      if (!jiix[\"bounding-box\"]) {\n        this.#logger.warn(\"drawRecognitionBox\", \"You must to enabled configuration.recognition.exports[\\\"bounding-box\\\"]\")\n        return\n      }\n      jiix.elements?.forEach(el =>\n      {\n        switch (el.type) {\n          case \"Node\": {\n            if (el[\"bounding-box\"]) {\n              const box = convertBoundingBoxMillimeterToPixel(el[\"bounding-box\"])\n              const hideProperties = [\"bounding-box\", \"items\", \"id\"]\n              const infos = Object.keys(el).filter(k => !hideProperties.includes(k)).map(k => `${ k }: ${ JSON.stringify(el[k as keyof typeof el]) }`)\n              this.drawRecognitionBox(box, infos)\n            }\n            break\n          }\n          case \"Text\": {\n            el.words?.forEach(w =>\n            {\n              if (w?.[\"bounding-box\"]) {\n                const box = convertBoundingBoxMillimeterToPixel(w[\"bounding-box\"])\n                this.drawRecognitionBox(box, [`type: ${ el.type }`, `candidates: ${ JSON.stringify(w.candidates || []) }`])\n              }\n            })\n            break\n          }\n          case \"Edge\": {\n            if (el.kind === JIIXEdgeKind.PolyEdge) {\n              const infos = [\n                `type: ${ el.type }`,\n                `kind: ${ el.kind }`,\n              ]\n              el.edges.forEach((e, i) =>\n              {\n                let inf = `edge-${ i }: [{ x1: ${ e.x1 }, y2: ${ e.y1 } },{ x2: ${ e.x2 }, y2: ${ e.y2 } }]`\n                if (e.p1Decoration) {\n                  inf += `, p1Decoration: ${ e.p1Decoration }`\n                }\n                if (e.p2Decoration) {\n                  inf += `, p2Decoration: ${ e.p2Decoration }`\n                }\n                infos.push(inf)\n              })\n              const box = convertBoundingBoxMillimeterToPixel(Box.createFromBoxes(el.edges.map(e => e[\"bounding-box\"] as TBoundingBox)))\n              this.drawRecognitionBox(box, infos)\n            }\n            else if (el[\"bounding-box\"]) {\n              const box = convertBoundingBoxMillimeterToPixel(el[\"bounding-box\"])\n              const hideProperties = [\"bounding-box\", \"items\", \"id\", \"ports\", \"connected\"]\n              const infos = Object.keys(el).filter(k => !hideProperties.includes(k)).map(k => `${ k }: ${ JSON.stringify(el[k as keyof typeof el]) }`)\n              this.drawRecognitionBox(box, infos)\n            }\n            break\n          }\n          default: {\n            this.#logger.warn(\"drawRecognitionBox\", `Unknow jiix element type: ${ el.type }`)\n            break\n          }\n        }\n      })\n    }\n  }\n  protected clearRecognitionBox(): void\n  {\n    this.#logger.info(\"clearRecognitionBox\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"recognition-box\" } })\n    this.renderer.clearElements({ attrs: { \"debug\": \"recognition-box-link\" } })\n  }\n  async debugRecognitionBox(): Promise<void>\n  {\n    this.clearRecognitionBox()\n    if (this.#recognitionBoxVisibility) {\n      this.showRecognitionBox()\n    }\n  }\n\n  protected drawRecognitionItemBox(box: TBoundingBox, label?: string, chars?: string[]): void\n  {\n    const COLOR = \"blue\"\n    const CHAR_SIZE = 14\n\n    const recognitionItemGroup = SVGBuilder.createGroup({ \"debug\": \"recognition-item-box\" })\n    const rect = SVGBuilder.createRect(box, { fill: \"transparent\", stroke: COLOR, style: OISVGRendererConst.noSelection })\n    recognitionItemGroup.appendChild(rect)\n\n    const charX = box.x\n    let charY = box.y - CHAR_SIZE\n\n    const charsGroup = SVGBuilder.createGroup({ id: `chars-group-${ createUUID() }` })\n    if (label) {\n      charsGroup.appendChild(SVGBuilder.createText({ x: charX, y: charY }, `label: ${ label }`, { fill: COLOR, \"font-size\": CHAR_SIZE.toString(), style: OISVGRendererConst.noSelection }))\n    }\n    if (chars?.length) {\n      charY += CHAR_SIZE\n      charsGroup.appendChild(SVGBuilder.createText({ x: charX, y: charY }, `[${ chars.join(\", \") }]`, { fill: COLOR, \"font-size\": CHAR_SIZE.toString(), style: OISVGRendererConst.noSelection }))\n    }\n\n    recognitionItemGroup.appendChild(charsGroup)\n    this.renderer.layer.appendChild(recognitionItemGroup)\n\n    const charsGroupBox = charsGroup.getBBox()\n    const rectBox = {\n      width: charsGroupBox.width + 10,\n      height: charsGroupBox.height + 10,\n      x: charsGroupBox.x - 5,\n      y: charsGroupBox.y - 5,\n    }\n    const rectTranslate = SVGBuilder.createRect(rectBox, { fill: \"white\", style: \"cursor:move\", stroke: COLOR })\n    charsGroup.prepend(rectTranslate)\n\n    const translateEl = (e: PointerEvent) =>\n    {\n      e.preventDefault()\n      e.stopPropagation()\n      const originX = Number(this.renderer.getAttribute(charsGroup.id, \"originX\"))\n      const originY = Number(this.renderer.getAttribute(charsGroup.id, \"originY\"))\n      const tx = e.clientX - originX\n      const ty = e.clientY - originY\n      this.renderer.setAttribute(charsGroup.id, \"transform\", `translate(${ tx },${ ty })`)\n      const newRectBox = {\n        width: rectBox.width,\n        height: rectBox.height,\n        x: rectBox.x + tx,\n        y: rectBox.y + ty,\n      }\n      this.renderer.removeSymbol(`connection-${ charsGroup.id }`)\n      this.renderer.drawConnectionBetweenBox(`connection-${ charsGroup.id }`, box, newRectBox, { stroke: COLOR, debug: \"recognition-item-box-link\" })\n    }\n\n    rectTranslate.addEventListener(\"pointerdown\", e =>\n    {\n      e.preventDefault()\n      e.stopPropagation()\n      if (!this.renderer.getAttribute(charsGroup.id, \"originX\")) {\n        this.renderer.setAttribute(charsGroup.id, \"originX\", e.clientX.toString())\n        this.renderer.setAttribute(charsGroup.id, \"originY\", e.clientY.toString())\n      }\n      this.renderer.layer.addEventListener(\"pointermove\", translateEl)\n    })\n    this.renderer.layer.addEventListener(\"pointerup\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n    this.renderer.layer.addEventListener(\"pointerleave\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n    this.renderer.layer.addEventListener(\"pointercancel\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n\n  }\n  protected async showRecognitionItemBox(): Promise<void>\n  {\n    this.#logger.info(\"showRecognitionBoxItem\")\n    await this.behaviors.export([\"application/vnd.myscript.jiix\"])\n    const jiix = this.model.exports?.[\"application/vnd.myscript.jiix\"]\n    this.#logger.debug(\"showRecognitionBoxItem\", { jiix })\n    if (jiix) {\n      jiix.elements?.forEach(el =>\n      {\n        switch (el.type) {\n          case \"Text\": {\n            el.chars?.forEach(c =>\n            {\n              if (c?.[\"bounding-box\"]) {\n                const box = convertBoundingBoxMillimeterToPixel(c[\"bounding-box\"])\n                this.drawRecognitionItemBox(box, c.label, c.candidates)\n              }\n            })\n            break\n          }\n          case \"Node\": {\n            if (el?.[\"bounding-box\"]) {\n              const box = convertBoundingBoxMillimeterToPixel(el[\"bounding-box\"])\n              this.drawRecognitionItemBox(box, el.kind)\n            }\n            break\n          }\n          case \"Edge\": {\n            if (el.kind === JIIXEdgeKind.PolyEdge) {\n              el.edges.forEach(e =>\n              {\n                const box = convertBoundingBoxMillimeterToPixel(e[\"bounding-box\"])\n                this.drawRecognitionItemBox(box, e.kind)\n              })\n            }\n            else if (el[\"bounding-box\"]) {\n              const box = convertBoundingBoxMillimeterToPixel(el[\"bounding-box\"])\n              this.drawRecognitionItemBox(box, el.kind)\n            }\n            break\n          }\n          default:\n            this.#logger.warn(\"drawRecognitionBoxItem\", `Unknow jiix element type: ${ el.type }`)\n            break\n        }\n      })\n    }\n  }\n  protected clearRecognitionItemBox(): void\n  {\n    this.#logger.info(\"clearRecognitionBoxItem\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"recognition-item-box\" } })\n    this.renderer.clearElements({ attrs: { \"debug\": \"recognition-item-box-link\" } })\n  }\n  async debugRecognitionItemBox(): Promise<void>\n  {\n    this.clearRecognitionItemBox()\n    if (this.#recognitionItemBoxVisibility) {\n      this.showRecognitionItemBox()\n    }\n  }\n\n  apply(): void\n  {\n    this.debugBoundingBox()\n    this.debugVertices()\n    this.debugSnapPoints()\n    this.debugRecognitionBox()\n    this.debugRecognitionItemBox()\n  }\n}\n","import ArrowDown from \"../assets/svg/nav-arrow-down.svg\"\n\n/**\n * @group Menu\n */\nexport type TMenuItem = {\n  id: string,\n  label: string,\n  type: \"button\" | \"checkbox\" | \"select\" | \"list\" | \"colors\"\n  disabled?: boolean\n}\n\n/**\n * @group Menu\n */\nexport type TMenuItemButton = TMenuItem & {\n  type: \"button\"\n  tooltip?: {\n    label: string,\n    position: \"top\" | \"left\" | \"right\" | \"bottom\"\n  },\n  icon?: string\n  callback: () => void\n}\n\n/**\n * @group Menu\n */\nexport type TMenuItemButtonList = TMenuItem & {\n  type: \"list\"\n  tooltip?: {\n    label: string,\n    position: \"top\" | \"left\" | \"right\" | \"bottom\"\n  }\n  initValue: string,\n  values: { label: string, value: string }[]\n  callback: (value: string) => void\n}\n\n/**\n * @group Menu\n */\nexport type TMenuItemColorList = TMenuItem & {\n  type: \"colors\"\n  tooltip?: {\n    label: string,\n    position: \"top\" | \"left\" | \"right\" | \"bottom\"\n  },\n  initValue: string,\n  values: string[]\n  fill: boolean\n  callback: (value: string) => void\n}\n\n/**\n * @group Menu\n */\nexport type TMenuItemBoolean = TMenuItem & {\n  type: \"checkbox\",\n  initValue: boolean | \"indeterminate\",\n  callback: (value: boolean) => void\n}\n\n/**\n * @group Menu\n */\nexport type TMenuItemSelect = TMenuItem & {\n  type: \"select\",\n  initValue: string,\n  values: { label: string, value: string }[]\n  callback: (value: string) => void\n}\n\n/**\n * @group Menu\n */\nexport abstract class OIMenu\n{\n  thicknessList = [\n    { label: \"S\", value: 1 },\n    { label: \"M\", value: 2 },\n    { label: \"L\", value: 4 },\n    { label: \"XL\", value: 8 },\n  ]\n\n  fontSizeList = [\n    { label: \"Auto\", value: 0 },\n    { label: \"S\", value: 0.5 },\n    { label: \"M\", value: 0.75 },\n    { label: \"L\", value: 1 },\n  ]\n\n  fontWeightList = [\n    { label: \"Auto\", value: undefined },\n    { label: \"Normal\", value: \"normal\" },\n    { label: \"Bold\", value: \"bold\" },\n  ]\n\n  colors = [\n    \"#000000\", \"#808080\", \"#ffffff\", \"transparent\",\n    \"#ff0000\", \"#ff6400\", \"#ffc800\", \"#ffff00\",\n    \"#0000ff\", \"#0064ff\", \"#00c8ff\", \"#00ffff\",\n    \"#008000\", \"#00af00\", \"#00e100\", \"#00ff00\"\n  ]\n\n  protected createToolTip(el: HTMLElement, text: string, position: \"top\" | \"left\" | \"right\" | \"bottom\" = \"top\"): HTMLElement\n  {\n    el.classList.add(\"ms-tooltip\")\n    const tooltipContent = document.createElement(\"span\")\n    tooltipContent.classList.add(\"ms-tooltip-content\", position)\n    tooltipContent.textContent = text\n    el.appendChild(tooltipContent)\n    return el\n  }\n\n  protected createWrapCollapsible(el: Node, title: string): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.classList.add(\"collapsible-wrapper\")\n    const head = document.createElement(\"div\")\n    head.classList.add(\"collapsible-header\")\n    head.textContent = title\n    const btn = document.createElement(\"span\")\n    btn.classList.add(\"collapsible-header-icon\")\n    btn.innerHTML = ArrowDown\n    head.appendChild(btn)\n    head.style.setProperty(\"pointer\", \"cursor\")\n    const content = document.createElement(\"div\")\n    content.classList.add(\"collapsible-content\")\n    head.addEventListener(\"pointerup\", () => wrapper.classList.toggle(\"active\"))\n    wrapper.appendChild(head)\n    content.appendChild(el)\n    wrapper.appendChild(content)\n    return wrapper\n  }\n\n  protected createSeparatorHorizontal(): HTMLHRElement\n  {\n    const separator = document.createElement(\"hr\")\n    separator.classList.add(\"separator\")\n    separator.classList.add(\"horizontal\")\n    return separator\n  }\n\n  protected createSeparatorVertical(): HTMLHRElement\n  {\n    const separator = document.createElement(\"hr\")\n    separator.classList.add(\"separator\")\n    separator.classList.add(\"vertical\")\n    return separator\n  }\n\n  protected createMenuItemBoolean(item: TMenuItemBoolean): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.classList.add(\"ms-menu-item\", item.type)\n    const labelEl = document.createElement(\"span\")\n    labelEl.textContent = item.label\n    wrapper.appendChild(labelEl)\n    const checkbox = document.createElement(\"input\")\n    checkbox.id = item.id\n    checkbox.setAttribute(\"type\", \"checkbox\")\n    if (item.disabled) {\n      checkbox.disabled = true\n    }\n    if (item.initValue === \"indeterminate\") {\n      checkbox.indeterminate = true\n    } else {\n      checkbox.checked = item.initValue\n    }\n    checkbox.addEventListener(\"change\", (e) => item.callback((e.target as HTMLInputElement).checked))\n    wrapper.appendChild(checkbox)\n    return wrapper\n  }\n\n  protected createMenuItemSelect(item: TMenuItemSelect): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.classList.add(\"ms-menu-item\", item.type)\n    const labelEl = document.createElement(\"span\")\n    labelEl.textContent = item.label\n    wrapper.appendChild(labelEl)\n    const select = document.createElement(\"select\")\n    select.id = item.id\n    if (item.disabled) {\n      select.disabled = true\n    }\n    item.values.forEach(v =>\n    {\n      const selected = v.value === item.initValue\n      const opt = new Option(v.label, v.value.toString(), selected, selected)\n      select.appendChild(opt)\n    })\n    select.addEventListener(\"change\", (e) => item.callback((e.target as HTMLInputElement).value))\n    wrapper.appendChild(select)\n    return wrapper\n  }\n\n  protected createMenuItemButton(item: TMenuItemButton): HTMLElement\n  {\n    const btn = document.createElement(\"button\")\n    btn.classList.add(\"ms-menu-item\", \"ms-menu-button\")\n    btn.innerHTML = item.icon || item.label\n    btn.addEventListener(\"pointerup\", item.callback)\n    if (item.tooltip) {\n      return this.createToolTip(btn, item.tooltip.label, item.tooltip.position)\n    }\n    else {\n      return btn\n    }\n  }\n\n  protected createMenuItemButtonList(item: TMenuItemButtonList): HTMLElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.classList.add(\"ms-menu-item\", item.type)\n    wrapper.id = item.id\n    const labelEl = document.createElement(\"span\")\n    labelEl.textContent = item.label\n    wrapper.appendChild(labelEl)\n    item.values.forEach((v) =>\n    {\n      const btn = document.createElement(\"button\")\n      if (item.disabled) {\n        btn.disabled = true\n      }\n      btn.id = `${item.id}-${ v.value }-btn`\n      if (item.initValue === v.value) {\n        btn.classList.add(\"active\")\n      }\n      btn.textContent = v.label\n      btn.addEventListener(\"pointerup\", () =>\n      {\n        item.callback(v.value)\n        wrapper.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n        btn.classList.add(\"active\")\n      })\n      wrapper.appendChild(btn)\n    })\n    return wrapper\n  }\n\n  protected createMenuItemColorList(item: TMenuItemColorList): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.classList.add(\"ms-menu-item\", item.type)\n    wrapper.id = item.id\n    const labelEl = document.createElement(\"span\")\n    labelEl.textContent = item.label\n    wrapper.appendChild(labelEl)\n    wrapper.appendChild(this.createColorList(item))\n    return wrapper\n  }\n\n  protected createColorList(item: TMenuItemColorList): HTMLDivElement\n  {\n    const list = document.createElement(\"div\")\n    list.id = `${ item.id }-list`\n    list.classList.add(\"ms-menu-row\", \"color-list\")\n    item.values.forEach((color) =>\n    {\n      const btn = document.createElement(\"button\")\n      if (item.disabled) {\n        btn.disabled = true\n      }\n      btn.id = `${ item.id }-${ color.replace(\"#\", \"\") }-btn`\n      btn.classList.add(\"ms-menu-button\", \"square\")\n      const colorEl = document.createElement(\"div\")\n      colorEl.classList.add(\"color\")\n      if (item.fill) {\n        colorEl.style.setProperty(\"background-color\", color)\n        colorEl.style.setProperty(\"border\", \"1px solid lightgrey\")\n      } else {\n        colorEl.style.setProperty(\"background-color\", \"transparent\")\n        colorEl.style.setProperty(\"border\", `3px solid ${ color }`)\n      }\n      if (color === \"#ffffff\") {\n        colorEl.style.setProperty(\"border\", \"1px solid black\")\n      }\n      if (color === \"transparent\") {\n        colorEl.style.setProperty(\"background-image\", \"linear-gradient(45deg, #AAA 10%, transparent 20%, #AAA 30%, transparent 40%, #AAA 50%, transparent 60%, #AAA 70%, transparent 80%, #AAA 90%, transparent 100%)\")\n      }\n      if (item.initValue === color) {\n        btn.classList.add(\"active\")\n      }\n      btn.appendChild(colorEl)\n      btn.addEventListener(\"pointerup\", (e) =>\n      {\n        e.preventDefault()\n        e.stopPropagation()\n        item.callback(color)\n        list.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n        btn.classList.add(\"active\")\n      })\n      list!.appendChild(btn)\n    })\n    return list\n  }\n\n  protected createMenuItem(item: TMenuItem): HTMLElement\n  {\n    switch (item.type) {\n      case \"checkbox\":\n        return this.createMenuItemBoolean(item as TMenuItemBoolean)\n      case \"select\":\n        return this.createMenuItemSelect(item as TMenuItemSelect)\n      case \"list\":\n        return this.createMenuItemButtonList(item as TMenuItemButtonList)\n      case \"colors\":\n        return this.createMenuItemColorList(item as TMenuItemColorList)\n      case \"button\":\n      default:\n        return this.createMenuItemButton(item as TMenuItemButton)\n    }\n  }\n\n  abstract render(domElement: HTMLElement): void\n\n  abstract update(): void\n\n  abstract show(): void\n\n  abstract hide(): void\n\n  abstract destroy(): void\n}\n","/**\n * @group Menu\n */\nexport type TSubMenuParam =\n{\n  trigger: HTMLElement,\n  menuTitle?: string,\n  subMenu: HTMLElement,\n  position: \"top\" | \"left\" | \"right\" | \"right-top\" | \"bottom\" | \"bottom-left\" | \"bottom-right\"\n}\nexport class OIMenuSub {\n  element: HTMLDivElement\n  content: HTMLElement\n\n  constructor(param : TSubMenuParam) {\n    this.element = document.createElement(\"div\")\n    this.element.classList.add(\"sub-menu\")\n    this.element.appendChild(param.trigger)\n    this.content = document.createElement(\"div\")\n    if(param.menuTitle) {\n      const menuTitleElement = document.createElement(\"h3\")\n      menuTitleElement.classList.add(\"ms-menu-title\")\n      menuTitleElement.textContent = param.menuTitle\n      this.content.appendChild(menuTitleElement)\n    }\n    this.content.classList.add(\"sub-menu-content\", param.position)\n    this.content.appendChild(param.subMenu)\n    this.element.appendChild(this.content)\n\n    param.trigger.addEventListener(\"pointerdown\", () => this.toggle())\n    document.addEventListener(\"pointerdown\", (e) => {\n      if (!this.element.contains(e.target as HTMLElement)) {\n        this.close()\n      }\n    })\n  }\n\n  open(): void {\n    this.content.classList.add(\"open\")\n  }\n\n  close(): void {\n    this.content.classList.remove(\"open\")\n  }\n\n  toggle(): void {\n    this.content.classList.toggle(\"open\")\n  }\n\n  unwrap(): void {\n    this.content.classList.remove(\"sub-menu-content\")\n    this.element.insertAdjacentElement(\"beforebegin\", this.content)\n    this.element.style.display = \"none\"\n  }\n\n  wrap(): void {\n    this.content.classList.add(\"sub-menu-content\")\n    this.element.appendChild(this.content)\n    this.element.style.display = \"block\"\n  }\n\n}\n","import menuIcon from \"../assets/svg/menu.svg\"\nimport languageIcon from \"../assets/svg/language.svg\"\nimport trashIcon from \"../assets/svg/trash.svg\"\nimport undoIcon from \"../assets/svg/undo.svg\"\nimport redoIcon from \"../assets/svg/redo.svg\"\nimport translateIcon from \"../assets/svg/translate.svg\"\nimport gestureIcon from \"../assets/svg/spock-hand-gesture.svg\"\nimport guideIcon from \"../assets/svg/orthogonal-view.svg\"\nimport snapIcon from \"../assets/svg/arrow-to-dot.svg\"\nimport debugIcon from \"../assets/svg/wolf.svg\"\nimport downloadIcon from \"../assets/svg/download.svg\"\nimport uploadIcon from \"../assets/svg/upload.svg\"\nimport { Intention, WriteTool } from \"../Constants\"\nimport { OIBehaviors } from \"../behaviors\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { OIModel } from \"../model\"\nimport { OIMenu, TMenuItemBoolean, TMenuItemButton, TMenuItemButtonList, TMenuItemSelect } from \"./OIMenu\"\nimport { TOISymbol } from \"../primitive\"\nimport { InsertAction, StrikeThroughAction, SurroundAction } from \"../gesture\"\nimport { OIMenuSub, TSubMenuParam } from \"./OIMenuSub\"\nimport { getAvailableLanguageList, PartialDeep } from \"../utils\"\n\n/**\n * @group Menu\n */\nexport class OIMenuAction extends OIMenu\n{\n  #logger = LoggerManager.getLogger(LoggerClass.MENU)\n\n  behaviors: OIBehaviors\n  id: string\n  wrapper?: HTMLElement\n  menuLanguage!: OIMenuSub\n  menuClear?: HTMLButtonElement\n  menuUndo?: HTMLButtonElement\n  menuRedo?: HTMLButtonElement\n  menuConvert?: HTMLButtonElement\n\n  guideGaps = [\n    { label: \"S\", value: \"25\" },\n    { label: \"M\", value: \"50\" },\n    { label: \"L\", value: \"100\" },\n    { label: \"XL\", value: \"150\" },\n  ]\n\n  constructor(behaviors: OIBehaviors, id = \"ms-menu-action\")\n  {\n    super()\n    this.id = id\n    this.behaviors = behaviors\n  }\n\n  get model(): OIModel\n  {\n    return this.behaviors.model\n  }\n\n  get isMobile(): boolean\n  {\n    return this.behaviors.renderer.parent.clientWidth < 700\n  }\n\n  protected createMenuClear(): HTMLElement\n  {\n    this.menuClear = document.createElement(\"button\")\n    this.menuClear.id = `${ this.id }-clear`\n    this.menuClear.classList.add(\"ms-menu-button\", \"square\")\n    this.menuClear.innerHTML = trashIcon\n    this.menuClear.addEventListener(\"pointerup\", () =>\n    {\n      this.#logger.info(`${ this.id }.clear`)\n      this.behaviors.clear()\n    })\n    return this.createToolTip(this.menuClear, \"Clear\", \"bottom\")\n  }\n\n  protected createMenuLanguage(): HTMLElement\n  {\n    const triggerBtn = document.createElement(\"button\")\n    triggerBtn.id = this.id\n    triggerBtn.classList.add(\"ms-menu-button\", \"square\")\n    triggerBtn.innerHTML = languageIcon\n\n    const select = document.createElement(\"select\")\n    select.classList.add(\"select-language\")\n    select.id = `${ this.id }-language`\n    getAvailableLanguageList(this.behaviors.configuration)\n      .then(json =>\n      {\n        const languages = json.result as { [key: string]: string }\n        Object.keys(languages).forEach(key =>\n        {\n          const selected = key === this.behaviors.configuration.recognition.lang\n          const opt = new Option(languages[key], key, selected, selected)\n          select.appendChild(opt)\n        })\n      })\n    select.addEventListener(\"change\", (e) =>\n    {\n      this.#logger.info(`${ this.id }.selectLanguage`)\n      const value = (e.target as HTMLInputElement).value\n      this.behaviors.changeLanguage(value)\n    })\n    const params: TSubMenuParam = {\n      trigger: triggerBtn,\n      subMenu: select,\n      position: \"bottom-right\"\n    }\n    this.menuLanguage = new OIMenuSub(params)\n    return this.menuLanguage.element\n  }\n\n  protected createMenuUndo(): HTMLElement\n  {\n    this.menuUndo = document.createElement(\"button\")\n    this.menuUndo.id = `${ this.id }-undo`\n    this.menuUndo.classList.add(\"ms-menu-button\", \"square\")\n    this.menuUndo.innerHTML = undoIcon\n    this.menuUndo.addEventListener(\"pointerup\", async () =>\n    {\n      this.#logger.info(`${ this.id }.undo`)\n      await this.behaviors.undo()\n    })\n    return this.createToolTip(this.menuUndo, \"Undo\", \"bottom\")\n  }\n\n  protected createMenuRedo(): HTMLElement\n  {\n    this.menuRedo = document.createElement(\"button\")\n    this.menuRedo.id = `${ this.id }-redo`\n    this.menuRedo.classList.add(\"ms-menu-button\", \"square\")\n    this.menuRedo.innerHTML = redoIcon\n    this.menuRedo.addEventListener(\"pointerup\", async () =>\n    {\n      this.#logger.info(`${ this.id }.redo`)\n      await this.behaviors.redo()\n    })\n    return this.createToolTip(this.menuRedo, \"Redo\", \"bottom\")\n  }\n\n  protected createMenuConvert(): HTMLElement\n  {\n    this.menuConvert = document.createElement(\"button\")\n    this.menuConvert.id = `${ this.id }-convert`\n    this.menuConvert.classList.add(\"ms-menu-button\", \"square\")\n    this.menuConvert.innerHTML = translateIcon\n    this.menuConvert.addEventListener(\"pointerup\", () =>\n    {\n      this.#logger.info(`${ this.id }.convert`)\n      this.behaviors.convert()\n    })\n    return this.createToolTip(this.menuConvert, \"Convert\", \"bottom\")\n  }\n\n  protected createMenuGesture(): HTMLDivElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-gesture`\n    trigger.classList.add(\"ms-menu-button\", \"square\")\n    trigger.innerHTML = gestureIcon\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n\n    const surroundActionValues: { label: string, value: string }[] = []\n    for (const key in SurroundAction) {\n      const value = SurroundAction[key as keyof typeof SurroundAction]\n      surroundActionValues.push({ label: key, value })\n    }\n    const strikeThroughActionValues: { label: string, value: string }[] = []\n    for (const key in StrikeThroughAction) {\n      const value = StrikeThroughAction[key as keyof typeof StrikeThroughAction]\n      strikeThroughActionValues.push({ label: key, value })\n    }\n    const splitActionValues: { label: string, value: string }[] = []\n    for (const key in InsertAction) {\n      const value = InsertAction[key as keyof typeof InsertAction]\n      splitActionValues.push({ label: key, value })\n    }\n    const menuItems: (TMenuItemBoolean | TMenuItemSelect)[] = [\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-gesture-detect`,\n        label: \"Detect gesture\",\n        initValue: this.behaviors.writer.detectGesture,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.gesture-detect`, { value })\n          this.behaviors.writer.detectGesture = value\n          this.behaviors.intention = Intention.Write\n          this.behaviors.writer.tool = WriteTool.Pencil\n        }\n      },\n      {\n        type: \"select\",\n        id: `${ this.id }-gesture-surround`,\n        label: \"On surround\",\n        values: surroundActionValues,\n        initValue: this.behaviors.gesture.surroundAction,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.gesture-surround`, { value })\n          this.behaviors.gesture.surroundAction = value as SurroundAction\n          this.behaviors.intention = Intention.Write\n          this.behaviors.writer.tool = WriteTool.Pencil\n        }\n      },\n      {\n        type: \"select\",\n        id: `${ this.id }-gesture-strikethrough`,\n        label: \"On strikethrough\",\n        values: strikeThroughActionValues,\n        initValue: this.behaviors.gesture.strikeThroughAction,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.gesture-strikethrough`, { value })\n          this.behaviors.gesture.strikeThroughAction = value as StrikeThroughAction\n          this.behaviors.intention = Intention.Write\n          this.behaviors.writer.tool = WriteTool.Pencil\n        }\n      },\n      {\n        type: \"select\",\n        id: `${ this.id }-gesture-strikethrough`,\n        label: \"On insert\",\n        values: splitActionValues,\n        initValue: this.behaviors.gesture.insertAction,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.gesture-InsertAction`, { value })\n          this.behaviors.gesture.insertAction = value as InsertAction\n          this.behaviors.intention = Intention.Write\n          this.behaviors.writer.tool = WriteTool.Pencil\n        }\n      },\n    ]\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Gesture\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new OIMenuSub(params).element\n  }\n\n  protected createMenuGuide(): HTMLDivElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-guide`\n    trigger.classList.add(\"ms-menu-button\", \"square\")\n    trigger.innerHTML = guideIcon\n\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n\n    const menuItems: (TMenuItemBoolean | TMenuItemSelect | TMenuItemButtonList)[] = [\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-guide-enable`,\n        label: \"Show guide\",\n        initValue: this.behaviors.configuration.rendering.guides.enable,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.guide-enable`, { value })\n          this.behaviors.configuration.rendering.guides.enable = value as boolean\n          this.behaviors.renderingConfiguration = this.behaviors.configuration.rendering\n        }\n      },\n      {\n        type: \"select\",\n        id: `${ this.id }-guide-type`,\n        label: \"Guide style\",\n        values: [\n          { label: \"Line\", value: \"line\" },\n          { label: \"Grid\", value: \"grid\" },\n          { label: \"Point\", value: \"point\" },\n        ],\n        initValue: this.behaviors.configuration.rendering.guides.type,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.guide-type`, { value })\n          this.behaviors.configuration.rendering.guides.type = value as (\"line\" | \"grid\" | \"point\")\n          this.behaviors.renderingConfiguration = this.behaviors.configuration.rendering\n        }\n      },\n      {\n        type: \"list\",\n        id: `${ this.id }-guide-size`,\n        label: \"Guide style\",\n        values: this.guideGaps,\n        initValue: this.behaviors.configuration.rendering.guides.gap.toString(),\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.guide-size`, { value })\n          this.behaviors.configuration.rendering.guides.gap = +value\n          this.behaviors.renderingConfiguration = this.behaviors.configuration.rendering\n        }\n      },\n    ]\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Guide\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new OIMenuSub(params).element\n  }\n\n  protected createMenuSnap(): HTMLDivElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-snap`\n    trigger.classList.add(\"ms-menu-button\", \"square\")\n    trigger.innerHTML = snapIcon\n\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n\n    const menuItems: (TMenuItemBoolean | TMenuItemSelect)[] = [\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-snap-to-guide`,\n        label: \"Snap to guide\",\n        initValue: this.behaviors.snaps.snapToGrid,\n        callback: (value) => this.behaviors.snaps.snapToGrid = value\n      },\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-snap-to-element`,\n        label: \"Snap to element\",\n        initValue: this.behaviors.snaps.snapToElement,\n        callback: (value) => this.behaviors.snaps.snapToElement = value\n      },\n      {\n        type: \"select\",\n        id: `${ this.id }-snap-angle`,\n        label: \"Snap angle\",\n        values: [\n          { label: \"None\", value: \"0\" },\n          { label: \"10\", value: \"10\" },\n          { label: \"30\", value: \"30\" },\n          { label: \"45\", value: \"45\" },\n          { label: \"90\", value: \"90\" },\n          { label: \"180\", value: \"180\" },\n        ],\n        initValue: this.behaviors.snaps.snapAngle.toString(),\n        callback: (angle) => this.behaviors.snaps.snapAngle = +angle\n      },\n    ]\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Snap\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new OIMenuSub(params).element\n  }\n\n  protected createMenuDebug(): HTMLDivElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-debug`\n    trigger.classList.add(\"ms-menu-button\", \"square\")\n    trigger.innerHTML = debugIcon\n\n    const menuItems: TMenuItemBoolean[] = [\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-debug-bounding-box`,\n        label: \"Show bounding box\",\n        initValue: this.behaviors.svgDebugger.boundingBoxVisibility,\n        callback: (debug) => this.behaviors.svgDebugger.boundingBoxVisibility = debug\n      },\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-debug-recognition-box`,\n        label: \"Show recognition box\",\n        initValue: this.behaviors.svgDebugger.recognitionBoxVisibility,\n        callback: (debug) => this.behaviors.svgDebugger.recognitionBoxVisibility = debug\n      },\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-debug-bounding-item-box`,\n        label: \"Show recognition item box\",\n        initValue: this.behaviors.svgDebugger.recognitionItemBoxVisibility,\n        callback: (debug) => this.behaviors.svgDebugger.recognitionItemBoxVisibility = debug\n      },\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-debug-snap-points`,\n        label: \"Show snap points\",\n        initValue: this.behaviors.svgDebugger.snapPointsVisibility,\n        callback: (debug) => this.behaviors.svgDebugger.snapPointsVisibility = debug\n      },\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-debug-vertices`,\n        label: \"Show vertices\",\n        initValue: this.behaviors.svgDebugger.verticesVisibility,\n        callback: (debug) => this.behaviors.svgDebugger.verticesVisibility = debug\n      },\n    ]\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Debug\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new OIMenuSub(params).element\n  }\n\n  protected createMenuExport(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-export`\n    trigger.classList.add(\"ms-menu-button\", \"square\")\n    trigger.innerHTML = downloadIcon\n\n    const menuItems: TMenuItemButton[] = [\n      {\n        type: \"button\",\n        id: `${ this.id }-export-json`,\n        label: \"json\",\n        callback: () =>\n        {\n          this.behaviors.downloadAsJson()\n        }\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-export-svg`,\n        label: \"svg\",\n        callback: () =>\n        {\n          this.behaviors.downloadAsSVG()\n        }\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-export-png`,\n        label: \"png\",\n        callback: () =>\n        {\n          this.behaviors.downloadAsPNG()\n        }\n      },\n    ]\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Export\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new OIMenuSub(params).element\n  }\n\n  protected async readFileAsText(file: File): Promise<string>\n  {\n    return new Promise((resolve, reject) =>\n    {\n      const reader = new FileReader()\n      reader.onerror = reject;\n      reader.onload = () => {\n        resolve(reader.result as string)\n      }\n      if (file) {\n        reader.readAsText(file)\n      }\n    })\n  }\n\n  protected createMenuImport(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-import`\n    trigger.classList.add(\"ms-menu-button\", \"square\")\n    trigger.innerHTML = uploadIcon\n\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n\n    const importInput = document.createElement(\"input\")\n    importInput.type = \"file\"\n    importInput.accept = \".json\"\n    importInput.multiple = false\n    importInput.addEventListener(\"change\", () => {\n      importBtn.disabled = !importInput.files?.length\n    })\n\n    subMenuWrapper.appendChild(importInput)\n    const importBtn = document.createElement(\"button\")\n    importBtn.classList.add(\"ms-menu-button\")\n    importBtn.innerText = \"Import\"\n    importBtn.disabled = true\n    subMenuWrapper.appendChild(importBtn)\n    importBtn.addEventListener(\"pointerup\", async (e) =>\n    {\n      e.preventDefault()\n      e.stopPropagation()\n      try {\n        if (importInput.files?.length) {\n          const fileString = await this.readFileAsText(importInput.files[0])\n          const symbols = JSON.parse(fileString) as PartialDeep<TOISymbol>[]\n\n          await this.behaviors.createSymbols(symbols)\n          importInput.value = \"\"\n          importBtn.disabled = true\n        }\n      } catch (error) {\n        this.behaviors.internalEvent.emitError(new Error(error as string))\n      }\n\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Import\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new OIMenuSub(params).element\n  }\n\n  protected unselectAll(): void\n  {\n    this.wrapper?.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n  }\n\n  protected closeAllSubMenu(): void\n  {\n    this.wrapper?.querySelectorAll(\".open\").forEach(e => e.classList.remove(\"open\"))\n  }\n\n  render(layer: HTMLElement): void\n  {\n    if (this.behaviors.configuration.menu.action.enable) {\n      const menuTrigger = document.createElement(\"button\")\n      menuTrigger.id = this.id\n      menuTrigger.classList.add(\"ms-menu-button\", \"square\")\n      menuTrigger.innerHTML = menuIcon\n\n      const subMenuWrapper = document.createElement(\"div\")\n      subMenuWrapper.classList.add(\"ms-menu-colmun\")\n      subMenuWrapper.appendChild(this.createMenuGesture())\n      subMenuWrapper.appendChild(this.createMenuGuide())\n      subMenuWrapper.appendChild(this.createMenuSnap())\n      subMenuWrapper.appendChild(this.createMenuDebug())\n      subMenuWrapper.appendChild(this.createMenuImport())\n      subMenuWrapper.appendChild(this.createMenuExport())\n\n      this.wrapper = document.createElement(\"div\")\n      this.wrapper.classList.add(\"ms-menu\", \"ms-menu-top-left\", \"ms-menu-row\")\n      this.wrapper.appendChild(new OIMenuSub({ trigger: menuTrigger, subMenu: subMenuWrapper, position: \"bottom\" }).element)\n      this.wrapper.appendChild(this.createMenuLanguage())\n      this.wrapper.appendChild(this.createMenuClear())\n      this.wrapper.appendChild(this.createMenuUndo())\n      this.wrapper.appendChild(this.createMenuRedo())\n      this.wrapper.appendChild(this.createMenuConvert())\n\n      layer.appendChild(this.wrapper)\n      this.update()\n      this.show()\n    }\n  }\n\n  update(): void\n  {\n    if (this.menuLanguage) {\n      this.isMobile ? this.menuLanguage.wrap() : this.menuLanguage.unwrap()\n    }\n    if (this.menuClear) {\n      this.menuClear.disabled = this.behaviors.history.context.empty\n    }\n    if (this.menuUndo) {\n      this.menuUndo.disabled = !this.behaviors.history.context.canUndo\n    }\n    if (this.menuRedo) {\n      this.menuRedo.disabled = !this.behaviors.history.context.canRedo\n    }\n    if (this.menuConvert) {\n      this.menuConvert.disabled = !this.behaviors.extractStrokesFromSymbols(this.model.symbols).length\n    }\n  }\n\n  show(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"visible\"\n    }\n  }\n\n  hide(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"hidden\"\n    }\n  }\n\n  destroy(): void\n  {\n    if (this.wrapper) {\n      while (this.wrapper.lastChild) {\n        this.wrapper.removeChild(this.wrapper.lastChild)\n      }\n      this.wrapper.remove()\n      this.wrapper = undefined\n      this.menuClear = undefined\n      this.menuUndo = undefined\n      this.menuRedo = undefined\n      this.menuConvert = undefined\n    }\n  }\n}\n","import pencilIcon from \"../assets/svg/edit-pencil.svg\"\nimport cursorIcon from \"../assets/svg/frame-select.svg\"\nimport eraseIcon from \"../assets/svg/erase.svg\"\nimport handIcon from \"../assets/svg/drag-hand-gesture.svg\"\nimport rectangleIcon from \"../assets/svg/rectangle.svg\"\nimport rhombusIcon from \"../assets/svg/rhombus.svg\"\nimport circleIcon from \"../assets/svg/circle.svg\"\nimport ellipseIcon from \"../assets/svg/ellipse.svg\"\nimport triangleIcon from \"../assets/svg/triangle.svg\"\nimport lineIcon from \"../assets/svg/linear.svg\"\nimport arrowIcon from \"../assets/svg/linear-arrow.svg\"\nimport doubleArrowIcon from \"../assets/svg/linear-double-arrow.svg\"\nimport { Intention, WriteTool } from \"../Constants\"\nimport { OIBehaviors } from \"../behaviors\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { OIMenu } from \"./OIMenu\"\nimport { OIMenuSub } from \"./OIMenuSub\"\nimport { TSubMenuParam } from \"./OIMenuSub\"\n\n/**\n * @group Menu\n */\nexport class OIMenuIntention extends OIMenu\n{\n  #logger = LoggerManager.getLogger(LoggerClass.MENU)\n\n  behaviors: OIBehaviors\n  id: string\n  wrapper?: HTMLDivElement\n  writeBtn?: HTMLButtonElement\n  menuSelect?: HTMLButtonElement\n  menuMove?: HTMLButtonElement\n  menuErase?: HTMLButtonElement\n  menuShape?: HTMLButtonElement\n  subMenuShape?: {\n    rectangle: HTMLButtonElement,\n    circle: HTMLButtonElement,\n    triangle: HTMLButtonElement,\n    ellipse: HTMLButtonElement\n    rhombus: HTMLButtonElement\n  }\n  menuEdge?: HTMLButtonElement\n  subMenuEdge?: {\n    line: HTMLButtonElement,\n    arrow: HTMLButtonElement,\n    doubleArrow: HTMLButtonElement,\n  }\n\n  constructor(behaviors: OIBehaviors, id = \"ms-menu-intention\")\n  {\n    super()\n    this.id = id\n    this.#logger.info(\"constructor\")\n    this.behaviors = behaviors\n  }\n\n  protected createMenuWrite(): HTMLElement\n  {\n    this.writeBtn = document.createElement(\"button\")\n    this.writeBtn.id = `${this.id}-write-pencil`\n    this.writeBtn.classList.add(\"ms-menu-button\", \"square\")\n    this.writeBtn.innerHTML = pencilIcon\n    this.writeBtn.addEventListener(\"pointerup\", () =>\n    {\n      this.unselectAll()\n      this.writeBtn!.classList.add(\"active\")\n      this.behaviors.intention = Intention.Write\n      this.behaviors.writer.tool = WriteTool.Pencil\n    })\n    return this.createToolTip(this.writeBtn, \"Write\")\n  }\n\n  protected createMenuMove(): HTMLElement\n  {\n    this.menuMove = document.createElement(\"button\")\n    this.menuMove.id = `${this.id}-move`\n    this.menuMove.classList.add(\"ms-menu-button\", \"square\")\n    this.menuMove.innerHTML = handIcon\n    this.menuMove.addEventListener(\"pointerup\", () =>\n    {\n      this.unselectAll()\n      this.menuMove!.classList.add(\"active\")\n      this.behaviors.intention = Intention.Move\n    })\n    return this.createToolTip(this.menuMove, \"Move\")\n  }\n\n  protected createMenuSelect(): HTMLElement\n  {\n    this.menuSelect = document.createElement(\"button\")\n    this.menuSelect.id = `${this.id}-select`\n    this.menuSelect.classList.add(\"ms-menu-button\", \"square\")\n    this.menuSelect.innerHTML = cursorIcon\n    this.menuSelect.addEventListener(\"pointerup\", () =>\n    {\n      this.unselectAll()\n      this.menuSelect!.classList.add(\"active\")\n      this.behaviors.intention = Intention.Select\n    })\n    return this.createToolTip(this.menuSelect, \"Select\")\n  }\n\n  protected createMenuErase(): HTMLElement\n  {\n    this.menuErase = document.createElement(\"button\")\n    this.menuErase.id = `${this.id}-erase`\n    this.menuErase.classList.add(\"ms-menu-button\", \"square\")\n    this.menuErase.innerHTML = eraseIcon\n    this.menuErase.addEventListener(\"pointerup\", () =>\n    {\n      this.unselectAll()\n      this.menuErase!.classList.add(\"active\")\n      this.behaviors.intention = Intention.Erase\n    })\n    return this.createToolTip(this.menuErase, \"Erase\")\n  }\n\n  protected createShapeSubMenu(icon: string, tool: WriteTool): HTMLButtonElement\n  {\n    const subMenuShape = document.createElement(\"button\")\n    subMenuShape.id = `${this.id}-write-shape-${tool}`\n    subMenuShape.classList.add(\"ms-menu-button\", \"square\")\n    subMenuShape.innerHTML = icon\n    subMenuShape.addEventListener(\"pointerup\", () =>\n    {\n      this.unselectAll()\n      this.behaviors.intention = Intention.Write\n      this.behaviors.writer.tool = tool\n      subMenuShape.classList.add(\"active\")\n      this.menuShape!.innerHTML = icon\n      this.menuShape!.classList.add(\"active\")\n      const subMenuContent = this.menuShape!.nextSibling\n      if (subMenuContent) {\n        (subMenuContent as HTMLElement).classList.remove(\"open\")\n      }\n    })\n    return this.createToolTip(subMenuShape, tool.toString()) as HTMLButtonElement\n  }\n\n  protected createMenuShape(): HTMLElement\n  {\n    this.menuShape = document.createElement(\"button\")\n    this.menuShape.id = `${this.id}-write-shape`\n    this.menuShape.classList.add(\"ms-menu-button\", \"square\")\n    this.menuShape.innerHTML = rectangleIcon\n    this.subMenuShape = {\n      circle: this.createShapeSubMenu(circleIcon, WriteTool.Circle),\n      rectangle: this.createShapeSubMenu(rectangleIcon, WriteTool.Rectangle),\n      triangle: this.createShapeSubMenu(triangleIcon, WriteTool.Triangle),\n      ellipse: this.createShapeSubMenu(ellipseIcon, WriteTool.Ellipse),\n      rhombus: this.createShapeSubMenu(rhombusIcon, WriteTool.Rhombus),\n    }\n    const subMenuContent = document.createElement(\"div\")\n    subMenuContent.id = `${this.id}-write-shape-list`\n    subMenuContent.classList.add(\"ms-menu-row\", \"sub-menu-content-shape\")\n    subMenuContent.appendChild(this.subMenuShape.rectangle)\n    subMenuContent.appendChild(this.subMenuShape.circle)\n    subMenuContent.appendChild(this.subMenuShape.ellipse)\n    subMenuContent.appendChild(this.subMenuShape.triangle)\n    subMenuContent.appendChild(this.subMenuShape.rhombus)\n\n    const params: TSubMenuParam = {\n      trigger: this.menuShape,\n      subMenu: subMenuContent,\n      position: \"top\"\n    }\n\n    return new OIMenuSub(params).element\n  }\n\n  protected createEdgeSubMenu(square: string, tool: WriteTool): HTMLButtonElement\n  {\n    const subMenuEdge = document.createElement(\"button\")\n    subMenuEdge.id = `${this.id}-write-edge-${tool}`\n    subMenuEdge.classList.add(\"ms-menu-button\", \"square\")\n    subMenuEdge.innerHTML = square\n    subMenuEdge.addEventListener(\"pointerup\", () =>\n    {\n      this.unselectAll()\n      this.behaviors.intention = Intention.Write\n      this.behaviors.writer.tool = tool\n      subMenuEdge.classList.add(\"active\")\n      this.menuEdge!.innerHTML = square\n      this.menuEdge!.classList.add(\"active\")\n      const subMenuContent = this.menuEdge!.nextSibling\n      if (subMenuContent) {\n        (subMenuContent as HTMLElement).classList.remove(\"open\")\n      }\n    })\n    return this.createToolTip(subMenuEdge, tool.toString()) as HTMLButtonElement\n  }\n\n  protected createMenuEdge(): HTMLElement\n  {\n    this.menuEdge = document.createElement(\"button\")\n    this.menuEdge.id = `${this.id}-write-edge`\n    this.menuEdge.classList.add(\"ms-menu-button\", \"square\")\n    this.menuEdge.innerHTML = lineIcon\n    this.subMenuEdge = {\n      line: this.createEdgeSubMenu(lineIcon, WriteTool.Line),\n      arrow: this.createEdgeSubMenu(arrowIcon, WriteTool.Arrow),\n      doubleArrow: this.createEdgeSubMenu(doubleArrowIcon, WriteTool.DoubleArrow),\n    }\n    const subMenuContent = document.createElement(\"div\")\n    subMenuContent.id = `${this.id}-write-edge-list`\n    subMenuContent.classList.add(\"ms-menu-row\", \"sub-menu-content-edge\")\n    subMenuContent.appendChild(this.subMenuEdge.line)\n    subMenuContent.appendChild(this.subMenuEdge.arrow)\n    subMenuContent.appendChild(this.subMenuEdge.doubleArrow)\n\n    const params: TSubMenuParam = {\n      trigger: this.menuEdge,\n      subMenu: subMenuContent,\n      position: \"top\"\n    }\n\n    return new OIMenuSub(params).element\n  }\n\n  protected unselectAll(): void\n  {\n    this.wrapper?.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n  }\n\n  update(): void\n  {\n    this.unselectAll()\n    switch (this.behaviors.intention) {\n      case Intention.Erase:\n        this.menuErase?.classList.add(\"active\")\n        break;\n      case Intention.Move:\n        this.menuMove?.classList.add(\"active\")\n        break;\n      case Intention.Select:\n        this.menuSelect?.classList.add(\"active\")\n        break;\n      case Intention.Write:\n        switch (this.behaviors.writer.tool) {\n          case WriteTool.Circle:\n            this.menuShape?.classList.add(\"active\")\n            this.subMenuShape?.circle?.classList.add(\"active\")\n            break;\n          case WriteTool.Ellipse:\n            this.menuShape?.classList.add(\"active\")\n            this.subMenuShape?.ellipse?.classList.add(\"active\")\n            break;\n          case WriteTool.Triangle:\n            this.menuShape?.classList.add(\"active\")\n            this.subMenuShape?.triangle?.classList.add(\"active\")\n            break;\n          case WriteTool.Rectangle:\n            this.menuShape?.classList.add(\"active\")\n            this.subMenuShape?.rectangle?.classList.add(\"active\")\n            break;\n          case WriteTool.Line:\n            this.menuEdge?.classList.add(\"active\")\n            this.subMenuEdge?.line?.classList.add(\"active\")\n            break;\n          case WriteTool.Arrow:\n            this.menuEdge?.classList.add(\"active\")\n            this.subMenuEdge?.arrow?.classList.add(\"active\")\n            break;\n          case WriteTool.DoubleArrow:\n            this.menuEdge?.classList.add(\"active\")\n            this.subMenuEdge?.doubleArrow?.classList.add(\"active\")\n            break;\n          default:\n            this.writeBtn?.classList.add(\"active\")\n            break;\n        }\n        break;\n    }\n  }\n\n  render(domElement: HTMLElement): void\n  {\n    if (this.behaviors.configuration.menu.intention.enable) {\n      this.wrapper = document.createElement(\"div\")\n      this.wrapper.classList.add(\"ms-menu\", \"ms-menu-bottom\", \"ms-menu-row\")\n\n      this.wrapper.appendChild(this.createMenuWrite())\n      this.wrapper.appendChild(this.createMenuMove())\n      this.wrapper.appendChild(this.createMenuSelect())\n      this.wrapper.appendChild(this.createMenuErase())\n      this.wrapper.appendChild(this.createMenuEdge())\n      this.wrapper.appendChild(this.createMenuShape())\n\n      domElement.appendChild(this.wrapper)\n      this.update()\n      this.show()\n    }\n  }\n\n  show(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"visible\"\n    }\n  }\n\n  hide(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"hidden\"\n    }\n  }\n\n  destroy(): void\n  {\n    if (this.wrapper) {\n      while (this.wrapper.lastChild) {\n        this.wrapper.removeChild(this.wrapper.lastChild)\n      }\n      this.wrapper.remove()\n      this.writeBtn = undefined\n      this.menuSelect = undefined\n      this.menuMove = undefined\n      this.menuErase = undefined\n      this.menuShape = undefined\n      this.subMenuShape = undefined\n      this.menuEdge = undefined\n      this.subMenuEdge = undefined\n      this.wrapper = undefined\n    }\n  }\n}\n","import styleIcon from \"../assets/svg/palette.svg\"\nimport { Intention, WriteTool } from \"../Constants\"\nimport { OIBehaviors } from \"../behaviors\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { OIModel } from \"../model\"\nimport { SymbolType, TOISymbol } from \"../primitive\"\nimport { OIMenu, TMenuItemColorList } from \"./OIMenu\"\nimport { OIMenuSub } from \"./OIMenuSub\"\nimport { TSubMenuParam } from \"./OIMenuSub\"\n\n/**\n * @group Menu\n */\nexport class OIMenuStyle extends OIMenu\n{\n  #logger = LoggerManager.getLogger(LoggerClass.MENU)\n\n  behaviors: OIBehaviors\n  id: string\n  wrapper?: HTMLDivElement\n  subMenu?: OIMenuSub\n  triggerBtn?: HTMLButtonElement\n  menuColorStroke?: HTMLDivElement\n  menuColorFill?: HTMLDivElement\n  menuThickness?: HTMLDivElement\n  menuFontSize?: HTMLDivElement\n  menuFontWeight?: HTMLDivElement\n  menuStrokeOpacity?: HTMLDivElement\n\n  constructor(behaviors: OIBehaviors, id = \"ms-menu-style\")\n  {\n    super()\n    this.id = id\n    this.#logger.info(\"constructor\")\n    this.behaviors = behaviors\n  }\n\n  get model(): OIModel\n  {\n    return this.behaviors.model\n  }\n\n  get symbolsSelected(): TOISymbol[]\n  {\n    return this.model.symbolsSelected\n  }\n\n  get writeShape(): boolean\n  {\n    return ![WriteTool.Arrow, WriteTool.DoubleArrow, WriteTool.Line, WriteTool.Pencil].includes(this.behaviors.writer.tool)\n  }\n\n  get rowHeight(): number\n  {\n    return this.behaviors.configuration.rendering.guides.gap\n  }\n\n  get isMobile(): boolean\n  {\n    return this.behaviors.renderer.parent.clientWidth < 700\n  }\n\n  protected createMenuStroke(): HTMLDivElement\n  {\n    const symbolsStyles = this.symbolsSelected.map(s => s.style)\n    const hasUniqColor = symbolsStyles.length && symbolsStyles.every(st => st.color === symbolsStyles[0]?.color)\n    const color = hasUniqColor && symbolsStyles[0]?.color ? symbolsStyles[0]?.color : (this.behaviors.currentPenStyle.color || \"rgb(0, 0, 0)\") as string\n    const menuColorStrokeDef: TMenuItemColorList = {\n      type: \"colors\",\n      label: \"Colors\",\n      id: `${ this.id }-color`,\n      fill: false,\n      values: this.colors,\n      initValue: color,\n      callback: (color) =>\n      {\n        this.behaviors.setPenStyle({ color })\n        this.behaviors.updateSymbolsStyle(this.symbolsSelected.map(s => s.id), { color })\n      },\n    }\n    const menuColor = this.createColorList(menuColorStrokeDef)\n    this.menuColorStroke = this.createWrapCollapsible(menuColor, \"Colors\")\n    this.menuColorStroke.id = `${ this.id }-color`\n    return this.menuColorStroke\n  }\n\n  protected createMenuColorFill(): HTMLDivElement\n  {\n    const symbolsStyles = this.symbolsSelected.map(s => s.style)\n    const hasUniqColor = symbolsStyles.length && symbolsStyles.every(st => st.color === symbolsStyles[0]?.color)\n    const color = hasUniqColor && symbolsStyles[0]?.color ? symbolsStyles[0]?.color : (this.behaviors.currentPenStyle.color || \"rgb(0, 0, 0)\") as string\n    const menuColorStrokeDef: TMenuItemColorList = {\n      type: \"colors\",\n      label: \"Fill\",\n      id: `${ this.id }-fill`,\n      fill: true,\n      values: this.colors,\n      initValue: color,\n      callback: (fill) =>\n      {\n        this.behaviors.setPenStyle({ fill })\n        this.behaviors.updateSymbolsStyle(this.symbolsSelected.map(s => s.id), { fill })\n      },\n    }\n    const menuColor = this.createColorList(menuColorStrokeDef)\n    this.menuColorFill = this.createWrapCollapsible(menuColor, \"Fill\")\n    this.menuColorFill.id = `${ this.id }-fill`\n    return this.menuColorFill\n  }\n\n  protected createMenuThickness(): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.id = `${ this.id }-thickness-list`\n    wrapper.classList.add(\"ms-menu-row\", \"thickness-list\")\n\n    const symbolsStyles = this.symbolsSelected.map(s => s.style)\n    const hasUniqWidth = symbolsStyles.length && symbolsStyles.every(st => st.width === symbolsStyles[0]?.width)\n    const width = hasUniqWidth ? symbolsStyles[0]?.width : (this.behaviors.currentPenStyle.width || 2)\n\n    this.thicknessList.forEach((size) =>\n    {\n      const btn = document.createElement(\"button\")\n      btn.id = `${ this.id }-thickness-${ size.label }-btn`\n      btn.classList.add(\"ms-menu-button\", \"square\")\n      btn.textContent = size.label\n      if (width === size.value) {\n        btn.classList.add(\"active\")\n      }\n      btn.addEventListener(\"pointerup\", (e) =>\n      {\n        e.preventDefault()\n        e.stopPropagation()\n        this.behaviors.setPenStyle({ width: size.value })\n        wrapper.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n        btn.classList.add(\"active\")\n        if (this.symbolsSelected.length) {\n          this.behaviors.updateSymbolsStyle(this.symbolsSelected.map(s => s.id), { width: size.value })\n          this.behaviors.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      })\n      wrapper.appendChild(btn)\n    })\n    this.menuThickness = this.createWrapCollapsible(wrapper, \"Thickness\")\n    this.menuThickness.id = `${ this.id }-thickness`\n    return this.menuThickness\n  }\n\n  protected createMenuFontSize(): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.id = `${ this.id }-font-size-list`\n    wrapper.classList.add(\"ms-menu-row\", \"font-size-list\")\n\n    this.fontSizeList.forEach((size) =>\n    {\n      const btn = document.createElement(\"button\")\n      btn.id = `${ this.id }-font-size-${ size.label }-btn`\n      btn.classList.add(\"ms-menu-button\", \"square\")\n      btn.textContent = size.label\n      if ((this.behaviors.converter.fontSize || 0) === size.value * this.rowHeight) {\n        btn.classList.add(\"active\")\n      }\n      btn.addEventListener(\"pointerup\", (e) =>\n      {\n        e.preventDefault()\n        e.stopPropagation()\n        wrapper.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n        btn.classList.add(\"active\")\n        if (size.value === 0) {\n          this.behaviors.converter.fontSize = undefined\n        }\n        else {\n          const fontSize = size.value * this.rowHeight\n          this.behaviors.converter.fontSize = fontSize\n          const textSymbols = this.symbolsSelected.filter(s => s.type === SymbolType.Text || (s.type === SymbolType.Group && s.extractSymbols().some(c => c.type === SymbolType.Text)))\n          this.behaviors.updateTextFontStyle(textSymbols.map(s => s.id), { fontSize })\n          this.behaviors.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      })\n      wrapper.appendChild(btn)\n    })\n    this.menuFontSize = this.createWrapCollapsible(wrapper, \"Font size\")\n    this.menuFontSize.id = `${ this.id }-font-size`\n    return this.menuFontSize\n  }\n\n  protected createMenuFontWeight(): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.id = `${ this.id }-font-weight-list`\n    wrapper.classList.add(\"ms-menu-row\", \"font-weight-list\")\n\n    this.fontWeightList.forEach((weight) =>\n    {\n      const btn = document.createElement(\"button\")\n      btn.id = `${ this.id }-font-weight-${ weight.label }-btn`\n      btn.classList.add(\"ms-menu-button\", \"center\")\n      btn.textContent = weight.label\n      if (this.behaviors.converter.fontWeight === weight.value) {\n        btn.classList.add(\"active\")\n      }\n      btn.addEventListener(\"pointerup\", (e) =>\n      {\n        e.preventDefault()\n        e.stopPropagation()\n        wrapper.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n        btn.classList.add(\"active\")\n        this.behaviors.converter.fontWeight = weight.value === \"\" ? undefined : weight.value as \"normal\" | \"bold\"\n        if (this.behaviors.converter.fontWeight) {\n          const textSymbols = this.symbolsSelected.filter(s => s.type === SymbolType.Text || (s.type === SymbolType.Group && s.extractSymbols().some(c => c.type === SymbolType.Text)))\n          this.behaviors.updateTextFontStyle(textSymbols.map(s => s.id), { fontWeight: this.behaviors.converter.fontWeight })\n          this.behaviors.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      })\n      wrapper.appendChild(btn)\n    })\n    this.menuFontWeight = this.createWrapCollapsible(wrapper, \"Font weight\")\n    this.menuFontWeight.id = `${ this.id }-font-weight`\n    return this.menuFontWeight\n  }\n\n  protected createMenuOpacity(): HTMLDivElement\n  {\n    const symbolsStyles = this.symbolsSelected.map(s => s.style)\n    const hasUniqOpacity = symbolsStyles.length && symbolsStyles.every(st => st.opacity === symbolsStyles[0]?.opacity)\n    const currentOpacity = (hasUniqOpacity && symbolsStyles[0]?.opacity ? symbolsStyles[0]?.opacity : (this.behaviors.currentPenStyle.opacity || 1)) * 100 as number\n\n    const wrapper = document.createElement(\"div\")\n    wrapper.id = `${ this.id }-opacity-input-wrapper`\n    const input = document.createElement(\"input\")\n    input.id = `${ this.id }-opacity-input`\n    input.setAttribute(\"name\", `opacity`)\n    input.setAttribute(\"type\", \"range\")\n    input.setAttribute(\"step\", \"1\")\n    input.setAttribute(\"min\", \"1\")\n    input.setAttribute(\"max\", \"100\")\n    wrapper.appendChild(input)\n\n    const output = document.createElement(\"output\")\n    output.setAttribute(\"for\", `opacity`)\n    output.classList.add(\"tooltip\")\n    output.innerHTML = currentOpacity ? `${ currentOpacity }` : \"-\"\n    wrapper.appendChild(output)\n\n    if (currentOpacity) {\n      input.setAttribute(\"value\", currentOpacity.toString())\n    }\n    input.addEventListener(\"input\", (evt) =>\n    {\n      const value = (evt.target as HTMLInputElement).value as unknown as number\n      output.innerHTML = `${ value }%`\n      this.behaviors.setPenStyle({ opacity: value / 100 })\n      if (this.symbolsSelected.length) {\n        this.behaviors.updateSymbolsStyle(this.symbolsSelected.map(s => s.id), { opacity: value / 100 })\n      }\n    })\n    this.menuStrokeOpacity = this.createWrapCollapsible(wrapper, \"Opacity\")\n    this.menuStrokeOpacity.id = `${ this.id }-opacity`\n    return this.menuStrokeOpacity\n  }\n\n  render(layer: HTMLElement): void\n  {\n    if (this.behaviors.configuration.menu.style.enable) {\n      this.triggerBtn = document.createElement(\"button\")\n      this.triggerBtn.id = this.id\n      this.triggerBtn.classList.add(\"ms-menu-button\", \"square\")\n      this.triggerBtn.innerHTML = styleIcon\n\n      const subMenuContent = document.createElement(\"div\")\n      subMenuContent.classList.add(\"ms-menu-colmun\")\n      subMenuContent.appendChild(this.createMenuStroke())\n      subMenuContent.appendChild(this.createMenuColorFill())\n      subMenuContent.appendChild(this.createMenuThickness())\n      subMenuContent.appendChild(this.createMenuFontSize())\n      subMenuContent.appendChild(this.createMenuFontWeight())\n      subMenuContent.appendChild(this.createMenuOpacity())\n\n      const params: TSubMenuParam = {\n        trigger: this.triggerBtn,\n        subMenu: subMenuContent,\n        position: \"bottom-left\",\n      }\n      this.subMenu = new OIMenuSub(params)\n\n      this.wrapper = document.createElement(\"div\")\n      this.wrapper.classList.add(\"ms-menu\", \"ms-menu-top-right\")\n      this.wrapper.appendChild(this.subMenu.element)\n      layer.appendChild(this.wrapper)\n      this.update()\n    }\n  }\n\n  update(): void\n  {\n    if (this.subMenu) {\n      this.isMobile ? this.subMenu.wrap() : this.subMenu.unwrap()\n    }\n\n    if (this.behaviors.intention === Intention.Write) {\n      this.show()\n      if (this.menuColorStroke) {\n        this.menuColorStroke.style.display = \"block\"\n      }\n      if (this.menuColorFill) {\n        this.menuColorFill.style.display = this.writeShape ? \"block\" : \"none\"\n      }\n      if (this.menuThickness) {\n        this.menuThickness.style.display = \"block\"\n      }\n      if (this.menuFontSize) {\n        this.menuFontSize.style.display = \"block\"\n      }\n      if (this.menuFontWeight) {\n        this.menuFontWeight.style.display = \"block\"\n      }\n      if (this.menuStrokeOpacity) {\n        this.menuStrokeOpacity.style.display = \"block\"\n      }\n    }\n    else if (this.behaviors.intention === Intention.Select) {\n      this.show()\n      if (this.menuColorStroke) {\n        this.menuColorStroke.style.display = \"block\"\n      }\n      if (this.menuColorFill) {\n        const shapeSelected = this.model.symbolsSelected.length && this.model.symbolsSelected.some(s => s.type === SymbolType.Shape)\n        this.menuColorFill.style.display = shapeSelected ? \"block\" : \"none\"\n      }\n      if (this.menuThickness) {\n        this.menuThickness.style.display = \"block\"\n      }\n      if (this.menuFontSize) {\n        this.menuFontSize.style.display = \"block\"\n      }\n      if (this.menuFontWeight) {\n        this.menuFontWeight.style.display = \"block\"\n      }\n      if (this.menuStrokeOpacity) {\n        this.menuStrokeOpacity.style.display = \"block\"\n      }\n    }\n    else {\n      this.hide()\n    }\n  }\n\n  show(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"visible\"\n    }\n  }\n\n  hide(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"hidden\"\n    }\n  }\n\n  destroy(): void\n  {\n    if (this.wrapper) {\n      while (this.wrapper.lastChild) {\n        this.wrapper.removeChild(this.wrapper.lastChild)\n      }\n      this.wrapper.remove()\n      this.wrapper = undefined\n      this.subMenu = undefined\n      this.triggerBtn = undefined\n      this.menuColorStroke = undefined\n      this.menuColorFill = undefined\n      this.menuThickness = undefined\n      this.menuFontSize = undefined\n      this.menuFontWeight = undefined\n      this.menuStrokeOpacity = undefined\n    }\n  }\n}\n","import ArrowDown from \"../assets/svg/nav-arrow-down.svg\"\nimport { SELECTION_MARGIN } from \"../Constants\"\nimport { OIBehaviors } from \"../behaviors\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { DecoratorKind, OIDecorator, OIStroke, OISymbolGroup, OIText, SymbolType, TOISymbol } from \"../primitive\"\nimport { OIMenu, TMenuItemBoolean, TMenuItemButton, TMenuItemColorList } from \"./OIMenu\"\nimport { createUUID } from \"../utils\"\nimport { OIMenuSub, TSubMenuParam } from \"./OIMenuSub\"\n/**\n * @group Menu\n */\nexport class OIMenuContext extends OIMenu\n{\n  #logger = LoggerManager.getLogger(LoggerClass.MENU)\n  behaviors: OIBehaviors\n  id: string\n  wrapper?: HTMLElement\n  editMenu?: HTMLDivElement\n  editInput?: HTMLInputElement\n  editSaveBtn?: HTMLButtonElement\n  reorderMenu?: HTMLDivElement\n  decoratorMenu?: HTMLDivElement\n  menuExport?: HTMLDivElement\n  duplicateBtn?: HTMLButtonElement\n  groupBtn?: HTMLButtonElement\n  convertBtn?: HTMLButtonElement\n  removeBtn?: HTMLButtonElement\n\n  position: {\n    x: number,\n    y: number,\n    scrollTop: number,\n    scrollLeft: number\n  }\n\n  constructor(behaviors: OIBehaviors, id = \"ms-menu-context\")\n  {\n    super()\n    this.id = id\n    this.#logger.info(\"constructor\")\n    this.behaviors = behaviors\n    this.position = { x: 0, y: 0, scrollLeft: 0, scrollTop: 0 }\n  }\n\n  get symbolsSelected(): TOISymbol[]\n  {\n    return this.behaviors.model.symbolsSelected\n  }\n  get haveSymbolsSelected(): boolean\n  {\n    return this.symbolsSelected.length > 0\n  }\n\n  get symbolsDecorable(): (OIStroke | OIText | OISymbolGroup)[]\n  {\n    return this.symbolsSelected.filter(s => [SymbolType.Stroke.toString(), SymbolType.Text.toString(), SymbolType.Group.toString()].includes(s.type)) as (OIStroke | OIText)[]\n  }\n  get showDecorator(): boolean\n  {\n    return this.symbolsDecorable.length > 0\n  }\n\n  protected createMenuEdit(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-edit-trigger`\n    trigger.classList.add(\"ms-menu-button\")\n    const label = document.createElement(\"span\")\n    label.innerText = \"Edit\"\n    trigger.appendChild(label)\n    const icon = document.createElement(\"span\")\n    icon.style.setProperty(\"width\", \"32px\")\n    icon.style.setProperty(\"transform\", \"rotate(270deg)\")\n    icon.innerHTML = ArrowDown\n    trigger.appendChild(icon)\n\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    this.editInput = document.createElement(\"input\")\n    subMenuWrapper.appendChild(this.editInput)\n    this.editSaveBtn = document.createElement(\"button\")\n    this.editSaveBtn.classList.add(\"ms-menu-button\")\n    this.editSaveBtn.innerText = \"Save\"\n    subMenuWrapper.appendChild(this.editSaveBtn)\n    this.editSaveBtn.addEventListener(\"pointerdown\", async (e) =>\n    {\n      e.stopPropagation()\n      const textSymbol = this.behaviors.model.symbolsSelected.find(s => s.type === SymbolType.Text) as OIText\n      if (textSymbol) {\n        const firstChar = textSymbol.chars[0]\n        textSymbol.chars = []\n        for (let i = 0; i < this.editInput!.value.length; i++) {\n          textSymbol.chars.push({\n            label: this.editInput!.value.charAt(i),\n            id: createUUID(),\n            color: firstChar.color,\n            fontSize: firstChar.fontSize,\n            fontWeight: firstChar.fontWeight,\n            bounds: firstChar.bounds\n          })\n        }\n        await this.behaviors.updateSymbol(textSymbol)\n        this.behaviors.selector.resetSelectedGroup([textSymbol])\n      }\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      subMenu: subMenuWrapper,\n      position: \"right\"\n    }\n    this.editMenu = new OIMenuSub(params).element\n\n    return this.editMenu\n  }\n\n  protected createMenuDuplicate(): HTMLElement\n  {\n    this.duplicateBtn = document.createElement(\"button\")\n    this.duplicateBtn.id = `${ this.id }-duplicate`\n    this.duplicateBtn.textContent = \"Duplicate\"\n    this.duplicateBtn.classList.add(\"ms-menu-button\")\n    this.duplicateBtn.addEventListener(\"pointerup\", async () =>\n    {\n      const symbolsToDuplicate = this.symbolsSelected\n      const duplicatedSymbols = symbolsToDuplicate.map(s =>\n      {\n        const clone = s.clone()\n        while (this.behaviors.model.symbols.find(s => s.id === clone.id)) {\n          clone.id = clone.id.slice(0, -36) + `-${ createUUID() }`\n          if (clone.type === SymbolType.Group) {\n            const groupClone = clone as OISymbolGroup\n            groupClone.extractSymbols().forEach(s => s.id = s.id.slice(0, -36) + `-${ createUUID() }`)\n          }\n        }\n        clone.selected = true\n        this.behaviors.translator.applyToSymbol(clone, SELECTION_MARGIN, SELECTION_MARGIN)\n        return clone\n      })\n\n      this.behaviors.unselectAll()\n      await this.behaviors.addSymbols(duplicatedSymbols)\n      this.behaviors.selector.drawSelectedGroup(duplicatedSymbols)\n    })\n    return this.duplicateBtn\n  }\n\n  protected createMenuGroup(): HTMLElement\n  {\n    this.groupBtn = document.createElement(\"button\")\n    this.groupBtn.id = `${ this.id }-duplicate`\n    this.groupBtn.textContent = \"Group\"\n    this.groupBtn.classList.add(\"ms-menu-button\")\n    this.groupBtn.addEventListener(\"pointerup\", async () =>\n    {\n      if (this.symbolsSelected.length === 1 && this.symbolsSelected[0].type === SymbolType.Group) {\n        const symbols = this.behaviors.ungroupSymbol(this.symbolsSelected[0] as OISymbolGroup)\n        this.behaviors.select(symbols.map(s => s.id))\n      }\n      else {\n        const symbols = this.symbolsSelected.slice()\n        this.behaviors.unselectAll()\n        const group = this.behaviors.groupSymbols(symbols)\n        group.selected = true\n        this.behaviors.select([group.id])\n      }\n    })\n    return this.groupBtn\n  }\n\n  protected createMenuConvert(): HTMLElement\n  {\n    this.convertBtn = document.createElement(\"button\")\n    this.convertBtn.id = `${ this.id }-convert`\n    this.convertBtn.textContent = \"Convert\"\n    this.convertBtn.classList.add(\"ms-menu-button\")\n    this.convertBtn.addEventListener(\"pointerup\", async () =>\n    {\n      try {\n        this.behaviors.internalEvent.emitIdle(false)\n        await this.behaviors.converter.apply(this.symbolsSelected)\n      }\n      catch (error) {\n        this.#logger.error(\"convert\", error)\n        this.behaviors.internalEvent.emitError(error as Error)\n        throw error\n      }\n      finally {\n        this.behaviors.updateLayerInfos()\n      }\n    })\n    return this.convertBtn\n  }\n\n  protected createMenuRemove(): HTMLButtonElement\n  {\n    this.removeBtn = document.createElement(\"button\")\n    this.removeBtn.id = `${ this.id }-remove`\n    this.removeBtn.textContent = \"Remove\"\n    this.removeBtn.classList.add(\"ms-menu-button\")\n    this.removeBtn.addEventListener(\"pointerup\", async () =>\n    {\n      this.behaviors.selector.removeSelectedGroup()\n      await this.behaviors.removeSymbols(this.symbolsSelected.map(s => s.id))\n      this.behaviors.menu.update()\n    })\n    return this.removeBtn\n  }\n\n  protected createMenuReorder(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-reorder`\n    trigger.classList.add(\"ms-menu-button\")\n    const label = document.createElement(\"span\")\n    label.innerText = \"Reorder\"\n    trigger.appendChild(label)\n    const icon = document.createElement(\"span\")\n    icon.style.setProperty(\"width\", \"32px\")\n    icon.style.setProperty(\"transform\", \"rotate(270deg)\")\n    icon.innerHTML = ArrowDown\n    trigger.appendChild(icon)\n\n    const menuItems: TMenuItemButton[] = [\n      {\n        type: \"button\",\n        id: `${ this.id }-reorder-first`,\n        label: \"Bring to front\",\n        callback: () =>\n        {\n          this.behaviors.changeOrderSymbols(this.symbolsSelected, \"last\")\n          this.behaviors.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-reorder-forward`,\n        label: \"Bring forward\",\n        callback: () =>\n        {\n          this.behaviors.changeOrderSymbols(this.symbolsSelected, \"forward\")\n          this.behaviors.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-reorder-backward`,\n        label: \"Send backward\",\n        callback: () =>\n        {\n          this.behaviors.changeOrderSymbols(this.symbolsSelected, \"backward\")\n          this.behaviors.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-reorder-last`,\n        label: \"Send to back\",\n        callback: () =>\n        {\n          this.behaviors.changeOrderSymbols(this.symbolsSelected.slice().reverse(), \"first\")\n          this.behaviors.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      },\n    ]\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      subMenu: subMenuWrapper,\n      position: \"right\"\n    }\n    this.reorderMenu = new OIMenuSub(params).element\n    return this.reorderMenu\n  }\n\n  protected createDecoratorSubMenu(label: string, kind: DecoratorKind): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-decorator-${ kind }`\n    trigger.classList.add(\"ms-menu-button\")\n    const labelEL = document.createElement(\"span\")\n    labelEL.innerText = label\n    trigger.appendChild(labelEL)\n    const icon = document.createElement(\"span\")\n    icon.style.setProperty(\"width\", \"32px\")\n    icon.style.setProperty(\"transform\", \"rotate(270deg)\")\n    icon.innerHTML = ArrowDown\n    trigger.appendChild(icon)\n\n    const menuItems: (TMenuItemBoolean | TMenuItemColorList)[] = [\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-decorator-${ kind }-enable`,\n        label: \"Enable\",\n        initValue: false,\n        callback: (enable) =>\n        {\n          this.symbolsDecorable.forEach(s =>\n          {\n            if (enable) {\n              if (!s.decorators.some(d => d.kind === kind)) {\n                s.decorators.push(new OIDecorator(kind, this.behaviors.currentPenStyle))\n              }\n            }\n            else {\n              const decoIndex = s.decorators.findIndex(d => d.kind === kind)\n              if (decoIndex > -1) {\n                s.decorators.splice(decoIndex, 1)\n              }\n            }\n            this.behaviors.model.updateSymbol(s)\n            this.behaviors.renderer.drawSymbol(s)\n          })\n\n          document.querySelectorAll(`#${ this.id }-decorator-${ kind }-color button`).forEach(b =>\n          {\n            (b as HTMLButtonElement).disabled = !enable\n            b.classList.remove(\"active\")\n          })\n          if (enable) {\n            document.querySelector(`#${ this.id }-decorator-${ kind }-color button`)?.classList.add(\"active\")\n          }\n        }\n      },\n      {\n        type: \"colors\",\n        label: \"Colors\",\n        id: `${ this.id }-decorator-${ kind }-color`,\n        fill: false,\n        values: this.colors.filter((_c, i) => !(i % 4)),\n        initValue: this.colors[0],\n        disabled: true,\n        callback: (color) =>\n        {\n          this.symbolsDecorable.forEach(s =>\n          {\n            const deco = s.decorators.find(d => d.kind === kind)\n            if (deco) {\n              deco.style.color = color\n              this.behaviors.model.updateSymbol(s)\n              this.behaviors.renderer.drawSymbol(s)\n            }\n          })\n        },\n      }\n    ]\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      subMenu: subMenuWrapper,\n      position: \"right\"\n    }\n    return this.decoratorMenu = new OIMenuSub(params).element\n  }\n\n  protected createMenuDecorator(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-decorator`\n    trigger.classList.add(\"ms-menu-button\")\n    const label = document.createElement(\"span\")\n    label.innerText = \"Decorator\"\n    trigger.appendChild(label)\n    const icon = document.createElement(\"span\")\n    icon.style.setProperty(\"width\", \"32px\")\n    icon.style.setProperty(\"transform\", \"rotate(270deg)\")\n    icon.innerHTML = ArrowDown\n    trigger.appendChild(icon)\n\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    subMenuWrapper.appendChild(this.createDecoratorSubMenu(\"Hightlight\", DecoratorKind.Highlight))\n    subMenuWrapper.appendChild(this.createDecoratorSubMenu(\"Surround\", DecoratorKind.Surround))\n    subMenuWrapper.appendChild(this.createDecoratorSubMenu(\"Underline\", DecoratorKind.Underline))\n    subMenuWrapper.appendChild(this.createDecoratorSubMenu(\"Strikethrough\", DecoratorKind.Strikethrough))\n\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      subMenu: subMenuWrapper,\n      position: \"right\"\n    }\n    this.decoratorMenu = new OIMenuSub(params).element\n    return this.decoratorMenu\n  }\n\n  protected createMenuExport(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-export`\n    trigger.classList.add(\"ms-menu-button\")\n    const label = document.createElement(\"span\")\n    label.innerText = \"Export\"\n    trigger.appendChild(label)\n    const icon = document.createElement(\"span\")\n    icon.style.setProperty(\"width\", \"32px\")\n    icon.style.setProperty(\"transform\", \"rotate(270deg)\")\n    icon.innerHTML = ArrowDown\n    trigger.appendChild(icon)\n\n    const menuItems: TMenuItemButton[] = [\n      {\n        type: \"button\",\n        id: `${ this.id }-export-json`,\n        label: \"json\",\n        callback: () => this.behaviors.downloadAsJson(this.haveSymbolsSelected)\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-export-svg`,\n        label: \"svg\",\n        callback: () => this.behaviors.downloadAsSVG(this.haveSymbolsSelected)\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-export-png`,\n        label: \"png\",\n        callback: () => this.behaviors.downloadAsPNG(this.haveSymbolsSelected)\n      },\n    ]\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      subMenu: subMenuWrapper,\n      position: \"right\"\n    }\n    this.menuExport = new OIMenuSub(params).element\n    return this.menuExport\n  }\n\n  protected createMenuSelectAll(): HTMLElement\n  {\n    const btn = document.createElement(\"button\")\n    btn.id = `${ this.id }-duplicate`\n    btn.textContent = \"Select all\"\n    btn.classList.add(\"ms-menu-button\")\n    btn.addEventListener(\"pointerup\", async () => this.behaviors.selectAll())\n    return btn\n  }\n\n  protected updateDecoratorSubMenu(): void\n  {\n    if (this.showDecorator) {\n      this.decoratorMenu?.style.removeProperty(\"display\")\n\n      Object.values(DecoratorKind).forEach(kind =>\n      {\n        const checkbox = document.getElementById(`${ this.id }-decorator-${ kind }-enable`) as HTMLInputElement\n        if (checkbox) {\n          document.querySelectorAll(`#${ this.id }-decorator-${ kind }-color button`).forEach(e => e.classList.remove(\"active\"))\n          const decos = this.symbolsDecorable.flatMap(s => s.decorators).filter(d => d.kind === kind)\n\n          if (decos.length && decos.every(d => d.style.color === decos[0].style.color)) {\n            const btnToActivate = document.getElementById(`${ this.id }-decorator-${ kind }-color-${ decos[0].style.color?.replace(\"#\", \"\") }-btn`)\n            btnToActivate?.classList.add(\"active\")\n          }\n\n          if (this.symbolsDecorable.filter(s => s.decorators.some(d => d.kind === kind)).length === this.symbolsDecorable.length) {\n            checkbox.checked = true\n\n            document.querySelectorAll(`#${ this.id }-decorator-${ kind }-color button`).forEach(b =>\n            {\n              (b as HTMLButtonElement).disabled = false\n            })\n            checkbox.indeterminate = false\n          }\n          else if (this.symbolsDecorable.filter(s => !s.decorators.some(d => d.kind === kind)).length === this.symbolsDecorable.length) {\n            checkbox.checked = false\n            document.querySelectorAll(`#${ this.id }-decorator-${ kind }-color button`).forEach(b =>\n            {\n              (b as HTMLButtonElement).disabled = true\n            })\n            checkbox.indeterminate = false\n          }\n          else {\n            checkbox.setAttribute(\"indeterminate\", \"true\")\n            checkbox.indeterminate = true\n            document.querySelectorAll(`#${ this.id }-decorator-${ kind }-color button`).forEach(b =>\n            {\n              (b as HTMLButtonElement).disabled = false\n            })\n          }\n        }\n\n      })\n    }\n    else {\n      this.decoratorMenu?.style.setProperty(\"display\", \"none\")\n    }\n  }\n\n  protected updateGroupMenu(): void\n  {\n    if (this.groupBtn && this.haveSymbolsSelected) {\n      this.groupBtn.style.removeProperty(\"display\")\n      if (this.symbolsSelected.length === 1 && this.symbolsSelected[0].type === SymbolType.Group) {\n        this.groupBtn.textContent = \"UnGroup\"\n      }\n      else {\n        this.groupBtn.textContent = \"Group\"\n      }\n    }\n    else {\n      this.groupBtn?.style.setProperty(\"display\", \"none\")\n    }\n  }\n\n  update(): void\n  {\n    this.wrapper?.style.setProperty(\"left\", `${ this.position.x - this.position.scrollLeft }px`)\n    this.wrapper?.style.setProperty(\"top\", `${ this.position.y - this.position.scrollTop }px`)\n\n    if (this.haveSymbolsSelected) {\n      const textSymbol = this.behaviors.model.symbolsSelected.find(s => s.type === SymbolType.Text)\n      if (this.editMenu && this.editInput && this.behaviors.model.symbolsSelected.length === 1 && textSymbol) {\n        this.editMenu.style.removeProperty(\"display\")\n        this.editInput.value = (textSymbol as OIText).label\n      }\n      else {\n        this.editMenu?.style.setProperty(\"display\", \"none\")\n      }\n\n      if(this.behaviors.extractStrokesFromSymbols(this.symbolsSelected).length) {\n        this.convertBtn?.style.removeProperty(\"display\")\n      }\n      else {\n        this.convertBtn?.style.setProperty(\"display\", \"none\")\n      }\n\n\n      this.reorderMenu?.style.removeProperty(\"display\")\n      this.duplicateBtn?.style.removeProperty(\"display\")\n      this.removeBtn?.style.removeProperty(\"display\")\n      this.menuExport?.style.removeProperty(\"display\")\n    }\n    else {\n      this.editMenu?.style.setProperty(\"display\", \"none\")\n      this.convertBtn?.style.setProperty(\"display\", \"none\")\n      this.reorderMenu?.style.setProperty(\"display\", \"none\")\n      this.duplicateBtn?.style.setProperty(\"display\", \"none\")\n      this.removeBtn?.style.setProperty(\"display\", \"none\")\n      this.menuExport?.style.setProperty(\"display\", \"none\")\n    }\n    this.updateDecoratorSubMenu()\n    this.updateGroupMenu()\n  }\n\n  render(domElement: HTMLElement): void\n  {\n    this.wrapper = document.createElement(\"div\")\n    this.wrapper.id = `${ this.id }-wrapper`\n    this.wrapper.classList.add(\"ms-menu\", \"ms-menu-context\")\n    this.wrapper.appendChild(this.createMenuEdit())\n    this.wrapper.appendChild(this.createMenuDecorator())\n    this.wrapper.appendChild(this.createMenuReorder())\n    this.wrapper.appendChild(this.createMenuExport())\n    this.wrapper.appendChild(this.createMenuConvert())\n    this.wrapper.appendChild(this.createMenuGroup())\n    this.wrapper.appendChild(this.createMenuDuplicate())\n    this.wrapper.appendChild(this.createMenuRemove())\n    this.wrapper.appendChild(this.createMenuSelectAll())\n    this.wrapper.style.setProperty(\"display\", \"none\")\n    domElement.appendChild(this.wrapper)\n    domElement.parentElement?.addEventListener(\"scroll\", () =>\n    {\n      this.position.scrollLeft = domElement.parentElement?.scrollLeft || 0\n      this.position.scrollTop = domElement.parentElement?.scrollTop || 0\n      this.update()\n    })\n  }\n\n  show(): void\n  {\n    this.update()\n    this.wrapper?.style.setProperty(\"display\", \"block\")\n  }\n\n  hide(): void\n  {\n    this.wrapper?.style.setProperty(\"display\", \"none\")\n  }\n\n  destroy(): void\n  {\n\n  }\n}\n","import { OIBehaviors } from \"../behaviors\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { OIMenuAction, OIMenuIntention, OIMenuStyle, OIMenuContext } from \"../menu\"\nimport { PartialDeep } from \"../utils\"\n\n/**\n * @group Manager\n */\nexport class OIMenuManager\n{\n  #logger = LoggerManager.getLogger(LoggerClass.MENU)\n  behaviors: OIBehaviors\n  layer?: HTMLElement\n  action: OIMenuAction\n  intention: OIMenuIntention\n  context: OIMenuContext\n  style: OIMenuStyle\n\n  constructor(behaviors: OIBehaviors, custom?: PartialDeep<{ style?: OIMenuStyle, intention?: OIMenuIntention, action?: OIMenuAction, context?: OIMenuContext }>)\n  {\n    this.#logger.info(\"constructor\")\n    this.behaviors = behaviors\n\n    if (custom?.style) {\n      const CustomMenuStyle = custom.style as unknown as typeof OIMenuStyle\n      this.style = new CustomMenuStyle(this.behaviors)\n    }\n    else {\n      this.style = new OIMenuStyle(this.behaviors)\n    }\n    if (custom?.intention) {\n      const CustomMenuIntention = custom.intention as unknown as typeof OIMenuIntention\n      this.intention = new CustomMenuIntention(this.behaviors)\n    }\n    else {\n      this.intention = new OIMenuIntention(this.behaviors)\n    }\n    if (custom?.action) {\n      const CustomMenuAction = custom.action as unknown as typeof OIMenuAction\n      this.action = new CustomMenuAction(this.behaviors)\n    }\n    else {\n      this.action = new OIMenuAction(this.behaviors)\n    }\n    if (custom?.context) {\n      const CustomMenuAction = custom.context as unknown as typeof OIMenuContext\n      this.context = new CustomMenuAction(this.behaviors)\n    }\n    else {\n      this.context = new OIMenuContext(this.behaviors)\n    }\n  }\n\n  render(layer: HTMLElement): void\n  {\n    if (this.behaviors.configuration.menu.enable) {\n      this.layer = layer\n      if (this.behaviors.configuration.menu.action.enable) {\n        this.action.render(this.layer)\n      }\n      if (this.behaviors.configuration.menu.style.enable) {\n        this.style.render(this.layer)\n      }\n      if (this.behaviors.configuration.menu.intention.enable) {\n        this.intention.render(this.layer)\n      }\n      if (this.behaviors.configuration.menu.context.enable) {\n        this.context.render(this.layer)\n      }\n    }\n  }\n\n  update(): void\n  {\n    this.action.update()\n    this.intention.update()\n    this.style.update()\n  }\n\n  show(): void\n  {\n    this.action.show()\n    this.intention.show()\n    this.style.show()\n  }\n\n  hide(): void\n  {\n    this.action.hide()\n    this.intention.hide()\n    this.style.hide()\n  }\n\n  destroy(): void\n  {\n    this.action.destroy()\n    this.intention.destroy()\n    this.style.destroy()\n  }\n}\n","import { OIBehaviors } from \"../behaviors\"\nimport { OISVGRenderer } from \"../renderer\"\n\n/**\n * @group Manager\n */\nexport class OIMoveManager\n{\n  behaviors: OIBehaviors\n  origin?: {\n    left: number,\n    top: number,\n    x: number,\n    y: number\n  }\n\n  constructor(behaviors: OIBehaviors)\n  {\n    this.behaviors = behaviors\n  }\n\n  get renderer(): OISVGRenderer\n  {\n    return this.behaviors.renderer\n  }\n\n  start(evt: PointerEvent): void\n  {\n    this.origin = {\n      left: this.renderer.parent.scrollLeft,\n      top: this.renderer.parent.scrollTop,\n      x: evt.clientX,\n      y: evt.clientY,\n    }\n  }\n\n  continue(evt: PointerEvent): void\n  {\n    if (!this.origin) {\n      throw new Error(\"Can't move cause origin is undefined\")\n    }\n    const dx = evt.clientX - this.origin.x\n    const dy = evt.clientY - this.origin.y\n\n    this.renderer.parent.scrollTop = this.origin.top - dy\n    this.renderer.parent.scrollLeft = this.origin.left - dx\n  }\n\n  async end(evt: PointerEvent): Promise<void>\n  {\n    this.continue(evt)\n    this.origin = undefined\n  }\n}\n","/**\n * @group History\n */\nexport type TUndoRedoContext = {\n  canUndo: boolean\n  canRedo: boolean\n  empty: boolean\n  stackIndex: number\n  possibleUndoCount: number\n}\n\n/**\n * @group History\n */\nexport const getInitialUndoRedoContext = (): TUndoRedoContext => {\n  return {\n    stackIndex: 0,\n    possibleUndoCount: 0,\n    canRedo: false,\n    canUndo: false,\n    empty: true,\n  }\n}\n","import { TUndoRedoConfiguration } from \"../configuration\"\nimport { InternalEvent } from \"../event\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { IModel } from \"../model\"\nimport { IHistoryManager } from \"./IHistoryManager\"\nimport { TUndoRedoContext, getInitialUndoRedoContext } from \"./UndoRedoContext\"\n\n/**\n * @group History\n */\nexport class HistoryManager implements IHistoryManager\n{\n  #logger = LoggerManager.getLogger(LoggerClass.HISTORY)\n\n  configuration: TUndoRedoConfiguration\n  context: TUndoRedoContext\n  stack: IModel[]\n\n  constructor(configuration: TUndoRedoConfiguration)\n  {\n    this.#logger.info(\"constructor\", { configuration })\n    this.configuration = configuration\n    this.context = getInitialUndoRedoContext()\n    this.stack = []\n  }\n\n  get internalEvent(): InternalEvent\n  {\n    return InternalEvent.getInstance()\n  }\n\n  private updateContext(): void\n  {\n    this.context.canRedo = this.stack.length - 1 > this.context.stackIndex\n    this.context.canUndo = this.context.stackIndex > 0\n    this.context.empty = this.stack[this.context.stackIndex].symbols.length === 0\n  }\n\n  push(model: IModel): void\n  {\n    this.#logger.info(\"push\", { model })\n    if (this.context.stackIndex + 1 < this.stack.length) {\n      this.stack.splice(this.context.stackIndex + 1)\n    }\n\n    this.stack.push(model.clone())\n    this.context.stackIndex = this.stack.length - 1\n\n    if (this.stack.length > this.configuration.maxStackSize) {\n      this.stack.shift()\n      this.context.stackIndex--\n    }\n\n    this.updateContext()\n    this.internalEvent.emitContextChange(this.context)\n  }\n\n  updateStack(model: IModel): void\n  {\n    this.#logger.info(\"updateStack\", { model })\n    const index = this.stack.findIndex(m => m.modificationDate === model.modificationDate)\n    if (index > -1) {\n      this.stack.splice(index, 1, model.clone())\n    }\n    this.updateContext()\n    this.internalEvent.emitContextChange(this.context)\n  }\n\n  undo(): IModel\n  {\n    this.#logger.info(\"undo\")\n    if (this.context.canUndo) {\n      this.context.stackIndex--\n      this.updateContext()\n      this.internalEvent.emitContextChange(this.context)\n    }\n    const previousModel = this.stack[this.context.stackIndex].clone()\n    this.#logger.debug(\"undo\", previousModel)\n    return previousModel\n  }\n\n  redo(): IModel\n  {\n    this.#logger.info(\"redo\")\n    if (this.context.canRedo) {\n      this.context.stackIndex++\n      this.updateContext()\n      this.internalEvent.emitContextChange(this.context)\n    }\n    const nextModel = this.stack[this.context.stackIndex].clone()\n    this.#logger.debug(\"redo\", nextModel)\n    return nextModel\n  }\n}\n","import { TUndoRedoConfiguration } from \"../configuration\"\nimport { InternalEvent } from \"../event\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { OIModel } from \"../model\"\nimport { OIDecorator, OIStroke, TOISymbol, TPoint } from \"../primitive\"\nimport { TStyle } from \"../style\"\nimport { MatrixTransform, TMatrixTransform } from \"../transform\"\nimport { IHistoryManager } from \"./IHistoryManager\"\nimport { TUndoRedoContext, getInitialUndoRedoContext } from \"./UndoRedoContext\"\n\n/**\n * @group History\n */\nexport type TOIHistoryChanges = {\n  added?: TOISymbol[]\n  updated?: TOISymbol[]\n  erased?: TOISymbol[]\n  replaced?: { oldSymbols: TOISymbol[], newSymbols: TOISymbol[] }\n  matrix?: { symbols: TOISymbol[], matrix: TMatrixTransform }\n  translate?: { symbols: TOISymbol[], tx: number, ty: number }[]\n  scale?: { symbols: TOISymbol[], scaleX: number, scaleY: number, origin: TPoint }[]\n  rotate?: { symbols: TOISymbol[], angle: number, center: TPoint }[]\n  style?: { symbols: TOISymbol[], style?: TStyle, fontSize?: number }\n  order?: { symbols: TOISymbol[], position: \"first\" | \"last\" | \"forward\" | \"backward\" }\n  decorator?: { symbol: TOISymbol, decorator: OIDecorator, added: boolean }[]\n  group?: { symbols: TOISymbol[] }\n  ungroup?: { group: TOISymbol }\n}\n\n/**\n * @group History\n * @remarks used to send messages to the backend on undo or redo\n */\nexport type TOIHistoryBackendChanges = {\n  added?: OIStroke[]\n  erased?: OIStroke[]\n  replaced?: { oldStrokes: OIStroke[], newStrokes: OIStroke[] }\n  matrix?: { strokes: OIStroke[], matrix: TMatrixTransform },\n  translate?: { strokes: OIStroke[], tx: number, ty: number }[]\n  scale?: { strokes: OIStroke[], scaleX: number, scaleY: number, origin: TPoint }[]\n  rotate?: { strokes: OIStroke[], angle: number, center: TPoint }[]\n}\n\n/**\n * @group History\n */\nexport type TOIHistoryStackItem = {\n  changes: TOIHistoryChanges\n  model: OIModel\n}\n\n/**\n * @group History\n */\nexport class OIHistoryManager implements IHistoryManager\n{\n  #logger = LoggerManager.getLogger(LoggerClass.HISTORY)\n\n  configuration: TUndoRedoConfiguration\n  context: TUndoRedoContext\n  stack: TOIHistoryStackItem[]\n\n  constructor(configuration: TUndoRedoConfiguration)\n  {\n    this.#logger.info(\"constructor\", { configuration })\n    this.configuration = configuration\n    this.context = getInitialUndoRedoContext()\n    this.stack = []\n  }\n\n  get internalEvent(): InternalEvent\n  {\n    return InternalEvent.getInstance()\n  }\n\n  private updateContext(): void\n  {\n    this.context.canRedo = this.stack.length - 1 > this.context.stackIndex\n    this.context.canUndo = this.context.stackIndex > 0\n    this.context.empty = this.stack[this.context.stackIndex].model.symbols.length === 0\n  }\n\n  isChangesEmpty(changes: TOIHistoryChanges): boolean\n  {\n    return !(\n      changes.added?.length ||\n      changes.updated?.length ||\n      changes.erased?.length ||\n      changes.replaced?.oldSymbols.length ||\n      changes.matrix?.symbols.length ||\n      changes.translate?.length ||\n      changes.rotate?.length ||\n      changes.scale?.length ||\n      changes.style?.symbols?.length ||\n      changes.order?.symbols?.length ||\n      changes.decorator?.length ||\n      changes.group?.symbols.length ||\n      changes.ungroup?.group\n    )\n  }\n\n  init(model: OIModel): void\n  {\n    this.stack.push({ model: model.clone(), changes: {} })\n    this.internalEvent.emitContextChange(this.context)\n  }\n\n  push(model: OIModel, changes: TOIHistoryChanges): void\n  {\n    this.#logger.info(\"push\", { model, changes })\n    if (this.isChangesEmpty(changes)) return\n\n    if (this.context.stackIndex + 1 < this.stack.length) {\n      this.stack.splice(this.context.stackIndex + 1)\n    }\n\n    this.stack.push({ model: model.clone(), changes })\n    this.context.stackIndex = this.stack.length - 1\n\n    if (this.stack.length > this.configuration.maxStackSize) {\n      this.stack.shift()\n      this.context.stackIndex--\n    }\n\n    this.updateContext()\n    this.internalEvent.emitContextChange(this.context)\n  }\n\n  pop(): void\n  {\n    this.#logger.info(\"pop\")\n    this.stack.pop()\n    this.context.stackIndex = this.stack.length - 1\n    this.updateContext()\n  }\n\n  protected reverseChanges(changes: TOIHistoryChanges): TOIHistoryChanges\n  {\n    const reversedChanges: TOIHistoryChanges = {}\n    if (changes.added) {\n      reversedChanges.erased = changes.added\n    }\n    if (changes.erased) {\n      reversedChanges.added = changes.erased\n    }\n    if (changes.replaced) {\n      reversedChanges.replaced = {\n        newSymbols: changes.replaced.oldSymbols,\n        oldSymbols: changes.replaced.newSymbols\n      }\n    }\n    if (changes.matrix) {\n      reversedChanges.matrix = {\n        symbols: changes.matrix.symbols,\n        matrix: new MatrixTransform(changes.matrix.matrix.xx, changes.matrix.matrix.yx, changes.matrix.matrix.xy, changes.matrix.matrix.yy, changes.matrix.matrix.tx, changes.matrix.matrix.ty).invert()\n      }\n    }\n    if (changes.translate?.length) {\n      reversedChanges.translate = changes.translate.map(tr =>\n      {\n        return {\n          symbols: tr.symbols,\n          tx: -tr.tx,\n          ty: -tr.ty,\n        }\n      })\n    }\n    if (changes.rotate?.length) {\n      reversedChanges.rotate = changes.rotate.map(tr =>\n      {\n        return {\n          symbols: tr.symbols,\n          angle: 2 * Math.PI - tr.angle,\n          center: tr.center\n        }\n      })\n    }\n    if (changes.scale?.length) {\n      reversedChanges.scale = changes.scale.map(tr =>\n      {\n        return {\n          symbols: tr.symbols,\n          origin: tr.origin,\n          scaleX: 1 / tr.scaleX,\n          scaleY: 1 / tr.scaleY\n        }\n      })\n    }\n\n    return reversedChanges\n  }\n\n  undo(): TOIHistoryStackItem\n  {\n    this.#logger.info(\"undo\")\n    const currentStackItem = this.stack[this.context.stackIndex]\n    if (this.context.canUndo) {\n      this.context.stackIndex--\n      this.updateContext()\n      this.internalEvent.emitContextChange(this.context)\n    }\n    const previousStackItem = this.stack[this.context.stackIndex]\n    this.#logger.debug(\"undo\", previousStackItem)\n    return {\n      model: previousStackItem.model,\n      changes: this.reverseChanges(currentStackItem.changes)\n    }\n  }\n\n  redo(): TOIHistoryStackItem\n  {\n    this.#logger.info(\"redo\")\n    if (this.context.canRedo) {\n      this.context.stackIndex++\n      this.updateContext()\n      this.internalEvent.emitContextChange(this.context)\n    }\n    const nextStackItem = this.stack[this.context.stackIndex]\n    this.#logger.debug(\"redo\", nextStackItem)\n    return nextStackItem\n  }\n\n  clear(): void\n  {\n    this.context = getInitialUndoRedoContext()\n    this.stack = []\n  }\n}\n","import { Intention, SELECTION_MARGIN } from \"../Constants\"\nimport { Configuration, TConfiguration, TRenderingConfiguration } from \"../configuration\"\nimport { InternalEvent } from \"../event\"\nimport { OIPointerEventGrabber } from \"../grabber\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { OIModel, TExport, TJIIXTextElement } from \"../model\"\nimport\n{\n  Box,\n  EdgeKind,\n  OIDecorator,\n  TOIEdge,\n  OIEdgeArc,\n  OIEdgeLine,\n  OIEdgePolyLine,\n  TOIShape,\n  OIShapeCircle,\n  OIShapeEllipse,\n  OIShapePolygon,\n  OIStroke,\n  OISymbolGroup,\n  OIText,\n  ShapeKind,\n  SymbolType,\n  TOISymbol,\n  TPoint,\n  TPointer,\n  convertPartialStrokesToOIStrokes\n} from \"../primitive\"\nimport { OIRecognizer } from \"../recognizer\"\nimport { OISVGRenderer, SVGBuilder } from \"../renderer\"\nimport { DefaultStyle, StyleManager, TStyle, TTheme } from \"../style\"\nimport\n{\n  OIConversionManager,\n  OISnapManager,\n  OIWriteManager,\n  OIGestureManager,\n  OISelectionManager,\n  OIResizeManager,\n  OIRotationManager,\n  OITranslateManager,\n  OITextManager,\n  OIEraseManager,\n  OIDebugSVGManager,\n  OIMoveManager,\n  OIMenuManager\n} from \"../manager\"\nimport { OIHistoryManager, TOIHistoryBackendChanges, TOIHistoryChanges } from \"../history\"\nimport { PartialDeep, mergeDeep } from \"../utils\"\nimport { IBehaviors } from \"./IBehaviors\"\nimport { TBehaviorOptions } from \"./TBehaviorOptions\"\n\n/**\n * @group Behavior\n */\nexport class OIBehaviors implements IBehaviors\n{\n  name = \"OIBehaviors\"\n  #logger = LoggerManager.getLogger(LoggerClass.BEHAVIORS)\n  #configuration: TConfiguration\n  #model: OIModel\n  #intention: Intention\n  #layerInfosTimer?: ReturnType<typeof setTimeout>\n  layerInfos: HTMLDivElement\n\n  grabber: OIPointerEventGrabber\n  renderer: OISVGRenderer\n  recognizer: OIRecognizer\n\n  styler: StyleManager\n  history: OIHistoryManager\n  writer: OIWriteManager\n  eraser: OIEraseManager\n  gesture: OIGestureManager\n  resizer: OIResizeManager\n  rotator: OIRotationManager\n  translator: OITranslateManager\n  converter: OIConversionManager\n  texter: OITextManager\n  selector: OISelectionManager\n  svgDebugger: OIDebugSVGManager\n  snaps: OISnapManager\n  move: OIMoveManager\n  menu: OIMenuManager\n\n  constructor(options: PartialDeep<TBehaviorOptions>, layerInfos: HTMLDivElement)\n  {\n    this.#logger.info(\"constructor\", { options })\n    this.#configuration = new Configuration(options?.configuration)\n    this.layerInfos = layerInfos\n    this.styler = new StyleManager(Object.assign({}, DefaultStyle, options?.penStyle), options?.theme)\n\n    this.grabber = new OIPointerEventGrabber(this.#configuration.grabber)\n    this.recognizer = new OIRecognizer(this.#configuration.server, this.#configuration.recognition)\n    this.renderer = new OISVGRenderer(this.#configuration.rendering)\n\n    this.history = new OIHistoryManager(this.#configuration[\"undo-redo\"])\n    this.writer = new OIWriteManager(this)\n    this.eraser = new OIEraseManager(this)\n    this.gesture = new OIGestureManager(this, options.behaviors?.gesture)\n    this.resizer = new OIResizeManager(this)\n    this.rotator = new OIRotationManager(this)\n    this.translator = new OITranslateManager(this)\n    this.converter = new OIConversionManager(this, options.fontStyle)\n    this.texter = new OITextManager(this)\n    this.selector = new OISelectionManager(this)\n    this.svgDebugger = new OIDebugSVGManager(this)\n    this.snaps = new OISnapManager(this, options.behaviors?.snap)\n    this.move = new OIMoveManager(this)\n    this.menu = new OIMenuManager(this, options.behaviors?.menu)\n\n    this.#intention = Intention.Write\n    this.#model = new OIModel(this.#configuration.rendering.minWidth, this.#configuration.rendering.minHeight, this.configuration.rendering.guides.gap)\n\n  }\n\n  //#region Properties\n  get internalEvent(): InternalEvent\n  {\n    return InternalEvent.getInstance()\n  }\n\n  get intention(): Intention\n  {\n    return this.#intention\n  }\n  set intention(i: Intention)\n  {\n    this.#intention = i\n    switch (this.#intention) {\n      case Intention.Erase:\n        this.renderer.parent?.classList.remove(\"draw\")\n        this.renderer.parent?.classList.add(\"erase\")\n        this.renderer.parent?.classList.remove(\"select\")\n        this.renderer.parent?.classList.remove(\"move\")\n        break\n      case Intention.Select:\n        this.renderer.parent?.classList.remove(\"draw\")\n        this.renderer.parent?.classList.remove(\"erase\")\n        this.renderer.parent?.classList.add(\"select\")\n        this.renderer.parent?.classList.remove(\"move\")\n        break\n      case Intention.Move:\n        this.renderer.parent?.classList.remove(\"draw\")\n        this.renderer.parent?.classList.remove(\"erase\")\n        this.renderer.parent?.classList.remove(\"select\")\n        this.renderer.parent?.classList.add(\"move\")\n        break\n      default:\n        this.renderer.parent?.classList.add(\"draw\")\n        this.renderer.parent?.classList.remove(\"erase\")\n        this.renderer.parent?.classList.remove(\"select\")\n        this.renderer.parent?.classList.remove(\"move\")\n        break\n    }\n    this.unselectAll()\n  }\n\n  get model(): OIModel\n  {\n    return this.#model\n  }\n\n  get configuration(): TConfiguration\n  {\n    return this.#configuration\n  }\n  set renderingConfiguration(renderingConfiguration: TRenderingConfiguration)\n  {\n    this.configuration.rendering = mergeDeep(this.configuration.rendering, renderingConfiguration)\n    const height = Math.max(this.renderer.parent.clientHeight, this.configuration.rendering.minHeight)\n    const width = Math.max(this.renderer.parent.clientWidth, this.configuration.rendering.minWidth)\n    this.renderer.resize(height, width)\n    this.model.rowHeight = this.configuration.rendering.guides.gap\n    this.history.stack.forEach(i => i.model.rowHeight = this.model.rowHeight)\n  }\n  //#endregion\n\n  //#region Style\n  get currentPenStyle(): TStyle\n  {\n    return this.styler.currentPenStyle\n  }\n\n  get penStyle(): TStyle\n  {\n    return this.styler.penStyle\n  }\n  async setPenStyle(penStyle?: TStyle | undefined): Promise<void>\n  {\n    this.#logger.info(\"setPenStyle\", { penStyle })\n    this.styler.setPenStyle(Object.assign({}, this.currentPenStyle, penStyle))\n    return Promise.resolve()\n  }\n\n  get penStyleClasses(): string\n  {\n    return this.styler.penStyleClasses\n  }\n  async setPenStyleClasses(penStyleClasses?: string | undefined): Promise<void>\n  {\n    this.#logger.info(\"setPenStyleClasses\", { penStyleClasses })\n    this.styler.setPenStyleClasses(penStyleClasses)\n    return Promise.resolve()\n  }\n\n  get theme(): TTheme\n  {\n    return this.styler.theme\n  }\n  async setTheme(theme?: TTheme): Promise<void>\n  {\n    this.#logger.info(\"setTheme\", { theme })\n    this.styler.setTheme(theme)\n    return Promise.resolve()\n  }\n  //#endregion\n\n\n  updateLayerInfos(): void\n  {\n    clearTimeout(this.#layerInfosTimer)\n    this.#layerInfosTimer = setTimeout(() =>\n    {\n      this.menu.update()\n      this.svgDebugger.apply()\n      this.recognizer.waitForIdle()\n    }, 1500)\n  }\n\n  protected onPointerDown(evt: PointerEvent, pointer: TPointer): void\n  {\n    this.#logger.debug(\"onPointerDown\", { evt, pointer })\n    this.internalEvent.emitIdle(false)\n    try {\n      this.unselectAll()\n      switch (this.#intention) {\n        case Intention.Erase:\n          this.eraser.start(pointer)\n          break\n        case Intention.Select:\n          this.selector.start(pointer)\n          break\n        case Intention.Move:\n          this.move.start(evt)\n          break\n        default:\n          this.writer.start(this.currentPenStyle, pointer, evt.pointerType)\n          break\n      }\n    }\n    catch (error) {\n      this.#logger.error(\"onPointerDown\", error)\n      this.grabber.stopPointerEvent()\n      this.internalEvent.emitError(error as Error)\n    }\n    finally {\n      this.svgDebugger.apply()\n    }\n  }\n\n  protected onPointerMove(evt: PointerEvent, pointer: TPointer): void\n  {\n    this.#logger.debug(\"onPointerMove\", { pointer })\n    try {\n      switch (this.#intention) {\n        case Intention.Erase:\n          this.eraser.continue(pointer)\n          break\n        case Intention.Select:\n          this.selector.continue(pointer)\n          break\n        case Intention.Move:\n          this.move.continue(evt)\n          break\n        default:\n          this.writer.continue(pointer)\n          break\n      }\n    }\n    catch (error) {\n      this.#logger.error(\"onPointerMove\", error)\n      this.internalEvent.emitError(error as Error)\n    }\n    finally {\n      this.svgDebugger.apply()\n    }\n  }\n\n  protected async onPointerUp(evt: PointerEvent, pointer: TPointer): Promise<void>\n  {\n    this.#logger.debug(\"onPointerUp\", { pointer })\n    try {\n      switch (this.#intention) {\n        case Intention.Erase:\n          this.eraser.end(pointer)\n          break\n        case Intention.Select:\n          this.selector.end(pointer)\n          break\n        case Intention.Move:\n          this.move.end(evt)\n          break\n        default:\n          this.writer.end(pointer)\n          break\n      }\n    }\n    catch (error) {\n      this.undo()\n      this.#logger.error(\"onPointerUp\", error)\n      this.internalEvent.emitError(error as Error)\n    }\n    finally {\n      this.updateLayerInfos()\n    }\n  }\n\n  protected async onContextMenu(el: HTMLElement, point: TPoint): Promise<void>\n  {\n    if (this.intention === Intention.Select) {\n      let found = false\n      let currentEl: HTMLElement | null = el\n      const symbolTypesAllowed = [SymbolType.Edge.toString(), SymbolType.Shape.toString(), SymbolType.Stroke.toString(), SymbolType.Text.toString()]\n      while (currentEl && currentEl.tagName !== \"svg\" && !found) {\n        if (symbolTypesAllowed.includes(currentEl.getAttribute(\"type\") as string)) {\n          found = true\n        }\n        else {\n          currentEl = currentEl.parentElement\n        }\n      }\n      this.unselectAll()\n      if (currentEl?.id) {\n        this.model.selectSymbol(currentEl.id)\n        this.renderer.drawSymbol(this.model.symbolsSelected[0])\n        this.selector.drawSelectedGroup(this.model.symbolsSelected)\n      }\n      else {\n        this.menu.context.position.x = point.x + this.renderer.parent.clientLeft\n        this.menu.context.position.y = point.y + this.renderer.parent.clientTop\n        this.menu.context.show()\n      }\n    }\n  }\n\n  async init(domElement: HTMLElement): Promise<void>\n  {\n    this.#logger.info(\"init\", { domElement })\n\n    this.renderer.init(domElement)\n    this.menu.render(this.layerInfos)\n\n    this.grabber.attach(this.renderer.layer as unknown as HTMLElement)\n    this.grabber.onPointerDown = this.onPointerDown.bind(this)\n    this.grabber.onPointerMove = this.onPointerMove.bind(this)\n    this.grabber.onPointerUp = this.onPointerUp.bind(this)\n    this.grabber.onContextMenu = this.onContextMenu.bind(this)\n\n    this.model.width = Math.max(domElement.clientWidth, this.#configuration.rendering.minWidth)\n    this.model.height = Math.max(domElement.clientHeight, this.#configuration.rendering.minHeight)\n    this.model.rowHeight = this.configuration.rendering.guides.gap\n    this.history.init(this.model)\n\n    await this.recognizer.init()\n    await this.setPenStyle(this.penStyle)\n    await this.setTheme(this.theme)\n    await this.setPenStyleClasses(this.penStyleClasses)\n  }\n\n  async changeLanguage(code: string): Promise<void>\n  {\n    try {\n      this.#logger.info(\"changeLanguage\", { code })\n      this.internalEvent.emitIdle(false)\n      this.configuration.recognition.lang = code\n      await this.recognizer.destroy()\n      this.recognizer = new OIRecognizer(this.#configuration.server, this.#configuration.recognition)\n      await this.recognizer.init()\n      await this.recognizer.addStrokes(this.model.symbols.filter(s => s.type === SymbolType.Stroke) as OIStroke[], false)\n    }\n    catch (error) {\n      this.#logger.error(\"changeLanguage\", error)\n      this.internalEvent.emitError(error as Error)\n      throw error\n    }\n    finally {\n      this.updateLayerInfos()\n    }\n  }\n\n  protected createShape(partialShape: PartialDeep<TOIShape>): TOIShape\n  {\n    switch (partialShape.kind) {\n      case ShapeKind.Circle:\n        return OIShapeCircle.create(partialShape as PartialDeep<OIShapeCircle>)\n      case ShapeKind.Ellipse:\n        return OIShapeEllipse.create(partialShape as PartialDeep<OIShapeEllipse>)\n      case ShapeKind.Polygon:\n        return OIShapePolygon.create(partialShape as PartialDeep<OIShapePolygon>)\n      default:\n        throw new Error(`Unable to create shape, kind: \"${ partialShape.kind }\" is unknown`)\n    }\n  }\n\n  protected createEdge(partialEdge: PartialDeep<TOIEdge>): TOIEdge\n  {\n    switch (partialEdge.kind) {\n      case EdgeKind.Arc:\n        return OIEdgeArc.create(partialEdge as PartialDeep<OIEdgeArc>)\n      case EdgeKind.Line:\n        return OIEdgeLine.create(partialEdge as PartialDeep<OIEdgeLine>)\n      case EdgeKind.PolyEdge:\n        return OIEdgePolyLine.create(partialEdge as PartialDeep<OIEdgePolyLine>)\n      default:\n        throw new Error(`Unable to create edge, kind: \"${ partialEdge.kind }\" is unknown`)\n    }\n  }\n\n  protected createGroup(partialGroup: PartialDeep<OISymbolGroup>): OISymbolGroup\n  {\n    if (!partialGroup.children?.length) {\n      throw new Error(`Unable to create group, no children`)\n    }\n\n    const children = partialGroup.children.map(partialSymbol =>\n    {\n      switch (partialSymbol?.type) {\n        case SymbolType.Stroke:\n          return OIStroke.create(partialSymbol as PartialDeep<OIStroke>)\n        case SymbolType.Shape:\n          return this.createShape(partialSymbol as PartialDeep<TOIShape>)\n        case SymbolType.Edge:\n          return this.createEdge(partialSymbol as PartialDeep<TOIEdge>)\n        case SymbolType.Text:\n          return OIText.create(partialSymbol as PartialDeep<OIText>)\n        case SymbolType.Group:\n          return this.createGroup(partialSymbol as PartialDeep<OISymbolGroup>)\n        default:\n          throw new Error(`Unable to create group, symbol type '${ JSON.stringify(partialSymbol) } is unknow`)\n      }\n    })\n    const group = new OISymbolGroup(children, partialGroup.style)\n    if (partialGroup.id) {\n      group.id = partialGroup.id\n    }\n    if (partialGroup.decorators) {\n      group.decorators = partialGroup.decorators.map(d => new OIDecorator(d!.kind!, d!.style!))\n    }\n    return group\n  }\n\n  protected createStroke(partialSymbol: PartialDeep<OIStroke>): OIStroke\n  {\n    return OIStroke.create(partialSymbol as PartialDeep<OIStroke>)\n  }\n\n  protected createText(partialSymbol: PartialDeep<OIText>): OIText\n  {\n    return OIText.create(partialSymbol as PartialDeep<OIText>)\n  }\n\n  async createSymbol(partialSymbol: PartialDeep<TOISymbol>): Promise<TOISymbol>\n  {\n    try {\n      switch (partialSymbol.type) {\n        case SymbolType.Stroke:\n          return await this.addSymbol(this.createStroke(partialSymbol))\n        case SymbolType.Shape:\n          return await this.addSymbol(this.createShape(partialSymbol))\n        case SymbolType.Edge:\n          return await this.addSymbol(this.createEdge(partialSymbol))\n        case SymbolType.Text:\n          return await this.addSymbol(this.createText(partialSymbol))\n        case SymbolType.Group:\n          return await this.addSymbol(this.createGroup(partialSymbol))\n        default:\n          throw new Error(`Unable to create symbol, type: \"${ partialSymbol.type }\" is unknown`)\n      }\n    }\n    catch (error) {\n      this.#logger.error(\"createSymbol\", error)\n      this.updateLayerInfos()\n      this.internalEvent.emitError(error as Error)\n      throw error\n    }\n  }\n\n  async createSymbols(partialSymbols: PartialDeep<TOISymbol>[]): Promise<TOISymbol[]>\n  {\n    try {\n      const errors: string[] = []\n      const symbols: TOISymbol[] = []\n      partialSymbols.forEach(partialSymbol =>\n      {\n        try {\n          switch (partialSymbol.type) {\n            case SymbolType.Stroke:\n              symbols.push(this.createStroke(partialSymbol))\n              break\n            case SymbolType.Shape:\n              symbols.push(this.createShape(partialSymbol))\n              break\n            case SymbolType.Edge:\n              symbols.push(this.createEdge(partialSymbol))\n              break\n            case SymbolType.Text:\n              symbols.push(this.createText(partialSymbol))\n              break\n            case SymbolType.Group:\n              symbols.push(this.createGroup(partialSymbol))\n              break\n            default:\n              errors.push(`Unable to create symbol, type: \"${ partialSymbol.type }\" is unknown`)\n          }\n        } catch (error) {\n          errors.push(((error as Error).message || error) as string)\n        }\n      })\n      if (errors.length) {\n        throw new Error(errors.join(\"\\n\"))\n      }\n      return await this.addSymbols(symbols)\n    } catch (error) {\n      this.#logger.error(\"importPointEvents\", error)\n      this.internalEvent.emitError(error as Error)\n      throw error\n    }\n  }\n\n  async addSymbol(sym: TOISymbol, addToHistory = true): Promise<TOISymbol>\n  {\n    this.#logger.info(\"addSymbol\", { sym })\n    this.internalEvent.emitIdle(false)\n    if (sym.type === SymbolType.Text) {\n      this.texter.updateBounds(sym)\n    }\n    else if (sym.type === SymbolType.Group) {\n      sym.extractSymbols().forEach(t =>\n      {\n        if (t.type === SymbolType.Text) {\n          this.texter.updateBounds(t)\n        }\n      })\n    }\n    this.model.addSymbol(sym)\n    this.renderer.drawSymbol(sym)\n\n    const strokes = this.extractStrokesFromSymbols([sym])\n    this.recognizer.addStrokes(strokes, false)\n\n    if (addToHistory) {\n      this.history.push(this.model, { added: [sym] })\n    }\n    this.updateLayerInfos()\n    return sym\n  }\n\n  async addSymbols(symList: TOISymbol[], addToHistory = true): Promise<TOISymbol[]>\n  {\n    this.#logger.info(\"addSymbol\", { symList })\n    this.internalEvent.emitIdle(false)\n    symList.forEach(s =>\n    {\n      if (s.type === SymbolType.Text) {\n        this.texter.updateBounds(s)\n      }\n      else if (s.type === SymbolType.Group) {\n        s.extractSymbols().forEach(t =>\n        {\n          if (t.type === SymbolType.Text) {\n            this.texter.updateBounds(t)\n          }\n        })\n      }\n      this.model.addSymbol(s)\n      this.renderer.drawSymbol(s)\n    })\n    const strokes = this.extractStrokesFromSymbols(symList)\n    this.recognizer.addStrokes(strokes, false)\n    if (addToHistory) {\n      this.history.push(this.model, { added: symList })\n    }\n    this.updateLayerInfos()\n    return symList\n  }\n\n  async updateSymbol(sym: TOISymbol, addToHistory = true): Promise<TOISymbol>\n  {\n    this.#logger.info(\"updateSymbol\", { sym })\n    this.internalEvent.emitIdle(false)\n    if (sym.type === SymbolType.Text) {\n      this.texter.updateBounds(sym)\n    }\n    else if (sym.type === SymbolType.Group) {\n      sym.extractSymbols().forEach(t =>\n      {\n        if (t.type === SymbolType.Text) {\n          this.texter.updateBounds(t)\n        }\n      })\n    }\n    this.model.updateSymbol(sym)\n    this.renderer.drawSymbol(sym)\n    const strokes = this.extractStrokesFromSymbols([sym])\n    this.recognizer.replaceStrokes(strokes.map(s => s.id), strokes)\n    if (addToHistory) {\n      this.history.push(this.model, { updated: [sym] })\n    }\n    this.updateLayerInfos()\n    return sym\n  }\n\n  async updateSymbols(symList: TOISymbol[], addToHistory = true): Promise<TOISymbol[]>\n  {\n    this.#logger.info(\"updateSymbol\", { symList })\n    this.internalEvent.emitIdle(false)\n    symList.forEach(s =>\n    {\n      if (s.type === SymbolType.Text) {\n        this.texter.updateBounds(s)\n      }\n      else if (s.type === SymbolType.Group) {\n        s.extractSymbols().forEach(t =>\n        {\n          if (t.type === SymbolType.Text) {\n            this.texter.updateBounds(t)\n          }\n        })\n      }\n      this.model.updateSymbol(s)\n      this.renderer.drawSymbol(s)\n    })\n    const strokes = this.extractStrokesFromSymbols(symList)\n    this.recognizer.replaceStrokes(strokes.map(s => s.id), strokes)\n    if (addToHistory) {\n      this.history.push(this.model, { updated: symList })\n    }\n    this.updateLayerInfos()\n    return symList\n  }\n\n  updateSymbolsStyle(symbolIds: string[], style: TStyle, addToHistory = true): void\n  {\n    this.#logger.info(\"updateSymbolsStyle\", { symbolIds, style })\n    const symbols: TOISymbol[] = []\n    this.model.symbols.forEach(s =>\n    {\n      if (symbolIds.includes(s.id)) {\n        s.style = Object.assign({}, s.style, style)\n        if (s.type === SymbolType.Text) {\n          s.chars.forEach(c =>\n          {\n            if (style.color) {\n              c.color = style.color\n            }\n          })\n        }\n        else if (s.type === SymbolType.Group) {\n          s.updateChildrenStyle()\n        }\n        this.renderer.drawSymbol(s)\n        this.model.updateSymbol(s)\n        s.modificationDate = Date.now()\n        symbols.push(s)\n      }\n    })\n    if (symbols.length) {\n      symbols.forEach(s =>\n      {\n        if (s.type === SymbolType.Text) {\n          const lastWidth = s.bounds.width\n          this.texter.updateBounds(s)\n          const tx = s.bounds.width - lastWidth\n          if (tx !== 0) {\n            this.texter.moveTextAfter(s, tx)\n          }\n        }\n      })\n    }\n    if (addToHistory && symbols.length) {\n      this.history.push(this.model, { style: { symbols, style } })\n    }\n  }\n\n  updateTextFontStyle(textIds: string[], { fontSize, fontWeight }: { fontSize?: number, fontWeight?: \"normal\" | \"bold\" }): void\n  {\n    this.#logger.info(\"updateTextFontStyle\", { textIds, fontSize, fontWeight })\n    const symbols: (OIText | OISymbolGroup)[] = []\n    const translate: { symbols: TOISymbol[], tx: number, ty: number }[] = []\n    this.model.symbols.forEach(s =>\n    {\n      if (textIds.includes(s.id)) {\n        if (s.type === SymbolType.Text) {\n          s.chars.forEach(tc =>\n          {\n            if (fontSize) {\n              tc.fontSize = fontSize\n            }\n            if (fontWeight) {\n              tc.fontWeight = fontWeight\n            }\n          })\n          const lastWidth = s.bounds.width\n          this.texter.updateBounds(s)\n          this.renderer.drawSymbol(s)\n          const tx = s.bounds.width - lastWidth\n          if (tx !== 0) {\n            const symbolsTranslated = this.texter.moveTextAfter(s, tx)\n            if (symbolsTranslated?.length) {\n              translate.push({\n                symbols: symbolsTranslated,\n                tx,\n                ty: 0\n              })\n            }\n          }\n          s.modificationDate = Date.now()\n          symbols.push(s)\n        }\n        else if ((s.type === SymbolType.Group && s.extractSymbols().some(c => c.type === SymbolType.Text))) {\n          s.extractSymbols().forEach(c =>\n          {\n            if (c.type === SymbolType.Text) {\n              c.chars.forEach(tc =>\n              {\n                if (fontSize) {\n                  tc.fontSize = fontSize\n                }\n                if (fontWeight) {\n                  tc.fontWeight = fontWeight\n                }\n              })\n              const lastWidth = s.bounds.width\n              this.texter.updateBounds(c)\n              const tx = s.bounds.width - lastWidth\n              const symbolsTranslated = this.texter.moveTextAfter(c, tx)\n              if (symbolsTranslated?.length) {\n                translate.push({\n                  symbols: symbolsTranslated,\n                  tx,\n                  ty: 0\n                })\n              }\n              c.modificationDate = Date.now()\n            }\n          })\n          s.modificationDate = Date.now()\n          this.renderer.drawSymbol(s)\n          symbols.push(s)\n\n        }\n      }\n    })\n    if (symbols.length) {\n      this.history.push(this.model, { style: { symbols, fontSize }, translate })\n    }\n  }\n\n  async replaceSymbols(oldSymbols: TOISymbol[], newSymbols: TOISymbol[], addToHistory = true): Promise<void>\n  {\n    this.#logger.info(\"replaceSymbol\", { oldSymbols, newSymbols })\n    this.internalEvent.emitIdle(false)\n\n    const oldStrokes = this.extractStrokesFromSymbols(oldSymbols)\n    const newStrokes = this.extractStrokesFromSymbols(newSymbols)\n\n    const firstSym = oldSymbols[0]\n\n    if (firstSym) {\n      this.model.replaceSymbol(firstSym.id, newSymbols)\n      this.renderer.replaceSymbol(firstSym.id, newSymbols)\n\n      oldSymbols.slice(1).forEach(s =>\n      {\n        this.renderer.removeSymbol(s.id)\n        this.model.removeSymbol(s.id)\n      })\n\n      if (oldStrokes.length && newStrokes.length) {\n        this.recognizer.replaceStrokes(oldStrokes.map(s => s.id), newStrokes)\n      }\n      else if (oldStrokes.length) {\n        this.recognizer.eraseStrokes(oldStrokes.map(s => s.id))\n      }\n      else {\n        this.recognizer.addStrokes(newStrokes, false)\n      }\n\n      if (addToHistory) {\n        this.history.push(this.model, { replaced: { oldSymbols, newSymbols } })\n      }\n      this.updateLayerInfos()\n    }\n  }\n\n  changeOrderSymbol(symbol: TOISymbol, position: \"first\" | \"last\" | \"forward\" | \"backward\"): void\n  {\n    this.model.changeOrderSymbol(symbol.id, position)\n    this.renderer.changeOrderSymbol(symbol, position)\n    this.history.push(this.model, { order: { symbols: [symbol], position } })\n  }\n\n  changeOrderSymbols(symbols: TOISymbol[], position: \"first\" | \"last\" | \"forward\" | \"backward\")\n  {\n    symbols.forEach(s =>\n    {\n      this.model.changeOrderSymbol(s.id, position)\n      this.renderer.changeOrderSymbol(s, position)\n    })\n    this.history.push(this.model, { order: { symbols, position } })\n  }\n\n  groupSymbols(symbols: TOISymbol[]): OISymbolGroup\n  {\n    const group = this.createGroup({ children: symbols })\n    symbols.forEach(s =>\n    {\n      this.model.removeSymbol(s.id)\n      this.renderer.removeSymbol(s.id)\n    })\n    this.model.addSymbol(group)\n    this.history.push(this.model, { group: { symbols } })\n    return group\n  }\n\n  ungroupSymbol(group: OISymbolGroup): TOISymbol[]\n  {\n    group.children.forEach(s => this.renderer.drawSymbol(s))\n    this.renderer.removeSymbol(group.id)\n    this.model.replaceSymbol(group.id, group.children)\n    this.history.push(this.model, { ungroup: { group } })\n    return group.children\n  }\n\n  async groupStrokesByJIIXElement(): Promise<void>\n  {\n    await this.export([\"application/vnd.myscript.jiix\"])\n    const strokes = this.model.symbols.filter(s => s.type === SymbolType.Stroke)\n    const jiix = this.model.exports?.[\"application/vnd.myscript.jiix\"]\n    jiix?.elements?.forEach(el =>\n    {\n      if (el.type === \"Text\") {\n        const jiixText = el as TJIIXTextElement\n        jiixText.words?.forEach(w =>\n        {\n          const wordStrokes = strokes.filter(s => w.items?.map(s => s[\"full-id\"]).includes(s.id))\n          if (wordStrokes.length) {\n            const orginDeco: OIDecorator[] = []\n            let orginStyle: TStyle = wordStrokes[0].style\n            if (w.items?.length !== wordStrokes.length) {\n              w.items?.forEach(i =>\n              {\n                const sym = this.model.getRootSymbol(i[\"full-id\"] as string)\n                if (sym?.type === SymbolType.Group) {\n                  orginDeco.push(...sym.decorators)\n                  orginStyle = Object.assign({}, orginStyle, sym.style)\n                  wordStrokes.push(...sym.extractStrokes())\n                  this.model.removeSymbol(sym.id)\n                  this.renderer.removeSymbol(sym.id)\n                }\n              })\n            }\n            const wordSymb = this.createGroup({ children: wordStrokes, style: orginStyle })\n            orginDeco.forEach(d =>\n            {\n              if (!wordSymb.decorators.some(wd => wd.kind === d.kind)) {\n                wordSymb.decorators.push(d)\n              }\n            })\n            wordStrokes.map(s =>\n            {\n              this.model.removeSymbol(s.id)\n              this.renderer.removeSymbol(s.id)\n            })\n            this.model.addSymbol(wordSymb)\n            this.renderer.drawSymbol(wordSymb)\n          }\n        })\n      }\n      else {\n        const strokesAssociated = strokes.filter(s => el.items?.map(s => s[\"full-id\"]).includes(s.id))\n        if (strokesAssociated.length) {\n          const group = this.createGroup({ children: strokesAssociated })\n          strokesAssociated.map(s =>\n          {\n            this.model.removeSymbol(s.id)\n            this.renderer.removeSymbol(s.id)\n          })\n          this.model.addSymbol(group)\n          this.renderer.drawSymbol(group)\n        }\n      }\n    })\n  }\n\n  async removeSymbol(id: string, addToHistory = true): Promise<void>\n  {\n    this.#logger.info(\"removeSymbol\", { id })\n    const symbol = this.model.getRootSymbol(id)\n    if (symbol) {\n      this.internalEvent.emitIdle(false)\n      if (symbol.type === SymbolType.Group) {\n        const groupStrokeIds = symbol.extractStrokes().map(s => s.id)\n        symbol.removeChilds([id])\n        if (symbol.children.length) {\n          this.model.updateSymbol(symbol)\n          this.renderer.drawSymbol(symbol)\n          if (groupStrokeIds.includes(id)) {\n            this.recognizer.eraseStrokes([id])\n          }\n        }\n        else {\n          this.recognizer.eraseStrokes(groupStrokeIds)\n          this.model.removeSymbol(symbol.id)\n          this.renderer.removeSymbol(symbol.id)\n        }\n      }\n      else {\n        this.recognizer.eraseStrokes([id])\n        this.model.removeSymbol(symbol.id)\n        this.renderer.removeSymbol(symbol.id)\n      }\n      if (addToHistory) {\n        this.history.push(this.model, { erased: [symbol] })\n      }\n      this.updateLayerInfos()\n    }\n    else {\n      this.renderer.removeSymbol(id)\n      this.recognizer.eraseStrokes([id])\n    }\n  }\n\n  async removeSymbols(ids: string[], addToHistory = true): Promise<TOISymbol[]>\n  {\n    this.#logger.info(\"removeSymbol\", { ids })\n    const symbolsToRemove: TOISymbol[] = []\n    const symbolsToUpdate: TOISymbol[] = []\n    const strokesIds: string[] = []\n    ids.forEach(id =>\n    {\n      const sym = this.model.getRootSymbol(id)\n      if (sym) {\n        if (sym.id === id) {\n          symbolsToRemove.push(sym)\n          switch (sym.type) {\n            case SymbolType.Stroke:\n              strokesIds.push(sym.id)\n              break\n            case SymbolType.Group:\n              strokesIds.push(...sym.extractStrokes().map(s => s.id))\n              break\n          }\n        }\n        else {\n          /** we want to remove element in group */\n          const gr = sym.clone() as OISymbolGroup\n          strokesIds.push(...gr.extractStrokes().map(s => s.id).filter(id => ids.includes(id)))\n          gr.removeChilds(ids)\n          if (gr.children.length) {\n            symbolsToUpdate.push(gr)\n          }\n          else {\n            symbolsToRemove.push(gr)\n          }\n        }\n      }\n    })\n    this.recognizer.eraseStrokes(strokesIds)\n    symbolsToRemove.forEach(s =>\n    {\n      this.model.removeSymbol(s.id)\n      this.renderer.removeSymbol(s.id)\n    })\n\n    symbolsToUpdate.forEach(s =>\n    {\n      this.model.updateSymbol(s)\n      this.renderer.drawSymbol(s)\n    })\n\n\n    if (addToHistory) {\n      const changes: TOIHistoryChanges = {}\n      if (symbolsToRemove.length || symbolsToUpdate.length) {\n        if (symbolsToRemove.length) {\n          changes.erased = symbolsToRemove\n        }\n        if (symbolsToUpdate.length) {\n          changes.updated = symbolsToUpdate\n        }\n        this.history.push(this.model, changes)\n        this.updateLayerInfos()\n      }\n    }\n    this.internalEvent.emitIdle(false)\n    return symbolsToRemove\n  }\n\n  select(ids: string[]): void\n  {\n    this.selector.removeSelectedGroup()\n    this.model.symbols.forEach(s =>\n    {\n      s.selected = ids.includes(s.id)\n      this.renderer.drawSymbol(s)\n    })\n    this.selector.drawSelectedGroup(this.model.symbolsSelected)\n    this.internalEvent.emitSelected(this.model.symbolsSelected)\n  }\n\n  selectAll(): void\n  {\n    this.selector.removeSelectedGroup()\n    this.model.symbols.forEach(s =>\n    {\n      s.selected = true\n      this.renderer.drawSymbol(s)\n    })\n    this.selector.drawSelectedGroup(this.model.symbolsSelected)\n    this.internalEvent.emitSelected(this.model.symbolsSelected)\n  }\n\n  unselectAll(): void\n  {\n    this.menu.context.hide()\n    this.menu.update()\n    if (this.model.symbolsSelected.length) {\n      this.model.symbolsSelected.forEach(s =>\n      {\n        s.selected = false\n        this.renderer.drawSymbol(s)\n      })\n      this.selector.removeSelectedGroup()\n      this.internalEvent.emitSelected(this.model.symbolsSelected)\n    }\n  }\n\n  async importPointEvents(partialStrokes: PartialDeep<OIStroke>[]): Promise<OIModel>\n  {\n    this.#logger.info(\"importPointEvents\", { partialStrokes })\n    this.internalEvent.emitIdle(false)\n    const strokes = convertPartialStrokesToOIStrokes(partialStrokes)\n    strokes.forEach(s =>\n    {\n      this.model.addSymbol(s)\n      this.renderer.drawSymbol(s)\n    })\n    this.recognizer.addStrokes(strokes, false)\n    this.history.push(this.model, { added: strokes })\n    this.#logger.debug(\"importPointEvents\", this.model)\n    this.updateLayerInfos()\n    return this.model\n  }\n\n  protected triggerDownload(fileName: string, urlData: string): void\n  {\n    const downloadAnchorNode = document.createElement(\"a\")\n    downloadAnchorNode.setAttribute(\"href\", urlData)\n    downloadAnchorNode.setAttribute(\"download\", fileName)\n    document.body.appendChild(downloadAnchorNode)\n    downloadAnchorNode.click()\n    downloadAnchorNode.remove()\n  }\n\n  getSymbolsBounds(symbols: TOISymbol[], margin = SELECTION_MARGIN): Box\n  {\n    const box = Box.createFromBoxes(symbols.map(s => s.bounds))\n    box.x -= margin\n    box.y -= margin\n    box.width += margin * 2\n    box.height += margin * 2\n    return box\n  }\n\n  protected buildBlobFromSymbols(symbols: TOISymbol[], box: Box): Blob\n  {\n    const svgNode = SVGBuilder.createLayer(box)\n    symbols.forEach(s =>\n    {\n      const el = this.renderer.getElementById(s.id)?.cloneNode(true)\n      if (el) {\n        svgNode.appendChild(el)\n      }\n    })\n\n    const svgString = (new XMLSerializer()).serializeToString(svgNode)\n\n    return new Blob([svgString], {\n      type: \"image/svg+xml;charset=utf-8\"\n    })\n  }\n\n  protected getExportName(extension: string): string\n  {\n    const options: Intl.DateTimeFormatOptions = { year: \"numeric\", month: \"numeric\", day: \"numeric\", hour: \"2-digit\", minute: \"2-digit\", second: \"2-digit\" }\n    try {\n      return `iink-ts-${ new Date().toLocaleDateString(navigator.language, options) }.${ extension }`\n    }\n    catch {\n      return `iink-ts-${ new Date().toLocaleDateString(\"en-US\", options) }.${ extension }`\n    }\n  }\n\n  downloadAsSVG(selection = false)\n  {\n    const symbols = selection ? this.model.symbolsSelected : this.model.symbols\n    const box = this.getSymbolsBounds(symbols)\n    const svgBlob = this.buildBlobFromSymbols(symbols, box)\n    const url = URL.createObjectURL(svgBlob)\n    this.triggerDownload(this.getExportName(\"svg\"), url)\n  }\n\n  downloadAsPNG(selection = false)\n  {\n    const symbols = selection ? this.model.symbolsSelected : this.model.symbols\n    const box = this.getSymbolsBounds(symbols)\n    const svgBlob = this.buildBlobFromSymbols(symbols, box)\n\n    const url = URL.createObjectURL(svgBlob)\n    const image = new Image()\n    image.width = box.width\n    image.height = box.height\n    image.src = url\n    image.onload = () =>\n    {\n      const canvas = document.createElement(\"canvas\")\n      canvas.width = image.width\n      canvas.height = image.height\n\n      const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D\n      ctx.drawImage(image, 0, 0)\n      URL.revokeObjectURL(url)\n\n      const imgURI = canvas\n        .toDataURL(\"image/png\")\n        .replace(\"image/png\", \"image/octet-stream\")\n\n      this.triggerDownload(this.getExportName(\"png\"), imgURI)\n    }\n  }\n\n  downloadAsJson(selection = false)\n  {\n    const symbolsToExport = selection ? this.model.symbolsSelected : this.model.symbols\n    const dataStr = \"data:text/json;charset=utf-8,\" + encodeURIComponent(JSON.stringify(symbolsToExport, null, 2))\n    this.triggerDownload(this.getExportName(\"json\"), dataStr)\n  }\n\n  extractStrokesFromSymbols(symbols: TOISymbol[] | undefined): OIStroke[]\n  {\n    if (!symbols?.length) return []\n    const strokes: OIStroke[] = []\n    symbols.forEach(s =>\n    {\n      switch (s.type) {\n        case SymbolType.Stroke:\n          strokes.push(s)\n          break\n        case SymbolType.Group:\n          strokes.push(...s.extractStrokes())\n          break\n      }\n    })\n    return strokes\n  }\n\n  protected extractBackendChanges(changes: TOIHistoryChanges): TOIHistoryBackendChanges\n  {\n    const backendChanges: TOIHistoryBackendChanges = {}\n    backendChanges.added = this.extractStrokesFromSymbols(changes.added)\n    backendChanges.erased = this.extractStrokesFromSymbols(changes.erased)\n\n    const updated = this.extractStrokesFromSymbols(changes.updated)\n\n    const oldStrokes = updated.concat(this.extractStrokesFromSymbols(changes.replaced?.oldSymbols))\n    const newStrokes = updated.concat(this.extractStrokesFromSymbols(changes.replaced?.newSymbols))\n    if (oldStrokes.length && newStrokes.length) {\n      backendChanges.replaced = {\n        oldStrokes,\n        newStrokes\n      }\n    }\n    else {\n      backendChanges.added.push(...newStrokes)\n      backendChanges.erased.push(...oldStrokes)\n    }\n\n    if (changes.matrix) {\n      backendChanges.matrix = {\n        strokes: this.extractStrokesFromSymbols(changes.matrix.symbols),\n        matrix: changes.matrix.matrix,\n      }\n    }\n\n    if (changes.translate?.length) {\n      backendChanges.translate = []\n      changes.translate.forEach(tr =>\n      {\n        const strokes = this.extractStrokesFromSymbols(tr.symbols)\n        if (strokes.length) {\n          backendChanges.translate!.push({\n            strokes,\n            tx: tr.tx,\n            ty: tr.ty\n          })\n        }\n      })\n    }\n    if (changes.scale?.length) {\n      backendChanges.scale = []\n      changes.scale.forEach(tr =>\n      {\n        const strokes = this.extractStrokesFromSymbols(tr.symbols)\n        if (strokes.length) {\n          backendChanges.scale!.push({\n            strokes,\n            origin: tr.origin,\n            scaleX: tr.scaleX,\n            scaleY: tr.scaleY\n          })\n        }\n      })\n    }\n    if (changes.rotate?.length) {\n      backendChanges.rotate = []\n      changes.rotate.forEach(tr =>\n      {\n        const strokes = this.extractStrokesFromSymbols(tr.symbols)\n        if (strokes.length) {\n          backendChanges.rotate!.push({\n            strokes,\n            center: tr.center,\n            angle: tr.angle\n          })\n        }\n      })\n    }\n    return backendChanges\n  }\n\n  async undo(): Promise<OIModel>\n  {\n    this.#logger.info(\"undo\")\n    if (this.history.context.canUndo) {\n      this.internalEvent.emitIdle(false)\n      this.unselectAll()\n      const previousStackItem = this.history.undo()\n      const modifications = previousStackItem.model.extractDifferenceSymbols(this.model)\n      this.#model = previousStackItem.model.clone()\n      this.#logger.debug(\"undo\", { previousStackItem })\n      const actionsToBackend = this.extractBackendChanges(previousStackItem.changes)\n      modifications.removed.forEach(s => this.renderer.removeSymbol(s.id))\n      modifications.added.forEach(s => this.renderer.drawSymbol(s))\n      if (\n        actionsToBackend.added?.length ||\n        actionsToBackend.erased?.length ||\n        actionsToBackend.replaced ||\n        actionsToBackend.matrix ||\n        actionsToBackend.translate?.length ||\n        actionsToBackend.scale?.length ||\n        actionsToBackend.rotate?.length\n      ) {\n        await this.recognizer.undo(actionsToBackend)\n      }\n      this.updateLayerInfos()\n    }\n    return this.model\n  }\n\n  async redo(): Promise<OIModel>\n  {\n    this.#logger.info(\"redo\")\n\n    if (this.history.context.canRedo) {\n      this.internalEvent.emitIdle(false)\n      this.unselectAll()\n      const nextStackItem = this.history.redo()\n      const modifications = nextStackItem.model.extractDifferenceSymbols(this.model)\n      this.#model = nextStackItem.model.clone()\n      this.#logger.debug(\"redo\", { modifications })\n      const actionsToBackend = this.extractBackendChanges(nextStackItem.changes)\n      modifications.removed.forEach(s => this.renderer.removeSymbol(s.id))\n      modifications.added.forEach(s => this.renderer.drawSymbol(s))\n      if (\n        actionsToBackend.added?.length ||\n        actionsToBackend.erased?.length ||\n        actionsToBackend.replaced ||\n        actionsToBackend.matrix ||\n        actionsToBackend.translate?.length ||\n        actionsToBackend.scale?.length ||\n        actionsToBackend.rotate?.length\n      ) {\n        await this.recognizer.redo(actionsToBackend)\n      }\n\n      this.updateLayerInfos()\n    }\n    return this.model\n  }\n\n  async export(mimeTypes?: string[]): Promise<OIModel>\n  {\n    try {\n      this.#logger.info(\"export\", { mimeTypes })\n      const exports = await this.recognizer.export(mimeTypes)\n      this.model.mergeExport(exports as TExport)\n    }\n    catch (error) {\n      this.#logger.error(\"export\", { error })\n      this.internalEvent.emitError(error as Error)\n      throw error\n    }\n    return this.model\n  }\n\n  async convert(): Promise<OIModel>\n  {\n    try {\n      this.internalEvent.emitIdle(false)\n      await this.converter.apply()\n    }\n    catch (error) {\n      this.#logger.error(\"convert\", error)\n      this.internalEvent.emitError(error as Error)\n      throw error\n    }\n    finally {\n      this.updateLayerInfos()\n    }\n    return this.model\n  }\n\n  async resize(height: number, width: number): Promise<OIModel>\n  {\n    this.internalEvent.emitIdle(false)\n    this.#logger.info(\"resize\", { height, width })\n    this.model.height = height\n    this.model.width = width\n    this.renderer.resize(height, width)\n    this.menu.update()\n    this.internalEvent.emitIdle(true)\n    return this.model\n  }\n\n  async clear(): Promise<OIModel>\n  {\n    this.#logger.info(\"clear\")\n    this.internalEvent.emitIdle(false)\n    if (this.model.symbols.length) {\n      this.selector.removeSelectedGroup()\n      const erased = this.model.symbols\n      this.renderer.clear()\n      this.model.clear()\n      this.history.push(this.model, { erased })\n      this.recognizer.clear()\n      this.internalEvent.emitSelected(this.model.symbolsSelected)\n    }\n    this.updateLayerInfos()\n    return this.model\n  }\n\n  async destroy(): Promise<void>\n  {\n    this.#logger.info(\"destroy\")\n    this.grabber.detach()\n    this.renderer.destroy()\n    this.menu.destroy()\n    this.recognizer.destroy()\n    this.model.clear()\n    this.history.clear()\n    return Promise.resolve()\n  }\n}\n","import { Intention } from \"../Constants\"\nimport { Configuration, TConfiguration, TConverstionState } from \"../configuration\"\nimport { InternalEvent } from \"../event\"\nimport { PointerEventGrabber } from \"../grabber\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { IModel, Model, TExport } from \"../model\"\nimport { Stroke, TStroke, TPointer } from \"../primitive\"\nimport { RestRecognizer } from \"../recognizer\"\nimport { CanvasRenderer } from \"../renderer\"\nimport { DefaultPenStyle, StyleManager, TPenStyle, TTheme } from \"../style\"\nimport { HistoryManager } from \"../history\"\nimport { DeferredPromise, PartialDeep } from \"../utils\"\nimport { IBehaviors } from \"./IBehaviors\"\nimport { TBehaviorOptions } from \"./TBehaviorOptions\"\n\n/**\n * @group Behavior\n */\nexport class RestBehaviors implements IBehaviors\n{\n  name = \"RestBehaviors\"\n  #logger = LoggerManager.getLogger(LoggerClass.BEHAVIORS)\n  #configuration: TConfiguration\n  #model: Model\n  #resizeTimer?: ReturnType<typeof setTimeout>\n  #exportTimer?: ReturnType<typeof setTimeout>\n\n  grabber: PointerEventGrabber\n  renderer: CanvasRenderer\n  recognizer: RestRecognizer\n  history: HistoryManager\n  styleManager: StyleManager\n  intention: Intention\n\n  constructor(options: PartialDeep<TBehaviorOptions>)\n  {\n    this.#logger.info(\"constructor\", { options })\n    this.#configuration = new Configuration(options?.configuration)\n    this.styleManager = new StyleManager(options?.penStyle, options?.theme)\n\n    if (options.behaviors?.grabber) {\n      const CustomGrabber = options.behaviors?.grabber as unknown as typeof PointerEventGrabber\n      this.grabber = new CustomGrabber(this.#configuration.grabber)\n    }\n    else {\n      this.grabber = new PointerEventGrabber(this.#configuration.grabber)\n    }\n    if (options.behaviors?.recognizer) {\n      const CustomRecognizer = options.behaviors?.recognizer as unknown as typeof RestRecognizer\n      this.recognizer = new CustomRecognizer(this.#configuration.server, this.#configuration.recognition)\n    }\n    else {\n      this.recognizer = new RestRecognizer(this.#configuration.server, this.#configuration.recognition)\n    }\n    this.renderer = new CanvasRenderer(this.#configuration.rendering)\n\n    this.intention = Intention.Write\n    this.#model = new Model()\n    this.history = new HistoryManager(this.#configuration[\"undo-redo\"])\n  }\n\n  protected onPointerDown(evt: PointerEvent, point: TPointer): void\n  {\n    this.#logger.info(\"onPointerDown\", { intention: this.intention, evt, point })\n    const { pointerType } = evt\n    const style: TPenStyle = Object.assign({}, this.theme?.ink, this.currentPenStyle)\n    switch (this.intention) {\n      case Intention.Erase: {\n        if (this.model.removeStrokesFromPoint(point).length > 0) {\n          this.renderer.drawModel(this.model)\n        }\n        break\n      }\n      case Intention.Write:\n        this.model.initCurrentStroke(point, pointerType, style)\n        this.drawCurrentStroke()\n        break\n      default:\n        this.#logger.warn(\"#onPointerDown\", `onPointerDown intention unknow: \"${ this.intention }\"`)\n        break\n    }\n  }\n\n  protected onPointerMove(_evt: PointerEvent, point: TPointer): void\n  {\n    this.#logger.info(\"onPointerMove\", { intention: this.intention, point })\n    switch (this.intention) {\n      case Intention.Erase: {\n        if (this.model.removeStrokesFromPoint(point).length > 0) {\n          this.renderer.drawModel(this.model)\n        }\n        break\n      }\n      case Intention.Write:\n        this.model.appendToCurrentStroke(point)\n        this.drawCurrentStroke()\n        break\n      default:\n        this.#logger.warn(\"#onPointerMove\", `onPointerMove intention unknow: \"${ this.intention }\"`)\n        break\n    }\n  }\n\n  protected async onPointerUp(_evt: PointerEvent, point: TPointer): Promise<void>\n  {\n    this.#logger.info(\"onPointerUp\", { intention: this.intention, point })\n    switch (this.intention) {\n      case Intention.Erase:\n        this.model.removeStrokesFromPoint(point)\n        if (this.history.stack.at(-1)?.modificationDate !== this.model.modificationDate) {\n          await this.updateModelRendering()\n        }\n        break\n      case Intention.Write:\n        this.model.endCurrentStroke(point)\n        await this.updateModelRendering()\n        break\n      default:\n        this.#logger.warn(\"#onPointerUp\", `onPointerUp intention unknow: \"${ this.intention }\"`)\n        break\n    }\n  }\n\n  get internalEvent(): InternalEvent\n  {\n    return InternalEvent.getInstance()\n  }\n\n  get model(): Model\n  {\n    return this.#model\n  }\n\n  get currentPenStyle(): TPenStyle\n  {\n    return this.styleManager.currentPenStyle\n  }\n\n  get penStyle(): TPenStyle\n  {\n    return this.styleManager.penStyle\n  }\n  async setPenStyle(penStyle?: TPenStyle | undefined): Promise<void>\n  {\n    this.#logger.info(\"setPenStyle\", { penStyle })\n    this.styleManager.setPenStyle(penStyle)\n    return Promise.resolve()\n  }\n\n  get penStyleClasses(): string\n  {\n    return this.styleManager.penStyleClasses\n  }\n  async setPenStyleClasses(penStyleClasses?: string | undefined): Promise<void>\n  {\n    this.#logger.info(\"setPenStyleClasses\", { penStyleClasses })\n    this.styleManager.setPenStyleClasses(penStyleClasses)\n    return Promise.resolve()\n  }\n\n  get theme(): TTheme\n  {\n    return this.styleManager.theme\n  }\n  async setTheme(theme?: PartialDeep<TTheme>): Promise<void>\n  {\n    this.#logger.info(\"setTheme\", { theme })\n    this.styleManager.setTheme(theme)\n    return Promise.resolve()\n  }\n\n  get configuration(): TConfiguration\n  {\n    return this.#configuration\n  }\n\n  async init(domElement: HTMLElement): Promise<void>\n  {\n    this.#logger.info(\"init\", { domElement })\n    this.model.width = Math.max(domElement.clientWidth, this.#configuration.rendering.minWidth)\n    this.model.height = Math.max(domElement.clientHeight, this.#configuration.rendering.minHeight)\n\n    this.history.push(this.model)\n\n    this.renderer.init(domElement)\n\n    this.grabber.attach(domElement)\n    this.grabber.onPointerDown = this.onPointerDown.bind(this)\n    this.grabber.onPointerMove = this.onPointerMove.bind(this)\n    this.grabber.onPointerUp = this.onPointerUp.bind(this)\n    return Promise.resolve()\n  }\n\n  drawCurrentStroke(): void\n  {\n    this.#logger.debug(\"drawCurrentStroke\", { stroke: this.model.currentSymbol })\n    this.renderer.drawPendingStroke(this.model.currentSymbol)\n  }\n\n  async updateModelRendering(): Promise<IModel>\n  {\n    this.#logger.info(\"updateModelRendering\")\n    this.renderer.drawModel(this.model)\n    const deferred = new DeferredPromise<Model>()\n    this.history.push(this.model)\n    if (this.#configuration.triggers.exportContent !== \"DEMAND\") {\n      clearTimeout(this.#exportTimer)\n      let currentModel = this.model.clone()\n      this.#exportTimer = setTimeout(async () =>\n      {\n        try {\n          currentModel = await this.recognizer.export(currentModel)\n          this.history.updateStack(currentModel)\n          if (this.model.modificationDate === currentModel.modificationDate) {\n            this.model.exports = currentModel.exports\n          }\n          deferred.resolve(this.model)\n        } catch (error) {\n          this.#logger.error(\"updateModelRendering\", { error })\n          this.internalEvent.emitError(error as Error)\n          deferred.reject(error as Error)\n        }\n      }, this.#configuration.triggers.exportContent === \"QUIET_PERIOD\" ? this.#configuration.triggers.exportContentDelay : 0)\n    } else {\n      deferred.resolve(this.model)\n    }\n    await deferred.promise\n    this.internalEvent.emitExported(this.model.exports as TExport)\n    this.#logger.debug(\"updateModelRendering\", this.model.exports)\n    return deferred.promise\n  }\n\n  async export(mimeTypes?: string[]): Promise<IModel>\n  {\n    this.#logger.info(\"export\", { mimeTypes })\n    const newModel = await this.recognizer.export(this.model.clone(), mimeTypes)\n    if (this.model.modificationDate === newModel.modificationDate) {\n      this.model.mergeExport(newModel.exports as TExport)\n    }\n    this.history.updateStack(newModel)\n    this.#logger.debug(\"export\", this.model)\n    return this.model\n  }\n\n  async convert(conversionState?: TConverstionState, requestedMimeTypes?: string[]): Promise<IModel>\n  {\n    this.#logger.info(\"convert\", { conversionState, requestedMimeTypes })\n    const newModel = await this.recognizer.convert(this.model, conversionState, requestedMimeTypes)\n    Object.assign(this.#model, newModel)\n    this.#logger.debug(\"convert\", this.model)\n    return this.model\n  }\n\n  async importPointEvents(strokes: PartialDeep<TStroke>[]): Promise<IModel>\n  {\n    const errors: string[] = []\n    strokes.forEach((s, strokeIndex) =>\n    {\n      let flag = true\n      const stroke = new Stroke(s.style || DefaultPenStyle, s.pointerType)\n      if (s.id) stroke.id = s.id\n      if (!s.pointers?.length) {\n        errors.push(`stroke ${strokeIndex + 1} has not pointers`)\n        flag = false\n        return\n      }\n      s.pointers?.forEach((pp, pIndex) => {\n        if (!pp) {\n          errors.push(`stroke ${strokeIndex + 1} has no pointer at ${pIndex}`)\n          flag = false\n          return\n        }\n        const pointer: TPointer = {\n          p: pp.p || 1,\n          t: pp.t || pIndex,\n          x: 0,\n          y: 0\n        }\n        if (pp?.x == undefined || pp?.x == null) {\n          errors.push(`stroke ${strokeIndex + 1} has no x at pointer at ${pIndex}`)\n          flag = false\n          return\n        }\n        else {\n          pointer.x = pp.x\n        }\n        if (pp?.y == undefined || pp?.y == null) {\n          errors.push(`stroke ${strokeIndex + 1} has no y at pointer at ${pIndex}`)\n          flag = false\n          return\n        }\n        else {\n          pointer.y = pp.y\n        }\n        if (flag) {\n          stroke.pointers.push(pointer)\n        }\n      })\n      if (flag) {\n        this.model.addStroke(stroke)\n      }\n    })\n\n    if (errors.length) {\n      this.internalEvent.emitError( new Error(errors.join(\"\\n\")))\n    }\n    try {\n      const newModel = await this.updateModelRendering()\n      Object.assign(this.#model, newModel)\n      return this.model\n    } catch (error) {\n      this.internalEvent.emitError(error as Error)\n      throw error as Error\n    }\n  }\n\n  async resize(height: number, width: number): Promise<IModel>\n  {\n    this.#logger.info(\"resize\", { height, width })\n    const deferredResize = new DeferredPromise<Model>()\n    this.model.height = height\n    this.model.width = width\n    this.renderer.resize(this.model)\n    if (this.model.symbols.length) {\n      clearTimeout(this.#resizeTimer)\n      this.#resizeTimer = setTimeout(async () =>\n      {\n        const resizeModel = await this.recognizer.resize(this.model)\n        deferredResize.resolve(resizeModel)\n      }, this.#configuration.triggers.resizeTriggerDelay)\n    } else {\n      deferredResize.resolve(this.model)\n    }\n    this.#model = await deferredResize.promise\n    this.#logger.debug(\"resize\", { model: this.model })\n    this.internalEvent.emitExported(this.model.exports as TExport)\n    return this.model\n  }\n\n  async undo(): Promise<IModel>\n  {\n    this.#logger.info(\"undo\")\n    this.#model = this.history.undo() as Model\n    this.renderer.drawModel(this.#model)\n    this.#model = await this.recognizer.export(this.#model)\n    this.history.updateStack(this.#model)\n    this.internalEvent.emitExported(this.#model.exports as TExport)\n    this.#logger.debug(\"undo\", this.#model)\n    return this.#model\n  }\n\n  async redo(): Promise<IModel>\n  {\n    this.#logger.info(\"redo\")\n    this.#model = this.history.redo() as Model\n    this.renderer.drawModel(this.#model)\n    this.#model = await this.recognizer.export(this.#model)\n    this.history.updateStack(this.#model)\n    this.internalEvent.emitExported(this.#model.exports as TExport)\n    this.#logger.debug(\"redo\", this.#model)\n    return this.#model\n  }\n\n  async clear(): Promise<IModel>\n  {\n    this.#logger.info(\"clear\")\n    this.model.clear()\n    this.history.push(this.model)\n    this.renderer.drawModel(this.model)\n    this.internalEvent.emitExported(this.model.exports as TExport)\n    this.#logger.debug(\"clear\", this.model)\n    return this.model\n  }\n\n  async destroy(): Promise<void>\n  {\n    this.#logger.info(\"destroy\")\n    this.grabber.detach()\n    this.renderer.destroy()\n    return Promise.resolve()\n  }\n}\n","import { Intention } from \"../Constants\"\nimport { Configuration, TConfiguration, TConverstionState } from \"../configuration\"\nimport { InternalEvent } from \"../event\"\nimport { PointerEventGrabber } from \"../grabber\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { IModel, Model, TExport } from \"../model\"\nimport { TWSMessageEventSVGPatch, WSRecognizer } from \"../recognizer\"\nimport { WSSVGRenderer } from \"../renderer\"\nimport { DefaultPenStyle, StyleManager, TPenStyle, TTheme } from \"../style\"\nimport { HistoryManager } from \"../history\"\nimport { DeferredPromise, PartialDeep } from \"../utils\"\nimport { Stroke, TStroke, TPointer } from \"../primitive\"\nimport { IBehaviors } from \"./IBehaviors\"\nimport { TBehaviorOptions } from \"./TBehaviorOptions\"\n\n/**\n * @group Behavior\n */\nexport class WSBehaviors implements IBehaviors\n{\n  name = \"WSBehaviors\"\n  #logger = LoggerManager.getLogger(LoggerClass.BEHAVIORS)\n  #configuration: TConfiguration\n  #model: Model\n  #resizeTimer?: ReturnType<typeof setTimeout>\n\n  grabber: PointerEventGrabber\n  renderer: WSSVGRenderer\n  recognizer: WSRecognizer\n  history: HistoryManager\n  styleManager: StyleManager\n  intention: Intention\n\n\n  constructor(options: PartialDeep<TBehaviorOptions>)\n  {\n    this.#logger.info(\"constructor\", { options })\n    this.#configuration = new Configuration(options?.configuration)\n    this.styleManager = new StyleManager(options?.penStyle, options?.theme)\n\n    if (options.behaviors?.grabber) {\n      const CustomGrabber = options.behaviors?.grabber as unknown as typeof PointerEventGrabber\n      this.grabber = new CustomGrabber(this.#configuration.grabber)\n    }\n    else {\n      this.grabber = new PointerEventGrabber(this.#configuration.grabber)\n    }\n    if (options.behaviors?.recognizer) {\n      const CustomRecognizer = options.behaviors?.recognizer as unknown as typeof WSRecognizer\n      this.recognizer = new CustomRecognizer(this.#configuration.server, this.#configuration.recognition)\n    }\n    else {\n      this.recognizer = new WSRecognizer(this.#configuration.server, this.#configuration.recognition)\n    }\n    this.renderer = new WSSVGRenderer(this.#configuration.rendering)\n\n    this.intention = Intention.Write\n    this.#model = new Model()\n    this.history = new HistoryManager(this.#configuration[\"undo-redo\"])\n  }\n\n  get internalEvent(): InternalEvent\n  {\n    return InternalEvent.getInstance()\n  }\n\n  get model(): Model\n  {\n    return this.#model\n  }\n\n  get configuration(): TConfiguration\n  {\n    return this.#configuration\n  }\n\n  get currentPenStyle(): TPenStyle\n  {\n    return this.styleManager.currentPenStyle\n  }\n\n  get penStyle(): TPenStyle\n  {\n    return this.styleManager.penStyle\n  }\n  setPenStyle(penStyle?: PartialDeep<TPenStyle>): Promise<void>\n  {\n    this.#logger.info(\"setPenStyle\", { penStyle })\n    this.styleManager.setPenStyle(penStyle)\n    this.#logger.debug(\"setPenStyle\", this.styleManager.penStyle)\n    return this.recognizer.setPenStyle(this.styleManager.penStyle)\n  }\n\n  get penStyleClasses(): string\n  {\n    return this.styleManager.penStyleClasses\n  }\n  setPenStyleClasses(penClass?: string): Promise<void>\n  {\n    this.#logger.info(\"setPenStyleClasses\", { penClass })\n    this.styleManager.setPenStyleClasses(penClass)\n    this.#logger.debug(\"setPenStyleClasses\", this.styleManager.penStyleClasses)\n    return this.recognizer.setPenStyleClasses(this.styleManager.penStyleClasses)\n  }\n\n  get theme(): TTheme\n  {\n    return this.styleManager.theme\n  }\n  setTheme(theme?: PartialDeep<TTheme>): Promise<void>\n  {\n    this.#logger.info(\"setTheme\", { theme })\n    this.styleManager.setTheme(theme)\n    this.#logger.debug(\"setTheme\", this.styleManager.theme)\n    return this.recognizer.setTheme(this.styleManager.theme)\n  }\n\n  protected onExport(exports: TExport): void\n  {\n    this.#logger.debug(\"onExport\", { exports })\n    this.model.mergeExport(exports)\n  }\n\n  protected onPointerDown(evt: PointerEvent, point: TPointer): void\n  {\n    this.#logger.info(\"onPointerDown\", { intention: this.intention, evt, point })\n    let { pointerType } = evt\n    const style: TPenStyle = Object.assign({}, this.theme?.ink, this.currentPenStyle)\n    if (this.intention === Intention.Erase) {\n      pointerType = \"eraser\"\n    }\n    this.model.initCurrentStroke(point, pointerType, style)\n    this.drawCurrentStroke()\n  }\n\n  protected onPointerMove(_evt: PointerEvent, point: TPointer): void\n  {\n    this.#logger.info(\"onPointerMove\", { intention: this.intention, point })\n    this.model.appendToCurrentStroke(point)\n    this.drawCurrentStroke()\n  }\n\n  protected async onPointerUp(_evt: PointerEvent, point: TPointer): Promise<void>\n  {\n    try {\n      this.#logger.info(\"onPointerUp\", { intention: this.intention, point })\n      this.model.endCurrentStroke(point)\n      await this.synchronizeModelWithBackend()\n    } catch (error) {\n      this.internalEvent.emitError(error as Error)\n    }\n  }\n\n  protected onSVGPatch(evt: TWSMessageEventSVGPatch): void\n  {\n    this.#logger.info(\"onSVGPatch\", { evt })\n    this.renderer.updatesLayer(evt.layer, evt.updates)\n  }\n\n  async init(domElement: HTMLElement): Promise<void>\n  {\n    this.#logger.info(\"init\", { domElement })\n    const compStyles = window.getComputedStyle(domElement);\n    this.model.width = Math.max(parseInt(compStyles.width.replace(\"px\",\"\")), this.#configuration.rendering.minWidth)\n    this.model.height = Math.max(parseInt(compStyles.height.replace(\"px\",\"\")), this.#configuration.rendering.minHeight)\n    this.history.push(this.model)\n\n    this.renderer.init(domElement)\n\n    this.grabber.attach(domElement)\n    this.grabber.onPointerDown = this.onPointerDown.bind(this)\n    this.grabber.onPointerMove = this.onPointerMove.bind(this)\n    this.grabber.onPointerUp = this.onPointerUp.bind(this)\n\n    this.internalEvent.addExportedListener(this.onExport.bind(this))\n    this.internalEvent.addSVGPatchListener(this.onSVGPatch.bind(this))\n\n    await this.recognizer.init(this.model.height, this.model.width)\n    await this.setPenStyle(this.penStyle)\n    await this.setTheme(this.theme as PartialDeep<TTheme>)\n    await this.setPenStyleClasses(this.penStyleClasses)\n  }\n\n  drawCurrentStroke(): void\n  {\n    this.#logger.debug(\"drawCurrentStroke\", { stroke: this.model.currentSymbol })\n    const currentSymbol = this.model.currentSymbol as Stroke\n    if (currentSymbol) {\n      this.renderer.drawPendingStroke(currentSymbol)\n    }\n  }\n\n  async synchronizeModelWithBackend(): Promise<IModel>\n  {\n    this.#logger.info(\"synchronizeModelWithBackend\")\n    if (this.#configuration.triggers.exportContent !== \"DEMAND\") {\n      const unsentStrokes = this.model.extractUnsentStrokes()\n      this.model.updatePositionSent()\n      this.history.push(this.model)\n      this.renderer.clearErasingStrokes()\n      const exports = await this.recognizer.addStrokes(unsentStrokes)\n      this.model.mergeExport(exports)\n      this.history.updateStack(this.model)\n    }\n    this.#logger.debug(\"synchronizeModelWithBackend\", this.model)\n    return this.model\n  }\n\n  async waitForIdle(): Promise<void>\n  {\n    return this.recognizer.waitForIdle()\n  }\n\n  async export(mimeTypes?: string[]): Promise<IModel>\n  {\n    this.#logger.info(\"export\", { mimeTypes })\n    try {\n      if (this.#configuration.triggers.exportContent === \"DEMAND\") {\n        const unsentStrokes = this.model.extractUnsentStrokes()\n        this.model.updatePositionSent()\n        const exports = await this.recognizer.addStrokes(unsentStrokes)\n        this.model.updatePositionReceived()\n        this.model.mergeExport(exports)\n        this.#logger.debug(\"export\", this.model)\n        return this.model\n      } else {\n        return this.recognizer.export(this.model, mimeTypes)\n      }\n    } catch (error) {\n      this.#logger.error(\"export\", { error } )\n      this.internalEvent.emitError(error as Error)\n      return Promise.reject(error)\n    }\n  }\n\n  async convert(conversionState?: TConverstionState): Promise<IModel>\n  {\n    this.#logger.info(\"convert\", { conversionState })\n    this.history.push(this.model)\n    this.history.stack.push(this.model.clone())\n    this.#model = await this.recognizer.convert(this.model, conversionState)\n    this.#logger.debug(\"convert\", this.model)\n    this.history.push(this.model)\n    return this.model\n  }\n\n  async import(data: Blob, mimeType?: string): Promise<IModel>\n  {\n    this.#logger.info(\"import\", { data, mimeType })\n    this.history.stack.push(this.model.clone())\n    const m = await this.recognizer.import(this.model, data, mimeType)\n    this.history.push(m)\n    return m\n  }\n\n  async importPointEvents(strokes: PartialDeep<TStroke>[]): Promise<IModel>\n  {\n    this.#logger.info(\"importPointEvents\", { strokes })\n    const errors: string[] = []\n    const strokesToImport = strokes.map((s, strokeIndex) => {\n      const str = new Stroke(s.style || DefaultPenStyle, s.pointerType)\n      if (s.id) str.id = s.id\n      if (s.pointerType) str.pointerType = s.pointerType\n      if (!s.pointers?.length) {\n        errors.push(`stroke ${strokeIndex + 1} has not pointers`)\n      }\n      let flag = true\n      s.pointers?.forEach((pp, pIndex) => {\n        flag = true\n        if (!pp) {\n          errors.push(`stroke ${strokeIndex + 1} has no pointer at ${pIndex}`)\n          return\n        }\n        const pointer: TPointer = {\n          p: pp.p || 1,\n          t: pp.t || pIndex,\n          x: 0,\n          y: 0\n        }\n        if (pp?.x == undefined || pp?.x == null) {\n          errors.push(`stroke ${strokeIndex + 1} has no x at pointer at ${pIndex}`)\n          flag = false\n        }\n        else {\n          pointer.x = pp.x\n        }\n        if (pp?.y == undefined || pp?.y == null) {\n          errors.push(`stroke ${strokeIndex + 1} has no y at pointer at ${pIndex}`)\n          flag = false\n        }\n        else {\n          pointer.y = pp.y\n        }\n        if (flag) {\n          str.pointers.push(pointer)\n        }\n      })\n      return str\n    })\n    if (errors.length) {\n      this.internalEvent.emitError( new Error(errors.join(\"\\n\")))\n    }\n    strokesToImport.map(s => this.model.addStroke(s))\n    const exportPoints = await this.recognizer.importPointEvents(strokesToImport)\n    this.model.mergeExport(exportPoints)\n    this.#logger.debug(\"importPointEvents\", this.model)\n    return this.model\n  }\n\n  async resize(height: number, width: number): Promise<IModel>\n  {\n    this.#logger.info(\"resize\", { height, width })\n    const deferredResize = new DeferredPromise<Model>()\n    this.model.height = height\n    this.model.width = width\n    const clonedModel = this.model.clone()\n    this.renderer.resize(clonedModel)\n    clearTimeout(this.#resizeTimer)\n    this.#resizeTimer = setTimeout(async () =>\n    {\n      try {\n        const resizeModel = await this.recognizer.resize(clonedModel)\n        deferredResize.resolve(resizeModel)\n      } catch (error) {\n        this.#logger.error(\"resize\", { height, width, error } )\n        deferredResize.reject(error as Error)\n      }\n    }, this.#configuration.triggers.resizeTriggerDelay)\n\n    this.#model = await deferredResize.promise\n    this.internalEvent.emitExported(this.model.exports as TExport)\n    this.#logger.debug(\"resize\", this.model)\n    return this.model\n  }\n\n  async undo(): Promise<IModel>\n  {\n    this.#logger.info(\"undo\")\n    if (this.history.context.canUndo) {\n      this.#model = this.history.undo() as Model\n      return this.recognizer.undo(this.model)\n    }\n    else {\n      throw new Error(\"Undo not allowed\")\n    }\n  }\n\n  async redo(): Promise<IModel>\n  {\n    this.#logger.info(\"redo\")\n    if (this.history.context.canRedo) {\n      this.#model = this.history.redo() as Model\n      this.#logger.debug(\"undo\", this.#model)\n      return this.recognizer.redo(this.model)\n    }\n    else {\n      throw new Error(\"Redo not allowed\")\n    }\n  }\n\n  async clear(): Promise<IModel>\n  {\n    this.#logger.info(\"clear\")\n    this.model.clear()\n    this.history.push(this.model)\n    return this.recognizer.clear(this.model)\n  }\n\n  async destroy(): Promise<void>\n  {\n    this.#logger.info(\"destroy\")\n    this.grabber.detach()\n    this.renderer.destroy()\n    this.recognizer.destroy()\n    return Promise.resolve()\n  }\n}\n","import { TMarginConfiguration, TRenderingConfiguration } from \"../configuration\"\nimport { InternalEvent } from \"../event\"\nimport { LoggerClass, LoggerManager } from \"../logger\"\nimport { TJIIXExport, TJIIXWord } from \"../model\"\nimport { convertMillimeterToPixel, createUUID } from \"../utils\"\n\n/**\n * @group SmartGuide\n */\nexport class SmartGuide\n{\n  uuid: string\n  #smartGuideElement!: HTMLDivElement\n  #wrapperElement!: HTMLDivElement\n  #prompterContainerElement!: HTMLDivElement\n  #prompterTextElement!: HTMLDivElement\n  #ellipsisElement!: HTMLDivElement\n  #tagElement!: HTMLDivElement\n  #candidatesElement!: HTMLDivElement\n  #menuElement!: HTMLDivElement\n  #convertElement!: HTMLButtonElement\n  #copyElement!: HTMLButtonElement\n  #deleteElement!: HTMLButtonElement\n  #isMenuOpen!: boolean\n  margin: TMarginConfiguration\n  renderingConfiguration!: TRenderingConfiguration\n  jiix?: TJIIXExport\n  lastWord?: TJIIXWord\n  wordToChange?: TJIIXWord\n  #logger = LoggerManager.getLogger(LoggerClass.SMARTGUIDE)\n\n  constructor()\n  {\n    this.#logger.info(\"constructor\")\n    this.uuid = createUUID()\n    this.margin = {\n      bottom: 0,\n      left: 0,\n      right: 0,\n      top: 0\n    }\n    this.#createRootElement()\n    this.#createWrapperElement()\n    this.#createPrompterContainerElement()\n    this.#createPrompterTextElement()\n    this.#createEllipsisElement()\n    this.#createTagElement()\n    this.#createCandidatesElement()\n    this.#createMoreMenuElement()\n    this.#createConvertElement()\n    this.#createCopyElement()\n    this.#createDeleteElement()\n  }\n\n  get internalEvent(): InternalEvent\n  {\n    return InternalEvent.getInstance()\n  }\n\n  #createRootElement(): void\n  {\n    this.#smartGuideElement = document.createElement(\"div\")\n    this.#smartGuideElement.id = `smartguide-${ this.uuid }`\n    this.#smartGuideElement.classList.add(\"smartguide\")\n    this.#smartGuideElement.addEventListener(\"pointerdown\", e => {\n      e.preventDefault()\n      e.stopPropagation()\n    })\n  }\n\n  #createWrapperElement(): void\n  {\n    this.#wrapperElement = document.createElement(\"div\")\n    this.#wrapperElement.id = `smartguide-wrapper-${ this.uuid }`\n    this.#wrapperElement.classList.add(\"smartguide-wrapper\")\n  }\n\n  #createPrompterContainerElement(): void\n  {\n    this.#prompterContainerElement = document.createElement(\"div\")\n    this.#prompterContainerElement.id = `prompter-container-${ this.uuid }`\n    this.#prompterContainerElement.classList.add(\"prompter-container\")\n  }\n\n  #createPrompterTextElement(): void\n  {\n    this.#prompterTextElement = document.createElement(\"div\")\n    this.#prompterTextElement.id = `prompter-text-${ this.uuid }`\n    this.#prompterTextElement.classList.add(\"prompter-text\")\n    this.#prompterTextElement.setAttribute(\"touch-action\", \"none\")\n  }\n\n  #createEllipsisElement(): void\n  {\n    this.#ellipsisElement = document.createElement(\"div\")\n    this.#ellipsisElement.id = `ellipsis-${ this.uuid }`\n    this.#ellipsisElement.classList.add(\"ellipsis\")\n    this.#ellipsisElement.innerHTML = \"...\"\n  }\n\n  #createTagElement(): void\n  {\n    this.#tagElement = document.createElement(\"div\")\n    this.#tagElement.id = `tag-icon-${ this.uuid }`\n    this.#tagElement.classList.add(\"tag-icon\")\n    this.#tagElement.innerHTML = \"&#182;\"\n  }\n\n  #createCandidatesElement(): void\n  {\n    this.#candidatesElement = document.createElement(\"div\")\n    this.#candidatesElement.id = `candidates-${ this.uuid }`\n    this.#candidatesElement.classList.add(\"candidates\")\n  }\n\n  #createMoreMenuElement(): void\n  {\n    this.#menuElement = document.createElement(\"div\")\n    this.#menuElement.id = `more-menu-${ this.uuid }`\n    this.#menuElement.classList.add(\"more-menu\")\n  }\n\n  #createConvertElement(): void\n  {\n    this.#convertElement = document.createElement(\"button\")\n    this.#convertElement.id = `convert-${ this.uuid }`\n    this.#convertElement.classList.add(\"options-label-button\")\n    this.#convertElement.innerHTML = \"Convert\"\n  }\n\n  #createCopyElement(): void\n  {\n    this.#copyElement = document.createElement(\"button\")\n    this.#copyElement.id = `copy-${ this.uuid }`\n    this.#copyElement.classList.add(\"options-label-button\")\n    this.#copyElement.innerHTML = \"Copy\"\n  }\n\n  #createDeleteElement(): void\n  {\n    this.#deleteElement = document.createElement(\"button\")\n    this.#deleteElement.id = `delete-${ this.uuid }`\n    this.#deleteElement.classList.add(\"options-label-button\")\n    this.#deleteElement.innerHTML = \"Delete\"\n  }\n\n  init(domElement: HTMLElement, margin: TMarginConfiguration, renderingConfiguration: TRenderingConfiguration): void\n  {\n    this.#logger.info(\"init\", { domElement, margin, renderingConfiguration })\n    domElement.appendChild(this.#smartGuideElement)\n    this.#smartGuideElement.appendChild(this.#wrapperElement)\n\n    this.#wrapperElement.appendChild(this.#tagElement)\n\n    this.#prompterContainerElement.appendChild(this.#prompterTextElement)\n    this.#wrapperElement.appendChild(this.#prompterContainerElement)\n\n    this.#wrapperElement.appendChild(this.#ellipsisElement)\n\n    this.#menuElement.appendChild(this.#convertElement)\n    this.#menuElement.appendChild(this.#copyElement)\n    this.#menuElement.appendChild(this.#deleteElement)\n    this.#menuElement.classList.add(\"close\")\n    this.#wrapperElement.appendChild(this.#menuElement)\n    this.#isMenuOpen = false\n\n    this.#candidatesElement.style.display = \"none\"\n    this.#wrapperElement.appendChild(this.#candidatesElement)\n    this.margin = margin\n    this.renderingConfiguration = renderingConfiguration\n    this.#addListeners()\n\n    this.resize()\n  }\n\n  #showCandidates = (target: HTMLElement) =>\n  {\n    this.#logger.info(\"showCandidates\", { target })\n    const wordId = parseInt(target.id.replace(\"word-\", \"\").replace(this.uuid, \"\"))\n    const words = this.jiix?.words as TJIIXWord[]\n    this.wordToChange = words[wordId]\n    if (this.wordToChange) {\n      this.wordToChange.id = wordId.toString()\n      this.#candidatesElement.innerHTML = \"\"\n      if (this.wordToChange?.candidates) {\n        this.#candidatesElement.style.display = \"flex\"\n        this.wordToChange.candidates.forEach((word, index) =>\n        {\n          if (this.wordToChange?.label === word) {\n            this.#candidatesElement.innerHTML += `<span id=\"cdt-${ index }${ this.uuid }\" class=\"selected-word\">${ word }</span>`\n          } else {\n            this.#candidatesElement.innerHTML += `<span id=\"cdt-${ index }${ this.uuid }\">${ word }</span>`\n          }\n        })\n\n        target.appendChild(this.#candidatesElement)\n      }\n    }\n  }\n  #hideCandidates(): void\n  {\n    this.#candidatesElement.style.display = \"none\"\n  }\n\n  #openMenu(): void\n  {\n    this.#menuElement.classList.add(\"open\")\n    this.#menuElement.classList.remove(\"close\")\n    this.#isMenuOpen = true\n  }\n  #closeMenu(): void\n  {\n    this.#menuElement.classList.add(\"close\")\n    this.#menuElement.classList.remove(\"open\")\n    this.#isMenuOpen = false\n  }\n\n  #onClickEllipsis = (evt: Event) =>\n  {\n    this.#logger.info(\"onClickEllipsis\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    this.#isMenuOpen ? this.#closeMenu() : this.#openMenu()\n    this.#hideCandidates()\n  }\n\n  #onClickConvert = (evt: Event) =>\n  {\n    this.#logger.info(\"onClickConvert\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    this.internalEvent.emitConvert()\n    this.#closeMenu()\n  }\n\n  #createTextAreaElement(value: string): HTMLTextAreaElement\n  {\n    const isRTL = document.documentElement.getAttribute(\"dir\") === \"rtl\"\n    const textArea = document.createElement(\"textarea\")\n    textArea.style.fontSize = \"12pt\"\n    textArea.style.display = \"absolute\"\n    textArea.style[isRTL ? \"right\" : \"left\"] = \"-9999px\"\n    const yPosition = window.pageYOffset || document.documentElement.scrollTop\n    textArea.style.top = `${ yPosition }px`\n    textArea.setAttribute(\"readonly\", \"\")\n    textArea.value = value\n    return textArea\n  }\n\n  #selectText(textArea: HTMLTextAreaElement)\n  {\n    if (navigator.userAgent.match(/ipad|iphone/i)) {\n      const range = document.createRange()\n      range.selectNodeContents(textArea)\n      const selection = window.getSelection()\n      if (selection) {\n        selection.removeAllRanges()\n        selection.addRange(range)\n        textArea.setSelectionRange(0, 999999)\n      }\n    } else {\n      textArea.select()\n    }\n  }\n\n  #onClickCopy = async (evt: Event): Promise<void> =>\n  {\n    this.#logger.info(\"onClickCopy\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    try {\n      this.#closeMenu()\n      let message = \"Nothing to copy\"\n      if (this.#prompterTextElement.innerText) {\n        message = `\"${ this.#prompterTextElement.innerText }\" copied to clipboard`\n        const fakeEl = this.#createTextAreaElement(this.#prompterTextElement.innerText)\n        this.#prompterContainerElement.appendChild(fakeEl)\n        this.#selectText(fakeEl)\n        document.execCommand(\"copy\")\n        fakeEl.remove()\n      }\n      this.internalEvent.emitNotif({ message, timeout: 1500 })\n    } catch (error) {\n      this.#logger.error(\"onClickCopy\", error)\n      this.internalEvent.emitError(error as Error)\n    }\n  }\n\n  #onClickDelete = (evt: Event) =>\n  {\n    this.#logger.info(\"onClickDelete\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    this.internalEvent.emitClear()\n    this.#closeMenu()\n  }\n\n  #onClickCandidate = (evt: Event) =>\n  {\n    this.#logger.info(\"onClickCandidate\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    const target = evt.target as HTMLElement\n    const candidate = target.innerText\n    if (this.jiix?.words && candidate !== this.wordToChange?.label && this.wordToChange?.candidates?.includes(candidate)) {\n      this.jiix.words[parseInt(this.wordToChange?.id as string)].label = candidate\n      this.internalEvent.emitImportJIIX(this.jiix)\n    }\n    this.#candidatesElement.style.display = \"none\"\n  }\n\n  #onClickPrompter = (evt: Event): void =>\n  {\n    this.#logger.info(\"onClickPrompter\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    this.#closeMenu()\n    const target = evt.target as HTMLElement\n    if (target.id !== this.#prompterTextElement.id) {\n      this.#showCandidates(target)\n    } else {\n      this.#hideCandidates()\n    }\n  }\n\n  #stopPropagation = (evt: Event) =>\n  {\n    evt.preventDefault()\n    evt.stopPropagation()\n  }\n\n  #onClickOutSide = () =>\n  {\n    this.#hideCandidates()\n    this.#closeMenu()\n  }\n\n  #addListeners(): void\n  {\n    this.#smartGuideElement.addEventListener(\"pointerdown\", this.#stopPropagation.bind(this))\n    this.#ellipsisElement.addEventListener(\"pointerdown\", this.#onClickEllipsis.bind(this))\n    this.#convertElement.addEventListener(\"pointerdown\", this.#onClickConvert.bind(this))\n    this.#copyElement.addEventListener(\"pointerdown\", this.#onClickCopy.bind(this))\n    this.#deleteElement.addEventListener(\"pointerdown\", this.#onClickDelete.bind(this))\n    this.#prompterTextElement.addEventListener(\"pointerdown\", this.#onClickPrompter.bind(this))\n    this.#candidatesElement.addEventListener(\"pointerdown\", this.#onClickCandidate.bind(this))\n    document.addEventListener(\"pointerdown\", this.#onClickOutSide.bind(this))\n  }\n\n  #removeListeners(): void\n  {\n    this.#smartGuideElement.addEventListener(\"pointerdown\", this.#stopPropagation)\n    this.#ellipsisElement.removeEventListener(\"pointerdown\", this.#onClickEllipsis)\n    this.#convertElement.removeEventListener(\"pointerdown\", this.#onClickConvert)\n    this.#copyElement.removeEventListener(\"pointerdown\", this.#onClickCopy)\n    this.#deleteElement.removeEventListener(\"pointerdown\", this.#onClickDelete)\n    this.#prompterTextElement.removeEventListener(\"pointerdown\", this.#onClickPrompter)\n    this.#candidatesElement.removeEventListener(\"pointerdown\", this.#onClickCandidate)\n    document.removeEventListener(\"pointerdown\", this.#onClickOutSide)\n  }\n\n  resize(): void\n  {\n    this.#logger.info(\"resize\")\n    const marginLeft = convertMillimeterToPixel(this.margin.left)\n    const marginRight = convertMillimeterToPixel(this.margin.right)\n    this.#wrapperElement.style.marginLeft = `${ marginLeft }px`\n    this.#wrapperElement.style.marginRight = `${ marginRight }px`\n  }\n\n  update(exports: TJIIXExport): void\n  {\n    this.#logger.info(\"update\", { exports })\n    this.jiix = exports\n    const createWordSpan = (index: number, word?: TJIIXWord) =>\n    {\n      const span = document.createElement(\"span\")\n      span.id = `word-${ index }${ this.uuid }`\n      if (word) {\n        span.textContent = word.label\n      } else {\n        span.innerHTML = \"&nbsp;\"\n      }\n      this.#logger.debug(\"update\", { span })\n      return span\n    }\n\n    const populatePrompter = () =>\n    {\n      this.#logger.info(\"populatePrompter\")\n      this.#prompterTextElement.innerHTML = \"\"\n      if (this.jiix?.words) {\n        const words = this.jiix.words as TJIIXWord[]\n        const myFragment = document.createDocumentFragment()\n        words.forEach((word, index) =>\n        {\n          if (word.label === \" \" || word.label.includes(\"\\n\")) {\n            myFragment.appendChild(createWordSpan(index))\n          } else if (index !== words.length - 1) {\n            myFragment.appendChild(createWordSpan(index, word))\n          } else {\n            this.#prompterTextElement.appendChild(myFragment)\n            if (this.lastWord) {\n              this.lastWord = word\n            }\n            const span = createWordSpan(index, word)\n            // This is used to scroll to last word if last word is modified\n\n            if ((this.lastWord?.candidates !== word.candidates) && (this.lastWord?.label !== word.label)) {\n              this.lastWord = word\n            }\n            if (this.wordToChange?.id === index.toString()) {\n              span.classList.add(\"modified-word\")\n              this.wordToChange = undefined\n            }\n            else {\n              span.classList.add(\"added-word\")\n            }\n            this.#prompterTextElement.appendChild(span)\n            this.#prompterContainerElement.scrollLeft = span.offsetLeft\n            this.#logger.debug(\"update => populatePrompter\", { span, lastWord: this.lastWord })\n          }\n        })\n      }\n    }\n    populatePrompter()\n    if (this.jiix?.words?.length) {\n      this.#ellipsisElement.style.setProperty(\"pointer-events\", \"auto\")\n    }\n    else {\n      this.#ellipsisElement.style.setProperty(\"pointer-events\", \"none\")\n    }\n  }\n\n  clear(): void\n  {\n    this.#logger.info(\"clear\")\n    this.#prompterTextElement.innerHTML = \"\"\n    this.#candidatesElement.innerHTML = \"\"\n  }\n\n  destroy(): void\n  {\n    this.#logger.info(\"destroy\")\n    this.#removeListeners()\n    this.#smartGuideElement.remove()\n  }\n}\n","\nimport style from \"./iink.css\"\nimport { IBehaviors, OIBehaviors, RestBehaviors, TBehaviorOptions, WSBehaviors } from \"./behaviors\"\nimport { SmartGuide } from \"./smartguide\"\nimport { DeferredPromise, PartialDeep, mergeDeep } from \"./utils\"\nimport { LoggerClass, LoggerManager } from \"./logger\"\nimport { Intention } from \"./Constants\"\nimport { DefaultLoggerConfiguration, TConfiguration, TConverstionState, TLoggerConfiguration, TMarginConfiguration } from \"./configuration\"\nimport { ExportType, IModel, TExport, TJIIXExport } from \"./model\"\nimport { TSymbol, TStroke } from \"./primitive\"\nimport { InternalEvent, PublicEvent } from \"./event\"\nimport { TUndoRedoContext } from \"./history\"\nimport { IGrabber } from \"./grabber\"\nimport { TPenStyle, TTheme } from \"./style\"\n\n/**\n * @group Editor\n */\nexport type HTMLEditorElement = HTMLElement &\n{\n  editor: Editor\n}\n\n/**\n * @group Editor\n */\nexport class Editor\n{\n  logger = LoggerManager.getLogger(LoggerClass.EDITOR)\n  wrapperHTML: HTMLEditorElement\n  #layerInfos!: HTMLDivElement\n  #loaderHTML!: HTMLDivElement\n\n  #messageContainer!: HTMLDivElement\n  #messageModal!: HTMLDivElement\n  #messageOverlay!: HTMLDivElement\n  #messageText!: HTMLParagraphElement\n\n  #stateHTML!: HTMLDivElement\n  #busyHTML!: HTMLDivElement\n  #idleHTML!: HTMLDivElement\n  #behaviors!: IBehaviors\n  #smartGuide?: SmartGuide\n  #initializationDeferred: DeferredPromise<void>\n\n  #loggerConfiguration!: TLoggerConfiguration\n\n  constructor(wrapperHTML: HTMLElement, options: PartialDeep<TBehaviorOptions>, globalClassCss = \"ms-editor\")\n  {\n    this.#initializationDeferred = new DeferredPromise<void>()\n    this.loggerConfiguration = mergeDeep({}, options.logger, DefaultLoggerConfiguration)\n    this.logger.info(\"constructor\", { wrapperHTML, options, globalClassCss })\n\n    this.wrapperHTML = wrapperHTML as HTMLEditorElement\n    this.wrapperHTML.classList.add(globalClassCss)\n    this.wrapperHTML.classList.add(\"draw\")\n    this.events.setElement(this.wrapperHTML)\n\n    const styleElement = document.createElement(\"style\")\n    styleElement.appendChild(document.createTextNode(style as string))\n    this.wrapperHTML.appendChild(styleElement)\n\n    this.wrapperHTML.appendChild(this.#createLayerInfos())\n\n    this.#instantiateBehaviors(options)\n  }\n\n  get loggerConfiguration(): TLoggerConfiguration\n  {\n    return this.#loggerConfiguration\n  }\n\n  set loggerConfiguration(loggerConfig: TLoggerConfiguration)\n  {\n    this.#loggerConfiguration = Object.assign({}, DefaultLoggerConfiguration, loggerConfig)\n    LoggerManager.setLoggerLevel(this.#loggerConfiguration)\n  }\n\n  get initializationPromise(): Promise<void>\n  {\n    return this.#initializationDeferred.promise\n  }\n\n  get model(): IModel\n  {\n    return this.behaviors.model\n  }\n\n  get behaviors(): IBehaviors\n  {\n    return this.#behaviors\n  }\n\n  get configuration(): TConfiguration\n  {\n    return this.behaviors.configuration\n  }\n  set configuration(configuration: TConfiguration)\n  {\n    this.logger.info(\"set configuration\", { configuration })\n    this.#instantiateBehaviors({ configuration })\n    this.initialize()\n  }\n\n  get intention(): Intention\n  {\n    return this.behaviors.intention\n  }\n  set intention(i: Intention)\n  {\n    this.logger.info(\"set intention\", i)\n    this.behaviors.intention = i\n    this.#setCursorIntention()\n  }\n\n  get events(): PublicEvent\n  {\n    return PublicEvent.getInstance()\n  }\n\n  get internalEvents(): InternalEvent\n  {\n    return InternalEvent.getInstance()\n  }\n\n  get context(): TUndoRedoContext\n  {\n    return this.behaviors.history.context\n  }\n\n  get grabber(): IGrabber\n  {\n    return this.behaviors.grabber\n  }\n\n  get currentPenStyle(): TPenStyle\n  {\n    return this.behaviors.currentPenStyle\n  }\n\n  get penStyle(): TPenStyle\n  {\n    return this.behaviors.penStyle\n  }\n  set penStyle(ps: PartialDeep<TPenStyle>)\n  {\n    this.logger.info(\"set penStyle\", { ps })\n    this.behaviors.setPenStyle(ps)\n  }\n\n  get theme(): TTheme\n  {\n    return this.behaviors.theme\n  }\n  set theme(theme: PartialDeep<TTheme>)\n  {\n    this.logger.info(\"set theme\", { t: theme })\n    this.behaviors.setTheme(theme)\n  }\n\n  get penStyleClasses(): string\n  {\n    return this.behaviors.penStyleClasses\n  }\n  set penStyleClasses(styleClasses: string)\n  {\n    this.logger.info(\"set penStyleClasses\", { psc: styleClasses })\n    this.behaviors.setPenStyleClasses(styleClasses)\n  }\n\n  #setCursorIntention(): void\n  {\n    switch (this.behaviors.intention) {\n      case Intention.Erase:\n        this.wrapperHTML.classList.remove(\"draw\")\n        this.wrapperHTML.classList.add(\"erase\")\n        this.wrapperHTML.classList.remove(\"select\")\n        break\n      case Intention.Select:\n        this.wrapperHTML.classList.remove(\"draw\")\n        this.wrapperHTML.classList.remove(\"erase\")\n        this.wrapperHTML.classList.add(\"select\")\n        break\n      default:\n        this.wrapperHTML.classList.add(\"draw\")\n        this.wrapperHTML.classList.remove(\"erase\")\n        this.wrapperHTML.classList.remove(\"select\")\n        break\n    }\n  }\n\n  #createLoader(): HTMLDivElement\n  {\n    this.#loaderHTML = document.createElement(\"div\")\n    this.#loaderHTML.classList.add(\"loader\")\n    this.#loaderHTML.style.display = \"none\"\n    return this.#loaderHTML\n  }\n\n  #createMessage(): HTMLDivElement\n  {\n    this.#messageContainer = document.createElement(\"div\")\n    this.#messageContainer.classList.add(\"message-container\")\n    this.#messageContainer.style.display = \"none\"\n\n    this.#messageOverlay = document.createElement(\"div\")\n    this.#messageOverlay.classList.add(\"message-overlay\")\n    this.#messageContainer.appendChild(this.#messageOverlay)\n\n    this.#messageModal = document.createElement(\"div\")\n    this.#messageModal.classList.add(\"message-modal\")\n\n    const closeBtn = document.createElement(\"button\")\n    closeBtn.classList.add(\"ms-button\", \"close\")\n    closeBtn.addEventListener(\"pointerup\", () => this.closeMessageModal())\n    this.#messageModal.appendChild(closeBtn)\n\n    this.#messageText = document.createElement(\"p\")\n    this.#messageModal.appendChild(this.#messageText)\n    this.#messageContainer.appendChild(this.#messageModal)\n    return this.#messageContainer\n  }\n\n  #createEditorState(): HTMLDivElement\n  {\n    this.#stateHTML = document.createElement(\"div\")\n    this.#stateHTML.classList.add(\"state\")\n    this.#idleHTML = document.createElement(\"div\")\n    this.#idleHTML.textContent = \"idle\"\n    this.#idleHTML.style.display = \"block\"\n    this.#stateHTML.appendChild(this.#idleHTML)\n    this.#busyHTML = document.createElement(\"div\")\n    this.#busyHTML.classList.add(\"busy\")\n    this.#busyHTML.style.display = \"none\"\n    this.#stateHTML.appendChild(this.#busyHTML)\n    this.#stateHTML.style.display = \"none\"\n    return this.#stateHTML\n  }\n\n  #updateEditorState(idle: boolean): void\n  {\n    if (this.configuration.offscreen) {\n      this.#stateHTML.style.display = \"block\"\n      if (idle) {\n        this.#idleHTML.style.display = \"block\"\n        this.#busyHTML.style.display = \"none\"\n      }\n      else {\n        this.#idleHTML.style.display = \"none\"\n        this.#busyHTML.style.display = \"block\"\n      }\n    }\n    else {\n      this.#stateHTML.style.display = \"none\"\n    }\n  }\n\n  #createLayerInfos(): HTMLDivElement\n  {\n    this.#layerInfos = document.createElement(\"div\")\n    this.#layerInfos.classList.add(\"ms-layer-infos\")\n    this.#layerInfos.appendChild(this.#createLoader())\n    this.#layerInfos.appendChild(this.#createMessage())\n    this.#layerInfos.appendChild(this.#createEditorState())\n    return this.#layerInfos\n  }\n\n  #instantiateBehaviors(options: PartialDeep<TBehaviorOptions>)\n  {\n    this.logger.info(\"instantiateBehaviors\", { options })\n    if (!options?.configuration) {\n      throw new Error(\"Configuration required\")\n    }\n    this.internalEvents.removeAllListeners()\n    if (this.#behaviors) {\n      this.#behaviors.destroy()\n    }\n    if (options.configuration.offscreen) {\n      this.#behaviors = new OIBehaviors(options, this.#layerInfos)\n    }\n    else if (options.configuration.server?.protocol === \"REST\") {\n      this.#behaviors = new RestBehaviors(options)\n    } else {\n      this.#behaviors = new WSBehaviors(options)\n    }\n    this.logger.debug(\"instantiateBehaviors\", this.#behaviors)\n  }\n\n  async #initializeBehaviors(): Promise<void>\n  {\n    this.logger.info(\"initializeBehaviors\", \"start\")\n    this.#initializationDeferred = new DeferredPromise<void>()\n    this.#loaderHTML.style.display = \"initial\"\n    this.closeMessageModal()\n    return this.behaviors.init(this.wrapperHTML)\n      .then(async () =>\n      {\n        this.logger.info(\"initializeBehaviors\", \"then\")\n        this.wrapperHTML.editor = this\n        this.#initializationDeferred.resolve()\n        this.events.emitLoaded()\n      })\n      .catch((error: Error) =>\n      {\n        this.logger.error(\"initializeBehaviors\", error)\n        this.#initializationDeferred.reject(error)\n        this.showError(error)\n      })\n      .finally(() =>\n      {\n        this.logger.debug(\"initializeBehaviors\", \"finally\")\n        this.#loaderHTML.style.display = \"none\"\n        this.#updateEditorState(true)\n        return this.#initializationDeferred.promise\n      })\n  }\n\n  #initializeSmartGuide(): void\n  {\n    this.#smartGuide?.destroy()\n    this.logger.info(\"initializeSmartGuide\", { smartGuide: this.configuration.rendering.smartGuide })\n    if (this.configuration.rendering.smartGuide.enable) {\n      this.#smartGuide = new SmartGuide()\n      let margin: TMarginConfiguration\n      switch (this.configuration.recognition.type) {\n        case \"TEXT\":\n          margin = this.configuration.recognition.text.margin\n          break\n        case \"MATH\":\n          margin = this.configuration.recognition.math.margin\n          break\n        default:\n          margin = {\n            top: 20,\n            left: 10,\n            right: 10,\n            bottom: 10\n          }\n          break\n      }\n      this.#smartGuide.init(this.#layerInfos, margin, this.configuration.rendering)\n    }\n  }\n\n  async closeMessageModal(): Promise<void>\n  {\n    this.#messageContainer.style.display = \"none\"\n    this.#messageText.innerText = \"\"\n    if (this.#messageModal.classList.contains(\"error-msg\")) {\n      this.#messageModal.classList.remove(\"error-msg\")\n      await this.behaviors.destroy()\n      this.initialize()\n    }\n  }\n\n  showError(err: Error | string)\n  {\n    this.#messageModal.classList.add(\"error-msg\")\n    this.#messageModal.classList.remove(\"info-msg\")\n    this.#messageContainer.style.display = \"block\"\n    this.#messageText.innerText = typeof err === \"string\" ? err : err.message\n  }\n\n  showNotif(notif: { message: string, timeout?: number })\n  {\n    this.#messageModal.classList.add(\"info-msg\")\n    this.#messageModal.classList.remove(\"error-msg\")\n    this.#messageContainer.style.display = \"block\"\n    this.#messageText.innerText = notif.message\n    setTimeout(() =>\n    {\n      this.closeMessageModal()\n    }, notif.timeout || 2500)\n  }\n\n  #addInternalListeners(): void\n  {\n    this.internalEvents.removeAllListeners()\n    this.internalEvents.addConvertListener(this.convert.bind(this))\n    this.internalEvents.addClearListener(this.clear.bind(this))\n    this.internalEvents.addErrorListener(this.showError.bind(this))\n    this.internalEvents.addNotifListener(this.showNotif.bind(this))\n    this.internalEvents.addClearMessageListener(this.closeMessageModal.bind(this))\n    this.internalEvents.addImportJIIXListener(this.#onImportJIIX.bind(this))\n    this.internalEvents.addExportedListener(this.#onExport.bind(this))\n    this.internalEvents.addContextChangeListener(this.#onContextChange.bind(this))\n    this.internalEvents.addIdleListener(this.#onIdleChange.bind(this))\n    this.internalEvents.addSelectedListener(this.#onSelectionChange.bind(this))\n    this.internalEvents.addIntentionListener(this.#onIntentionChange.bind(this))\n  }\n\n  #onSelectionChange = (symbols: TSymbol[]) =>\n  {\n    this.events.emitSelected(symbols)\n  }\n\n  #onIntentionChange = (intention: Intention) =>\n  {\n    this.intention = intention\n    this.events.emitIntention(intention)\n  }\n\n  #onContextChange = (context: TUndoRedoContext) =>\n  {\n    this.events.emitChanged(context)\n  }\n\n  #onIdleChange = (idle: boolean) =>\n  {\n    this.#updateEditorState(idle)\n    this.events.emitIdle(idle)\n  }\n\n  #onExport(exports: TExport): void\n  {\n    this.logger.info(\"onExport\", { exports })\n    if (this.configuration.rendering.smartGuide.enable) {\n      if (exports && exports[\"application/vnd.myscript.jiix\"]) {\n        const jjix = exports[\"application/vnd.myscript.jiix\"] as TJIIXExport\n        this.#smartGuide?.update(jjix)\n      }\n    }\n    this.events.emitExported(exports)\n  }\n\n  #onImportJIIX(jiix: TJIIXExport): void\n  {\n    this.logger.info(\"onImportJIIX\", { jiix })\n    this.import(new Blob([JSON.stringify(jiix)], { type: ExportType.JIIX }), ExportType.JIIX)\n  }\n\n  async initialize(): Promise<void>\n  {\n    this.logger.info(\"initialize\")\n    this.#addInternalListeners()\n    await this.#initializeBehaviors()\n    this.#initializeSmartGuide()\n  }\n\n  async waitForIdle(): Promise<void>\n  {\n    if (this.behaviors.waitForIdle) {\n      return this.behaviors.waitForIdle()\n    }\n    return\n  }\n\n  async undo(): Promise<IModel>\n  {\n    this.logger.info(\"undo\")\n    await this.#initializationDeferred.promise\n    await this.behaviors.undo()\n    this.logger.debug(\"undo\", this.model)\n    return this.model\n  }\n\n  async redo(): Promise<IModel>\n  {\n    this.logger.info(\"redo\")\n    await this.#initializationDeferred.promise\n    await this.behaviors.redo()\n    this.logger.debug(\"redo\", this.model)\n    return this.model\n  }\n\n  async clear(): Promise<IModel>\n  {\n    this.logger.info(\"clear\")\n    await this.#initializationDeferred.promise\n    await this.behaviors.clear()\n    this.events.emitCleared(this.model)\n    this.logger.debug(\"clear\", this.model)\n    return this.model\n  }\n\n  async resize(): Promise<IModel>\n  {\n    this.logger.info(\"resize\")\n    await this.#initializationDeferred.promise\n    if (this.configuration.rendering.smartGuide.enable) {\n      this.#smartGuide?.resize()\n    }\n    const compStyles = window.getComputedStyle(this.wrapperHTML)\n    const height = Math.max(parseInt(compStyles.height.replace(\"px\", \"\")), this.configuration.rendering.minHeight)\n    const width = Math.max(parseInt(compStyles.width.replace(\"px\", \"\")), this.configuration.rendering.minWidth)\n    await this.behaviors.resize(height, width)\n    this.logger.debug(\"resize\", this.model)\n    return this.model\n  }\n\n  async export(mimeTypes?: string[]): Promise<IModel>\n  {\n    this.logger.info(\"export\", { mimeTypes })\n    await this.#initializationDeferred.promise\n    await this.behaviors.export(mimeTypes)\n    this.logger.debug(\"export\", this.model)\n    return this.model\n  }\n\n  async convert(params?: { conversionState?: TConverstionState, mimeTypes?: string[] }): Promise<IModel | never>\n  {\n    this.logger.info(\"export\", { params })\n    await this.#initializationDeferred.promise\n    await this.behaviors.convert(params?.conversionState, params?.mimeTypes)\n    this.events.emitConverted(this.model.converts as TExport)\n    this.logger.debug(\"convert\", this.model)\n    return this.model\n  }\n\n  async import(data: Blob | string | TJIIXExport, mimeType?: string): Promise<IModel | never>\n  {\n    this.logger.info(\"import\", { data, mimeType })\n    await this.#initializationDeferred.promise\n    if (this.behaviors.import) {\n      let blobToImport: Blob\n      if (data instanceof Blob) {\n        blobToImport = data\n      }\n      else if (typeof data === \"string\") {\n        blobToImport = new Blob([data])\n      }\n      else {\n        blobToImport = new Blob([JSON.stringify(data)])\n      }\n      await this.behaviors.import(blobToImport, mimeType)\n      this.events.emitImported(this.model.exports as TExport)\n      this.logger.debug(\"import\", this.model)\n      return this.model\n    }\n    return Promise.reject(\"Import impossible, behaviors has no import function\")\n  }\n\n  async importPointEvents(strokes: PartialDeep<TStroke>[]): Promise<IModel>\n  {\n    this.logger.info(\"importPointEvents\", { strokes })\n    await this.#initializationDeferred.promise\n    await this.behaviors.importPointEvents(strokes)\n    this.events.emitImported(this.model.exports as TExport)\n    this.logger.debug(\"importPointEvents\", this.model)\n    return this.model\n    return Promise.reject(\"Import impossible, behaviors has no importPointEvents function\")\n  }\n}\n","import { TConfiguration } from \"../configuration\"\nimport { PartialDeep } from \"./types\"\n\n/**\n * @group Utils\n */\nexport async function getAvailableFontList(configuration: PartialDeep<TConfiguration>): Promise<Array<string>>\n{\n  if (!configuration?.server?.scheme && !configuration?.server?.host) {\n    return Promise.reject(\"Failed to get fonts: configuration.server.scheme & configuration.server.host are required!\")\n  }\n  if (!configuration?.recognition?.lang) {\n    return Promise.reject(\"Failed to get fonts: configuration.recognition.lang is required!\")\n  }\n  const serverConfig = configuration.server\n  const response = await fetch(`${ serverConfig.scheme }://${ serverConfig.host }/api/v4.0/iink/font/google/language/` + configuration.recognition.lang)\n  const { result } = await response.json()\n  return result.sort()\n}\n"],"names":["Intention","WriteTool","SvgElementRole","ResizeDirection","exports","SELECTION_MARGIN","LoggerLevel","LoggerClass","Logger","constructor","instanceName","level","this","debug","functionName","data","DEBUG","dataLog","from","message","console","info","INFO","warn","WARN","error","LoggerManager","getLogger","name","__classPrivateFieldGet","_a","_LoggerManager_loggerMap","has","set","ERROR","get","setLoggerLevel","config","Object","keys","forEach","lc","value","Map","DeferredPromise","isFullFilled","isPending","promise","Promise","resolve","reject","v","__awaiter","isValidNumber","x","isNaN","parseFloat","toString","isFinite","isBetween","val","min","max","computeAverage","arr","reduce","p","c","length","computeDistance","p1","p2","distance","Math","hypot","y","computeAngleAxeRadian","begin","end","atan2","scalaire","v1","v2","computeNearestPointOnSegment","seg","vectP1P","vectP1P2","scalaireP1P_P1P2","scalaireP1P2_P1P2","t","convertRadianToDegree","radian","PI","toFixed","convertDegreeToRadian","degree","computeRotatedPoint","point","center","dx","dy","cos","sin","computePointOnEllipse","radiusX","radiusY","phi","theta","cosPhi","sinPhi","M","abs","N","findIntersectionBetween2Segment","seg1","seg2","S1dx","S1dy","S2dx","S2dy","S1S2dx","S1S2dy","ua_t","ub_t","u_b","ua","ub","findIntersectBetweenSegmentAndCircle","r","result","a","pow","b","cc","deter","e","sqrt","u1","u2","push","computeAngleRadian","p1c","p2c","p1p2","acos","getClosestPoints","points1","points2","minDistance","Number","MAX_SAFE_INTEGER","_p1","_p2","d","getClosestPoint","points","closest","index","i","isPointInsidePolygon","inside","j","isVersionSuperiorOrEqual","source","target","sourceParts","split","targetParts","computeHmac","applicationKey","hmacKey","enc","TextEncoder","messageEncoded","encode","keyEncoded","key","crypto","subtle","importKey","hash","signature","sign","buffer","Uint8Array","Array","prototype","map","call","padStart","join","convertMillimeterToPixel","mm","convertBoundingBoxMillimeterToPixel","box","width","height","createUUID","dt","Date","now","replace","random","floor","mergeDeep","sources","isObject","item","isArray","shift","assign","concat","getAvailableLanguageList","configuration","server","scheme","_b","host","serverConfig","fetch","json","computeLinksPointers","angle","radius","computeMiddlePointer","point1","point2","DefaultListenerConfiguration","capture","passive","DefaultGrabberConfiguration","listenerOptions","xyFloatPrecision","timestampFloatPrecision","delayLongTouch","DefaultMenuConfiguration","enable","style","intention","action","context","DefaultEraserConfiguration","DefaultDiagramConvertConfiguration","types","DefaultDiagramConfiguration","convert","eraser","mimeTypes","DefaultJiixConfiguration","strokes","ids","text","chars","words","DefaultExportConfiguration","jiix","DefaultMarginConfiguration","top","left","right","bottom","DefaultSolverConfiguration","DefaultMathUndoRedoConfiguration","mode","DefaultMathConfiguration","solver","margin","DefaultRawContentConfiguration","recognition","gestures","DefaultDebugConfiguration","DefaultRecognitionRendererConfiguration","DefaultTextGuidesConfiguration","DefaultTextConfiguration","guides","DefaultConvertionConfiguration","force","DefaultRecognitionConfiguration","diagram","export","math","renderer","type","alwaysConnected","lang","gesture","ignoreGestureStrokes","DefaultGuidesConfiguration","gap","DefaultSmartGuidesConfiguration","DefaultRenderingConfiguration","smartGuide","minHeight","minWidth","DefaultServerConfiguration","protocol","version","useWindowLocation","websocket","pingEnabled","pingDelay","maxPingLostCount","autoReconnect","maxRetryCount","fileChunkSize","DefaultTriggerConfiguration","exportContent","exportContentDelay","resizeTriggerDelay","DefaultUndoRedoConfiguration","maxStackSize","DefaultConfiguration","offscreen","grabber","rendering","triggers","menu","Configuration","_Configuration_logger","CONFIGURATION","structuredClone","overrideDefaultConfiguration","defaultConf","Boolean","_d","_c","_f","_e","_h","_g","_j","_l","_k","_o","_m","_p","_q","window","location","indexOf","includes","DefaultLoggerConfiguration","EDITOR","BEHAVIORS","RECOGNIZER","GRABBER","RENDERER","PUBLIC_EVENT","INTERNAL_EVENT","MODEL","SYMBOL","SMARTGUIDE","GESTURE","STYLE","HISTORY","TRANSFORMER","CONVERTER","WRITE","SELECTION","SVGDEBUG","MENU","InternalEventType","EventType","ExportType","JIIXELementType","JIIXNodeKind","JIIXEdgeKind","DecoratorKind","InternalEvent","EventTarget","super","_InternalEvent_abortController","_InternalEvent_logger","__classPrivateFieldSet","AbortController","getInstance","_InternalEvent_instance","removeAllListeners","abort","emitSVGPatch","patchChange","_InternalEvent_instances","_InternalEvent_emit","SVG_PATCH","addSVGPatchListener","callback","addEventListener","evt","detail","signal","emitExported","EXPORTED","addExportedListener","emitClearMessage","CLEAR_MESSAGE","addClearMessageListener","emitError","err","addErrorListener","emitNotif","notif","NOTIF","addNotifListener","emitImportJIIX","IMPORT_JIIX","addImportJIIXListener","emitConvert","conversionState","CONVERT","addConvertListener","emitClear","CLEAR","addClearListener","emitContextChange","CONTEXT_CHANGE","addContextChangeListener","emitIdle","idle","IDLE","addIdleListener","emitSelected","symbols","SELECTED","addSelectedListener","emitIntention","INTENTION","addIntentionListener","WeakMap","WeakSet","dispatchEvent","CustomEvent","bubbles","composed","undefined","PublicEvent","_PublicEvent_element","_PublicEvent_logger","_PublicEvent_instance","setElement","el","emitLoaded","LOADED","_PublicEvent_instances","_PublicEvent_emit","emitChanged","undoRedoContext","CHANGED","canClear","empty","emitCleared","model","CLEARED","emitConverted","CONVERTED","emitImported","IMPORTED","OIPointerEventGrabber","_OIPointerEventGrabber_logger","prevent","preventDefault","pointerDownHandler","button","buttons","activePointerId","pointerId","onPointerDown","extractPoint","pointerMoveHandler","onPointerMove","pointerUpHandler","stopPropagation","onPointerUp","pointerOutHandler","domElement","contains","contextMenuHandler","onContextMenu","roundFloat","oneFloat","requestedFloatPrecision","floatPrecision","round","event","clientX","clientY","changedTouches","rect","getBoundingClientRect","pointer","clientLeft","scrollLeft","clientTop","scrollTop","pressure","stopPointerEvent","attach","detach","removeEventListener","PointerEventGrabber","_PointerEventGrabber_logger","classList","document","documentElement","Box","boundindBox","Error","createFromBoxes","boxes","createFromPoints","getCorners","getCenter","getSides","vertices","isContained","wrapper","containsPoint","child","overlaps","box1","box2","xMin","xMid","xMax","yMin","yMid","yMax","corners","snapPoints","boundaries","OIDecorator","kind","id","clone","DefaultStyle","color","opacity","fill","DefaultPenStyle","DefaultTheme","ink","module","o","n","l","m","defineProperty","configurable","enumerable","__esModule","default","hasOwnProperty","s","TypeError","Symbol","iterator","toJSON","u","trim","substring","_trimSemiColon","toCSS","slice","parser","JsonCSS","StyleHelper","themeToCSS","themeToJSON","theme","penStyleToCSS","penStyle","css","penStyleToJSON","penStyleString","stringToJSON","JSONToString","entries","k","SymbolType","EdgeKind","ShapeKind","StyleManager","_StyleManager_penStyle","_StyleManager_theme","_StyleManager_penStyleClasses","_StyleManager_currentPenStyle","_StyleManager_logger","setTheme","setPenStyleClasses","setPenStyle","currentPenStyle","penStyleClasses","penStyleClass","MatrixTransform","xx","yx","xy","yy","tx","ty","identity","applyToPoint","mat","rotation","hypotAc","hypotBd","toCssString","matrix","invert","denom","multiply","translate","rotate","cosAngle","sinAngle","scale","OISymbolBase","creationTime","modificationDate","selected","deleting","transform","edges","isClosed","isIntersected","some","edge","EdgeDecoration","OIEdgeBase","startDecoration","endDecoration","Edge","bounds","bb","e1","e2","isValidPoint","OIEdgeArc","startAngle","sweepAngle","Arc","_vertices","verticesId","computedVertices","nbVertices","angleStep","endAngle","at","create","partial","arc","OIEdgeLine","start","Line","line","OIEdgePolyLine","PolyEdge","polyline","OIShapeBase","Shape","OIShapeEllipse","orientation","Ellipse","perimeter","nbPoint","createBetweenPoints","origin","updateBetweenPoints","ellipse","OIShapeCircle","Circle","_bounds","computedBondingBox","firstPoint","rad","boundingBox","circle","OIShapePolygon","Polygon","polygon","createTriangleBetweenPoints","updateTriangleBetweenPoints","poly","createParallelogramBetweenPoints","updateParallelogramBetweenPoints","createRectangleBetweenPoints","updateRectangleBetweenPoints","createRhombusBetweenPoints","updateRhombusBetweenPoints","OIStroke","pointerType","Stroke","pointers","decorators","strokeToSplit","before","after","substract","stroke","partStroke","lastPointBeforeStroke","closestLastPointBeforeStroke","newStrokes","strokeAfter","firstPointAfterStroke","closestFirstPointStrokeAfter","computePressure","ratio","filterPointByAcquisitionDelta","lastPointer","delta","addPointer","formatToSend","errors","flag","pp","pIndex","convertPartialStrokesToOIStrokes","OISymbolGroup","children","Group","flatMap","updateChildrenStyle","Text","containsSymbol","strokeId","containsOnlyStroke","extractSymbols","extractStrokes","removeChilds","symbolIds","group","every","filter","symbolId","symbol","s1","JSON","parse","stringify","OIText","label","offsetY","getCharCorners","char","boxBox","getCharsOverlaps","charCorners","OIEraser","Eraser","RecognizerError","TOIMessageType","Model","rowHeight","creationDate","_Model_logger","positions","lastSentPosition","lastReceivedPosition","globalDistance","getStrokeFromPoint","_strokeList","strokePointer","addPoint","addStroke","converts","updateStroke","updatedStroke","strokeIndex","findIndex","splice","removeStroke","removeStrokesFromPoint","strokeToRemove","extractUnsentStrokes","initCurrentStroke","dpi","pxWidth","currentSymbol","appendToCurrentStroke","endCurrentStroke","updatePositionSent","position","updatePositionReceived","mergeExport","mergeConvert","clonedModel","clear","OIModel","_OIModel_logger","symbolsSelected","symbolsToDelete","selectSymbol","find","unselectSymbol","resetSelection","getRootSymbol","getSymbolRowIndex","getSymbolsByRowOrdered","rows","rowIndex","row","sort","s2","r1","r2","roundToLineGuide","isSymbolAbove","isSymbolInRow","isSymbolBelow","getFirstSymbol","previous","current","getLastSymbol","addSymbol","updateSymbol","updatedSymbol","sIndex","replaceSymbol","changeOrderSymbol","fromIndex","toIndex","sym","removeSymbol","symbolIndex","extractDifferenceSymbols","added","removed","OIRecognizer","recognitionConfig","_OIRecognizer_logger","pingCount","reconnectionCount","serverConfiguration","recognitionConfiguration","url","exportDeferredMap","contextlessGestureDeferred","connected","initialized","rejectDeferredPending","addStrokeDeferred","transformStrokeDeferred","eraseStrokeDeferred","replaceStrokeDeferred","undoDeferred","redoDeferred","clearDeferred","values","waitForIdleDeferred","resetAllDeferred","closeDeferred","clearSocketListener","socket","openCallback","bind","closeCallback","messageCallback","reason","currentErrorCode","code","GOING_AWAY","PROTOCOL_ERROR","UNSUPPORTED_DATA","ABNORMAL_CLOSURE","INVALID_FRAME_PAYLOAD","POLICY_VIOLATION","MESSAGE_TOO_BIG","INTERNAL_ERROR","SERVICE_RESTART","TRY_AGAIN","BAD_GATEWAY","TLS_HANDSHAKE","CANT_ESTABLISH","pingWorker","terminate","_OIRecognizer_instances","_OIRecognizer_send","manageHMACChallenge","hmacChallengeMessage","hmac","hmacChallenge","initPing","PingWorker","postMessage","onmessage","close","manageAuthenticated","pixelTomm","sessionId","iinkSessionId","scaleX","scaleY","manageSessionDescriptionMessage","sessionDescriptionMessage","currentPartId","contentType","manageNewPartMessage","newPartMessage","managePartChangeMessage","partChangeMessage","partId","manageContentChangedMessage","contentChangeMessage","canRedo","canUndo","manageExportMessage","exportMessage","manageWaitForIdle","manageErrorMessage","errorMessage","UNKNOW","NO_ACTIVITY","timeout","Infinity","WRONG_CREDENTIALS","TOO_OLD","NO_SESSION_FOUND","manageGestureDetected","gestureMessage","manageContextlessGesture","websocketMessage","Pong","HMAC_Challenge","Authenticated","SessionDescription","NewPart","PartChanged","ContentChanged","Exported","GestureDetected","ContextlessGesture","Idle","init","WebSocket","send","readyState","CONNECTING","OPEN","CLOSING","CLOSED","waitForIdle","buildAddStrokesMessage","processGestures","addStrokes","buildReplaceStrokesMessage","oldStrokeIds","replaceStrokes","buildTransformTranslateMessage","strokeIds","transformationType","transformTranslate","buildTransformRotateMessage","x0","y0","transformRotate","buildTransformScaleMessage","transformScale","buildTransformMatrixMessage","transformMatrix","buildEraseStrokesMessage","eraseStrokes","recognizeGesture","buildUndoRedoChanges","changes","changesMessages","erased","replaced","oldStrokes","tr","undo","actions","redo","requestedMimeTypes","all","mt","destroy","RestRecognizer","_RestRecognizer_logger","postConfig","buildData","strokeGroupByPenStyle","groupIndex","sg","isPenStyleEqual","ps1","ps2","strokeGroupsToSend","newGroup","charAt","toUpperCase","toLowerCase","xDPI","yDPI","strokeGroups","post","mimeType","headers","Headers","append","reqInit","method","body","request","Request","response","ok","blob","catch","tryFetch","then","res","getMimeTypes","myModel","dataToConcert","promises","String","mimeTypesRequiringExport","resize","WSRecognizer","_WSRecognizer_logger","toLocaleLowerCase","internalEvent","infinitePing","setTimeout","params","xDpi","yDpi","viewSizeHeight","viewSizeWidth","exportDeferred","convertDeferred","importDeferred","resizeDeferred","_r","_s","_t","_u","_v","manageAckMessage","ackDeferred","manageContentPackageDescriptionMessage","importPointEventsDeferred","manageContentChangeMessage","stackIndex","undoStackIndex","possibleUndoCount","manageSVGPatchMessage","svgPatchMessage","styleClasses","localModel","import","chunkSize","importFileId","readBlob","fileReader","FileReader","onloadend","ev","onerror","readAsText","importFileMessage","size","blobPart","fileChuckMessage","lastChunk","importPointEvents","events","exportPoints","myExportConverted","undoExports","redoExports","clearExports","CanvasRendererShape","_CanvasRendererShape_logger","table","returnedAngle","drawEllipseArc","context2D","shapeEllipse","centerPoint","maxRadius","minRadius","z1","z2","z3","z4","boundariesPoints","save","beginPath","alpha","cosAlpha","sinAlpha","moveTo","lineTo","restore","drawLine","drawArrowHead","headPoint","beta","fillStyle","strokeStyle","drawShapeEllipse","beginDecoration","beginTangentAngle","endTangentAngle","drawShapeLine","shapeLine","lastPoint","draw","lineWidth","lines","CanvasRendererStroke","_CanvasRendererStroke_logger","renderArc","context2d","renderLine","linkPoints1","linkPoints2","renderFinal","linkPoints","newAngle","renderQuadratic","ctrl","linkPoints3","quadraticCurveTo","NUMBER_POINTS","NUMBER_QUADRATICS","secondPoint","beginLine","endLine","beginFinal","endFinal","closePath","CanvasRendererText","_CanvasRendererText_logger","string","textLine","drawUnderline","textUnderline","underline","topLeftPoint","firstCharacter","lastCharacter","drawText","font","textHeight","textAlign","justificationType","textBaseline","fillText","drawTextLine","underlineList","CanvasRenderer","_CanvasRenderer_logger","strokeRenderer","shapeRenderer","textRenderer","createCanvas","canvas","createElement","add","resizeContent","pixelRatio","devicePixelRatio","renderingCanvas","capturingCanvas","parentNode","clientWidth","clientHeight","getContext","drawSymbol","element","appendChild","parent","renderingCanvasContext","capturingCanvasContext","drawModel","clearRect","drawPendingStroke","innerHTML","OISVGRendererConst","arrowHeadStartMarker","arrowHeadEndMaker","selectionFilterId","removalFilterId","crossMarker","noSelection","XMLNS","SVGBuilder","createLayer","attrs","svgEl","createElementNS","setAttribute","createFilter","createDefs","createMarker","marker","createComponentTransfert","createDropShadow","deviation","shadow","createTransfertFunctionTable","feFunc","createGroup","groupEl","createLine","lineEl","createCircle","circleEl","createPath","pathEl","createPolygon","polygonEl","createRect","rectEl","createTSpan","tSpanEl","textContent","createForeignObject","node","objEl","createText","textEl","OISVGRendererEdgeUtil","getLinePath","getPolyLinePath","getArcPath","getSVGPath","getSVGElement","pathAttrs","Arrow","OISVGRendererEraserUtil","strokeWith","middlePoints","acc","shadowBlur","OISVGRendererDecoratorUtil","decorator","Highlight","Surround","Strikethrough","Underline","OISVGRendererShapeUtil","getPolygonePath","getCirclePath","getEllipsePath","shape","OISVGRendererStrokeUtil","getFinalPath","parts","getQuadraticPath","central","STROKE_LENGTH","STROKE_WIDTH","NB_QUADRATICS","beforeLastPoint","strokeGroup","strokeAttrs","deco","prepend","OISVGRendererTextUtil","textGroup","textElement","fontSize","fontWeight","OISVGRendererGroupUtil","getChildElement","symbolGroup","SurroundAction","StrikeThroughAction","InsertAction","OISVGRenderer","_OISVGRenderer_logger","groupGuidesId","verticalGuides","horizontalGuides","initLayer","layer","setProperty","createSVGTools","defs","REFX","SIZE","REFY","arrowHeadMarkerAttrs","markerWidth","markerHeight","refX","refY","arrowHeadStart","orient","arrowHeadEnd","crossMarkerAttrs","viewBox","cross","createFilters","filtersGroup","removalFilter","filterUnits","bfeComponentTransfer","bfeFuncA","selectionFilter","drawGuides","getAttribute","offSet","subOffSet","role","Guide","guidesGroup","svgLine","subY","subX","svgPoint","Set","definitionGroup","removeGuides","querySelector","remove","oncontextmenu","buildElementFromSymbol","prependElement","symbolToMove","moveEl","insertAdjacentElement","nextElementSibling","previousElementSibling","appendElement","removeElement","oldStroke","oldNode","replaceWith","elements","drawCircle","drawRect","drawConnectionBetweenBox","attrsLine","getElementById","getElements","tagName","query","querySelectorAll","clearElements","firstChild","SVGStroker","buildSVGPath","drawStroke","svgElement","svgPathElement","svgPath","WSSVGRenderer","_WSSVGRenderer_logger","stroker","replaceAll","layerName","update","oldLayer","insertAdjacentHTML","svg","pendingStrokesGroup","replaceElement","elementToRemove","parentSelector","parentId","removeChild","insertBefore","refId","selector","removeAttribute","updateLayer","updatesLayer","updates","clearPendingStroke","pendingStrokeGroup","clearErasingStrokes","erasingStroke","svgList","OIConversionManager","behaviors","fontStyle","_OIConversionManager_logger","weight","computeFontSize","buildChar","grid","buildWord","word","charSymbols","charStrokes","items","g","hightlight","strikethrough","surround","convertText","onlyText","jiixWords","jiixChars","textBounds","isNewLine","currentY","currentX","texter","getSpaceWidth","wordStrokes","textSymbol","nbRow","setBounds","buildCircle","cx","cy","buildEllipse","rx","ry","buildRectangle","rectangle","buildPolygon","buildRhombus","buildTriangle","buildParallelogram","convertNode","associatedStroke","uniqStrokes","Rectangle","Triangle","Parallelogram","Rhombus","buildLine","x1","y1","x2","y2","p1Decoration","p2Decoration","buildPolyEdge","unshift","buildArc","convertEdge","apply","removeSelectedGroup","strokesToConvert","extractStrokesFromSymbols","conversionResults","conversion","addSymbols","cs","removeSymbols","history","OIGestureManager","gestureAction","_OIGestureManager_logger","insertAction","LineBreak","surroundAction","Select","strikeThroughAction","Draw","strikeThrough","insert","recognizer","translator","currentStyle","styler","strokeSpaceWidth","applySurroundGesture","gestureStroke","select","symWithDec","highlight","computeScratchOnStrokes","partPointersToRemove","subStrokes","ss","fullStrokeId","strokePartToErase","computeScratchOnText","charsToRemove","cIndex","c1","updateBounds","computeScratchOnSymbol","strokesScratchedResult","childrenNotTouch","results","symbolsGroup","textScratchedResult","applyScratch","symbolsToUpdate","symbolsToErase","symbolsToReplace","oldSymbols","newSymbols","updateSymbols","updated","replaceSymbols","applyJoinGesture","symbolsAbove","symbolsRow","symbolsBeforeGestureInRow","symbolsOnGestureInRow","symbolsAfterGestureInRow","symbolsBelow","symbolToJoin","childBefore","childAfter","applyToSymbol","symbolsAfterNextRow","lastSymbBefore","firstSymbolAfter","translateX","lastSymbBeforeClone","firstSymbolAfterClone","symbolsToGroup","texts","d1","rest","lastSymbolBeforeGesture","firstSymbolAfterGesture","symbolInNextRow","lastSymbolAbove","createStrokesFromGestureSubStroke","strokeOrigin","subStroke","computeSplitStroke","computeSplitStrokeInGroup","newGroups","groupSymbols","symbolsBefore","symbolsAfter","strokeIdToSplit","gs","computeChangesOnSplitStroke","symbolToSplit","computeChangesOnSplitGroup","groupToSplit","groupSymbolsBefore","groupsSymbolsAfter","groupBefore","grouAfter","computeChangesOnSplitText","textToSplit","charsBefore","charsAfter","newTexts","textBefore","pointAfter","textAfter","applyInsertGesture","Insert","applyUnderlineGesture","applyStrikeThroughGesture","Erase","updateSymbolsStyle","groupStrokesByJIIXElement","gestureType","svgDebugger","getGestureFromContextLess","gestureStrokeId","strokeAfterIds","strokeBeforeIds","symbolsToUnderline","symbolsToStrikeThrough","OIResizeManager","_OIResizeManager_logger","keepRatio","applyToStroke","applyToShape","applyToEdge","applyOnText","applyOnGroup","setTransformOrigin","originX","originY","scaleElement","sx","sy","interactElementsGroup","InteractElementsGroup","direction","transformOrigin","hideInteractElements","localPoint","horizontalResize","verticalResize","snaps","snapResize","deltaX","deltaY","continue","clearSnapToElementLines","strokesFromSymbols","resetSelectedGroup","showInteractElements","OIRotationManager","_OIRotationManager_logger","angleRad","rotateElement","angleDegree","snapRotation","OISelectionManager","_OISelectionManager_logger","_OISelectionManager_selectingId","rotator","resizer","selectionBox","startSelectionPoint","endSelectionPoint","drawSelectingRect","clearSelectingRect","getPoint","createTranslateRect","Translate","boxWithMarge","translateEl","handler","endHandler","createRotateGroup","Rotate","attrs1","attrs2","attrs3","createResizeGroup","Resize","P_NW","P_NE","P_SE","P_SW","bindEl","def","lineResize","cornerResize","createInteractElementsGroup","symbolElementMap","surroundGroup","SURROUND_ATTRS","drawSelectedGroup","selectedGroup","groupBox","getBBox","show","hide","updatedSymbols","OISnapManager","options","_OISnapManager_logger","snapToElement","snapToGrid","snapAngle","selectionSnapPoints","otherSnapPoints","selectSymbolIds","snapThreshold","getNearestVerticalGuide","prev","curr","getNearestHorizontalGuide","getGuidePointToSnap","drawSnapToElementLines","getSnapLinesInfos","sourcePoints","targetPoints","infos","nudge","verticales","horizontales","horizontal","vertical","snapLines","snapLinesInfos","snapTranslate","selectionSymbolPoints","lastDeltaX","lastDeltaY","gridPoint","OITextManager","_OITextManager_logger","drawSymbolHidden","setCharsBounds","textGroupEl","getNumberOfChars","ext","getExtentOfChar","getElementBoundingBox","markers","clipped","getBoundingBox","charSymbol","moveTextAfter","textsAfter","OITranslateManager","_OITranslateManager_logger","addToHistory","translateElement","OIWriteManager","_OIWriteManager_logger","_OIWriteManager_tool","Pencil","detectGesture","tool","wt","unselectAll","gestureManager","needContextLessGesture","strokeBoundsWithMargin","subS","createCurrentSymbol","DoubleArrow","updateCurrentSymbol","updateCurrentSymbolShape","currentSymbolOrigin","updateCurrentSymbolEdge","localPointer","interactWithBackend","localStroke","gestureFromContextLess","pop","localSymbol","OIEraseManager","_OIEraseManager_logger","currentEraser","lastSeg","OIDebugSVGManager","_OIDebugSVGManager_logger","_OIDebugSVGManager_snapPointsVisibility","_OIDebugSVGManager_verticesVisibility","_OIDebugSVGManager_boundingBoxVisibility","_OIDebugSVGManager_recognitionBoxVisibility","_OIDebugSVGManager_recognitionItemBoxVisibility","snapPointsVisibility","debugSnapPoints","verticesVisibility","debugVertices","boundingBoxVisibility","showBoundingBox","hideBoundingBox","recognitionBoxVisibility","debugRecognitionBox","recognitionItemBoxVisibility","debugRecognitionItemBox","showSnapPoints","hideSnapPoints","showVertices","hideVertices","drawBoundingBox","symbolAttrs","charAttrs","symEl","ca","sa","debugBoundingBox","drawRecognitionBox","COLOR","recognitionGroup","infosGroup","infoX","infoY","TEXT_HEIGHT","w","infosGroupBox","rectBox","rectTranslate","newRectBox","showRecognitionBox","hideProperties","candidates","inf","clearRecognitionBox","drawRecognitionItemBox","recognitionItemGroup","charX","charY","charsGroup","charsGroupBox","showRecognitionItemBox","clearRecognitionItemBox","OIMenu","thicknessList","fontSizeList","fontWeightList","colors","createToolTip","tooltipContent","createWrapCollapsible","title","head","btn","ArrowDown","content","toggle","createSeparatorHorizontal","separator","createSeparatorVertical","createMenuItemBoolean","labelEl","checkbox","disabled","initValue","indeterminate","checked","createMenuItemSelect","opt","Option","createMenuItemButton","icon","tooltip","createMenuItemButtonList","createMenuItemColorList","createColorList","list","colorEl","createMenuItem","OIMenuSub","param","trigger","menuTitle","menuTitleElement","subMenu","open","unwrap","display","wrap","OIMenuAction","_OIMenuAction_logger","guideGaps","isMobile","createMenuClear","menuClear","createMenuLanguage","triggerBtn","languages","changeLanguage","menuLanguage","createMenuUndo","menuUndo","createMenuRedo","menuRedo","createMenuConvert","menuConvert","createMenuGesture","subMenuWrapper","surroundActionValues","strikeThroughActionValues","splitActionValues","writer","Write","createMenuGuide","renderingConfiguration","createMenuSnap","createMenuDebug","menuItems","createMenuExport","downloadAsJson","downloadAsSVG","downloadAsPNG","readFileAsText","file","reader","onload","createMenuImport","importInput","accept","multiple","importBtn","files","innerText","fileString","createSymbols","closeAllSubMenu","render","menuTrigger","visibility","lastChild","OIMenuIntention","_OIMenuIntention_logger","createMenuWrite","writeBtn","createMenuMove","menuMove","Move","createMenuSelect","menuSelect","createMenuErase","menuErase","createShapeSubMenu","subMenuShape","menuShape","subMenuContent","nextSibling","createMenuShape","rectangleIcon","triangle","rhombus","createEdgeSubMenu","square","subMenuEdge","menuEdge","createMenuEdge","lineIcon","arrow","doubleArrow","_w","_x","_z","_y","_0","OIMenuStyle","_OIMenuStyle_logger","writeShape","createMenuStroke","symbolsStyles","hasUniqColor","st","menuColorStrokeDef","menuColor","menuColorStroke","createMenuColorFill","menuColorFill","createMenuThickness","hasUniqWidth","menuThickness","createMenuFontSize","converter","textSymbols","updateTextFontStyle","menuFontSize","createMenuFontWeight","menuFontWeight","createMenuOpacity","hasUniqOpacity","currentOpacity","input","output","menuStrokeOpacity","shapeSelected","OIMenuContext","_OIMenuContext_logger","haveSymbolsSelected","symbolsDecorable","showDecorator","createMenuEdit","editInput","editSaveBtn","firstChar","editMenu","createMenuDuplicate","duplicateBtn","duplicatedSymbols","createMenuGroup","groupBtn","ungroupSymbol","convertBtn","updateLayerInfos","createMenuRemove","removeBtn","createMenuReorder","changeOrderSymbols","reverse","reorderMenu","createDecoratorSubMenu","labelEL","decoIndex","decoratorMenu","createMenuDecorator","menuExport","createMenuSelectAll","selectAll","updateDecoratorSubMenu","removeProperty","decos","btnToActivate","updateGroupMenu","parentElement","OIMenuManager","custom","_OIMenuManager_logger","CustomMenuStyle","CustomMenuIntention","CustomMenuAction","OIMoveManager","getInitialUndoRedoContext","HistoryManager","_HistoryManager_logger","stack","updateContext","updateStack","previousModel","nextModel","OIHistoryManager","_OIHistoryManager_logger","isChangesEmpty","order","ungroup","reverseChanges","reversedChanges","currentStackItem","previousStackItem","nextStackItem","OIBehaviors","layerInfos","_OIBehaviors_logger","_OIBehaviors_configuration","_OIBehaviors_model","_OIBehaviors_intention","_OIBehaviors_layerInfosTimer","snap","move","clearTimeout","found","currentEl","symbolTypesAllowed","createShape","partialShape","createEdge","partialEdge","partialGroup","partialSymbol","createStroke","createSymbol","partialSymbols","symList","lastWidth","textIds","tc","symbolsTranslated","firstSym","orginDeco","orginStyle","wordSymb","wd","strokesAssociated","groupStrokeIds","symbolsToRemove","strokesIds","gr","partialStrokes","triggerDownload","fileName","urlData","downloadAnchorNode","click","getSymbolsBounds","buildBlobFromSymbols","svgNode","cloneNode","svgString","XMLSerializer","serializeToString","Blob","getExportName","extension","year","month","day","hour","minute","second","toLocaleDateString","navigator","language","selection","svgBlob","URL","createObjectURL","image","Image","src","drawImage","revokeObjectURL","imgURI","toDataURL","symbolsToExport","dataStr","encodeURIComponent","extractBackendChanges","backendChanges","modifications","actionsToBackend","RestBehaviors","_RestBehaviors_logger","_RestBehaviors_configuration","_RestBehaviors_model","_RestBehaviors_resizeTimer","_RestBehaviors_exportTimer","styleManager","CustomGrabber","CustomRecognizer","drawCurrentStroke","_evt","updateModelRendering","deferred","currentModel","newModel","deferredResize","resizeModel","WSBehaviors","_WSBehaviors_logger","_WSBehaviors_configuration","_WSBehaviors_model","_WSBehaviors_resizeTimer","penClass","onExport","synchronizeModelWithBackend","onSVGPatch","compStyles","getComputedStyle","parseInt","unsentStrokes","strokesToImport","str","SmartGuide","_SmartGuide_smartGuideElement","_SmartGuide_wrapperElement","_SmartGuide_prompterContainerElement","_SmartGuide_prompterTextElement","_SmartGuide_ellipsisElement","_SmartGuide_tagElement","_SmartGuide_candidatesElement","_SmartGuide_menuElement","_SmartGuide_convertElement","_SmartGuide_copyElement","_SmartGuide_deleteElement","_SmartGuide_isMenuOpen","_SmartGuide_logger","_SmartGuide_showCandidates","wordId","uuid","wordToChange","_SmartGuide_onClickEllipsis","_SmartGuide_instances","_SmartGuide_hideCandidates","_SmartGuide_onClickConvert","_SmartGuide_closeMenu","_SmartGuide_onClickCopy","fakeEl","_SmartGuide_selectText","execCommand","_SmartGuide_onClickDelete","_SmartGuide_onClickCandidate","candidate","_SmartGuide_onClickPrompter","_SmartGuide_stopPropagation","_SmartGuide_onClickOutSide","_SmartGuide_createRootElement","_SmartGuide_createWrapperElement","_SmartGuide_createPrompterContainerElement","_SmartGuide_createPrompterTextElement","_SmartGuide_createEllipsisElement","_SmartGuide_createTagElement","_SmartGuide_createCandidatesElement","_SmartGuide_createMoreMenuElement","_SmartGuide_createConvertElement","_SmartGuide_createCopyElement","_SmartGuide_createDeleteElement","_SmartGuide_addListeners","marginLeft","marginRight","createWordSpan","span","myFragment","createDocumentFragment","lastWord","offsetLeft","populatePrompter","_SmartGuide_removeListeners","_SmartGuide_openMenu","isRTL","textArea","yPosition","pageYOffset","userAgent","match","range","createRange","selectNodeContents","getSelection","removeAllRanges","addRange","setSelectionRange","wrapperHTML","_Editor_createLoader","_Editor_loaderHTML","_Editor_createMessage","_Editor_messageOverlay","closeBtn","closeMessageModal","_Editor_messageModal","_Editor_messageText","_Editor_messageContainer","_Editor_createEditorState","_Editor_idleHTML","_Editor_busyHTML","_Editor_stateHTML","_Editor_createLayerInfos","_Editor_layerInfos","_Editor_instances","logger","internalEvents","_Editor_behaviors","_Editor_initializeBehaviors","_Editor_initializationDeferred","editor","showError","finally","_Editor_updateEditorState","_Editor_smartGuide","_Editor_addInternalListeners","showNotif","_Editor_onImportJIIX","_Editor_onExport","_Editor_onContextChange","_Editor_onIdleChange","_Editor_onSelectionChange","_Editor_onIntentionChange","jjix","JIIX","Editor","globalClassCss","_Editor_loggerConfiguration","loggerConfiguration","styleElement","createTextNode","_Editor_instantiateBehaviors","loggerConfig","initializationPromise","initialize","_Editor_setCursorIntention","ps","psc","_Editor_initializeSmartGuide","blobToImport","computeDistanceBetweenPointAndSegment","convertPartialStrokesToStrokes","ji","convertPixelToMillimeter","px","createPointsOnSegment","spaceBetweenPoint","spaceWithP1","getAvailableFontList","isPointInsideBox"],"mappings":"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","x_google_ignoreList":[41]}